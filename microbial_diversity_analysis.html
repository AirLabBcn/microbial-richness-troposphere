<!DOCTYPE html>

<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head>
<meta charset="utf-8"/>
<meta content="quarto-1.6.4" name="generator"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
<meta content="Alejandro Fontal" name="author"/>
<meta content="2024-08-02" name="dcterms.date"/>
<title>Microbial Richness in the Troposphere: Appeal Reanalysis â€“ Microbial Richness in the Troposphere</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>
<script crossorigin="anonymous" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta content="./" name="quarto:offset"/>
<link href="./assets/favicon.ico" rel="icon"/>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet"/>
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" id="quarto-text-highlighting-styles" rel="stylesheet"/>
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet"/>
<link data-mode="light" href="site_libs/bootstrap/bootstrap.min.css" id="quarto-bootstrap" rel="stylesheet"/>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script crossorigin="anonymous" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<link href="custom.css" rel="stylesheet"/>
</head>
<body class="nav-fixed">
<div id="quarto-search-results"></div>
<header class="headroom fixed-top" id="quarto-header">
<nav class="navbar navbar-expand-lg" data-bs-theme="dark">
<div class="navbar-container container-fluid">
<div class="navbar-brand-container mx-auto">
<a class="navbar-brand" href="./index.html">
<span class="navbar-title">Microbial Richness in the Troposphere</span>
</a>
</div>
<div class="" id="quarto-search" title="Search"></div>
<button aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#navbarCollapse" data-bs-toggle="collapse" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }" role="menu" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarCollapse">
<ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
<a class="nav-link" href="./index.qmd">
<span class="menu-text">Home</span></a>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="nav-menu-reports" role="link">
<span class="menu-text">Reports</span>
</a>
<ul aria-labelledby="nav-menu-reports" class="dropdown-menu">
<li>
<a class="dropdown-item" href="./microbial_diversity_analysis.html">
<span class="dropdown-text">Diversity analysis</span></a>
</li>
<li>
<a class="dropdown-item" href="./flights.html">
<span class="dropdown-text">Flights GPS</span></a>
</li>
</ul>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="nav-menu-about" role="link">
<span class="menu-text">About</span>
</a>
<ul aria-labelledby="nav-menu-about" class="dropdown-menu">
<li>
<a class="dropdown-item" href="https://www.isglobal.org/en">
<span class="dropdown-text">ISGlobal</span></a>
</li>
<li class="dropdown-header">Climate &amp; Health Programme</li>
<li>
<a class="dropdown-item" href="https://ginys.cerca.cat/en/facility/airlab/">
<span class="dropdown-text">AIRLAB</span></a>
</li>
</ul>
</li>
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="nav-menu-bi-github" role="link">
<i class="bi bi-github" role="img">
</i>
<span class="menu-text"></span>
</a>
<ul aria-labelledby="nav-menu-bi-github" class="dropdown-menu dropdown-menu-end">
<li>
<a class="dropdown-item" href="https://github.com/Airlabbcn/microbial-richness-troposphere">
<span class="dropdown-text">GitHub Repository</span></a>
</li>
<li>
<a class="dropdown-item" href="https://github.com/Airlabbcn/microbial-richness-troposphere/issues/new">
<span class="dropdown-text">Raise an issue</span></a>
</li>
</ul>
</li>
<li class="nav-item compact">
<a class="nav-link" href="mailto:alejandro.fontal.92@gmail.com"> <i aria-label="Mail" class="bi bi-envelope" role="img">
</i>
<span class="menu-text"></span></a>
</li>
</ul>
</div> <!-- /navcollapse -->
<div class="quarto-navbar-tools">
</div>
</div> <!-- /container-fluid -->
</nav>
</header>
<!-- content -->
<div class="quarto-container page-columns page-rows-contents page-layout-article page-navbar" id="quarto-content">
<!-- sidebar -->
<!-- margin-sidebar -->
<div class="sidebar margin-sidebar" id="quarto-margin-sidebar">
<nav class="toc-active" id="TOC" role="doc-toc">
<h2 id="toc-title">CONTENTS</h2>
<ul>
<li><a class="nav-link active" data-scroll-target="#preamble" href="#preamble" id="toc-preamble">Preamble</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#imports" href="#imports" id="toc-imports">Imports</a></li>
<li><a class="nav-link" data-scroll-target="#pre-sets" href="#pre-sets" id="toc-pre-sets">Pre-sets</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#data-loading-and-wrangling" href="#data-loading-and-wrangling" id="toc-data-loading-and-wrangling">Data Loading and Wrangling</a></li>
<li><a class="nav-link" data-scroll-target="#analysis-figures" href="#analysis-figures" id="toc-analysis-figures">Analysis &amp; Figures</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#sampling-schedule" href="#sampling-schedule" id="toc-sampling-schedule">Sampling Schedule</a></li>
<li><a class="nav-link" data-scroll-target="#abundance-comparisons" href="#abundance-comparisons" id="toc-abundance-comparisons">Abundance comparisons</a></li>
<li><a class="nav-link" data-scroll-target="#metagenomics-identification-rate" href="#metagenomics-identification-rate" id="toc-metagenomics-identification-rate">Metagenomics identification rate</a></li>
<li><a class="nav-link" data-scroll-target="#exclusive-otus-per-sample-type" href="#exclusive-otus-per-sample-type" id="toc-exclusive-otus-per-sample-type">Exclusive OTUs per sample type</a></li>
<li><a class="nav-link" data-scroll-target="#filtering-for-correlation-analysis" href="#filtering-for-correlation-analysis" id="toc-filtering-for-correlation-analysis">Filtering for correlation analysis</a></li>
<li><a class="nav-link" data-scroll-target="#diversity-per-sample" href="#diversity-per-sample" id="toc-diversity-per-sample">Diversity per sample</a></li>
<li><a class="nav-link" data-scroll-target="#distance-between-samples-nmds-and-permanova" href="#distance-between-samples-nmds-and-permanova" id="toc-distance-between-samples-nmds-and-permanova">Distance between samples (nMDS and PERMANOVA)</a></li>
<li><a class="nav-link" data-scroll-target="#barplots" href="#barplots" id="toc-barplots">Barplots</a></li>
<li><a class="nav-link" data-scroll-target="#correlation-with-heavy-metals" href="#correlation-with-heavy-metals" id="toc-correlation-with-heavy-metals">Correlation with heavy metals</a></li>
<li><a class="nav-link" data-scroll-target="#pathogen-bubble-plots" href="#pathogen-bubble-plots" id="toc-pathogen-bubble-plots">Pathogen bubble plots</a></li>
<li><a class="nav-link" data-scroll-target="#re-sequencing-nov23" href="#re-sequencing-nov23" id="toc-re-sequencing-nov23">Re-sequencing Novâ€™23</a></li>
</ul></li>
</ul>
</nav>
</div>
<!-- main -->
<main class="content" id="quarto-document-content">
<header class="quarto-title-block default" id="title-block-header">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Microbial Richness in the Troposphere: Appeal Reanalysis</h1><button aria-expanded="false" class="btn code-tools-button dropdown-toggle" data-bs-toggle="dropdown" id="quarto-code-tools-menu" type="button"><i class="bi"></i> Code</button><ul aria-labelelledby="quarto-code-tools-menu" class="dropdown-menu dropdown-menu-end"><li><a class="dropdown-item" href="javascript:void(0)" id="quarto-show-all-code" role="button">Show All Code</a></li><li><a class="dropdown-item" href="javascript:void(0)" id="quarto-hide-all-code" role="button">Hide All Code</a></li></ul></div></div>
<p class="subtitle lead">Data Analysis and Figures</p>
</div>
<div class="quarto-title-meta-author">
<div class="quarto-title-meta-heading">Author</div>
<div class="quarto-title-meta-heading">Affiliation</div>
<div class="quarto-title-meta-contents">
<p class="author">Alejandro Fontal <a class="quarto-title-author-email" href="mailto:alejandro.fontal@isglobal.org"><i class="bi bi-envelope"></i></a> <a class="quarto-title-author-orcid" href="https://orcid.org/0000-0003-1138-2158"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="/></a></p>
</div>
<div class="quarto-title-meta-contents">
<p class="affiliation">
            Climate &amp; Health Program, ISGlobal
          </p>
</div>
</div>
<div class="quarto-title-meta">
<div>
<div class="quarto-title-meta-heading">Published</div>
<div class="quarto-title-meta-contents">
<p class="date">August 2, 2024</p>
</div>
</div>
</div>
</header>
<details>
<summary>
Click to show library imports and pre-sets
</summary>
<section class="level2" id="preamble">
<h2 class="anchored" data-anchor-id="preamble">Preamble</h2>
<section class="level3" id="imports">
<h3 class="anchored" data-anchor-id="imports">Imports</h3>
<div class="cell" data-execution_count="1" id="cell-4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3" tabindex="-1"></a><span class="im">import</span> plotnine <span class="im">as</span> p9</span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5" tabindex="-1"></a><span class="im">import</span> skbio.diversity <span class="im">as</span> div</span>
<span id="cb1-6"><a aria-hidden="true" href="#cb1-6" tabindex="-1"></a><span class="im">from</span> skbio <span class="im">import</span> DistanceMatrix</span>
<span id="cb1-7"><a aria-hidden="true" href="#cb1-7" tabindex="-1"></a><span class="im">from</span> skbio.stats.distance <span class="im">import</span> permanova</span>
<span id="cb1-8"><a aria-hidden="true" href="#cb1-8" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image</span>
<span id="cb1-9"><a aria-hidden="true" href="#cb1-9" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a aria-hidden="true" href="#cb1-10" tabindex="-1"></a><span class="im">from</span> mizani.formatters <span class="im">import</span> percent_format</span>
<span id="cb1-11"><a aria-hidden="true" href="#cb1-11" tabindex="-1"></a><span class="im">from</span> matplotlib_inline.backend_inline <span class="im">import</span> set_matplotlib_formats</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="level3" id="pre-sets">
<h3 class="anchored" data-anchor-id="pre-sets">Pre-sets</h3>
<div class="cell" data-execution_count="2" id="cell-6">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1" tabindex="-1"></a><span class="co"># Matplotlib settings</span></span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a><span class="im">from</span> matplotlib_inline.backend_inline <span class="im">import</span> set_matplotlib_formats</span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3" tabindex="-1"></a>plt.rcParams[<span class="st">'svg.fonttype'</span>] <span class="op">=</span> <span class="st">'none'</span></span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4" tabindex="-1"></a>set_matplotlib_formats(<span class="st">'retina'</span>)</span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.dpi'</span>] <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6" tabindex="-1"></a><span class="co"># Plotnine settings (for figures)</span></span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7" tabindex="-1"></a>p9.theme_set(</span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8" tabindex="-1"></a>    p9.theme_bw()</span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9" tabindex="-1"></a>    <span class="op">+</span> p9.theme(panel_grid<span class="op">=</span>p9.element_blank(),</span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10" tabindex="-1"></a>               legend_background<span class="op">=</span>p9.element_blank(),</span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11" tabindex="-1"></a>               panel_grid_major<span class="op">=</span>p9.element_line(size<span class="op">=</span><span class="fl">.5</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>,</span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12" tabindex="-1"></a>                                                alpha<span class="op">=</span><span class="fl">.15</span>, color<span class="op">=</span><span class="st">'black'</span>),</span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13" tabindex="-1"></a>               dpi<span class="op">=</span><span class="dv">300</span></span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14" tabindex="-1"></a>    )</span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4" id="cell-7">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1" tabindex="-1"></a>bac_df <span class="op">=</span> (pd.read_csv(<span class="st">'../data/metagenomics/16S_genus_NB90.csv'</span>)</span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a>          .query(<span class="st">'Order != "Chloroplast"'</span>)</span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a>          .query(<span class="st">'Kingdom.notna()'</span>)</span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5" id="cell-8">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1" tabindex="-1"></a>sample_columns <span class="op">=</span> bac_df.columns[<span class="dv">6</span>:]</span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2" tabindex="-1"></a>zfill_map <span class="op">=</span> {s: <span class="st">'S'</span> <span class="op">+</span> s[<span class="dv">1</span>:].zfill(<span class="dv">2</span>) <span class="cf">for</span> s <span class="kw">in</span> sample_columns}</span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3" tabindex="-1"></a>sample_columns <span class="op">=</span> sample_columns.<span class="bu">map</span>(zfill_map)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6" id="cell-9">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1" tabindex="-1"></a>taxon_names <span class="op">=</span> [</span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2" tabindex="-1"></a>    <span class="st">'Kingdom'</span>, </span>
<span id="cb5-3"><a aria-hidden="true" href="#cb5-3" tabindex="-1"></a>    <span class="st">'Phylum'</span>, </span>
<span id="cb5-4"><a aria-hidden="true" href="#cb5-4" tabindex="-1"></a>    <span class="st">'Class'</span>, </span>
<span id="cb5-5"><a aria-hidden="true" href="#cb5-5" tabindex="-1"></a>    <span class="st">'Order'</span>, </span>
<span id="cb5-6"><a aria-hidden="true" href="#cb5-6" tabindex="-1"></a>    <span class="st">'Family'</span>, </span>
<span id="cb5-7"><a aria-hidden="true" href="#cb5-7" tabindex="-1"></a>    <span class="st">'Genus'</span>]</span>
<span id="cb5-8"><a aria-hidden="true" href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a aria-hidden="true" href="#cb5-9" tabindex="-1"></a>taxon_plurals <span class="op">=</span> {</span>
<span id="cb5-10"><a aria-hidden="true" href="#cb5-10" tabindex="-1"></a>    <span class="st">'Phylum'</span>: <span class="st">'Phyla'</span>,</span>
<span id="cb5-11"><a aria-hidden="true" href="#cb5-11" tabindex="-1"></a>    <span class="st">'Class'</span>: <span class="st">'Classes'</span>,</span>
<span id="cb5-12"><a aria-hidden="true" href="#cb5-12" tabindex="-1"></a>    <span class="st">'Order'</span>: <span class="st">'Orders'</span>,</span>
<span id="cb5-13"><a aria-hidden="true" href="#cb5-13" tabindex="-1"></a>    <span class="st">'Family'</span>: <span class="st">'Families'</span>,</span>
<span id="cb5-14"><a aria-hidden="true" href="#cb5-14" tabindex="-1"></a>    <span class="st">'Genus'</span>: <span class="st">'Genera'</span>}</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7" id="cell-10">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a aria-hidden="true" href="#cb6-1" tabindex="-1"></a>bac_df <span class="op">=</span> bac_df.rename(columns<span class="op">=</span>zfill_map).fillna(<span class="st">'unknown'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8" id="cell-11">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a aria-hidden="true" href="#cb7-1" tabindex="-1"></a>fun_df <span class="op">=</span> (pd.read_csv(<span class="st">'../data/metagenomics/ITS_genus_NB90.csv'</span>)</span>
<span id="cb7-2"><a aria-hidden="true" href="#cb7-2" tabindex="-1"></a>          .query(<span class="st">'Kingdom == "k__Fungi"'</span>)</span>
<span id="cb7-3"><a aria-hidden="true" href="#cb7-3" tabindex="-1"></a>)</span>
<span id="cb7-4"><a aria-hidden="true" href="#cb7-4" tabindex="-1"></a>fun_df[taxon_names] <span class="op">=</span> fun_df[taxon_names].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb7-5"><a aria-hidden="true" href="#cb7-5" tabindex="-1"></a>fun_df <span class="op">=</span> fun_df.rename(columns<span class="op">=</span>zfill_map).fillna(<span class="st">'unknown'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9" id="cell-12">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a aria-hidden="true" href="#cb8-1" tabindex="-1"></a>abundance_df_genera <span class="op">=</span> pd.concat([bac_df, fun_df])</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11" id="cell-13">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a aria-hidden="true" href="#cb9-1" tabindex="-1"></a>samples_info <span class="op">=</span> (pd.read_csv(<span class="st">'../data/metadata/samples_info.csv'</span>)</span>
<span id="cb9-2"><a aria-hidden="true" href="#cb9-2" tabindex="-1"></a>        .assign(sample_id <span class="op">=</span> <span class="kw">lambda</span> dd:  <span class="st">"S"</span> <span class="op">+</span> dd.sample_id.<span class="bu">str</span>[<span class="op">-</span><span class="dv">2</span>:])</span>
<span id="cb9-3"><a aria-hidden="true" href="#cb9-3" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12" id="cell-14">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a aria-hidden="true" href="#cb10-1" tabindex="-1"></a>inconclusive_list <span class="op">=</span> [<span class="st">'unknown'</span>,</span>
<span id="cb10-2"><a aria-hidden="true" href="#cb10-2" tabindex="-1"></a>                     <span class="st">'Cystobasidiomycetes_ord_Incertae_sedis'</span>,</span>
<span id="cb10-3"><a aria-hidden="true" href="#cb10-3" tabindex="-1"></a>                     <span class="st">'uncultured bacterium'</span>, <span class="st">'uncultured'</span>,</span>
<span id="cb10-4"><a aria-hidden="true" href="#cb10-4" tabindex="-1"></a>                     <span class="st">'uncultured Armatimonadetes bacterium'</span>,</span>
<span id="cb10-5"><a aria-hidden="true" href="#cb10-5" tabindex="-1"></a>                     <span class="st">'uncultured phototrophic eukaryote'</span>,</span>
<span id="cb10-6"><a aria-hidden="true" href="#cb10-6" tabindex="-1"></a>                     <span class="st">'Ambiguous_taxa'</span>,</span>
<span id="cb10-7"><a aria-hidden="true" href="#cb10-7" tabindex="-1"></a>                     <span class="st">'Hypocreales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-8"><a aria-hidden="true" href="#cb10-8" tabindex="-1"></a>                     <span class="st">'Polyporales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-9"><a aria-hidden="true" href="#cb10-9" tabindex="-1"></a>                     <span class="st">'Medicago truncatula (barrel medic)'</span>,</span>
<span id="cb10-10"><a aria-hidden="true" href="#cb10-10" tabindex="-1"></a>                     <span class="st">'Cantharellales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-11"><a aria-hidden="true" href="#cb10-11" tabindex="-1"></a>                     <span class="st">'Russulales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-12"><a aria-hidden="true" href="#cb10-12" tabindex="-1"></a>                     <span class="st">'uncultured Chloroflexi bacterium'</span>,</span>
<span id="cb10-13"><a aria-hidden="true" href="#cb10-13" tabindex="-1"></a>                     <span class="st">'uncultured soil bacterium'</span>,</span>
<span id="cb10-14"><a aria-hidden="true" href="#cb10-14" tabindex="-1"></a>                     <span class="st">'uncultured Chlorophyta'</span>,</span>
<span id="cb10-15"><a aria-hidden="true" href="#cb10-15" tabindex="-1"></a>                     <span class="st">'Pleosporales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-16"><a aria-hidden="true" href="#cb10-16" tabindex="-1"></a>                     <span class="st">'Xylariales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-17"><a aria-hidden="true" href="#cb10-17" tabindex="-1"></a>                     <span class="st">'Hymenochaetales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-18"><a aria-hidden="true" href="#cb10-18" tabindex="-1"></a>                     <span class="st">'Entylomatales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-19"><a aria-hidden="true" href="#cb10-19" tabindex="-1"></a>                     <span class="st">'Saccharomycetales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-20"><a aria-hidden="true" href="#cb10-20" tabindex="-1"></a>                     <span class="st">'Phytophthora lateralis MPF4'</span>,</span>
<span id="cb10-21"><a aria-hidden="true" href="#cb10-21" tabindex="-1"></a>                     <span class="st">'Helotiales_fam_Incertae_sedis'</span>,</span>
<span id="cb10-22"><a aria-hidden="true" href="#cb10-22" tabindex="-1"></a>                     <span class="st">'candidate division SR1 bacterium taxon 345'</span>,</span>
<span id="cb10-23"><a aria-hidden="true" href="#cb10-23" tabindex="-1"></a>                     <span class="st">'Neo-b11'</span>,</span>
<span id="cb10-24"><a aria-hidden="true" href="#cb10-24" tabindex="-1"></a>                     <span class="st">'gut'</span>,</span>
<span id="cb10-25"><a aria-hidden="true" href="#cb10-25" tabindex="-1"></a>                     <span class="st">'candidate'</span>,</span>
<span id="cb10-26"><a aria-hidden="true" href="#cb10-26" tabindex="-1"></a>                     <span class="st">'Chloroplast'</span></span>
<span id="cb10-27"><a aria-hidden="true" href="#cb10-27" tabindex="-1"></a>                     ]</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13" id="cell-15">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a aria-hidden="true" href="#cb11-1" tabindex="-1"></a>(abundance_df_genera</span>
<span id="cb11-2"><a aria-hidden="true" href="#cb11-2" tabindex="-1"></a> .replace(<span class="st">'unknown'</span>, np.nan)</span>
<span id="cb11-3"><a aria-hidden="true" href="#cb11-3" tabindex="-1"></a> .assign(total_counts<span class="op">=</span><span class="kw">lambda</span> dd: dd[sample_columns].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb11-4"><a aria-hidden="true" href="#cb11-4" tabindex="-1"></a> .query(<span class="st">'total_counts &gt; 0'</span>)</span>
<span id="cb11-5"><a aria-hidden="true" href="#cb11-5" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb11-6"><a aria-hidden="true" href="#cb11-6" tabindex="-1"></a>         np.where(dd[<span class="st">'Genus'</span>].isin(inconclusive_list), np.nan, dd[<span class="st">'Genus'</span>]))</span>
<span id="cb11-7"><a aria-hidden="true" href="#cb11-7" tabindex="-1"></a> .drop(columns<span class="op">=</span><span class="st">'total_counts'</span>)</span>
<span id="cb11-8"><a aria-hidden="true" href="#cb11-8" tabindex="-1"></a> .melt(id_vars<span class="op">=</span>taxon_names, var_name<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb11-9"><a aria-hidden="true" href="#cb11-9" tabindex="-1"></a> .merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb11-10"><a aria-hidden="true" href="#cb11-10" tabindex="-1"></a> .assign(date<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date))</span>
<span id="cb11-11"><a aria-hidden="true" href="#cb11-11" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: dd.date.dt.month_name())</span>
<span id="cb11-12"><a aria-hidden="true" href="#cb11-12" tabindex="-1"></a> .query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb11-13"><a aria-hidden="true" href="#cb11-13" tabindex="-1"></a> .query(<span class="st">'month=="February"'</span>)</span>
<span id="cb11-14"><a aria-hidden="true" href="#cb11-14" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>])</span>
<span id="cb11-15"><a aria-hidden="true" href="#cb11-15" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd[taxon_names[<span class="dv">1</span>:]].nunique())</span>
<span id="cb11-16"><a aria-hidden="true" href="#cb11-16" tabindex="-1"></a> .T</span>
<span id="cb11-17"><a aria-hidden="true" href="#cb11-17" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Kingdom</th>
<th data-quarto-table-cell-role="th">Bacteria</th>
<th data-quarto-table-cell-role="th">Fungi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Phylum</td>
<td>17</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Class</td>
<td>34</td>
<td>19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Order</td>
<td>72</td>
<td>60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Family</td>
<td>110</td>
<td>155</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Genus</td>
<td>160</td>
<td>234</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="14" id="cell-16">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a aria-hidden="true" href="#cb12-1" tabindex="-1"></a>abundance_df_phyla <span class="op">=</span> (abundance_df_genera</span>
<span id="cb12-2"><a aria-hidden="true" href="#cb12-2" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>])</span>
<span id="cb12-3"><a aria-hidden="true" href="#cb12-3" tabindex="-1"></a> [sample_columns]</span>
<span id="cb12-4"><a aria-hidden="true" href="#cb12-4" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb12-5"><a aria-hidden="true" href="#cb12-5" tabindex="-1"></a> .astype(<span class="bu">int</span>)</span>
<span id="cb12-6"><a aria-hidden="true" href="#cb12-6" tabindex="-1"></a> .reset_index()</span>
<span id="cb12-7"><a aria-hidden="true" href="#cb12-7" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16" id="cell-17">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a aria-hidden="true" href="#cb13-1" tabindex="-1"></a>only_assigned_bac_df <span class="op">=</span> bac_df.query(<span class="st">'Genus.notna()'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17" id="cell-18">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a aria-hidden="true" href="#cb14-1" tabindex="-1"></a>shannon_only_assigned <span class="op">=</span> (div.alpha_diversity(metric<span class="op">=</span><span class="st">'shannon'</span>,</span>
<span id="cb14-2"><a aria-hidden="true" href="#cb14-2" tabindex="-1"></a>                    counts<span class="op">=</span>only_assigned_bac_df[sample_columns].T.values,</span>
<span id="cb14-3"><a aria-hidden="true" href="#cb14-3" tabindex="-1"></a>                    ids<span class="op">=</span>sample_columns</span>
<span id="cb14-4"><a aria-hidden="true" href="#cb14-4" tabindex="-1"></a>                    ).rename(<span class="st">'shannon_only_assigned'</span>)</span>
<span id="cb14-5"><a aria-hidden="true" href="#cb14-5" tabindex="-1"></a>)</span>
<span id="cb14-6"><a aria-hidden="true" href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a aria-hidden="true" href="#cb14-7" tabindex="-1"></a>shannon_all <span class="op">=</span> (div.alpha_diversity(metric<span class="op">=</span><span class="st">'shannon'</span>,</span>
<span id="cb14-8"><a aria-hidden="true" href="#cb14-8" tabindex="-1"></a>                    counts<span class="op">=</span>bac_df[sample_columns].T.values,</span>
<span id="cb14-9"><a aria-hidden="true" href="#cb14-9" tabindex="-1"></a>                    ids<span class="op">=</span>sample_columns</span>
<span id="cb14-10"><a aria-hidden="true" href="#cb14-10" tabindex="-1"></a>                    ).rename(<span class="st">'shannon_all'</span>)</span>
<span id="cb14-11"><a aria-hidden="true" href="#cb14-11" tabindex="-1"></a>)</span>
<span id="cb14-12"><a aria-hidden="true" href="#cb14-12" tabindex="-1"></a></span>
<span id="cb14-13"><a aria-hidden="true" href="#cb14-13" tabindex="-1"></a>chao_only_assigned <span class="op">=</span> (div.alpha_diversity(metric<span class="op">=</span><span class="st">'chao1'</span>,</span>
<span id="cb14-14"><a aria-hidden="true" href="#cb14-14" tabindex="-1"></a>                    counts<span class="op">=</span>only_assigned_bac_df[sample_columns].T.values,</span>
<span id="cb14-15"><a aria-hidden="true" href="#cb14-15" tabindex="-1"></a>                    ids<span class="op">=</span>sample_columns</span>
<span id="cb14-16"><a aria-hidden="true" href="#cb14-16" tabindex="-1"></a>                    ).rename(<span class="st">'chao_only_assigned'</span>)</span>
<span id="cb14-17"><a aria-hidden="true" href="#cb14-17" tabindex="-1"></a>)</span>
<span id="cb14-18"><a aria-hidden="true" href="#cb14-18" tabindex="-1"></a></span>
<span id="cb14-19"><a aria-hidden="true" href="#cb14-19" tabindex="-1"></a>chao_all <span class="op">=</span> (div.alpha_diversity(metric<span class="op">=</span><span class="st">'chao1'</span>,</span>
<span id="cb14-20"><a aria-hidden="true" href="#cb14-20" tabindex="-1"></a>                    counts<span class="op">=</span>bac_df[sample_columns].T.values,</span>
<span id="cb14-21"><a aria-hidden="true" href="#cb14-21" tabindex="-1"></a>                    ids<span class="op">=</span>sample_columns</span>
<span id="cb14-22"><a aria-hidden="true" href="#cb14-22" tabindex="-1"></a>                    ).rename(<span class="st">'chao_all'</span>)</span>
<span id="cb14-23"><a aria-hidden="true" href="#cb14-23" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="18" id="cell-19">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a aria-hidden="true" href="#cb15-1" tabindex="-1"></a>(shannon_all</span>
<span id="cb15-2"><a aria-hidden="true" href="#cb15-2" tabindex="-1"></a> .reset_index()</span>
<span id="cb15-3"><a aria-hidden="true" href="#cb15-3" tabindex="-1"></a> .merge(shannon_only_assigned.reset_index())</span>
<span id="cb15-4"><a aria-hidden="true" href="#cb15-4" tabindex="-1"></a> .assign(index<span class="op">=</span><span class="kw">lambda</span> df: <span class="st">'S'</span> <span class="op">+</span> df[<span class="st">'index'</span>].<span class="bu">str</span>[<span class="dv">1</span>:].<span class="bu">str</span>.zfill(<span class="dv">2</span>))</span>
<span id="cb15-5"><a aria-hidden="true" href="#cb15-5" tabindex="-1"></a> .melt(id_vars<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb15-6"><a aria-hidden="true" href="#cb15-6" tabindex="-1"></a> .replace({<span class="st">'shannon_all'</span>: <span class="st">'Keeping all unassigned as different'</span>,</span>
<span id="cb15-7"><a aria-hidden="true" href="#cb15-7" tabindex="-1"></a>           <span class="st">'shannon_only_assigned'</span>: <span class="st">'Dropping unassigned genera'</span>})</span>
<span id="cb15-8"><a aria-hidden="true" href="#cb15-8" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) <span class="op">+</span> p9.aes(x<span class="op">=</span><span class="st">'index'</span>, y<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'variable'</span>)</span>
<span id="cb15-9"><a aria-hidden="true" href="#cb15-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col(position<span class="op">=</span><span class="st">'dodge'</span>)</span>
<span id="cb15-10"><a aria-hidden="true" href="#cb15-10" tabindex="-1"></a>       <span class="op">+</span> p9.theme(legend_position<span class="op">=</span>(<span class="fl">.5</span>, <span class="fl">.875</span>),</span>
<span id="cb15-11"><a aria-hidden="true" href="#cb15-11" tabindex="-1"></a>                  figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>)</span>
<span id="cb15-12"><a aria-hidden="true" href="#cb15-12" tabindex="-1"></a>                  )</span>
<span id="cb15-13"><a aria-hidden="true" href="#cb15-13" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Shannon diversity'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb15-14"><a aria-hidden="true" href="#cb15-14" tabindex="-1"></a>       )</span>
<span id="cb15-15"><a aria-hidden="true" href="#cb15-15" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-16-output-1.png" width="1800"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="20" id="cell-20">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a aria-hidden="true" href="#cb16-1" tabindex="-1"></a>shannon_16s <span class="op">=</span> (abundance_df_genera</span>
<span id="cb16-2"><a aria-hidden="true" href="#cb16-2" tabindex="-1"></a> .query(<span class="st">'Kingdom=="Bacteria"'</span>)</span>
<span id="cb16-3"><a aria-hidden="true" href="#cb16-3" tabindex="-1"></a> .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb16-4"><a aria-hidden="true" href="#cb16-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: div.alpha_diversity(metric<span class="op">=</span><span class="st">'shannon'</span>,</span>
<span id="cb16-5"><a aria-hidden="true" href="#cb16-5" tabindex="-1"></a>                                      counts<span class="op">=</span>dd[sample_columns].T.values,</span>
<span id="cb16-6"><a aria-hidden="true" href="#cb16-6" tabindex="-1"></a>                    ids<span class="op">=</span>sample_columns</span>
<span id="cb16-7"><a aria-hidden="true" href="#cb16-7" tabindex="-1"></a>                    ).rename(<span class="st">'shannon'</span>)</span>
<span id="cb16-8"><a aria-hidden="true" href="#cb16-8" tabindex="-1"></a> )</span>
<span id="cb16-9"><a aria-hidden="true" href="#cb16-9" tabindex="-1"></a> .reset_index()</span>
<span id="cb16-10"><a aria-hidden="true" href="#cb16-10" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'sample_id'</span>})</span>
<span id="cb16-11"><a aria-hidden="true" href="#cb16-11" tabindex="-1"></a> .assign(source<span class="op">=</span><span class="st">'16S'</span>)</span>
<span id="cb16-12"><a aria-hidden="true" href="#cb16-12" tabindex="-1"></a>)</span>
<span id="cb16-13"><a aria-hidden="true" href="#cb16-13" tabindex="-1"></a></span>
<span id="cb16-14"><a aria-hidden="true" href="#cb16-14" tabindex="-1"></a>shannon_its <span class="op">=</span> (abundance_df_genera</span>
<span id="cb16-15"><a aria-hidden="true" href="#cb16-15" tabindex="-1"></a>    .query(<span class="st">'Kingdom=="Fungi"'</span>)</span>
<span id="cb16-16"><a aria-hidden="true" href="#cb16-16" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb16-17"><a aria-hidden="true" href="#cb16-17" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">'S06'</span>)</span>
<span id="cb16-18"><a aria-hidden="true" href="#cb16-18" tabindex="-1"></a>    .pipe(<span class="kw">lambda</span> dd: div.alpha_diversity(metric<span class="op">=</span><span class="st">'shannon'</span>,</span>
<span id="cb16-19"><a aria-hidden="true" href="#cb16-19" tabindex="-1"></a>          counts<span class="op">=</span>dd[[col <span class="cf">for</span> col <span class="kw">in</span> sample_columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">'S06'</span>]].T.values,</span>
<span id="cb16-20"><a aria-hidden="true" href="#cb16-20" tabindex="-1"></a>                        ids<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> sample_columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">'S06'</span>]</span>
<span id="cb16-21"><a aria-hidden="true" href="#cb16-21" tabindex="-1"></a>                        ).rename(<span class="st">'shannon'</span>)</span>
<span id="cb16-22"><a aria-hidden="true" href="#cb16-22" tabindex="-1"></a>    )</span>
<span id="cb16-23"><a aria-hidden="true" href="#cb16-23" tabindex="-1"></a>    .reset_index()</span>
<span id="cb16-24"><a aria-hidden="true" href="#cb16-24" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'sample_id'</span>})</span>
<span id="cb16-25"><a aria-hidden="true" href="#cb16-25" tabindex="-1"></a>    .assign(source<span class="op">=</span><span class="st">'ITS'</span>)</span>
<span id="cb16-26"><a aria-hidden="true" href="#cb16-26" tabindex="-1"></a>    )</span>
<span id="cb16-27"><a aria-hidden="true" href="#cb16-27" tabindex="-1"></a></span>
<span id="cb16-28"><a aria-hidden="true" href="#cb16-28" tabindex="-1"></a>chao_16s <span class="op">=</span> (abundance_df_genera</span>
<span id="cb16-29"><a aria-hidden="true" href="#cb16-29" tabindex="-1"></a>    .query(<span class="st">'Kingdom=="Bacteria"'</span>)</span>
<span id="cb16-30"><a aria-hidden="true" href="#cb16-30" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb16-31"><a aria-hidden="true" href="#cb16-31" tabindex="-1"></a>    .pipe(<span class="kw">lambda</span> dd: div.alpha_diversity(metric<span class="op">=</span><span class="st">'chao1'</span>,</span>
<span id="cb16-32"><a aria-hidden="true" href="#cb16-32" tabindex="-1"></a>                                        counts<span class="op">=</span>dd[sample_columns].T.values,</span>
<span id="cb16-33"><a aria-hidden="true" href="#cb16-33" tabindex="-1"></a>                        ids<span class="op">=</span>sample_columns</span>
<span id="cb16-34"><a aria-hidden="true" href="#cb16-34" tabindex="-1"></a>                        ).rename(<span class="st">'chao'</span>)</span>
<span id="cb16-35"><a aria-hidden="true" href="#cb16-35" tabindex="-1"></a>    )</span>
<span id="cb16-36"><a aria-hidden="true" href="#cb16-36" tabindex="-1"></a>    .reset_index()</span>
<span id="cb16-37"><a aria-hidden="true" href="#cb16-37" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'sample_id'</span>})</span>
<span id="cb16-38"><a aria-hidden="true" href="#cb16-38" tabindex="-1"></a>    .assign(source<span class="op">=</span><span class="st">'16S'</span>)</span>
<span id="cb16-39"><a aria-hidden="true" href="#cb16-39" tabindex="-1"></a>    )</span>
<span id="cb16-40"><a aria-hidden="true" href="#cb16-40" tabindex="-1"></a></span>
<span id="cb16-41"><a aria-hidden="true" href="#cb16-41" tabindex="-1"></a>chao_its <span class="op">=</span> (abundance_df_genera</span>
<span id="cb16-42"><a aria-hidden="true" href="#cb16-42" tabindex="-1"></a>    .query(<span class="st">'Kingdom=="Fungi"'</span>)</span>
<span id="cb16-43"><a aria-hidden="true" href="#cb16-43" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">'S06'</span>)</span>
<span id="cb16-44"><a aria-hidden="true" href="#cb16-44" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb16-45"><a aria-hidden="true" href="#cb16-45" tabindex="-1"></a>    .pipe(<span class="kw">lambda</span> dd: div.alpha_diversity(metric<span class="op">=</span><span class="st">'chao1'</span>,</span>
<span id="cb16-46"><a aria-hidden="true" href="#cb16-46" tabindex="-1"></a>            counts<span class="op">=</span>dd[[col <span class="cf">for</span> col <span class="kw">in</span> sample_columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">'S06'</span>]].T.values,</span>
<span id="cb16-47"><a aria-hidden="true" href="#cb16-47" tabindex="-1"></a>                        ids<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> sample_columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">'S06'</span>]</span>
<span id="cb16-48"><a aria-hidden="true" href="#cb16-48" tabindex="-1"></a>                        ).rename(<span class="st">'chao'</span>)</span>
<span id="cb16-49"><a aria-hidden="true" href="#cb16-49" tabindex="-1"></a>    )</span>
<span id="cb16-50"><a aria-hidden="true" href="#cb16-50" tabindex="-1"></a>    .reset_index()</span>
<span id="cb16-51"><a aria-hidden="true" href="#cb16-51" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'sample_id'</span>})</span>
<span id="cb16-52"><a aria-hidden="true" href="#cb16-52" tabindex="-1"></a>    .assign(source<span class="op">=</span><span class="st">'ITS'</span>)</span>
<span id="cb16-53"><a aria-hidden="true" href="#cb16-53" tabindex="-1"></a>    )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22" id="cell-21">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a aria-hidden="true" href="#cb17-1" tabindex="-1"></a>diversity_df <span class="op">=</span> pd.concat(</span>
<span id="cb17-2"><a aria-hidden="true" href="#cb17-2" tabindex="-1"></a>    [chao_16s.merge(shannon_16s),</span>
<span id="cb17-3"><a aria-hidden="true" href="#cb17-3" tabindex="-1"></a>     chao_its.merge(shannon_its)]</span>
<span id="cb17-4"><a aria-hidden="true" href="#cb17-4" tabindex="-1"></a>)     [[<span class="st">'sample_id'</span>, <span class="st">'chao'</span>, <span class="st">'shannon'</span>, <span class="st">'source'</span>]]</span>
<span id="cb17-5"><a aria-hidden="true" href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a aria-hidden="true" href="#cb17-6" tabindex="-1"></a>diversity_df.to_csv(<span class="st">'../output/tables/diversity_df.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23" id="cell-22">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a aria-hidden="true" href="#cb18-1" tabindex="-1"></a>(chao_all</span>
<span id="cb18-2"><a aria-hidden="true" href="#cb18-2" tabindex="-1"></a> .reset_index()</span>
<span id="cb18-3"><a aria-hidden="true" href="#cb18-3" tabindex="-1"></a> .merge(chao_only_assigned.reset_index())</span>
<span id="cb18-4"><a aria-hidden="true" href="#cb18-4" tabindex="-1"></a> .assign(index<span class="op">=</span><span class="kw">lambda</span> df: <span class="st">'S'</span> <span class="op">+</span> df[<span class="st">'index'</span>].<span class="bu">str</span>[<span class="dv">1</span>:].<span class="bu">str</span>.zfill(<span class="dv">2</span>))</span>
<span id="cb18-5"><a aria-hidden="true" href="#cb18-5" tabindex="-1"></a> .melt(id_vars<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb18-6"><a aria-hidden="true" href="#cb18-6" tabindex="-1"></a> .replace({<span class="st">'chao_all'</span>: <span class="st">'Keeping all unassigned as different'</span>,</span>
<span id="cb18-7"><a aria-hidden="true" href="#cb18-7" tabindex="-1"></a>           <span class="st">'chao_only_assigned'</span>: <span class="st">'Dropping unassigned genera'</span>})</span>
<span id="cb18-8"><a aria-hidden="true" href="#cb18-8" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) <span class="op">+</span> p9.aes(x<span class="op">=</span><span class="st">'index'</span>, y<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'variable'</span>)</span>
<span id="cb18-9"><a aria-hidden="true" href="#cb18-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col(position<span class="op">=</span><span class="st">'dodge'</span>)</span>
<span id="cb18-10"><a aria-hidden="true" href="#cb18-10" tabindex="-1"></a>       <span class="op">+</span> p9.theme(legend_position<span class="op">=</span>(<span class="fl">.5</span>, <span class="fl">.9</span>),</span>
<span id="cb18-11"><a aria-hidden="true" href="#cb18-11" tabindex="-1"></a>                  figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>)</span>
<span id="cb18-12"><a aria-hidden="true" href="#cb18-12" tabindex="-1"></a>                  )</span>
<span id="cb18-13"><a aria-hidden="true" href="#cb18-13" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'CHAO1 diversity'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb18-14"><a aria-hidden="true" href="#cb18-14" tabindex="-1"></a>       )</span>
<span id="cb18-15"><a aria-hidden="true" href="#cb18-15" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-19-output-1.png" width="1800"/></p>
</figure>
</div>
</div>
</div>
</section></section></details>
<section class="level2" id="data-loading-and-wrangling">
<h2 class="anchored" data-anchor-id="data-loading-and-wrangling">Data Loading and Wrangling</h2>
<div class="cell" data-execution_count="24" id="cell-25">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a aria-hidden="true" href="#cb19-1" tabindex="-1"></a>abundance_long_genera <span class="op">=</span> (abundance_df_genera</span>
<span id="cb19-2"><a aria-hidden="true" href="#cb19-2" tabindex="-1"></a>      .melt(id_vars<span class="op">=</span>taxon_names,</span>
<span id="cb19-3"><a aria-hidden="true" href="#cb19-3" tabindex="-1"></a>            var_name<span class="op">=</span><span class="st">'sample_id'</span>,</span>
<span id="cb19-4"><a aria-hidden="true" href="#cb19-4" tabindex="-1"></a>            value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb19-5"><a aria-hidden="true" href="#cb19-5" tabindex="-1"></a>)</span>
<span id="cb19-6"><a aria-hidden="true" href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a aria-hidden="true" href="#cb19-7" tabindex="-1"></a>abundance_long_phyla <span class="op">=</span> (abundance_df_phyla</span>
<span id="cb19-8"><a aria-hidden="true" href="#cb19-8" tabindex="-1"></a>        .melt(id_vars<span class="op">=</span>taxon_names[:<span class="dv">2</span>],</span>
<span id="cb19-9"><a aria-hidden="true" href="#cb19-9" tabindex="-1"></a>                var_name<span class="op">=</span><span class="st">'sample_id'</span>,</span>
<span id="cb19-10"><a aria-hidden="true" href="#cb19-10" tabindex="-1"></a>                value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb19-11"><a aria-hidden="true" href="#cb19-11" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="level2" id="analysis-figures">
<h2 class="anchored" data-anchor-id="analysis-figures">Analysis &amp; Figures</h2>
<section class="level3" id="sampling-schedule">
<h3 class="anchored" data-anchor-id="sampling-schedule">Sampling Schedule</h3>
<div class="cell" data-execution_count="26" id="cell-28">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a aria-hidden="true" href="#cb20-1" tabindex="-1"></a>f <span class="op">=</span> (samples_info</span>
<span id="cb20-2"><a aria-hidden="true" href="#cb20-2" tabindex="-1"></a>.assign(date<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date))</span>
<span id="cb20-3"><a aria-hidden="true" href="#cb20-3" tabindex="-1"></a> .assign(weekday<span class="op">=</span><span class="kw">lambda</span> dd: dd.date.dt.weekday)</span>
<span id="cb20-4"><a aria-hidden="true" href="#cb20-4" tabindex="-1"></a> .assign(week<span class="op">=</span><span class="kw">lambda</span> dd: dd.date.dt.isocalendar().week)</span>
<span id="cb20-5"><a aria-hidden="true" href="#cb20-5" tabindex="-1"></a> .assign(week<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.sample_mode<span class="op">==</span><span class="st">'Flight'</span>, dd.week <span class="op">-</span><span class="fl">.25</span>, dd.week <span class="op">+</span> <span class="fl">.25</span>))</span>
<span id="cb20-6"><a aria-hidden="true" href="#cb20-6" tabindex="-1"></a> .assign(week<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.sample_id<span class="op">==</span><span class="st">'S11'</span>, dd.week <span class="op">-</span> <span class="fl">.5</span>, dd.week).astype(<span class="bu">float</span>))</span>
<span id="cb20-7"><a aria-hidden="true" href="#cb20-7" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb20-8"><a aria-hidden="true" href="#cb20-8" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'weekday'</span>, <span class="st">'week'</span>)</span>
<span id="cb20-9"><a aria-hidden="true" href="#cb20-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_tile(p9.aes(fill<span class="op">=</span><span class="st">'sample_mode'</span>), color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb20-10"><a aria-hidden="true" href="#cb20-10" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'sample_id'</span>), size<span class="op">=</span><span class="dv">9</span>, nudge_y<span class="op">=-</span><span class="fl">.05</span>)</span>
<span id="cb20-11"><a aria-hidden="true" href="#cb20-11" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_reverse(labels<span class="op">=</span>[<span class="st">'02/17-02/23'</span>, <span class="st">'02/24-03/02'</span>,</span>
<span id="cb20-12"><a aria-hidden="true" href="#cb20-12" tabindex="-1"></a>                                    <span class="st">'03/03-03/09'</span>, <span class="st">'03/10-03/16'</span>,</span>
<span id="cb20-13"><a aria-hidden="true" href="#cb20-13" tabindex="-1"></a>                                    <span class="st">'03/17-03/23'</span>, <span class="st">'03/24-03/30'</span>,</span>
<span id="cb20-14"><a aria-hidden="true" href="#cb20-14" tabindex="-1"></a>                                    <span class="st">'03/31-04/06'</span>, <span class="st">'04/07-04/13'</span>], </span>
<span id="cb20-15"><a aria-hidden="true" href="#cb20-15" tabindex="-1"></a>                            breaks<span class="op">=</span><span class="bu">range</span>(<span class="dv">8</span>, <span class="dv">16</span>))</span>
<span id="cb20-16"><a aria-hidden="true" href="#cb20-16" tabindex="-1"></a>       <span class="op">+</span> p9.scale_x_continuous(labels<span class="op">=</span>[<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>, <span class="st">'Thu'</span>, <span class="st">'Fri'</span>, <span class="st">'Sat'</span>, <span class="st">'Sun'</span>],</span>
<span id="cb20-17"><a aria-hidden="true" href="#cb20-17" tabindex="-1"></a>                               breaks<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>])</span>
<span id="cb20-18"><a aria-hidden="true" href="#cb20-18" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, title<span class="op">=</span><span class="st">'Sampling Schedule (2014)'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb20-19"><a aria-hidden="true" href="#cb20-19" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>),</span>
<span id="cb20-20"><a aria-hidden="true" href="#cb20-20" tabindex="-1"></a>                  plot_title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb20-21"><a aria-hidden="true" href="#cb20-21" tabindex="-1"></a>                  legend_position<span class="op">=</span>(<span class="fl">.6</span>, <span class="fl">.51</span>),</span>
<span id="cb20-22"><a aria-hidden="true" href="#cb20-22" tabindex="-1"></a>                  )</span>
<span id="cb20-23"><a aria-hidden="true" href="#cb20-23" tabindex="-1"></a>      )</span>
<span id="cb20-24"><a aria-hidden="true" href="#cb20-24" tabindex="-1"></a>)</span>
<span id="cb20-25"><a aria-hidden="true" href="#cb20-25" tabindex="-1"></a></span>
<span id="cb20-26"><a aria-hidden="true" href="#cb20-26" tabindex="-1"></a>f.save(<span class="st">'../output/figures/sampling_schedule.svg'</span>)</span>
<span id="cb20-27"><a aria-hidden="true" href="#cb20-27" tabindex="-1"></a>f</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-21-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level3" id="abundance-comparisons">
<h3 class="anchored" data-anchor-id="abundance-comparisons">Abundance comparisons</h3>
<section class="level4" id="read-count-boxplots-flight-vs-ground">
<h4 class="anchored" data-anchor-id="read-count-boxplots-flight-vs-ground">Read Count boxplots (Flight vs Ground)</h4>
<div class="cell" data-execution_count="27" id="cell-31">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a aria-hidden="true" href="#cb21-1" tabindex="-1"></a>f <span class="op">=</span> (abundance_long_phyla</span>
<span id="cb21-2"><a aria-hidden="true" href="#cb21-2" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_id'</span>])</span>
<span id="cb21-3"><a aria-hidden="true" href="#cb21-3" tabindex="-1"></a> [<span class="st">'counts'</span>]</span>
<span id="cb21-4"><a aria-hidden="true" href="#cb21-4" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb21-5"><a aria-hidden="true" href="#cb21-5" tabindex="-1"></a> .reset_index()</span>
<span id="cb21-6"><a aria-hidden="true" href="#cb21-6" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb21-7"><a aria-hidden="true" href="#cb21-7" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb21-8"><a aria-hidden="true" href="#cb21-8" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb21-9"><a aria-hidden="true" href="#cb21-9" tabindex="-1"></a>    <span class="op">+</span> p9.aes(<span class="st">'sample_mode'</span>, <span class="st">'counts.astype(float)'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb21-10"><a aria-hidden="true" href="#cb21-10" tabindex="-1"></a>    <span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom'</span>)</span>
<span id="cb21-11"><a aria-hidden="true" href="#cb21-11" tabindex="-1"></a>    <span class="op">+</span> p9.geom_boxplot(outlier_alpha<span class="op">=</span><span class="dv">0</span>, alpha<span class="op">=</span><span class="fl">.7</span>)</span>
<span id="cb21-12"><a aria-hidden="true" href="#cb21-12" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.5</span>, color<span class="op">=</span><span class="st">'black'</span>, fill<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb21-13"><a aria-hidden="true" href="#cb21-13" tabindex="-1"></a>    <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb21-14"><a aria-hidden="true" href="#cb21-14" tabindex="-1"></a>    <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Read Counts'</span>)</span>
<span id="cb21-15"><a aria-hidden="true" href="#cb21-15" tabindex="-1"></a>    <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-16"><a aria-hidden="true" href="#cb21-16" tabindex="-1"></a>    <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">2</span>))</span>
<span id="cb21-17"><a aria-hidden="true" href="#cb21-17" tabindex="-1"></a> )</span>
<span id="cb21-18"><a aria-hidden="true" href="#cb21-18" tabindex="-1"></a> )</span>
<span id="cb21-19"><a aria-hidden="true" href="#cb21-19" tabindex="-1"></a>f.save(<span class="st">'../output/figures/abundance_by_sample_type.svg'</span>)</span>
<span id="cb21-20"><a aria-hidden="true" href="#cb21-20" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>
<figure class="figure">
<p><img class="figure-img" height="614" src="microbial_diversity_analysis_files/figure-html/cell-22-output-1.png" width="1529"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level4" id="read-counts-per-sample-type-and-date">
<h4 class="anchored" data-anchor-id="read-counts-per-sample-type-and-date">Read Counts per sample type and date</h4>
<div class="cell" data-execution_count="30" id="cell-33">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a aria-hidden="true" href="#cb22-1" tabindex="-1"></a>f <span class="op">=</span> (abundance_long_phyla</span>
<span id="cb22-2"><a aria-hidden="true" href="#cb22-2" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_id'</span>])</span>
<span id="cb22-3"><a aria-hidden="true" href="#cb22-3" tabindex="-1"></a> [<span class="st">'counts'</span>]</span>
<span id="cb22-4"><a aria-hidden="true" href="#cb22-4" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb22-5"><a aria-hidden="true" href="#cb22-5" tabindex="-1"></a> .reset_index()</span>
<span id="cb22-6"><a aria-hidden="true" href="#cb22-6" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb22-7"><a aria-hidden="true" href="#cb22-7" tabindex="-1"></a> .assign(date_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.strftime(<span class="st">'%m/</span><span class="sc">%d</span><span class="st">'</span>))</span>
<span id="cb22-8"><a aria-hidden="true" href="#cb22-8" tabindex="-1"></a>    .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb22-9"><a aria-hidden="true" href="#cb22-9" tabindex="-1"></a>  <span class="op">+</span> p9.aes(<span class="st">'date_label'</span>, <span class="st">'counts.astype(float)'</span>, fill<span class="op">=</span><span class="st">'Kingdom'</span>)</span>
<span id="cb22-10"><a aria-hidden="true" href="#cb22-10" tabindex="-1"></a>  <span class="op">+</span> p9.facet_wrap(<span class="st">'sample_mode'</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-11"><a aria-hidden="true" href="#cb22-11" tabindex="-1"></a>  <span class="op">+</span> p9.geom_col(position<span class="op">=</span><span class="st">'dodge'</span>)</span>
<span id="cb22-12"><a aria-hidden="true" href="#cb22-12" tabindex="-1"></a>  <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb22-13"><a aria-hidden="true" href="#cb22-13" tabindex="-1"></a>  <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Read Counts'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb22-14"><a aria-hidden="true" href="#cb22-14" tabindex="-1"></a>  <span class="op">+</span> p9.theme(legend_position<span class="op">=</span>(<span class="fl">.55</span>, <span class="fl">.99</span>),</span>
<span id="cb22-15"><a aria-hidden="true" href="#cb22-15" tabindex="-1"></a>             figure_size<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">3</span>),</span>
<span id="cb22-16"><a aria-hidden="true" href="#cb22-16" tabindex="-1"></a>             legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb22-17"><a aria-hidden="true" href="#cb22-17" tabindex="-1"></a>             )</span>
<span id="cb22-18"><a aria-hidden="true" href="#cb22-18" tabindex="-1"></a>    )</span>
<span id="cb22-19"><a aria-hidden="true" href="#cb22-19" tabindex="-1"></a>)</span>
<span id="cb22-20"><a aria-hidden="true" href="#cb22-20" tabindex="-1"></a></span>
<span id="cb22-21"><a aria-hidden="true" href="#cb22-21" tabindex="-1"></a>f.save(<span class="st">'../output/figures/abundance_by_sample_type_time.svg'</span>)</span>
<span id="cb22-22"><a aria-hidden="true" href="#cb22-22" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>
<figure class="figure">
<p><img class="figure-img" height="902" src="microbial_diversity_analysis_files/figure-html/cell-23-output-1.png" width="2118"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level4" id="total-counts-per-phylum">
<h4 class="anchored" data-anchor-id="total-counts-per-phylum">Total counts per Phylum</h4>
<div class="cell" data-execution_count="31" id="cell-35">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a aria-hidden="true" href="#cb23-1" tabindex="-1"></a>(abundance_long_phyla</span>
<span id="cb23-2"><a aria-hidden="true" href="#cb23-2" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>])</span>
<span id="cb23-3"><a aria-hidden="true" href="#cb23-3" tabindex="-1"></a> .counts</span>
<span id="cb23-4"><a aria-hidden="true" href="#cb23-4" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb23-5"><a aria-hidden="true" href="#cb23-5" tabindex="-1"></a> .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-6"><a aria-hidden="true" href="#cb23-6" tabindex="-1"></a> .loc[<span class="kw">lambda</span> x: x <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb23-7"><a aria-hidden="true" href="#cb23-7" tabindex="-1"></a> .reset_index()</span>
<span id="cb23-8"><a aria-hidden="true" href="#cb23-8" tabindex="-1"></a> .style</span>
<span id="cb23-9"><a aria-hidden="true" href="#cb23-9" tabindex="-1"></a> .hide(axis<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb23-10"><a aria-hidden="true" href="#cb23-10" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> row: [<span class="st">'color: #435B97'</span>] <span class="op">*</span> <span class="bu">len</span>(row)   <span class="cf">if</span> <span class="st">'Fungi'</span> <span class="kw">in</span> row.Kingdom <span class="cf">else</span></span>
<span id="cb23-11"><a aria-hidden="true" href="#cb23-11" tabindex="-1"></a>        [<span class="st">'color: #D3894C'</span>] <span class="op">*</span> <span class="bu">len</span>(row), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-12"><a aria-hidden="true" href="#cb23-12" tabindex="-1"></a> .background_gradient(cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb23-13"><a aria-hidden="true" href="#cb23-13" tabindex="-1"></a> .applymap(<span class="kw">lambda</span> x: <span class="st">'color: red'</span> <span class="cf">if</span> x<span class="op">==</span><span class="st">'unknown'</span> <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb23-14"><a aria-hidden="true" href="#cb23-14" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<style type="text/css">
#T_a82be_row0_col0, #T_a82be_row0_col1, #T_a82be_row2_col0, #T_a82be_row2_col1, #T_a82be_row5_col0 {
  color: #435B97;
}
#T_a82be_row0_col2 {
  color: #435B97;
  background-color: #fde725;
  color: #000000;
}
#T_a82be_row1_col0, #T_a82be_row1_col1, #T_a82be_row3_col0, #T_a82be_row3_col1, #T_a82be_row4_col0, #T_a82be_row4_col1, #T_a82be_row6_col0, #T_a82be_row6_col1, #T_a82be_row7_col0, #T_a82be_row8_col0, #T_a82be_row8_col1, #T_a82be_row9_col0, #T_a82be_row9_col1, #T_a82be_row10_col0, #T_a82be_row10_col1, #T_a82be_row11_col0, #T_a82be_row11_col1, #T_a82be_row12_col0, #T_a82be_row12_col1, #T_a82be_row13_col0, #T_a82be_row13_col1, #T_a82be_row14_col0, #T_a82be_row14_col1, #T_a82be_row15_col0, #T_a82be_row15_col1, #T_a82be_row16_col0, #T_a82be_row16_col1, #T_a82be_row17_col0, #T_a82be_row17_col1, #T_a82be_row18_col0, #T_a82be_row18_col1, #T_a82be_row19_col0, #T_a82be_row19_col1, #T_a82be_row20_col0, #T_a82be_row20_col1, #T_a82be_row21_col0, #T_a82be_row21_col1 {
  color: #D3894C;
}
#T_a82be_row1_col2 {
  color: #D3894C;
  background-color: #77d153;
  color: #000000;
}
#T_a82be_row2_col2 {
  color: #435B97;
  background-color: #482878;
  color: #f1f1f1;
}
#T_a82be_row3_col2 {
  color: #D3894C;
  background-color: #470d60;
  color: #f1f1f1;
}
#T_a82be_row4_col2 {
  color: #D3894C;
  background-color: #46075a;
  color: #f1f1f1;
}
#T_a82be_row5_col1 {
  color: #435B97;
  color: red;
}
#T_a82be_row5_col2 {
  color: #435B97;
  background-color: #440256;
  color: #f1f1f1;
}
#T_a82be_row6_col2, #T_a82be_row7_col2, #T_a82be_row8_col2, #T_a82be_row9_col2, #T_a82be_row10_col2, #T_a82be_row11_col2, #T_a82be_row12_col2, #T_a82be_row13_col2, #T_a82be_row14_col2, #T_a82be_row15_col2, #T_a82be_row16_col2, #T_a82be_row17_col2, #T_a82be_row18_col2, #T_a82be_row19_col2, #T_a82be_row20_col2, #T_a82be_row21_col2 {
  color: #D3894C;
  background-color: #440154;
  color: #f1f1f1;
}
#T_a82be_row7_col1 {
  color: #D3894C;
  color: red;
}
</style>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true" id="T_a82be">
<thead>
<tr class="header">
<th class="col_heading level0 col0" data-quarto-table-cell-role="th" id="T_a82be_level0_col0">Kingdom</th>
<th class="col_heading level0 col1" data-quarto-table-cell-role="th" id="T_a82be_level0_col1">Phylum</th>
<th class="col_heading level0 col2" data-quarto-table-cell-role="th" id="T_a82be_level0_col2">counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="data row0 col0" id="T_a82be_row0_col0">Fungi</td>
<td class="data row0 col1" id="T_a82be_row0_col1">Ascomycota</td>
<td class="data row0 col2" id="T_a82be_row0_col2">1964855</td>
</tr>
<tr class="even">
<td class="data row1 col0" id="T_a82be_row1_col0">Bacteria</td>
<td class="data row1 col1" id="T_a82be_row1_col1">Proteobacteria</td>
<td class="data row1 col2" id="T_a82be_row1_col2">1562108</td>
</tr>
<tr class="odd">
<td class="data row2 col0" id="T_a82be_row2_col0">Fungi</td>
<td class="data row2 col1" id="T_a82be_row2_col1">Basidiomycota</td>
<td class="data row2 col2" id="T_a82be_row2_col2">222314</td>
</tr>
<tr class="even">
<td class="data row3 col0" id="T_a82be_row3_col0">Bacteria</td>
<td class="data row3 col1" id="T_a82be_row3_col1">Firmicutes</td>
<td class="data row3 col2" id="T_a82be_row3_col2">66403</td>
</tr>
<tr class="odd">
<td class="data row4 col0" id="T_a82be_row4_col0">Bacteria</td>
<td class="data row4 col1" id="T_a82be_row4_col1">Bacteroidota</td>
<td class="data row4 col2" id="T_a82be_row4_col2">30860</td>
</tr>
<tr class="even">
<td class="data row5 col0" id="T_a82be_row5_col0">Fungi</td>
<td class="data row5 col1" id="T_a82be_row5_col1">unknown</td>
<td class="data row5 col2" id="T_a82be_row5_col2">9247</td>
</tr>
<tr class="odd">
<td class="data row6 col0" id="T_a82be_row6_col0">Bacteria</td>
<td class="data row6 col1" id="T_a82be_row6_col1">Actinobacteriota</td>
<td class="data row6 col2" id="T_a82be_row6_col2">6048</td>
</tr>
<tr class="even">
<td class="data row7 col0" id="T_a82be_row7_col0">Bacteria</td>
<td class="data row7 col1" id="T_a82be_row7_col1">unknown</td>
<td class="data row7 col2" id="T_a82be_row7_col2">2702</td>
</tr>
<tr class="odd">
<td class="data row8 col0" id="T_a82be_row8_col0">Bacteria</td>
<td class="data row8 col1" id="T_a82be_row8_col1">Verrucomicrobiota</td>
<td class="data row8 col2" id="T_a82be_row8_col2">835</td>
</tr>
<tr class="even">
<td class="data row9 col0" id="T_a82be_row9_col0">Bacteria</td>
<td class="data row9 col1" id="T_a82be_row9_col1">Acidobacteriota</td>
<td class="data row9 col2" id="T_a82be_row9_col2">581</td>
</tr>
<tr class="odd">
<td class="data row10 col0" id="T_a82be_row10_col0">Bacteria</td>
<td class="data row10 col1" id="T_a82be_row10_col1">Fusobacteriota</td>
<td class="data row10 col2" id="T_a82be_row10_col2">565</td>
</tr>
<tr class="even">
<td class="data row11 col0" id="T_a82be_row11_col0">Bacteria</td>
<td class="data row11 col1" id="T_a82be_row11_col1">Desulfobacterota</td>
<td class="data row11 col2" id="T_a82be_row11_col2">476</td>
</tr>
<tr class="odd">
<td class="data row12 col0" id="T_a82be_row12_col0">Bacteria</td>
<td class="data row12 col1" id="T_a82be_row12_col1">Cyanobacteria</td>
<td class="data row12 col2" id="T_a82be_row12_col2">273</td>
</tr>
<tr class="even">
<td class="data row13 col0" id="T_a82be_row13_col0">Bacteria</td>
<td class="data row13 col1" id="T_a82be_row13_col1">Campylobacterota</td>
<td class="data row13 col2" id="T_a82be_row13_col2">245</td>
</tr>
<tr class="odd">
<td class="data row14 col0" id="T_a82be_row14_col0">Bacteria</td>
<td class="data row14 col1" id="T_a82be_row14_col1">Chloroflexi</td>
<td class="data row14 col2" id="T_a82be_row14_col2">123</td>
</tr>
<tr class="even">
<td class="data row15 col0" id="T_a82be_row15_col0">Bacteria</td>
<td class="data row15 col1" id="T_a82be_row15_col1">Planctomycetota</td>
<td class="data row15 col2" id="T_a82be_row15_col2">119</td>
</tr>
<tr class="odd">
<td class="data row16 col0" id="T_a82be_row16_col0">Bacteria</td>
<td class="data row16 col1" id="T_a82be_row16_col1">Patescibacteria</td>
<td class="data row16 col2" id="T_a82be_row16_col2">110</td>
</tr>
<tr class="even">
<td class="data row17 col0" id="T_a82be_row17_col0">Bacteria</td>
<td class="data row17 col1" id="T_a82be_row17_col1">Armatimonadota</td>
<td class="data row17 col2" id="T_a82be_row17_col2">98</td>
</tr>
<tr class="odd">
<td class="data row18 col0" id="T_a82be_row18_col0">Bacteria</td>
<td class="data row18 col1" id="T_a82be_row18_col1">Deinococcota</td>
<td class="data row18 col2" id="T_a82be_row18_col2">79</td>
</tr>
<tr class="even">
<td class="data row19 col0" id="T_a82be_row19_col0">Bacteria</td>
<td class="data row19 col1" id="T_a82be_row19_col1">Myxococcota</td>
<td class="data row19 col2" id="T_a82be_row19_col2">28</td>
</tr>
<tr class="odd">
<td class="data row20 col0" id="T_a82be_row20_col0">Bacteria</td>
<td class="data row20 col1" id="T_a82be_row20_col1">Gemmatimonadota</td>
<td class="data row20 col2" id="T_a82be_row20_col2">27</td>
</tr>
<tr class="even">
<td class="data row21 col0" id="T_a82be_row21_col0">Bacteria</td>
<td class="data row21 col1" id="T_a82be_row21_col1">Dependentiae</td>
<td class="data row21 col2" id="T_a82be_row21_col2">10</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section class="level3" id="metagenomics-identification-rate">
<h3 class="anchored" data-anchor-id="metagenomics-identification-rate">Metagenomics identification rate</h3>
<p>Here we are going to take a look at the rate at which the different samples have been resolved up to the Genus level.</p>
<div class="cell" data-execution_count="32" id="cell-38">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a aria-hidden="true" href="#cb24-1" tabindex="-1"></a>reads_per_source <span class="op">=</span> (abundance_long_genera</span>
<span id="cb24-2"><a aria-hidden="true" href="#cb24-2" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb24-3"><a aria-hidden="true" href="#cb24-3" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb24-4"><a aria-hidden="true" href="#cb24-4" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span> , <span class="st">'sample_mode'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-5"><a aria-hidden="true" href="#cb24-5" tabindex="-1"></a> .counts.<span class="bu">sum</span>()</span>
<span id="cb24-6"><a aria-hidden="true" href="#cb24-6" tabindex="-1"></a>)</span>
<span id="cb24-7"><a aria-hidden="true" href="#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a aria-hidden="true" href="#cb24-8" tabindex="-1"></a>identification_df <span class="op">=</span> <span class="op">\</span></span>
<span id="cb24-9"><a aria-hidden="true" href="#cb24-9" tabindex="-1"></a>(abundance_long_genera</span>
<span id="cb24-10"><a aria-hidden="true" href="#cb24-10" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb24-11"><a aria-hidden="true" href="#cb24-11" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb24-12"><a aria-hidden="true" href="#cb24-12" tabindex="-1"></a> .groupby(taxon_names <span class="op">+</span> [<span class="st">'sample_mode'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-13"><a aria-hidden="true" href="#cb24-13" tabindex="-1"></a> .counts.<span class="bu">sum</span>()</span>
<span id="cb24-14"><a aria-hidden="true" href="#cb24-14" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_mode'</span>])</span>
<span id="cb24-15"><a aria-hidden="true" href="#cb24-15" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span> dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb24-16"><a aria-hidden="true" href="#cb24-16" tabindex="-1"></a> .melt([<span class="st">'Kingdom'</span>, <span class="st">'sample_mode'</span>, <span class="st">'counts'</span>, <span class="st">'relative_abundance'</span>])</span>
<span id="cb24-17"><a aria-hidden="true" href="#cb24-17" tabindex="-1"></a> .query(<span class="st">'value == "unknown"'</span>)</span>
<span id="cb24-18"><a aria-hidden="true" href="#cb24-18" tabindex="-1"></a> .assign(variable<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.variable, categories<span class="op">=</span>taxon_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb24-19"><a aria-hidden="true" href="#cb24-19" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_mode'</span>, <span class="st">'variable'</span>])</span>
<span id="cb24-20"><a aria-hidden="true" href="#cb24-20" tabindex="-1"></a> .relative_abundance.<span class="bu">sum</span>()</span>
<span id="cb24-21"><a aria-hidden="true" href="#cb24-21" tabindex="-1"></a> .rename(<span class="st">'freq'</span>)</span>
<span id="cb24-22"><a aria-hidden="true" href="#cb24-22" tabindex="-1"></a> .astype(<span class="bu">float</span>)</span>
<span id="cb24-23"><a aria-hidden="true" href="#cb24-23" tabindex="-1"></a> .reset_index()</span>
<span id="cb24-24"><a aria-hidden="true" href="#cb24-24" tabindex="-1"></a> .assign(rate_discovered<span class="op">=</span><span class="kw">lambda</span> dd: <span class="dv">1</span> <span class="op">-</span> dd.freq)</span>
<span id="cb24-25"><a aria-hidden="true" href="#cb24-25" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_mode'</span>])</span>
<span id="cb24-26"><a aria-hidden="true" href="#cb24-26" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd</span>
<span id="cb24-27"><a aria-hidden="true" href="#cb24-27" tabindex="-1"></a> .assign(rate_diff<span class="op">=</span>dd.rate_discovered.diff().shift(<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb24-28"><a aria-hidden="true" href="#cb24-28" tabindex="-1"></a> .assign(rate_diff<span class="op">=</span><span class="kw">lambda</span> ddd: </span>
<span id="cb24-29"><a aria-hidden="true" href="#cb24-29" tabindex="-1"></a>         np.where(ddd.rate_diff.isna(), ddd.rate_discovered, ddd.rate_diff)))</span>
<span id="cb24-30"><a aria-hidden="true" href="#cb24-30" tabindex="-1"></a> )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If we go by maximum depth of identification, ordered by Genus &gt; Family &gt; Order &gt; Class &gt; Phylum &gt; Kingdom:</p>
<div class="cell" data-execution_count="33" id="cell-40">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a aria-hidden="true" href="#cb25-1" tabindex="-1"></a>f <span class="op">=</span> (identification_df</span>
<span id="cb25-2"><a aria-hidden="true" href="#cb25-2" tabindex="-1"></a> .assign(source_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> dd.Kingdom)</span>
<span id="cb25-3"><a aria-hidden="true" href="#cb25-3" tabindex="-1"></a> .assign(percent<span class="op">=</span><span class="kw">lambda</span> dd: (dd.rate_diff <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>).astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'%'</span>)</span>
<span id="cb25-4"><a aria-hidden="true" href="#cb25-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb25-5"><a aria-hidden="true" href="#cb25-5" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'source_label'</span>, <span class="st">'rate_diff'</span>, fill<span class="op">=</span><span class="st">'variable'</span>)</span>
<span id="cb25-6"><a aria-hidden="true" href="#cb25-6" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col()</span>
<span id="cb25-7"><a aria-hidden="true" href="#cb25-7" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_continuous(labels<span class="op">=</span>percent_format())</span>
<span id="cb25-8"><a aria-hidden="true" href="#cb25-8" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Percentage of all reads'</span>, fill<span class="op">=</span><span class="st">'Taxonomic level'</span>,</span>
<span id="cb25-9"><a aria-hidden="true" href="#cb25-9" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">'Maximum depth of identification for all reads'</span>)</span>
<span id="cb25-10"><a aria-hidden="true" href="#cb25-10" tabindex="-1"></a>       <span class="op">+</span> p9.coord_flip()</span>
<span id="cb25-11"><a aria-hidden="true" href="#cb25-11" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'percent'</span>, y<span class="op">=</span><span class="fl">.025</span>), ha<span class="op">=</span><span class="st">'left'</span>, size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb25-12"><a aria-hidden="true" href="#cb25-12" tabindex="-1"></a>                      data<span class="op">=</span>dd.loc[dd.variable<span class="op">==</span><span class="st">'Genus'</span>])</span>
<span id="cb25-13"><a aria-hidden="true" href="#cb25-13" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>), title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>))</span>
<span id="cb25-14"><a aria-hidden="true" href="#cb25-14" tabindex="-1"></a>)</span>
<span id="cb25-15"><a aria-hidden="true" href="#cb25-15" tabindex="-1"></a>)</span>
<span id="cb25-16"><a aria-hidden="true" href="#cb25-16" tabindex="-1"></a>f.save(<span class="st">'../output/figures/identification_depth.svg'</span>)</span>
<span id="cb25-17"><a aria-hidden="true" href="#cb25-17" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>
<figure class="figure">
<p><img class="figure-img" height="924" src="microbial_diversity_analysis_files/figure-html/cell-26-output-1.png" width="1824"/></p>
</figure>
</div>
</div>
</div>
<p>We see how the bacterial reads have really good resolution even at the Genus level. Fungal reads, from ITS, hover around the 94% rate at the Genus level.</p>
<p>Letâ€™s look at this the other way around, with the % of unidentified reads at each level per sample type and kingdom:</p>
<div class="cell" data-execution_count="34" id="cell-42">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a aria-hidden="true" href="#cb26-1" tabindex="-1"></a>reversed_taxon_names <span class="op">=</span> taxon_names.copy()</span>
<span id="cb26-2"><a aria-hidden="true" href="#cb26-2" tabindex="-1"></a>reversed_taxon_names.reverse()</span>
<span id="cb26-3"><a aria-hidden="true" href="#cb26-3" tabindex="-1"></a>f <span class="op">=</span> (identification_df</span>
<span id="cb26-4"><a aria-hidden="true" href="#cb26-4" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-5"><a aria-hidden="true" href="#cb26-5" tabindex="-1"></a> .assign(variable<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb26-6"><a aria-hidden="true" href="#cb26-6" tabindex="-1"></a>         pd.Categorical(dd.variable,</span>
<span id="cb26-7"><a aria-hidden="true" href="#cb26-7" tabindex="-1"></a>                        categories<span class="op">=</span>reversed_taxon_names,</span>
<span id="cb26-8"><a aria-hidden="true" href="#cb26-8" tabindex="-1"></a>                        ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb26-9"><a aria-hidden="true" href="#cb26-9" tabindex="-1"></a>  .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb26-10"><a aria-hidden="true" href="#cb26-10" tabindex="-1"></a>        <span class="op">+</span> p9.aes(<span class="st">'variable'</span>, <span class="st">'freq'</span>)</span>
<span id="cb26-11"><a aria-hidden="true" href="#cb26-11" tabindex="-1"></a>        <span class="op">+</span> p9.geom_col()</span>
<span id="cb26-12"><a aria-hidden="true" href="#cb26-12" tabindex="-1"></a>        <span class="op">+</span> p9.coord_flip()</span>
<span id="cb26-13"><a aria-hidden="true" href="#cb26-13" tabindex="-1"></a>        <span class="op">+</span> p9.facet_grid(<span class="st">'sample_mode ~ Kingdom'</span>)</span>
<span id="cb26-14"><a aria-hidden="true" href="#cb26-14" tabindex="-1"></a>        <span class="op">+</span> p9.scale_y_continuous(labels<span class="op">=</span>percent_format())</span>
<span id="cb26-15"><a aria-hidden="true" href="#cb26-15" tabindex="-1"></a>        <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">'Taxonomic level'</span>, y<span class="op">=</span><span class="st">'Unidentified reads (%)'</span>)</span>
<span id="cb26-16"><a aria-hidden="true" href="#cb26-16" tabindex="-1"></a>        <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="fl">3.5</span>))</span>
<span id="cb26-17"><a aria-hidden="true" href="#cb26-17" tabindex="-1"></a>        )</span>
<span id="cb26-18"><a aria-hidden="true" href="#cb26-18" tabindex="-1"></a></span>
<span id="cb26-19"><a aria-hidden="true" href="#cb26-19" tabindex="-1"></a>)</span>
<span id="cb26-20"><a aria-hidden="true" href="#cb26-20" tabindex="-1"></a>f.save(<span class="st">'../output/figures/unidentified_reads_bars.svg'</span>)</span>
<span id="cb26-21"><a aria-hidden="true" href="#cb26-21" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>
<figure class="figure">
<p><img class="figure-img" height="1064" src="microbial_diversity_analysis_files/figure-html/cell-27-output-1.png" width="1514"/></p>
</figure>
</div>
</div>
</div>
<p>And if we look at the numbers on a sample per sample basis, we can observe how there is quite a lot of variability, specially on the fungal side. This is probably a product of the higher diversity found in February samples compared to the April ones in the ITS database:</p>
<div class="cell" data-execution_count="35" id="cell-44">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a aria-hidden="true" href="#cb27-1" tabindex="-1"></a>sample_map <span class="op">=</span> (samples_info</span>
<span id="cb27-2"><a aria-hidden="true" href="#cb27-2" tabindex="-1"></a>              [[<span class="st">'sample_id'</span>, <span class="st">'sample_mode'</span>]]</span>
<span id="cb27-3"><a aria-hidden="true" href="#cb27-3" tabindex="-1"></a>              .set_index(<span class="st">'sample_id'</span>)</span>
<span id="cb27-4"><a aria-hidden="true" href="#cb27-4" tabindex="-1"></a>              .to_dict()</span>
<span id="cb27-5"><a aria-hidden="true" href="#cb27-5" tabindex="-1"></a>              [<span class="st">'sample_mode'</span>]</span>
<span id="cb27-6"><a aria-hidden="true" href="#cb27-6" tabindex="-1"></a>             )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="36" id="cell-45">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a aria-hidden="true" href="#cb28-1" tabindex="-1"></a>sample_map <span class="op">=</span> (samples_info</span>
<span id="cb28-2"><a aria-hidden="true" href="#cb28-2" tabindex="-1"></a>              [[<span class="st">'sample_id'</span>, <span class="st">'sample_mode'</span>]]</span>
<span id="cb28-3"><a aria-hidden="true" href="#cb28-3" tabindex="-1"></a>              .set_index(<span class="st">'sample_id'</span>)</span>
<span id="cb28-4"><a aria-hidden="true" href="#cb28-4" tabindex="-1"></a>              .to_dict()</span>
<span id="cb28-5"><a aria-hidden="true" href="#cb28-5" tabindex="-1"></a>              [<span class="st">'sample_mode'</span>]</span>
<span id="cb28-6"><a aria-hidden="true" href="#cb28-6" tabindex="-1"></a>             )</span>
<span id="cb28-7"><a aria-hidden="true" href="#cb28-7" tabindex="-1"></a></span>
<span id="cb28-8"><a aria-hidden="true" href="#cb28-8" tabindex="-1"></a>unknown_per_sample <span class="op">=</span> (abundance_long_genera</span>
<span id="cb28-9"><a aria-hidden="true" href="#cb28-9" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb28-10"><a aria-hidden="true" href="#cb28-10" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb28-11"><a aria-hidden="true" href="#cb28-11" tabindex="-1"></a> .groupby(taxon_names <span class="op">+</span> [<span class="st">'sample_mode'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-12"><a aria-hidden="true" href="#cb28-12" tabindex="-1"></a> .counts.<span class="bu">sum</span>()</span>
<span id="cb28-13"><a aria-hidden="true" href="#cb28-13" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_mode'</span>, <span class="st">'sample_id'</span>])</span>
<span id="cb28-14"><a aria-hidden="true" href="#cb28-14" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> df: df.assign(relative_abundance<span class="op">=</span>df.counts <span class="op">/</span> df.counts.<span class="bu">sum</span>()))</span>
<span id="cb28-15"><a aria-hidden="true" href="#cb28-15" tabindex="-1"></a> .melt([<span class="st">'Kingdom'</span>, <span class="st">'sample_mode'</span>, <span class="st">'counts'</span>, <span class="st">'relative_abundance'</span>, <span class="st">'sample_id'</span>])</span>
<span id="cb28-16"><a aria-hidden="true" href="#cb28-16" tabindex="-1"></a> .query(<span class="st">'value == "unknown"'</span>)</span>
<span id="cb28-17"><a aria-hidden="true" href="#cb28-17" tabindex="-1"></a> .assign(variable<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.variable, categories<span class="op">=</span>taxon_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb28-18"><a aria-hidden="true" href="#cb28-18" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_mode'</span>, <span class="st">'variable'</span>, <span class="st">'sample_id'</span>])</span>
<span id="cb28-19"><a aria-hidden="true" href="#cb28-19" tabindex="-1"></a> .relative_abundance.<span class="bu">sum</span>()</span>
<span id="cb28-20"><a aria-hidden="true" href="#cb28-20" tabindex="-1"></a> .rename(<span class="st">'freq'</span>)</span>
<span id="cb28-21"><a aria-hidden="true" href="#cb28-21" tabindex="-1"></a> .reset_index()</span>
<span id="cb28-22"><a aria-hidden="true" href="#cb28-22" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.variable<span class="op">!=</span><span class="st">'Kingdom'</span>]</span>
<span id="cb28-23"><a aria-hidden="true" href="#cb28-23" tabindex="-1"></a>  .replace(<span class="dv">0</span>, np.NaN)</span>
<span id="cb28-24"><a aria-hidden="true" href="#cb28-24" tabindex="-1"></a>  .dropna()</span>
<span id="cb28-25"><a aria-hidden="true" href="#cb28-25" tabindex="-1"></a> .drop(columns<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb28-26"><a aria-hidden="true" href="#cb28-26" tabindex="-1"></a> .pivot(index<span class="op">=</span>[<span class="st">'variable'</span>, <span class="st">'Kingdom'</span>], columns<span class="op">=</span><span class="st">'sample_id'</span>, values<span class="op">=</span><span class="st">'freq'</span>)</span>
<span id="cb28-27"><a aria-hidden="true" href="#cb28-27" tabindex="-1"></a> .fillna(<span class="dv">0</span>)</span>
<span id="cb28-28"><a aria-hidden="true" href="#cb28-28" tabindex="-1"></a> .T</span>
<span id="cb28-29"><a aria-hidden="true" href="#cb28-29" tabindex="-1"></a> .reset_index()</span>
<span id="cb28-30"><a aria-hidden="true" href="#cb28-30" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb28-31"><a aria-hidden="true" href="#cb28-31" tabindex="-1"></a> .set_index([<span class="st">'sample_id'</span>, <span class="st">'sample_mode'</span>])</span>
<span id="cb28-32"><a aria-hidden="true" href="#cb28-32" tabindex="-1"></a>)</span>
<span id="cb28-33"><a aria-hidden="true" href="#cb28-33" tabindex="-1"></a>unknown_per_sample.to_csv(<span class="st">'../output/tables/unknown_per_sample.csv'</span>)</span>
<span id="cb28-34"><a aria-hidden="true" href="#cb28-34" tabindex="-1"></a></span>
<span id="cb28-35"><a aria-hidden="true" href="#cb28-35" tabindex="-1"></a>(unknown_per_sample.pipe(<span class="kw">lambda</span> dd: dd</span>
<span id="cb28-36"><a aria-hidden="true" href="#cb28-36" tabindex="-1"></a>     .style</span>
<span id="cb28-37"><a aria-hidden="true" href="#cb28-37" tabindex="-1"></a>     .background_gradient(cmap<span class="op">=</span><span class="st">'inferno'</span>, axis<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb28-38"><a aria-hidden="true" href="#cb28-38" tabindex="-1"></a>     .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:.2%}</span><span class="st">"</span>)</span>
<span id="cb28-39"><a aria-hidden="true" href="#cb28-39" tabindex="-1"></a>     .set_caption(<span class="st">'Percentage of reads that could not be identified'</span>)</span>
<span id="cb28-40"><a aria-hidden="true" href="#cb28-40" tabindex="-1"></a>))</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="36">
<style type="text/css">
#T_9b317_row0_col0, #T_9b317_row0_col2, #T_9b317_row0_col4, #T_9b317_row1_col0, #T_9b317_row1_col2, #T_9b317_row1_col4, #T_9b317_row1_col6, #T_9b317_row1_col8, #T_9b317_row2_col0, #T_9b317_row2_col2, #T_9b317_row2_col4, #T_9b317_row3_col0, #T_9b317_row3_col1, #T_9b317_row3_col2, #T_9b317_row3_col3, #T_9b317_row3_col4, #T_9b317_row3_col5, #T_9b317_row3_col6, #T_9b317_row3_col8, #T_9b317_row4_col0, #T_9b317_row4_col1, #T_9b317_row4_col2, #T_9b317_row4_col4, #T_9b317_row4_col6, #T_9b317_row4_col8, #T_9b317_row5_col0, #T_9b317_row5_col1, #T_9b317_row5_col2, #T_9b317_row5_col3, #T_9b317_row5_col4, #T_9b317_row5_col5, #T_9b317_row5_col6, #T_9b317_row5_col7, #T_9b317_row5_col9, #T_9b317_row6_col0, #T_9b317_row6_col1, #T_9b317_row6_col2, #T_9b317_row6_col3, #T_9b317_row6_col4, #T_9b317_row6_col6, #T_9b317_row7_col0, #T_9b317_row7_col1, #T_9b317_row7_col2, #T_9b317_row7_col4, #T_9b317_row7_col6, #T_9b317_row7_col8, #T_9b317_row8_col0, #T_9b317_row8_col1, #T_9b317_row8_col2, #T_9b317_row8_col3, #T_9b317_row8_col4, #T_9b317_row8_col5, #T_9b317_row8_col6, #T_9b317_row8_col7, #T_9b317_row9_col0, #T_9b317_row9_col2, #T_9b317_row9_col4, #T_9b317_row9_col6, #T_9b317_row10_col0, #T_9b317_row10_col2, #T_9b317_row10_col4, #T_9b317_row11_col0, #T_9b317_row11_col2, #T_9b317_row11_col4, #T_9b317_row11_col6, #T_9b317_row14_col1, #T_9b317_row14_col3, #T_9b317_row14_col5, #T_9b317_row14_col7, #T_9b317_row15_col1, #T_9b317_row16_col1, #T_9b317_row16_col3, #T_9b317_row16_col5, #T_9b317_row19_col1, #T_9b317_row20_col1, #T_9b317_row20_col3, #T_9b317_row20_col5, #T_9b317_row20_col7, #T_9b317_row20_col9 {
  background-color: #000004;
  color: #f1f1f1;
}
#T_9b317_row0_col1, #T_9b317_row6_col5 {
  background-color: #010108;
  color: #f1f1f1;
}
#T_9b317_row0_col3, #T_9b317_row2_col1, #T_9b317_row12_col2, #T_9b317_row13_col4, #T_9b317_row17_col2 {
  background-color: #040314;
  color: #f1f1f1;
}
#T_9b317_row0_col5, #T_9b317_row15_col9, #T_9b317_row16_col4, #T_9b317_row18_col2 {
  background-color: #060419;
  color: #f1f1f1;
}
#T_9b317_row0_col6, #T_9b317_row2_col6, #T_9b317_row4_col3, #T_9b317_row4_col5, #T_9b317_row5_col8, #T_9b317_row6_col8, #T_9b317_row8_col8, #T_9b317_row10_col6, #T_9b317_row11_col8 {
  background-color: #010005;
  color: #f1f1f1;
}
#T_9b317_row0_col7 {
  background-color: #0c0826;
  color: #f1f1f1;
}
#T_9b317_row0_col8, #T_9b317_row9_col8, #T_9b317_row10_col8, #T_9b317_row15_col0 {
  background-color: #010106;
  color: #f1f1f1;
}
#T_9b317_row0_col9 {
  background-color: #fcffa4;
  color: #000000;
}
#T_9b317_row1_col1, #T_9b317_row4_col9, #T_9b317_row13_col2, #T_9b317_row16_col2, #T_9b317_row18_col1, #T_9b317_row18_col3, #T_9b317_row18_col5, #T_9b317_row18_col7 {
  background-color: #040312;
  color: #f1f1f1;
}
#T_9b317_row1_col3, #T_9b317_row1_col5, #T_9b317_row17_col4, #T_9b317_row18_col9 {
  background-color: #09061f;
  color: #f1f1f1;
}
#T_9b317_row1_col7, #T_9b317_row9_col3, #T_9b317_row11_col5, #T_9b317_row17_col6 {
  background-color: #150b37;
  color: #f1f1f1;
}
#T_9b317_row1_col9 {
  background-color: #1c0c43;
  color: #f1f1f1;
}
#T_9b317_row2_col3 {
  background-color: #3b0964;
  color: #f1f1f1;
}
#T_9b317_row2_col5 {
  background-color: #550f6d;
  color: #f1f1f1;
}
#T_9b317_row2_col7, #T_9b317_row18_col8 {
  background-color: #88226a;
  color: #f1f1f1;
}
#T_9b317_row2_col8, #T_9b317_row13_col0, #T_9b317_row20_col0 {
  background-color: #02020c;
  color: #f1f1f1;
}
#T_9b317_row2_col9 {
  background-color: #ef6c23;
  color: #f1f1f1;
}
#T_9b317_row3_col7, #T_9b317_row12_col4 {
  background-color: #08051d;
  color: #f1f1f1;
}
#T_9b317_row3_col9 {
  background-color: #ed6925;
  color: #f1f1f1;
}
#T_9b317_row4_col7, #T_9b317_row9_col1, #T_9b317_row12_col0, #T_9b317_row16_col0, #T_9b317_row17_col0, #T_9b317_row20_col2 {
  background-color: #02020e;
  color: #f1f1f1;
}
#T_9b317_row6_col7, #T_9b317_row6_col9, #T_9b317_row11_col1, #T_9b317_row20_col4 {
  background-color: #07051b;
  color: #f1f1f1;
}
#T_9b317_row7_col3, #T_9b317_row7_col5 {
  background-color: #3e0966;
  color: #f1f1f1;
}
#T_9b317_row7_col7, #T_9b317_row9_col7, #T_9b317_row17_col8 {
  background-color: #490b6a;
  color: #f1f1f1;
}
#T_9b317_row7_col9 {
  background-color: #e8602d;
  color: #f1f1f1;
}
#T_9b317_row8_col9 {
  background-color: #ee6a24;
  color: #f1f1f1;
}
#T_9b317_row9_col5 {
  background-color: #340a5f;
  color: #f1f1f1;
}
#T_9b317_row9_col9 {
  background-color: #a82e5f;
  color: #f1f1f1;
}
#T_9b317_row10_col1, #T_9b317_row12_col1, #T_9b317_row14_col2, #T_9b317_row15_col6, #T_9b317_row19_col7 {
  background-color: #050417;
  color: #f1f1f1;
}
#T_9b317_row10_col3, #T_9b317_row17_col3 {
  background-color: #120a32;
  color: #f1f1f1;
}
#T_9b317_row10_col5 {
  background-color: #1b0c41;
  color: #f1f1f1;
}
#T_9b317_row10_col7, #T_9b317_row12_col8 {
  background-color: #420a68;
  color: #f1f1f1;
}
#T_9b317_row10_col9 {
  background-color: #bc3754;
  color: #f1f1f1;
}
#T_9b317_row11_col3 {
  background-color: #110a30;
  color: #f1f1f1;
}
#T_9b317_row11_col7 {
  background-color: #260c51;
  color: #f1f1f1;
}
#T_9b317_row11_col9 {
  background-color: #932667;
  color: #f1f1f1;
}
#T_9b317_row12_col3, #T_9b317_row12_col5 {
  background-color: #0e092b;
  color: #f1f1f1;
}
#T_9b317_row12_col6, #T_9b317_row15_col8, #T_9b317_row17_col5 {
  background-color: #190c3e;
  color: #f1f1f1;
}
#T_9b317_row12_col7 {
  background-color: #180c3c;
  color: #f1f1f1;
}
#T_9b317_row12_col9, #T_9b317_row19_col6 {
  background-color: #5a116e;
  color: #f1f1f1;
}
#T_9b317_row13_col1, #T_9b317_row13_col3, #T_9b317_row13_col5, #T_9b317_row13_col7, #T_9b317_row13_col9 {
  background-color: #2d0b59;
  color: #f1f1f1;
}
#T_9b317_row13_col6, #T_9b317_row14_col4, #T_9b317_row18_col4 {
  background-color: #0b0724;
  color: #f1f1f1;
}
#T_9b317_row13_col8, #T_9b317_row18_col6 {
  background-color: #280b53;
  color: #f1f1f1;
}
#T_9b317_row14_col0, #T_9b317_row15_col4, #T_9b317_row17_col1, #T_9b317_row18_col0 {
  background-color: #030210;
  color: #f1f1f1;
}
#T_9b317_row14_col6, #T_9b317_row19_col2 {
  background-color: #160b39;
  color: #f1f1f1;
}
#T_9b317_row14_col8 {
  background-color: #470b6a;
  color: #f1f1f1;
}
#T_9b317_row14_col9, #T_9b317_row15_col2, #T_9b317_row15_col3, #T_9b317_row15_col5, #T_9b317_row15_col7, #T_9b317_row19_col3, #T_9b317_row19_col5 {
  background-color: #02010a;
  color: #f1f1f1;
}
#T_9b317_row16_col6 {
  background-color: #0a0722;
  color: #f1f1f1;
}
#T_9b317_row16_col7 {
  background-color: #380962;
  color: #f1f1f1;
}
#T_9b317_row16_col8 {
  background-color: #2b0b57;
  color: #f1f1f1;
}
#T_9b317_row16_col9 {
  background-color: #972766;
  color: #f1f1f1;
}
#T_9b317_row17_col7 {
  background-color: #440a68;
  color: #f1f1f1;
}
#T_9b317_row17_col9 {
  background-color: #771c6d;
  color: #f1f1f1;
}
#T_9b317_row19_col0, #T_9b317_row20_col6 {
  background-color: #0d0829;
  color: #f1f1f1;
}
#T_9b317_row19_col4 {
  background-color: #230c4c;
  color: #f1f1f1;
}
#T_9b317_row19_col8 {
  background-color: #e05536;
  color: #f1f1f1;
}
#T_9b317_row19_col9 {
  background-color: #7d1e6d;
  color: #f1f1f1;
}
#T_9b317_row20_col8 {
  background-color: #320a5e;
  color: #f1f1f1;
}
</style>
<div class="quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true" id="T_9b317">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="T_9b317-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
TableÂ 1: Percentage of reads that could not be identified
</figcaption>
<div aria-describedby="T_9b317-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true" id="T_9b317">
<thead>
<tr class="header">
<th class="blank" data-quarto-table-cell-role="th">Â </th>
<th class="index_name level0" data-quarto-table-cell-role="th">variable</th>
<th class="col_heading level0 col0" colspan="2" data-quarto-table-cell-role="th" id="T_9b317_level0_col0">Phylum</th>
<th class="col_heading level0 col2" colspan="2" data-quarto-table-cell-role="th" id="T_9b317_level0_col2">Class</th>
<th class="col_heading level0 col4" colspan="2" data-quarto-table-cell-role="th" id="T_9b317_level0_col4">Order</th>
<th class="col_heading level0 col6" colspan="2" data-quarto-table-cell-role="th" id="T_9b317_level0_col6">Family</th>
<th class="col_heading level0 col8" colspan="2" data-quarto-table-cell-role="th" id="T_9b317_level0_col8">Genus</th>
</tr>
<tr class="odd">
<th class="blank" data-quarto-table-cell-role="th">Â </th>
<th class="index_name level1" data-quarto-table-cell-role="th">Kingdom</th>
<th class="col_heading level1 col0" data-quarto-table-cell-role="th" id="T_9b317_level1_col0">Bacteria</th>
<th class="col_heading level1 col1" data-quarto-table-cell-role="th" id="T_9b317_level1_col1">Fungi</th>
<th class="col_heading level1 col2" data-quarto-table-cell-role="th" id="T_9b317_level1_col2">Bacteria</th>
<th class="col_heading level1 col3" data-quarto-table-cell-role="th" id="T_9b317_level1_col3">Fungi</th>
<th class="col_heading level1 col4" data-quarto-table-cell-role="th" id="T_9b317_level1_col4">Bacteria</th>
<th class="col_heading level1 col5" data-quarto-table-cell-role="th" id="T_9b317_level1_col5">Fungi</th>
<th class="col_heading level1 col6" data-quarto-table-cell-role="th" id="T_9b317_level1_col6">Bacteria</th>
<th class="col_heading level1 col7" data-quarto-table-cell-role="th" id="T_9b317_level1_col7">Fungi</th>
<th class="col_heading level1 col8" data-quarto-table-cell-role="th" id="T_9b317_level1_col8">Bacteria</th>
<th class="col_heading level1 col9" data-quarto-table-cell-role="th" id="T_9b317_level1_col9">Fungi</th>
</tr>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">sample_id</th>
<th class="index_name level1" data-quarto-table-cell-role="th">sample_mode</th>
<th class="blank col0" data-quarto-table-cell-role="th">Â </th>
<th class="blank col1" data-quarto-table-cell-role="th">Â </th>
<th class="blank col2" data-quarto-table-cell-role="th">Â </th>
<th class="blank col3" data-quarto-table-cell-role="th">Â </th>
<th class="blank col4" data-quarto-table-cell-role="th">Â </th>
<th class="blank col5" data-quarto-table-cell-role="th">Â </th>
<th class="blank col6" data-quarto-table-cell-role="th">Â </th>
<th class="blank col7" data-quarto-table-cell-role="th">Â </th>
<th class="blank col8" data-quarto-table-cell-role="th">Â </th>
<th class="blank col9" data-quarto-table-cell-role="th">Â </th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="row_heading level0 row0" data-quarto-table-cell-role="th" id="T_9b317_level0_row0">S01</td>
<td class="row_heading level1 row0" data-quarto-table-cell-role="th" id="T_9b317_level1_row0">Flight</td>
<td class="data row0 col0" id="T_9b317_row0_col0">0.00%</td>
<td class="data row0 col1" id="T_9b317_row0_col1">0.23%</td>
<td class="data row0 col2" id="T_9b317_row0_col2">0.00%</td>
<td class="data row0 col3" id="T_9b317_row0_col3">0.56%</td>
<td class="data row0 col4" id="T_9b317_row0_col4">0.01%</td>
<td class="data row0 col5" id="T_9b317_row0_col5">0.70%</td>
<td class="data row0 col6" id="T_9b317_row0_col6">0.07%</td>
<td class="data row0 col7" id="T_9b317_row0_col7">1.09%</td>
<td class="data row0 col8" id="T_9b317_row0_col8">0.13%</td>
<td class="data row0 col9" id="T_9b317_row0_col9">15.56%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row1" data-quarto-table-cell-role="th" id="T_9b317_level0_row1">S02</td>
<td class="row_heading level1 row1" data-quarto-table-cell-role="th" id="T_9b317_level1_row1">Ground</td>
<td class="data row1 col0" id="T_9b317_row1_col0">0.00%</td>
<td class="data row1 col1" id="T_9b317_row1_col1">0.51%</td>
<td class="data row1 col2" id="T_9b317_row1_col2">0.00%</td>
<td class="data row1 col3" id="T_9b317_row1_col3">0.86%</td>
<td class="data row1 col4" id="T_9b317_row1_col4">0.00%</td>
<td class="data row1 col5" id="T_9b317_row1_col5">0.86%</td>
<td class="data row1 col6" id="T_9b317_row1_col6">0.01%</td>
<td class="data row1 col7" id="T_9b317_row1_col7">1.47%</td>
<td class="data row1 col8" id="T_9b317_row1_col8">0.04%</td>
<td class="data row1 col9" id="T_9b317_row1_col9">1.80%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row2" data-quarto-table-cell-role="th" id="T_9b317_level0_row2">S03</td>
<td class="row_heading level1 row2" data-quarto-table-cell-role="th" id="T_9b317_level1_row2">Flight</td>
<td class="data row2 col0" id="T_9b317_row2_col0">0.00%</td>
<td class="data row2 col1" id="T_9b317_row2_col1">0.55%</td>
<td class="data row2 col2" id="T_9b317_row2_col2">0.00%</td>
<td class="data row2 col3" id="T_9b317_row2_col3">2.88%</td>
<td class="data row2 col4" id="T_9b317_row2_col4">0.02%</td>
<td class="data row2 col5" id="T_9b317_row2_col5">3.85%</td>
<td class="data row2 col6" id="T_9b317_row2_col6">0.10%</td>
<td class="data row2 col7" id="T_9b317_row2_col7">5.79%</td>
<td class="data row2 col8" id="T_9b317_row2_col8">0.33%</td>
<td class="data row2 col9" id="T_9b317_row2_col9">10.46%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row3" data-quarto-table-cell-role="th" id="T_9b317_level0_row3">S04</td>
<td class="row_heading level1 row3" data-quarto-table-cell-role="th" id="T_9b317_level1_row3">Ground</td>
<td class="data row3 col0" id="T_9b317_row3_col0">0.00%</td>
<td class="data row3 col1" id="T_9b317_row3_col1">0.00%</td>
<td class="data row3 col2" id="T_9b317_row3_col2">0.00%</td>
<td class="data row3 col3" id="T_9b317_row3_col3">0.01%</td>
<td class="data row3 col4" id="T_9b317_row3_col4">0.00%</td>
<td class="data row3 col5" id="T_9b317_row3_col5">0.01%</td>
<td class="data row3 col6" id="T_9b317_row3_col6">0.00%</td>
<td class="data row3 col7" id="T_9b317_row3_col7">0.82%</td>
<td class="data row3 col8" id="T_9b317_row3_col8">0.01%</td>
<td class="data row3 col9" id="T_9b317_row3_col9">10.36%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row4" data-quarto-table-cell-role="th" id="T_9b317_level0_row4">S05</td>
<td class="row_heading level1 row4" data-quarto-table-cell-role="th" id="T_9b317_level1_row4">Flight</td>
<td class="data row4 col0" id="T_9b317_row4_col0">0.01%</td>
<td class="data row4 col1" id="T_9b317_row4_col1">0.05%</td>
<td class="data row4 col2" id="T_9b317_row4_col2">0.01%</td>
<td class="data row4 col3" id="T_9b317_row4_col3">0.08%</td>
<td class="data row4 col4" id="T_9b317_row4_col4">0.01%</td>
<td class="data row4 col5" id="T_9b317_row4_col5">0.08%</td>
<td class="data row4 col6" id="T_9b317_row4_col6">0.02%</td>
<td class="data row4 col7" id="T_9b317_row4_col7">0.37%</td>
<td class="data row4 col8" id="T_9b317_row4_col8">0.05%</td>
<td class="data row4 col9" id="T_9b317_row4_col9">0.50%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row5" data-quarto-table-cell-role="th" id="T_9b317_level0_row5">S06</td>
<td class="row_heading level1 row5" data-quarto-table-cell-role="th" id="T_9b317_level1_row5">Ground</td>
<td class="data row5 col0" id="T_9b317_row5_col0">0.00%</td>
<td class="data row5 col1" id="T_9b317_row5_col1">0.00%</td>
<td class="data row5 col2" id="T_9b317_row5_col2">0.00%</td>
<td class="data row5 col3" id="T_9b317_row5_col3">0.00%</td>
<td class="data row5 col4" id="T_9b317_row5_col4">0.00%</td>
<td class="data row5 col5" id="T_9b317_row5_col5">0.00%</td>
<td class="data row5 col6" id="T_9b317_row5_col6">0.04%</td>
<td class="data row5 col7" id="T_9b317_row5_col7">0.00%</td>
<td class="data row5 col8" id="T_9b317_row5_col8">0.11%</td>
<td class="data row5 col9" id="T_9b317_row5_col9">0.00%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row6" data-quarto-table-cell-role="th" id="T_9b317_level0_row6">S07</td>
<td class="row_heading level1 row6" data-quarto-table-cell-role="th" id="T_9b317_level1_row6">Flight</td>
<td class="data row6 col0" id="T_9b317_row6_col0">0.00%</td>
<td class="data row6 col1" id="T_9b317_row6_col1">0.00%</td>
<td class="data row6 col2" id="T_9b317_row6_col2">0.00%</td>
<td class="data row6 col3" id="T_9b317_row6_col3">0.00%</td>
<td class="data row6 col4" id="T_9b317_row6_col4">0.00%</td>
<td class="data row6 col5" id="T_9b317_row6_col5">0.18%</td>
<td class="data row6 col6" id="T_9b317_row6_col6">0.00%</td>
<td class="data row6 col7" id="T_9b317_row6_col7">0.74%</td>
<td class="data row6 col8" id="T_9b317_row6_col8">0.06%</td>
<td class="data row6 col9" id="T_9b317_row6_col9">0.74%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row7" data-quarto-table-cell-role="th" id="T_9b317_level0_row7">S08</td>
<td class="row_heading level1 row7" data-quarto-table-cell-role="th" id="T_9b317_level1_row7">Ground</td>
<td class="data row7 col0" id="T_9b317_row7_col0">0.00%</td>
<td class="data row7 col1" id="T_9b317_row7_col1">0.00%</td>
<td class="data row7 col2" id="T_9b317_row7_col2">0.00%</td>
<td class="data row7 col3" id="T_9b317_row7_col3">2.99%</td>
<td class="data row7 col4" id="T_9b317_row7_col4">0.00%</td>
<td class="data row7 col5" id="T_9b317_row7_col5">2.99%</td>
<td class="data row7 col6" id="T_9b317_row7_col6">0.00%</td>
<td class="data row7 col7" id="T_9b317_row7_col7">3.37%</td>
<td class="data row7 col8" id="T_9b317_row7_col8">0.05%</td>
<td class="data row7 col9" id="T_9b317_row7_col9">10.02%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row8" data-quarto-table-cell-role="th" id="T_9b317_level0_row8">S09</td>
<td class="row_heading level1 row8" data-quarto-table-cell-role="th" id="T_9b317_level1_row8">Flight</td>
<td class="data row8 col0" id="T_9b317_row8_col0">0.00%</td>
<td class="data row8 col1" id="T_9b317_row8_col1">0.00%</td>
<td class="data row8 col2" id="T_9b317_row8_col2">0.00%</td>
<td class="data row8 col3" id="T_9b317_row8_col3">0.00%</td>
<td class="data row8 col4" id="T_9b317_row8_col4">0.00%</td>
<td class="data row8 col5" id="T_9b317_row8_col5">0.00%</td>
<td class="data row8 col6" id="T_9b317_row8_col6">0.02%</td>
<td class="data row8 col7" id="T_9b317_row8_col7">0.00%</td>
<td class="data row8 col8" id="T_9b317_row8_col8">0.08%</td>
<td class="data row8 col9" id="T_9b317_row8_col9">10.43%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row9" data-quarto-table-cell-role="th" id="T_9b317_level0_row9">S10</td>
<td class="row_heading level1 row9" data-quarto-table-cell-role="th" id="T_9b317_level1_row9">Ground</td>
<td class="data row9 col0" id="T_9b317_row9_col0">0.00%</td>
<td class="data row9 col1" id="T_9b317_row9_col1">0.39%</td>
<td class="data row9 col2" id="T_9b317_row9_col2">0.00%</td>
<td class="data row9 col3" id="T_9b317_row9_col3">1.50%</td>
<td class="data row9 col4" id="T_9b317_row9_col4">0.03%</td>
<td class="data row9 col5" id="T_9b317_row9_col5">2.64%</td>
<td class="data row9 col6" id="T_9b317_row9_col6">0.04%</td>
<td class="data row9 col7" id="T_9b317_row9_col7">3.35%</td>
<td class="data row9 col8" id="T_9b317_row9_col8">0.17%</td>
<td class="data row9 col9" id="T_9b317_row9_col9">7.03%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row10" data-quarto-table-cell-role="th" id="T_9b317_level0_row10">S11</td>
<td class="row_heading level1 row10" data-quarto-table-cell-role="th" id="T_9b317_level1_row10">Ground</td>
<td class="data row10 col0" id="T_9b317_row10_col0">0.00%</td>
<td class="data row10 col1" id="T_9b317_row10_col1">0.64%</td>
<td class="data row10 col2" id="T_9b317_row10_col2">0.00%</td>
<td class="data row10 col3" id="T_9b317_row10_col3">1.36%</td>
<td class="data row10 col4" id="T_9b317_row10_col4">0.02%</td>
<td class="data row10 col5" id="T_9b317_row10_col5">1.76%</td>
<td class="data row10 col6" id="T_9b317_row10_col6">0.08%</td>
<td class="data row10 col7" id="T_9b317_row10_col7">3.15%</td>
<td class="data row10 col8" id="T_9b317_row10_col8">0.18%</td>
<td class="data row10 col9" id="T_9b317_row10_col9">7.80%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row11" data-quarto-table-cell-role="th" id="T_9b317_level0_row11">S12</td>
<td class="row_heading level1 row11" data-quarto-table-cell-role="th" id="T_9b317_level1_row11">Ground</td>
<td class="data row11 col0" id="T_9b317_row11_col0">0.00%</td>
<td class="data row11 col1" id="T_9b317_row11_col1">0.77%</td>
<td class="data row11 col2" id="T_9b317_row11_col2">0.01%</td>
<td class="data row11 col3" id="T_9b317_row11_col3">1.33%</td>
<td class="data row11 col4" id="T_9b317_row11_col4">0.01%</td>
<td class="data row11 col5" id="T_9b317_row11_col5">1.50%</td>
<td class="data row11 col6" id="T_9b317_row11_col6">0.03%</td>
<td class="data row11 col7" id="T_9b317_row11_col7">2.18%</td>
<td class="data row11 col8" id="T_9b317_row11_col8">0.09%</td>
<td class="data row11 col9" id="T_9b317_row11_col9">6.23%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row12" data-quarto-table-cell-role="th" id="T_9b317_level0_row12">S13</td>
<td class="row_heading level1 row12" data-quarto-table-cell-role="th" id="T_9b317_level1_row12">Flight</td>
<td class="data row12 col0" id="T_9b317_row12_col0">0.42%</td>
<td class="data row12 col1" id="T_9b317_row12_col1">0.67%</td>
<td class="data row12 col2" id="T_9b317_row12_col2">0.56%</td>
<td class="data row12 col3" id="T_9b317_row12_col3">1.18%</td>
<td class="data row12 col4" id="T_9b317_row12_col4">0.80%</td>
<td class="data row12 col5" id="T_9b317_row12_col5">1.18%</td>
<td class="data row12 col6" id="T_9b317_row12_col6">1.65%</td>
<td class="data row12 col7" id="T_9b317_row12_col7">1.60%</td>
<td class="data row12 col8" id="T_9b317_row12_col8">3.12%</td>
<td class="data row12 col9" id="T_9b317_row12_col9">4.02%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row13" data-quarto-table-cell-role="th" id="T_9b317_level0_row13">S15</td>
<td class="row_heading level1 row13" data-quarto-table-cell-role="th" id="T_9b317_level1_row13">Flight</td>
<td class="data row13 col0" id="T_9b317_row13_col0">0.35%</td>
<td class="data row13 col1" id="T_9b317_row13_col1">2.42%</td>
<td class="data row13 col2" id="T_9b317_row13_col2">0.51%</td>
<td class="data row13 col3" id="T_9b317_row13_col3">2.42%</td>
<td class="data row13 col4" id="T_9b317_row13_col4">0.58%</td>
<td class="data row13 col5" id="T_9b317_row13_col5">2.42%</td>
<td class="data row13 col6" id="T_9b317_row13_col6">0.98%</td>
<td class="data row13 col7" id="T_9b317_row13_col7">2.42%</td>
<td class="data row13 col8" id="T_9b317_row13_col8">2.19%</td>
<td class="data row13 col9" id="T_9b317_row13_col9">2.42%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row14" data-quarto-table-cell-role="th" id="T_9b317_level0_row14">S16</td>
<td class="row_heading level1 row14" data-quarto-table-cell-role="th" id="T_9b317_level1_row14">Ground</td>
<td class="data row14 col0" id="T_9b317_row14_col0">0.48%</td>
<td class="data row14 col1" id="T_9b317_row14_col1">0.00%</td>
<td class="data row14 col2" id="T_9b317_row14_col2">0.62%</td>
<td class="data row14 col3" id="T_9b317_row14_col3">0.00%</td>
<td class="data row14 col4" id="T_9b317_row14_col4">1.01%</td>
<td class="data row14 col5" id="T_9b317_row14_col5">0.00%</td>
<td class="data row14 col6" id="T_9b317_row14_col6">1.58%</td>
<td class="data row14 col7" id="T_9b317_row14_col7">0.00%</td>
<td class="data row14 col8" id="T_9b317_row14_col8">3.29%</td>
<td class="data row14 col9" id="T_9b317_row14_col9">0.26%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row15" data-quarto-table-cell-role="th" id="T_9b317_level0_row15">S17</td>
<td class="row_heading level1 row15" data-quarto-table-cell-role="th" id="T_9b317_level1_row15">Flight</td>
<td class="data row15 col0" id="T_9b317_row15_col0">0.13%</td>
<td class="data row15 col1" id="T_9b317_row15_col1">0.00%</td>
<td class="data row15 col2" id="T_9b317_row15_col2">0.28%</td>
<td class="data row15 col3" id="T_9b317_row15_col3">0.26%</td>
<td class="data row15 col4" id="T_9b317_row15_col4">0.43%</td>
<td class="data row15 col5" id="T_9b317_row15_col5">0.26%</td>
<td class="data row15 col6" id="T_9b317_row15_col6">0.63%</td>
<td class="data row15 col7" id="T_9b317_row15_col7">0.26%</td>
<td class="data row15 col8" id="T_9b317_row15_col8">1.67%</td>
<td class="data row15 col9" id="T_9b317_row15_col9">0.67%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row16" data-quarto-table-cell-role="th" id="T_9b317_level0_row16">S18</td>
<td class="row_heading level1 row16" data-quarto-table-cell-role="th" id="T_9b317_level1_row16">Ground</td>
<td class="data row16 col0" id="T_9b317_row16_col0">0.37%</td>
<td class="data row16 col1" id="T_9b317_row16_col1">0.00%</td>
<td class="data row16 col2" id="T_9b317_row16_col2">0.49%</td>
<td class="data row16 col3" id="T_9b317_row16_col3">0.00%</td>
<td class="data row16 col4" id="T_9b317_row16_col4">0.68%</td>
<td class="data row16 col5" id="T_9b317_row16_col5">0.00%</td>
<td class="data row16 col6" id="T_9b317_row16_col6">0.91%</td>
<td class="data row16 col7" id="T_9b317_row16_col7">2.76%</td>
<td class="data row16 col8" id="T_9b317_row16_col8">2.33%</td>
<td class="data row16 col9" id="T_9b317_row16_col9">6.34%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row17" data-quarto-table-cell-role="th" id="T_9b317_level0_row17">S19</td>
<td class="row_heading level1 row17" data-quarto-table-cell-role="th" id="T_9b317_level1_row17">Flight</td>
<td class="data row17 col0" id="T_9b317_row17_col0">0.43%</td>
<td class="data row17 col1" id="T_9b317_row17_col1">0.44%</td>
<td class="data row17 col2" id="T_9b317_row17_col2">0.57%</td>
<td class="data row17 col3" id="T_9b317_row17_col3">1.39%</td>
<td class="data row17 col4" id="T_9b317_row17_col4">0.86%</td>
<td class="data row17 col5" id="T_9b317_row17_col5">1.66%</td>
<td class="data row17 col6" id="T_9b317_row17_col6">1.47%</td>
<td class="data row17 col7" id="T_9b317_row17_col7">3.19%</td>
<td class="data row17 col8" id="T_9b317_row17_col8">3.35%</td>
<td class="data row17 col9" id="T_9b317_row17_col9">5.14%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row18" data-quarto-table-cell-role="th" id="T_9b317_level0_row18">S20</td>
<td class="row_heading level1 row18" data-quarto-table-cell-role="th" id="T_9b317_level1_row18">Ground</td>
<td class="data row18 col0" id="T_9b317_row18_col0">0.48%</td>
<td class="data row18 col1" id="T_9b317_row18_col1">0.51%</td>
<td class="data row18 col2" id="T_9b317_row18_col2">0.69%</td>
<td class="data row18 col3" id="T_9b317_row18_col3">0.51%</td>
<td class="data row18 col4" id="T_9b317_row18_col4">1.01%</td>
<td class="data row18 col5" id="T_9b317_row18_col5">0.51%</td>
<td class="data row18 col6" id="T_9b317_row18_col6">2.19%</td>
<td class="data row18 col7" id="T_9b317_row18_col7">0.51%</td>
<td class="data row18 col8" id="T_9b317_row18_col8">5.80%</td>
<td class="data row18 col9" id="T_9b317_row18_col9">0.86%</td>
</tr>
<tr class="even">
<td class="row_heading level0 row19" data-quarto-table-cell-role="th" id="T_9b317_level0_row19">S21</td>
<td class="row_heading level1 row19" data-quarto-table-cell-role="th" id="T_9b317_level1_row19">Flight</td>
<td class="data row19 col0" id="T_9b317_row19_col0">1.10%</td>
<td class="data row19 col1" id="T_9b317_row19_col1">0.00%</td>
<td class="data row19 col2" id="T_9b317_row19_col2">1.53%</td>
<td class="data row19 col3" id="T_9b317_row19_col3">0.25%</td>
<td class="data row19 col4" id="T_9b317_row19_col4">2.04%</td>
<td class="data row19 col5" id="T_9b317_row19_col5">0.25%</td>
<td class="data row19 col6" id="T_9b317_row19_col6">4.06%</td>
<td class="data row19 col7" id="T_9b317_row19_col7">0.66%</td>
<td class="data row19 col8" id="T_9b317_row19_col8">9.49%</td>
<td class="data row19 col9" id="T_9b317_row19_col9">5.37%</td>
</tr>
<tr class="odd">
<td class="row_heading level0 row20" data-quarto-table-cell-role="th" id="T_9b317_level0_row20">S22</td>
<td class="row_heading level1 row20" data-quarto-table-cell-role="th" id="T_9b317_level1_row20">Ground</td>
<td class="data row20 col0" id="T_9b317_row20_col0">0.32%</td>
<td class="data row20 col1" id="T_9b317_row20_col1">0.00%</td>
<td class="data row20 col2" id="T_9b317_row20_col2">0.42%</td>
<td class="data row20 col3" id="T_9b317_row20_col3">0.00%</td>
<td class="data row20 col4" id="T_9b317_row20_col4">0.75%</td>
<td class="data row20 col5" id="T_9b317_row20_col5">0.00%</td>
<td class="data row20 col6" id="T_9b317_row20_col6">1.15%</td>
<td class="data row20 col7" id="T_9b317_row20_col7">0.00%</td>
<td class="data row20 col8" id="T_9b317_row20_col8">2.58%</td>
<td class="data row20 col9" id="T_9b317_row20_col9">0.00%</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</section>
<section class="level3" id="exclusive-otus-per-sample-type">
<h3 class="anchored" data-anchor-id="exclusive-otus-per-sample-type">Exclusive OTUs per sample type</h3>
<p>In this section we will compute the number of OTUs, resolved to at least the <strong>Genus</strong> level, that belong to each group of sample types.</p>
<p>We will be looking at mainly two variables:</p>
<ul>
<li>Sample source: Ground or Flight level</li>
<li>Month of the sample: February or April</li>
</ul>
<div class="cell" data-execution_count="37" id="cell-48">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a aria-hidden="true" href="#cb29-1" tabindex="-1"></a>sample_types <span class="op">=</span> [<span class="st">'February-flight'</span>,</span>
<span id="cb29-2"><a aria-hidden="true" href="#cb29-2" tabindex="-1"></a>                <span class="st">'February-ground'</span>,</span>
<span id="cb29-3"><a aria-hidden="true" href="#cb29-3" tabindex="-1"></a>                <span class="st">'April-flight'</span>,</span>
<span id="cb29-4"><a aria-hidden="true" href="#cb29-4" tabindex="-1"></a>                <span class="st">'April-ground'</span>]</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we are looking into resolved OTUs, we will be removing the unknown Genera. On top of that, there are several resolved taxons that either refer to plants or to unresolved Genus-level values, so weâ€™ll make a list and remove all of those from the posterior analysis:</p>
<p>If we only consider an OTU present in a sample if <em>AT LEAST 2 READS</em> match with it, the distribution of number of samples in which each Genera-level OTU is found looks as the following:</p>
<div class="cell" data-execution_count="38" id="cell-51">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a aria-hidden="true" href="#cb30-1" tabindex="-1"></a>samples_per_otu <span class="op">=</span> (abundance_long_genera</span>
<span id="cb30-2"><a aria-hidden="true" href="#cb30-2" tabindex="-1"></a> .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb30-3"><a aria-hidden="true" href="#cb30-3" tabindex="-1"></a> .query(<span class="st">'counts &gt;= 2'</span>)</span>
<span id="cb30-4"><a aria-hidden="true" href="#cb30-4" tabindex="-1"></a> .groupby(taxon_names)</span>
<span id="cb30-5"><a aria-hidden="true" href="#cb30-5" tabindex="-1"></a> .size()</span>
<span id="cb30-6"><a aria-hidden="true" href="#cb30-6" tabindex="-1"></a> .rename(<span class="st">'n_samples'</span>)</span>
<span id="cb30-7"><a aria-hidden="true" href="#cb30-7" tabindex="-1"></a> .reset_index()</span>
<span id="cb30-8"><a aria-hidden="true" href="#cb30-8" tabindex="-1"></a>)</span>
<span id="cb30-9"><a aria-hidden="true" href="#cb30-9" tabindex="-1"></a></span>
<span id="cb30-10"><a aria-hidden="true" href="#cb30-10" tabindex="-1"></a>(samples_per_otu</span>
<span id="cb30-11"><a aria-hidden="true" href="#cb30-11" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: </span>
<span id="cb30-12"><a aria-hidden="true" href="#cb30-12" tabindex="-1"></a>       p9.ggplot(dd)</span>
<span id="cb30-13"><a aria-hidden="true" href="#cb30-13" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'n_samples'</span>, fill<span class="op">=</span><span class="st">'Kingdom'</span>)</span>
<span id="cb30-14"><a aria-hidden="true" href="#cb30-14" tabindex="-1"></a>       <span class="op">+</span> p9.geom_histogram(binwidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-15"><a aria-hidden="true" href="#cb30-15" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb30-16"><a aria-hidden="true" href="#cb30-16" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom'</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-17"><a aria-hidden="true" href="#cb30-17" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'"n = " + size'</span>), x<span class="op">=</span><span class="dv">18</span>, y<span class="op">=</span><span class="dv">130</span>, size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb30-18"><a aria-hidden="true" href="#cb30-18" tabindex="-1"></a>                                 data<span class="op">=</span>dd.groupby(<span class="st">'Kingdom'</span>, as_index<span class="op">=</span><span class="va">False</span>).size().astype(<span class="bu">str</span>))</span>
<span id="cb30-19"><a aria-hidden="true" href="#cb30-19" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb30-20"><a aria-hidden="true" href="#cb30-20" tabindex="-1"></a>       <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-21"><a aria-hidden="true" href="#cb30-21" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">'Present in $n$ samples'</span>, y<span class="op">=</span><span class="st">'Number of unique Genera'</span>)</span>
<span id="cb30-22"><a aria-hidden="true" href="#cb30-22" tabindex="-1"></a>       )</span>
<span id="cb30-23"><a aria-hidden="true" href="#cb30-23" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-31-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<p>If we look at the number of unique Genera which are present in just a single sample, they represent:</p>
<ul>
<li>29.4% (94) of all bacterial genera.</li>
<li>58.6% (143) of all fungal genera.</li>
</ul>
<p>Counting all the resolved OTUs at the Genus level, there are a total of <strong>564</strong> distinct genera present at least in one sample with at least two reads (320 bacterial, 244 fungal).</p>
<p>If we are a bit more strict and focus only on those genera that appear in at least 2 distinct samples, the distribution looks like the following:</p>
<div class="cell" data-execution_count="39" id="cell-53">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a aria-hidden="true" href="#cb31-1" tabindex="-1"></a>(samples_per_otu</span>
<span id="cb31-2"><a aria-hidden="true" href="#cb31-2" tabindex="-1"></a> .query(<span class="st">'n_samples &gt;= 2'</span>)</span>
<span id="cb31-3"><a aria-hidden="true" href="#cb31-3" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: </span>
<span id="cb31-4"><a aria-hidden="true" href="#cb31-4" tabindex="-1"></a>       p9.ggplot(dd)</span>
<span id="cb31-5"><a aria-hidden="true" href="#cb31-5" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'n_samples'</span>, fill<span class="op">=</span><span class="st">'Kingdom'</span>)</span>
<span id="cb31-6"><a aria-hidden="true" href="#cb31-6" tabindex="-1"></a>       <span class="op">+</span> p9.geom_histogram(binwidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-7"><a aria-hidden="true" href="#cb31-7" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb31-8"><a aria-hidden="true" href="#cb31-8" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom'</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-9"><a aria-hidden="true" href="#cb31-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'"n = " + size'</span>), x<span class="op">=</span><span class="dv">18</span>, y<span class="op">=</span><span class="dv">35</span>, size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb31-10"><a aria-hidden="true" href="#cb31-10" tabindex="-1"></a>                                 data<span class="op">=</span>dd.groupby(<span class="st">'Kingdom'</span>, as_index<span class="op">=</span><span class="va">False</span>).size().astype(<span class="bu">str</span>))</span>
<span id="cb31-11"><a aria-hidden="true" href="#cb31-11" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb31-12"><a aria-hidden="true" href="#cb31-12" tabindex="-1"></a>       <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-13"><a aria-hidden="true" href="#cb31-13" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">'Present in $n$ samples'</span>, y<span class="op">=</span><span class="st">'Number of unique Genera'</span>)</span>
<span id="cb31-14"><a aria-hidden="true" href="#cb31-14" tabindex="-1"></a>       )</span>
<span id="cb31-15"><a aria-hidden="true" href="#cb31-15" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-32-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<p>The total number of distinct genera is therefore 327, 226 of them bacterial and 101 fungal.</p>
<p>Take into account that fungal genera can appear at most in 20 samples since S06 didnâ€™t work for ITS. Bacterial genera can appear in a maximum of 21 samples.</p>
<p>IF we look at the <em>ubiquitous</em> genera, those that appear in every single sample, this is the list:</p>
<div class="cell" data-execution_count="40" id="cell-55">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a aria-hidden="true" href="#cb32-1" tabindex="-1"></a>samples_per_otu.query(<span class="st">'n_samples &gt;=20'</span>).set_index(<span class="st">'Kingdom'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Phylum</th>
<th data-quarto-table-cell-role="th">Class</th>
<th data-quarto-table-cell-role="th">Order</th>
<th data-quarto-table-cell-role="th">Family</th>
<th data-quarto-table-cell-role="th">Genus</th>
<th data-quarto-table-cell-role="th">n_samples</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Kingdom</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>Firmicutes</td>
<td>Bacilli</td>
<td>Lactobacillales</td>
<td>Streptococcaceae</td>
<td>Streptococcus</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>Firmicutes</td>
<td>Bacilli</td>
<td>Staphylococcales</td>
<td>Staphylococcaceae</td>
<td>Staphylococcus</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>Proteobacteria</td>
<td>Alphaproteobacteria</td>
<td>Rhizobiales</td>
<td>Beijerinckiaceae</td>
<td>Methylobacterium-Methylorubrum</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>Proteobacteria</td>
<td>Alphaproteobacteria</td>
<td>Rhizobiales</td>
<td>Rhizobiaceae</td>
<td>Ochrobactrum</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>Proteobacteria</td>
<td>Alphaproteobacteria</td>
<td>Sphingomonadales</td>
<td>Sphingomonadaceae</td>
<td>Porphyrobacter</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>Proteobacteria</td>
<td>Alphaproteobacteria</td>
<td>Sphingomonadales</td>
<td>Sphingomonadaceae</td>
<td>Sphingomonas</td>
<td>21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>Proteobacteria</td>
<td>Gammaproteobacteria</td>
<td>Burkholderiales</td>
<td>Comamonadaceae</td>
<td>Delftia</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>Proteobacteria</td>
<td>Gammaproteobacteria</td>
<td>Salinisphaerales</td>
<td>Solimonadaceae</td>
<td>Nevskia</td>
<td>21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Fungi</td>
<td>Ascomycota</td>
<td>Eurotiomycetes</td>
<td>Chaetothyriales</td>
<td>Herpotrichiellaceae</td>
<td>Exophiala</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Fungi</td>
<td>Basidiomycota</td>
<td>Malasseziomycetes</td>
<td>Malasseziales</td>
<td>Malasseziaceae</td>
<td>Malassezia</td>
<td>20</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="41" id="cell-57">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a aria-hidden="true" href="#cb33-1" tabindex="-1"></a>min_n_samples <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-2"><a aria-hidden="true" href="#cb33-2" tabindex="-1"></a>min_n_counts <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb33-3"><a aria-hidden="true" href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a aria-hidden="true" href="#cb33-4" tabindex="-1"></a>over_threshold_otus <span class="op">=</span> (samples_per_otu</span>
<span id="cb33-5"><a aria-hidden="true" href="#cb33-5" tabindex="-1"></a>        .query(<span class="ss">f"n_samples &gt;= </span><span class="sc">{</span>min_n_samples<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-6"><a aria-hidden="true" href="#cb33-6" tabindex="-1"></a>        .Genus</span>
<span id="cb33-7"><a aria-hidden="true" href="#cb33-7" tabindex="-1"></a>        .unique()</span>
<span id="cb33-8"><a aria-hidden="true" href="#cb33-8" tabindex="-1"></a>         )</span>
<span id="cb33-9"><a aria-hidden="true" href="#cb33-9" tabindex="-1"></a></span>
<span id="cb33-10"><a aria-hidden="true" href="#cb33-10" tabindex="-1"></a>counts_per_sample_type <span class="op">=</span> <span class="op">\</span></span>
<span id="cb33-11"><a aria-hidden="true" href="#cb33-11" tabindex="-1"></a>(abundance_long_genera</span>
<span id="cb33-12"><a aria-hidden="true" href="#cb33-12" tabindex="-1"></a> .merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb33-13"><a aria-hidden="true" href="#cb33-13" tabindex="-1"></a> .query(<span class="ss">f'counts &gt;= </span><span class="sc">{</span>min_n_counts<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb33-14"><a aria-hidden="true" href="#cb33-14" tabindex="-1"></a> .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb33-15"><a aria-hidden="true" href="#cb33-15" tabindex="-1"></a> .query(<span class="st">'Genus in @over_threshold_otus'</span>)</span>
<span id="cb33-16"><a aria-hidden="true" href="#cb33-16" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb33-17"><a aria-hidden="true" href="#cb33-17" tabindex="-1"></a> .groupby(taxon_names <span class="op">+</span> [<span class="st">'sample_mode'</span>, <span class="st">'month'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-18"><a aria-hidden="true" href="#cb33-18" tabindex="-1"></a> .counts.<span class="bu">sum</span>()</span>
<span id="cb33-19"><a aria-hidden="true" href="#cb33-19" tabindex="-1"></a> .pivot(index<span class="op">=</span>taxon_names, columns<span class="op">=</span>[<span class="st">'sample_mode'</span>, <span class="st">'month'</span>], values<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb33-20"><a aria-hidden="true" href="#cb33-20" tabindex="-1"></a>)</span>
<span id="cb33-21"><a aria-hidden="true" href="#cb33-21" tabindex="-1"></a></span>
<span id="cb33-22"><a aria-hidden="true" href="#cb33-22" tabindex="-1"></a>presence_by_sample_type <span class="op">=</span> (counts_per_sample_type</span>
<span id="cb33-23"><a aria-hidden="true" href="#cb33-23" tabindex="-1"></a> .melt(ignore_index<span class="op">=</span><span class="va">False</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb33-24"><a aria-hidden="true" href="#cb33-24" tabindex="-1"></a> .assign(present_in<span class="op">=</span><span class="kw">lambda</span> dd: dd.month <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> dd.sample_mode)</span>
<span id="cb33-25"><a aria-hidden="true" href="#cb33-25" tabindex="-1"></a> .dropna()</span>
<span id="cb33-26"><a aria-hidden="true" href="#cb33-26" tabindex="-1"></a> .groupby(taxon_names)</span>
<span id="cb33-27"><a aria-hidden="true" href="#cb33-27" tabindex="-1"></a> .agg({<span class="st">'counts'</span>: <span class="st">'sum'</span>, <span class="st">'present_in'</span>: <span class="st">'unique'</span>})</span>
<span id="cb33-28"><a aria-hidden="true" href="#cb33-28" tabindex="-1"></a> .assign(presence_type<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb33-29"><a aria-hidden="true" href="#cb33-29" tabindex="-1"></a>         dd.present_in.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'All sample types'</span> <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">==</span> <span class="dv">4</span> <span class="cf">else</span> (</span>
<span id="cb33-30"><a aria-hidden="true" href="#cb33-30" tabindex="-1"></a>         <span class="ss">f'Only </span><span class="sc">{</span>x[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">'</span> <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> (</span>
<span id="cb33-31"><a aria-hidden="true" href="#cb33-31" tabindex="-1"></a>         <span class="st">'All except '</span> <span class="op">+</span> <span class="bu">list</span>(<span class="bu">set</span>(sample_types).difference(<span class="bu">set</span>(x)))[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">==</span> <span class="dv">3</span> <span class="cf">else</span> (</span>
<span id="cb33-32"><a aria-hidden="true" href="#cb33-32" tabindex="-1"></a>         <span class="st">'Only February'</span> <span class="cf">if</span> <span class="st">'April'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="st">''</span>.join(x) <span class="cf">else</span> (</span>
<span id="cb33-33"><a aria-hidden="true" href="#cb33-33" tabindex="-1"></a>         <span class="st">'Only April'</span> <span class="cf">if</span> <span class="st">'February'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="st">''</span>.join(x) <span class="cf">else</span> (</span>
<span id="cb33-34"><a aria-hidden="true" href="#cb33-34" tabindex="-1"></a>         <span class="st">'Only Flight'</span> <span class="cf">if</span> <span class="st">'Ground'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="st">''</span>.join(x) <span class="cf">else</span> (</span>
<span id="cb33-35"><a aria-hidden="true" href="#cb33-35" tabindex="-1"></a>         <span class="st">'Only Ground'</span> <span class="cf">if</span> <span class="st">'Flight'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="st">''</span>.join(x) <span class="cf">else</span> (</span>
<span id="cb33-36"><a aria-hidden="true" href="#cb33-36" tabindex="-1"></a>         <span class="st">' and '</span>.join(x))</span>
<span id="cb33-37"><a aria-hidden="true" href="#cb33-37" tabindex="-1"></a>         ))))))</span>
<span id="cb33-38"><a aria-hidden="true" href="#cb33-38" tabindex="-1"></a>        ))</span>
<span id="cb33-39"><a aria-hidden="true" href="#cb33-39" tabindex="-1"></a>  .rename(columns<span class="op">=</span>{<span class="st">'counts'</span>: <span class="st">'total_counts'</span>})</span>
<span id="cb33-40"><a aria-hidden="true" href="#cb33-40" tabindex="-1"></a>.assign(month_presence<span class="op">=</span><span class="kw">lambda</span> dd: dd.presence_type.<span class="bu">apply</span>(<span class="kw">lambda</span> x: </span>
<span id="cb33-41"><a aria-hidden="true" href="#cb33-41" tabindex="-1"></a>    <span class="st">'Both months'</span> <span class="cf">if</span> <span class="st">'All'</span> <span class="kw">in</span> x <span class="kw">or</span> <span class="st">'and'</span> <span class="kw">in</span> x <span class="kw">or</span> x <span class="op">==</span> <span class="st">'Only Ground'</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">'Only Flight'</span> </span>
<span id="cb33-42"><a aria-hidden="true" href="#cb33-42" tabindex="-1"></a>                                                          <span class="cf">else</span> x.split(<span class="st">'-'</span>)[<span class="dv">0</span>]))</span>
<span id="cb33-43"><a aria-hidden="true" href="#cb33-43" tabindex="-1"></a> .assign(area_presence<span class="op">=</span><span class="kw">lambda</span> dd: dd.presence_type.<span class="bu">apply</span>(<span class="kw">lambda</span> x: </span>
<span id="cb33-44"><a aria-hidden="true" href="#cb33-44" tabindex="-1"></a>    <span class="st">'Both sites'</span> <span class="cf">if</span> <span class="st">'All'</span> <span class="kw">in</span> x <span class="kw">or</span> <span class="st">'and'</span> <span class="kw">in</span> x <span class="kw">or</span> x <span class="op">==</span> <span class="st">'Only February'</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">'Only April'</span> <span class="cf">else</span></span>
<span id="cb33-45"><a aria-hidden="true" href="#cb33-45" tabindex="-1"></a>                            <span class="st">'Only '</span> <span class="op">+</span> x.split(<span class="st">'-'</span>)[<span class="dv">1</span>].capitalize() <span class="cf">if</span> <span class="st">'-'</span> <span class="kw">in</span> x <span class="cf">else</span> x))        </span>
<span id="cb33-46"><a aria-hidden="true" href="#cb33-46" tabindex="-1"></a>)</span>
<span id="cb33-47"><a aria-hidden="true" href="#cb33-47" tabindex="-1"></a></span>
<span id="cb33-48"><a aria-hidden="true" href="#cb33-48" tabindex="-1"></a>counts_per_sample_type.columns <span class="op">=</span> counts_per_sample_type.columns.<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="st">'-'</span>.join(x))</span>
<span id="cb33-49"><a aria-hidden="true" href="#cb33-49" tabindex="-1"></a>presence_by_sample_type <span class="op">=</span> (presence_by_sample_type</span>
<span id="cb33-50"><a aria-hidden="true" href="#cb33-50" tabindex="-1"></a>      .merge(counts_per_sample_type, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-51"><a aria-hidden="true" href="#cb33-51" tabindex="-1"></a>      [[<span class="st">'total_counts'</span>, <span class="st">'Flight-February'</span>, <span class="st">'Flight-April'</span>, <span class="st">'Ground-February'</span>, <span class="st">'Ground-April'</span>,</span>
<span id="cb33-52"><a aria-hidden="true" href="#cb33-52" tabindex="-1"></a>        <span class="st">'month_presence'</span>, <span class="st">'area_presence'</span>, <span class="st">'presence_type'</span>]]</span>
<span id="cb33-53"><a aria-hidden="true" href="#cb33-53" tabindex="-1"></a>        .fillna(<span class="dv">0</span>)</span>
<span id="cb33-54"><a aria-hidden="true" href="#cb33-54" tabindex="-1"></a>        .applymap(<span class="kw">lambda</span> x: <span class="bu">int</span>(x) <span class="cf">if</span> <span class="bu">isinstance</span>(x, <span class="bu">float</span>) <span class="cf">else</span> x)</span>
<span id="cb33-55"><a aria-hidden="true" href="#cb33-55" tabindex="-1"></a>)</span>
<span id="cb33-56"><a aria-hidden="true" href="#cb33-56" tabindex="-1"></a></span>
<span id="cb33-57"><a aria-hidden="true" href="#cb33-57" tabindex="-1"></a>presence_by_sample_type.to_csv(<span class="st">'../output/tables/genera_presence_by_sample_type.csv'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="42" id="cell-58">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a aria-hidden="true" href="#cb34-1" tabindex="-1"></a>genera_long_df <span class="op">=</span> (abundance_df_genera</span>
<span id="cb34-2"><a aria-hidden="true" href="#cb34-2" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb34-3"><a aria-hidden="true" href="#cb34-3" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'Genus'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-4"><a aria-hidden="true" href="#cb34-4" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb34-5"><a aria-hidden="true" href="#cb34-5" tabindex="-1"></a> .melt([<span class="st">'Kingdom'</span>, <span class="st">'Genus'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb34-6"><a aria-hidden="true" href="#cb34-6" tabindex="-1"></a>)</span>
<span id="cb34-7"><a aria-hidden="true" href="#cb34-7" tabindex="-1"></a></span>
<span id="cb34-8"><a aria-hidden="true" href="#cb34-8" tabindex="-1"></a>top_10_genera <span class="op">=</span> (genera_long_df</span>
<span id="cb34-9"><a aria-hidden="true" href="#cb34-9" tabindex="-1"></a> .query(<span class="st">'Genus != "unknown"'</span>)</span>
<span id="cb34-10"><a aria-hidden="true" href="#cb34-10" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'Genus'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-11"><a aria-hidden="true" href="#cb34-11" tabindex="-1"></a> .agg({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb34-12"><a aria-hidden="true" href="#cb34-12" tabindex="-1"></a> .groupby(<span class="st">'Kingdom'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-13"><a aria-hidden="true" href="#cb34-13" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.sort_values(<span class="st">'counts'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>))</span>
<span id="cb34-14"><a aria-hidden="true" href="#cb34-14" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-15"><a aria-hidden="true" href="#cb34-15" tabindex="-1"></a> [<span class="st">'Genus'</span>]</span>
<span id="cb34-16"><a aria-hidden="true" href="#cb34-16" tabindex="-1"></a>)</span>
<span id="cb34-17"><a aria-hidden="true" href="#cb34-17" tabindex="-1"></a></span>
<span id="cb34-18"><a aria-hidden="true" href="#cb34-18" tabindex="-1"></a>f <span class="op">=</span> (genera_long_df</span>
<span id="cb34-19"><a aria-hidden="true" href="#cb34-19" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb34-20"><a aria-hidden="true" href="#cb34-20" tabindex="-1"></a> .replace({<span class="st">'Genus'</span>: {<span class="st">'unknown'</span>: pd.NA}})</span>
<span id="cb34-21"><a aria-hidden="true" href="#cb34-21" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.Genus.isin(top_10_genera) <span class="op">|</span> dd.Genus.isna(), dd.Genus, <span class="st">'Other'</span>))</span>
<span id="cb34-22"><a aria-hidden="true" href="#cb34-22" tabindex="-1"></a> .query(<span class="st">'Kingdom=="Bacteria"'</span>)</span>
<span id="cb34-23"><a aria-hidden="true" href="#cb34-23" tabindex="-1"></a> .assign(date_short<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.strftime(<span class="st">'%m/</span><span class="sc">%d</span><span class="st">'</span>))</span>
<span id="cb34-24"><a aria-hidden="true" href="#cb34-24" tabindex="-1"></a> .assign(date_short<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.sample_id<span class="op">==</span><span class="st">'S12'</span>, <span class="st">'02/28.5'</span>, dd.date_short))</span>
<span id="cb34-25"><a aria-hidden="true" href="#cb34-25" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb34-26"><a aria-hidden="true" href="#cb34-26" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'date_short'</span>, <span class="st">'counts'</span>, fill<span class="op">=</span><span class="st">'Genus'</span>, group<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb34-27"><a aria-hidden="true" href="#cb34-27" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col()</span>
<span id="cb34-28"><a aria-hidden="true" href="#cb34-28" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom + " " + sample_mode'</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-29"><a aria-hidden="true" href="#cb34-29" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Read Counts'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb34-30"><a aria-hidden="true" href="#cb34-30" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb34-31"><a aria-hidden="true" href="#cb34-31" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">45</span>),</span>
<span id="cb34-32"><a aria-hidden="true" href="#cb34-32" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb34-33"><a aria-hidden="true" href="#cb34-33" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, face<span class="op">=</span><span class="st">'italic'</span>),</span>
<span id="cb34-34"><a aria-hidden="true" href="#cb34-34" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span></span>
<span id="cb34-35"><a aria-hidden="true" href="#cb34-35" tabindex="-1"></a>                  )</span>
<span id="cb34-36"><a aria-hidden="true" href="#cb34-36" tabindex="-1"></a>       )</span>
<span id="cb34-37"><a aria-hidden="true" href="#cb34-37" tabindex="-1"></a>)</span>
<span id="cb34-38"><a aria-hidden="true" href="#cb34-38" tabindex="-1"></a>f.save(<span class="st">'../output/figures/top_10_genera_bac.svg'</span>)</span>
<span id="cb34-39"><a aria-hidden="true" href="#cb34-39" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>
<figure class="figure">
<p><img class="figure-img" height="1520" src="microbial_diversity_analysis_files/figure-html/cell-35-output-1.png" width="1497"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="47" id="cell-59">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a aria-hidden="true" href="#cb35-1" tabindex="-1"></a>blanks_abundance_df_16s <span class="op">=</span> (pd.read_csv(</span>
<span id="cb35-2"><a aria-hidden="true" href="#cb35-2" tabindex="-1"></a>    <span class="st">'../data/metagenomics/with_blank_pools/reduced_and_merged_ONLY_genus_16S.csv'</span></span>
<span id="cb35-3"><a aria-hidden="true" href="#cb35-3" tabindex="-1"></a>    )</span>
<span id="cb35-4"><a aria-hidden="true" href="#cb35-4" tabindex="-1"></a></span>
<span id="cb35-5"><a aria-hidden="true" href="#cb35-5" tabindex="-1"></a>.melt(<span class="st">'Genus'</span>, var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb35-6"><a aria-hidden="true" href="#cb35-6" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'sample_id'</span>]</span>
<span id="cb35-7"><a aria-hidden="true" href="#cb35-7" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">'subsampled'</span>, <span class="st">''</span>)</span>
<span id="cb35-8"><a aria-hidden="true" href="#cb35-8" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>)</span>
<span id="cb35-9"><a aria-hidden="true" href="#cb35-9" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">'new'</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">(new)'</span>)</span>
<span id="cb35-10"><a aria-hidden="true" href="#cb35-10" tabindex="-1"></a>        )</span>
<span id="cb35-11"><a aria-hidden="true" href="#cb35-11" tabindex="-1"></a>.replace({<span class="st">'Blank-Flightpool'</span>: <span class="st">'B_Flight'</span>,</span>
<span id="cb35-12"><a aria-hidden="true" href="#cb35-12" tabindex="-1"></a>          <span class="st">'Blank-Groundpool'</span>: <span class="st">'B_Ground'</span>,</span>
<span id="cb35-13"><a aria-hidden="true" href="#cb35-13" tabindex="-1"></a>          })</span>
<span id="cb35-14"><a aria-hidden="true" href="#cb35-14" tabindex="-1"></a>.query(<span class="st">'sample_id.str.contains("B_")'</span>)</span>
<span id="cb35-15"><a aria-hidden="true" href="#cb35-15" tabindex="-1"></a>.assign(Kingdom<span class="op">=</span><span class="st">'Bacteria'</span>)</span>
<span id="cb35-16"><a aria-hidden="true" href="#cb35-16" tabindex="-1"></a>)</span>
<span id="cb35-17"><a aria-hidden="true" href="#cb35-17" tabindex="-1"></a></span>
<span id="cb35-18"><a aria-hidden="true" href="#cb35-18" tabindex="-1"></a>blanks_abundance_df_its <span class="op">=</span> (pd.read_csv(</span>
<span id="cb35-19"><a aria-hidden="true" href="#cb35-19" tabindex="-1"></a>    <span class="st">'../data/metagenomics/with_blank_pools/complete_table_ITS.csv'</span></span>
<span id="cb35-20"><a aria-hidden="true" href="#cb35-20" tabindex="-1"></a>    )</span>
<span id="cb35-21"><a aria-hidden="true" href="#cb35-21" tabindex="-1"></a></span>
<span id="cb35-22"><a aria-hidden="true" href="#cb35-22" tabindex="-1"></a>.melt(<span class="st">'Genus'</span>, var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb35-23"><a aria-hidden="true" href="#cb35-23" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'sample_id'</span>]</span>
<span id="cb35-24"><a aria-hidden="true" href="#cb35-24" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">'subsampled'</span>, <span class="st">''</span>)</span>
<span id="cb35-25"><a aria-hidden="true" href="#cb35-25" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>)</span>
<span id="cb35-26"><a aria-hidden="true" href="#cb35-26" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">'new'</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">(new)'</span>)</span>
<span id="cb35-27"><a aria-hidden="true" href="#cb35-27" tabindex="-1"></a>        )</span>
<span id="cb35-28"><a aria-hidden="true" href="#cb35-28" tabindex="-1"></a>.replace({<span class="st">'Blank-Flightpool'</span>: <span class="st">'B_Flight'</span>,</span>
<span id="cb35-29"><a aria-hidden="true" href="#cb35-29" tabindex="-1"></a>          <span class="st">'Blank-Groundpool'</span>: <span class="st">'B_Ground'</span>,</span>
<span id="cb35-30"><a aria-hidden="true" href="#cb35-30" tabindex="-1"></a>          })</span>
<span id="cb35-31"><a aria-hidden="true" href="#cb35-31" tabindex="-1"></a>.query(<span class="st">'sample_id.str.contains("B_")'</span>)</span>
<span id="cb35-32"><a aria-hidden="true" href="#cb35-32" tabindex="-1"></a>.assign(Kingdom<span class="op">=</span><span class="st">'Fungi'</span>)</span>
<span id="cb35-33"><a aria-hidden="true" href="#cb35-33" tabindex="-1"></a>)</span>
<span id="cb35-34"><a aria-hidden="true" href="#cb35-34" tabindex="-1"></a></span>
<span id="cb35-35"><a aria-hidden="true" href="#cb35-35" tabindex="-1"></a>blanks_abundance_df <span class="op">=</span> pd.concat([blanks_abundance_df_16s, blanks_abundance_df_its])</span>
<span id="cb35-36"><a aria-hidden="true" href="#cb35-36" tabindex="-1"></a></span>
<span id="cb35-37"><a aria-hidden="true" href="#cb35-37" tabindex="-1"></a>full_genera_df <span class="op">=</span> (pd.concat([genera_long_df, blanks_abundance_df])</span>
<span id="cb35-38"><a aria-hidden="true" href="#cb35-38" tabindex="-1"></a>            .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb35-39"><a aria-hidden="true" href="#cb35-39" tabindex="-1"></a>            )   </span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="48" id="cell-60">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a aria-hidden="true" href="#cb36-1" tabindex="-1"></a>f <span class="op">=</span> (full_genera_df</span>
<span id="cb36-2"><a aria-hidden="true" href="#cb36-2" tabindex="-1"></a> .query(<span class="st">'sample_id.str.startswith("S")'</span>)</span>
<span id="cb36-3"><a aria-hidden="true" href="#cb36-3" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Fungi"'</span>)</span>
<span id="cb36-4"><a aria-hidden="true" href="#cb36-4" tabindex="-1"></a>  .assign(counts<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts.astype(<span class="bu">int</span>))</span>
<span id="cb36-5"><a aria-hidden="true" href="#cb36-5" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb36-6"><a aria-hidden="true" href="#cb36-6" tabindex="-1"></a> .replace({<span class="st">'Genus'</span>: {<span class="st">'unknown'</span>: pd.NA}})</span>
<span id="cb36-7"><a aria-hidden="true" href="#cb36-7" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.Genus.isin(top_10_genera) <span class="op">|</span> dd.Genus.isna(), dd.Genus, <span class="st">'Other'</span>))</span>
<span id="cb36-8"><a aria-hidden="true" href="#cb36-8" tabindex="-1"></a> .assign(date_short<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.strftime(<span class="st">'%m/</span><span class="sc">%d</span><span class="st">'</span>))</span>
<span id="cb36-9"><a aria-hidden="true" href="#cb36-9" tabindex="-1"></a> .assign(date_short<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.sample_id<span class="op">==</span><span class="st">'S12'</span>, <span class="st">'02/28.5'</span>, dd.date_short))</span>
<span id="cb36-10"><a aria-hidden="true" href="#cb36-10" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb36-11"><a aria-hidden="true" href="#cb36-11" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'date_short'</span>, <span class="st">'counts'</span>, fill<span class="op">=</span><span class="st">'Genus'</span>)</span>
<span id="cb36-12"><a aria-hidden="true" href="#cb36-12" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col(p9.aes(group<span class="op">=</span><span class="st">'sample_id'</span>))</span>
<span id="cb36-13"><a aria-hidden="true" href="#cb36-13" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom + " " + sample_mode'</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb36-14"><a aria-hidden="true" href="#cb36-14" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Read Counts'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb36-15"><a aria-hidden="true" href="#cb36-15" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb36-16"><a aria-hidden="true" href="#cb36-16" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">45</span>),</span>
<span id="cb36-17"><a aria-hidden="true" href="#cb36-17" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb36-18"><a aria-hidden="true" href="#cb36-18" tabindex="-1"></a>                                    legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, face<span class="op">=</span><span class="st">'italic'</span>),</span>
<span id="cb36-19"><a aria-hidden="true" href="#cb36-19" tabindex="-1"></a></span>
<span id="cb36-20"><a aria-hidden="true" href="#cb36-20" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span></span>
<span id="cb36-21"><a aria-hidden="true" href="#cb36-21" tabindex="-1"></a>                  )</span>
<span id="cb36-22"><a aria-hidden="true" href="#cb36-22" tabindex="-1"></a>       )</span>
<span id="cb36-23"><a aria-hidden="true" href="#cb36-23" tabindex="-1"></a>)</span>
<span id="cb36-24"><a aria-hidden="true" href="#cb36-24" tabindex="-1"></a>f.save(<span class="st">'../output/figures/top_10_genera_fun.svg'</span>)</span>
<span id="cb36-25"><a aria-hidden="true" href="#cb36-25" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>
<figure class="figure">
<p><img class="figure-img" height="1520" src="microbial_diversity_analysis_files/figure-html/cell-37-output-1.png" width="1293"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="49" id="cell-61">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a aria-hidden="true" href="#cb37-1" tabindex="-1"></a>(genera_long_df</span>
<span id="cb37-2"><a aria-hidden="true" href="#cb37-2" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb37-3"><a aria-hidden="true" href="#cb37-3" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.Genus.isin(top_10_genera), dd.Genus, <span class="st">'Other'</span>))</span>
<span id="cb37-4"><a aria-hidden="true" href="#cb37-4" tabindex="-1"></a> .query(<span class="st">'Kingdom=="Bacteria"'</span>)</span>
<span id="cb37-5"><a aria-hidden="true" href="#cb37-5" tabindex="-1"></a><span class="co">#  .groupby('Genus', as_index=False)</span></span>
<span id="cb37-6"><a aria-hidden="true" href="#cb37-6" tabindex="-1"></a><span class="co">#  .agg({'counts': 'sum'})</span></span>
<span id="cb37-7"><a aria-hidden="true" href="#cb37-7" tabindex="-1"></a> .assign(date_short<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.strftime(<span class="st">'%m/</span><span class="sc">%d</span><span class="st">'</span>))</span>
<span id="cb37-8"><a aria-hidden="true" href="#cb37-8" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb37-9"><a aria-hidden="true" href="#cb37-9" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'date_short'</span>, <span class="st">'counts'</span>, fill<span class="op">=</span><span class="st">'Genus'</span>)</span>
<span id="cb37-10"><a aria-hidden="true" href="#cb37-10" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col(p9.aes(group<span class="op">=</span><span class="st">'sample_id'</span>), position<span class="op">=</span><span class="st">'dodge'</span>)</span>
<span id="cb37-11"><a aria-hidden="true" href="#cb37-11" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom + " " + sample_mode'</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb37-12"><a aria-hidden="true" href="#cb37-12" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Read Counts'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb37-13"><a aria-hidden="true" href="#cb37-13" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">4.5</span>, <span class="dv">5</span>),</span>
<span id="cb37-14"><a aria-hidden="true" href="#cb37-14" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">45</span>),</span>
<span id="cb37-15"><a aria-hidden="true" href="#cb37-15" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb37-16"><a aria-hidden="true" href="#cb37-16" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span></span>
<span id="cb37-17"><a aria-hidden="true" href="#cb37-17" tabindex="-1"></a>                  )</span>
<span id="cb37-18"><a aria-hidden="true" href="#cb37-18" tabindex="-1"></a>       )</span>
<span id="cb37-19"><a aria-hidden="true" href="#cb37-19" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1500" src="microbial_diversity_analysis_files/figure-html/cell-38-output-1.png" width="1350"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="52" id="cell-62">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a aria-hidden="true" href="#cb38-1" tabindex="-1"></a>f <span class="op">=</span> (presence_by_sample_type</span>
<span id="cb38-2"><a aria-hidden="true" href="#cb38-2" tabindex="-1"></a> .groupby([<span class="st">'area_presence'</span>, <span class="st">'Kingdom'</span>], as_index<span class="op">=</span><span class="va">False</span>).size()</span>
<span id="cb38-3"><a aria-hidden="true" href="#cb38-3" tabindex="-1"></a> .assign(area_presence<span class="op">=</span><span class="kw">lambda</span> dd: dd.area_presence.<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))</span>
<span id="cb38-4"><a aria-hidden="true" href="#cb38-4" tabindex="-1"></a>    .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb38-5"><a aria-hidden="true" href="#cb38-5" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'area_presence'</span>, <span class="st">'size'</span>)</span>
<span id="cb38-6"><a aria-hidden="true" href="#cb38-6" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col(p9.aes(fill<span class="op">=</span><span class="st">'Kingdom'</span>))</span>
<span id="cb38-7"><a aria-hidden="true" href="#cb38-7" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'perc'</span>, y<span class="op">=</span><span class="st">'size + 10'</span>), ha<span class="op">=</span><span class="st">'center'</span>, color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'black'</span>, <span class="st">'black'</span>], size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb38-8"><a aria-hidden="true" href="#cb38-8" tabindex="-1"></a>                     data<span class="op">=</span>dd</span>
<span id="cb38-9"><a aria-hidden="true" href="#cb38-9" tabindex="-1"></a>                      .groupby(<span class="st">'area_presence'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-10"><a aria-hidden="true" href="#cb38-10" tabindex="-1"></a>                      .<span class="bu">sum</span>()</span>
<span id="cb38-11"><a aria-hidden="true" href="#cb38-11" tabindex="-1"></a>                      .assign(perc<span class="op">=</span><span class="kw">lambda</span> ddd: ((ddd[<span class="st">'size'</span>] <span class="op">/</span> ddd[<span class="st">'size'</span>].<span class="bu">sum</span>()) <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb38-12"><a aria-hidden="true" href="#cb38-12" tabindex="-1"></a>                              .astype(<span class="bu">str</span>)<span class="op">+</span> <span class="st">'%'</span>))</span>
<span id="cb38-13"><a aria-hidden="true" href="#cb38-13" tabindex="-1"></a>    <span class="co">#    + p9.coord_flip()</span></span>
<span id="cb38-14"><a aria-hidden="true" href="#cb38-14" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Number of unique genera'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb38-15"><a aria-hidden="true" href="#cb38-15" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values <span class="op">=</span> [<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>] )</span>
<span id="cb38-16"><a aria-hidden="true" href="#cb38-16" tabindex="-1"></a>       <span class="op">+</span> p9.ylim(<span class="dv">0</span>, <span class="dv">300</span>)</span>
<span id="cb38-17"><a aria-hidden="true" href="#cb38-17" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=</span><span class="fl">2.75</span>, y<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-18"><a aria-hidden="true" href="#cb38-18" tabindex="-1"></a>                     label<span class="op">=</span><span class="ss">f'n = </span><span class="sc">{</span>dd[<span class="st">"size"</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> genera'</span>, size<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb38-19"><a aria-hidden="true" href="#cb38-19" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">2</span>, <span class="fl">2.5</span>),</span>
<span id="cb38-20"><a aria-hidden="true" href="#cb38-20" tabindex="-1"></a>                  axis_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb38-21"><a aria-hidden="true" href="#cb38-21" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb38-22"><a aria-hidden="true" href="#cb38-22" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb38-23"><a aria-hidden="true" href="#cb38-23" tabindex="-1"></a>                  legend_position<span class="op">=</span>(<span class="fl">.735</span>, <span class="fl">.95</span>), legend_margin<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb38-24"><a aria-hidden="true" href="#cb38-24" tabindex="-1"></a>         )</span>
<span id="cb38-25"><a aria-hidden="true" href="#cb38-25" tabindex="-1"></a>)</span>
<span id="cb38-26"><a aria-hidden="true" href="#cb38-26" tabindex="-1"></a>f.save(<span class="st">'../output/figures/genera_presence_by_area_vert.svg'</span>)</span>
<span id="cb38-27"><a aria-hidden="true" href="#cb38-27" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<div>
<figure class="figure">
<p><img class="figure-img" height="798" src="microbial_diversity_analysis_files/figure-html/cell-39-output-1.png" width="648"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="56" id="cell-63">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a aria-hidden="true" href="#cb39-1" tabindex="-1"></a>f <span class="op">=</span> (presence_by_sample_type</span>
<span id="cb39-2"><a aria-hidden="true" href="#cb39-2" tabindex="-1"></a> .groupby([<span class="st">'month_presence'</span>, <span class="st">'Kingdom'</span>], as_index<span class="op">=</span><span class="va">False</span>).size()</span>
<span id="cb39-3"><a aria-hidden="true" href="#cb39-3" tabindex="-1"></a> .assign(month_presence<span class="op">=</span><span class="kw">lambda</span> dd: dd.month_presence.<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))</span>
<span id="cb39-4"><a aria-hidden="true" href="#cb39-4" tabindex="-1"></a>    .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb39-5"><a aria-hidden="true" href="#cb39-5" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'month_presence'</span>, <span class="st">'size'</span>)</span>
<span id="cb39-6"><a aria-hidden="true" href="#cb39-6" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col(p9.aes(fill<span class="op">=</span><span class="st">'Kingdom'</span>))</span>
<span id="cb39-7"><a aria-hidden="true" href="#cb39-7" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'perc'</span>, y<span class="op">=</span><span class="st">'size + 10'</span>), ha<span class="op">=</span><span class="st">'center'</span>, color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'black'</span>, <span class="st">'black'</span>], size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb39-8"><a aria-hidden="true" href="#cb39-8" tabindex="-1"></a>                     data<span class="op">=</span>dd</span>
<span id="cb39-9"><a aria-hidden="true" href="#cb39-9" tabindex="-1"></a>                      .groupby(<span class="st">'month_presence'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-10"><a aria-hidden="true" href="#cb39-10" tabindex="-1"></a>                      .<span class="bu">sum</span>()</span>
<span id="cb39-11"><a aria-hidden="true" href="#cb39-11" tabindex="-1"></a>                      .assign(perc<span class="op">=</span><span class="kw">lambda</span> ddd: ((ddd[<span class="st">'size'</span>] <span class="op">/</span> ddd[<span class="st">'size'</span>].<span class="bu">sum</span>()) <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb39-12"><a aria-hidden="true" href="#cb39-12" tabindex="-1"></a>                              .astype(<span class="bu">str</span>)<span class="op">+</span> <span class="st">'%'</span>))</span>
<span id="cb39-13"><a aria-hidden="true" href="#cb39-13" tabindex="-1"></a>    <span class="co">#    + p9.coord_flip()</span></span>
<span id="cb39-14"><a aria-hidden="true" href="#cb39-14" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Number of unique genera'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb39-15"><a aria-hidden="true" href="#cb39-15" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values <span class="op">=</span> [<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>] )</span>
<span id="cb39-16"><a aria-hidden="true" href="#cb39-16" tabindex="-1"></a>       <span class="op">+</span> p9.ylim(<span class="dv">0</span>, <span class="dv">300</span>)</span>
<span id="cb39-17"><a aria-hidden="true" href="#cb39-17" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=</span><span class="fl">2.75</span>, y<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-18"><a aria-hidden="true" href="#cb39-18" tabindex="-1"></a>                     label<span class="op">=</span><span class="ss">f'n = </span><span class="sc">{</span>dd[<span class="st">"size"</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> genera'</span>, size<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb39-19"><a aria-hidden="true" href="#cb39-19" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">2</span>, <span class="fl">2.5</span>),</span>
<span id="cb39-20"><a aria-hidden="true" href="#cb39-20" tabindex="-1"></a>                  axis_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb39-21"><a aria-hidden="true" href="#cb39-21" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb39-22"><a aria-hidden="true" href="#cb39-22" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb39-23"><a aria-hidden="true" href="#cb39-23" tabindex="-1"></a>                  legend_position<span class="op">=</span>(<span class="fl">.1</span>, <span class="dv">1</span>), legend_margin<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb39-24"><a aria-hidden="true" href="#cb39-24" tabindex="-1"></a>         )</span>
<span id="cb39-25"><a aria-hidden="true" href="#cb39-25" tabindex="-1"></a>)</span>
<span id="cb39-26"><a aria-hidden="true" href="#cb39-26" tabindex="-1"></a>f.save(<span class="st">'../output/figures/genera_presence_by_month_vert.svg'</span>)</span>
<span id="cb39-27"><a aria-hidden="true" href="#cb39-27" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>
<figure class="figure">
<p><img class="figure-img" height="798" src="microbial_diversity_analysis_files/figure-html/cell-40-output-1.png" width="648"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="57" id="cell-64">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a aria-hidden="true" href="#cb40-1" tabindex="-1"></a>f <span class="op">=</span> (presence_by_sample_type</span>
<span id="cb40-2"><a aria-hidden="true" href="#cb40-2" tabindex="-1"></a> .groupby([<span class="st">'area_presence'</span>, <span class="st">'Kingdom'</span>], as_index<span class="op">=</span><span class="va">False</span>).size()</span>
<span id="cb40-3"><a aria-hidden="true" href="#cb40-3" tabindex="-1"></a>    .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb40-4"><a aria-hidden="true" href="#cb40-4" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'area_presence'</span>, <span class="st">'size'</span>)</span>
<span id="cb40-5"><a aria-hidden="true" href="#cb40-5" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col(p9.aes(fill<span class="op">=</span><span class="st">'Kingdom'</span>))</span>
<span id="cb40-6"><a aria-hidden="true" href="#cb40-6" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'perc'</span>, y<span class="op">=</span><span class="st">'size + 5'</span>), ha<span class="op">=</span><span class="st">'left'</span>, color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'black'</span>, <span class="st">'black'</span>], size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb40-7"><a aria-hidden="true" href="#cb40-7" tabindex="-1"></a>                     data<span class="op">=</span>dd</span>
<span id="cb40-8"><a aria-hidden="true" href="#cb40-8" tabindex="-1"></a>                      .groupby(<span class="st">'area_presence'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-9"><a aria-hidden="true" href="#cb40-9" tabindex="-1"></a>                      .<span class="bu">sum</span>()</span>
<span id="cb40-10"><a aria-hidden="true" href="#cb40-10" tabindex="-1"></a>                      .assign(perc<span class="op">=</span><span class="kw">lambda</span> ddd: ((ddd[<span class="st">'size'</span>] <span class="op">/</span> ddd[<span class="st">'size'</span>].<span class="bu">sum</span>()) <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb40-11"><a aria-hidden="true" href="#cb40-11" tabindex="-1"></a>                              .astype(<span class="bu">str</span>)<span class="op">+</span> <span class="st">'%'</span>))</span>
<span id="cb40-12"><a aria-hidden="true" href="#cb40-12" tabindex="-1"></a>       <span class="op">+</span> p9.coord_flip()</span>
<span id="cb40-13"><a aria-hidden="true" href="#cb40-13" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Number of unique genera'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb40-14"><a aria-hidden="true" href="#cb40-14" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values <span class="op">=</span> [<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>] )</span>
<span id="cb40-15"><a aria-hidden="true" href="#cb40-15" tabindex="-1"></a>       <span class="op">+</span> p9.ylim(<span class="dv">0</span>, <span class="dv">330</span>)</span>
<span id="cb40-16"><a aria-hidden="true" href="#cb40-16" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=</span><span class="fl">3.4</span>, y<span class="op">=</span><span class="dv">270</span>,</span>
<span id="cb40-17"><a aria-hidden="true" href="#cb40-17" tabindex="-1"></a>                     label<span class="op">=</span><span class="ss">f'n = </span><span class="sc">{</span>dd[<span class="st">"size"</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> genera'</span>, size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb40-18"><a aria-hidden="true" href="#cb40-18" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.5</span>, <span class="dv">2</span>),</span>
<span id="cb40-19"><a aria-hidden="true" href="#cb40-19" tabindex="-1"></a>                  axis_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb40-20"><a aria-hidden="true" href="#cb40-20" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb40-21"><a aria-hidden="true" href="#cb40-21" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb40-22"><a aria-hidden="true" href="#cb40-22" tabindex="-1"></a>                  legend_position<span class="op">=</span>(<span class="fl">.835</span>, <span class="fl">.85</span>), legend_margin<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb40-23"><a aria-hidden="true" href="#cb40-23" tabindex="-1"></a>         )</span>
<span id="cb40-24"><a aria-hidden="true" href="#cb40-24" tabindex="-1"></a>)</span>
<span id="cb40-25"><a aria-hidden="true" href="#cb40-25" tabindex="-1"></a></span>
<span id="cb40-26"><a aria-hidden="true" href="#cb40-26" tabindex="-1"></a>f.save(<span class="st">'../output/figures/genera_presence_by_area.svg'</span>)</span>
<span id="cb40-27"><a aria-hidden="true" href="#cb40-27" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>
<figure class="figure">
<p><img class="figure-img" height="639" src="microbial_diversity_analysis_files/figure-html/cell-41-output-1.png" width="1089"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="58" id="cell-65">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a aria-hidden="true" href="#cb41-1" tabindex="-1"></a>f <span class="op">=</span> (presence_by_sample_type</span>
<span id="cb41-2"><a aria-hidden="true" href="#cb41-2" tabindex="-1"></a> .groupby([<span class="st">'month_presence'</span>, <span class="st">'Kingdom'</span>], as_index<span class="op">=</span><span class="va">False</span>).size()</span>
<span id="cb41-3"><a aria-hidden="true" href="#cb41-3" tabindex="-1"></a>    .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb41-4"><a aria-hidden="true" href="#cb41-4" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'month_presence'</span>, <span class="st">'size'</span>)</span>
<span id="cb41-5"><a aria-hidden="true" href="#cb41-5" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col(p9.aes(fill<span class="op">=</span><span class="st">'Kingdom'</span>))</span>
<span id="cb41-6"><a aria-hidden="true" href="#cb41-6" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'perc'</span>, y<span class="op">=</span><span class="st">'size + 5'</span>), ha<span class="op">=</span><span class="st">'left'</span>, color<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'black'</span>, <span class="st">'black'</span>], size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb41-7"><a aria-hidden="true" href="#cb41-7" tabindex="-1"></a>                     data<span class="op">=</span>dd</span>
<span id="cb41-8"><a aria-hidden="true" href="#cb41-8" tabindex="-1"></a>                      .groupby(<span class="st">'month_presence'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-9"><a aria-hidden="true" href="#cb41-9" tabindex="-1"></a>                      .<span class="bu">sum</span>()</span>
<span id="cb41-10"><a aria-hidden="true" href="#cb41-10" tabindex="-1"></a>                      .assign(perc<span class="op">=</span><span class="kw">lambda</span> ddd: ((ddd[<span class="st">'size'</span>] <span class="op">/</span> ddd[<span class="st">'size'</span>].<span class="bu">sum</span>()) <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb41-11"><a aria-hidden="true" href="#cb41-11" tabindex="-1"></a>                              .astype(<span class="bu">str</span>)<span class="op">+</span> <span class="st">'%'</span>))</span>
<span id="cb41-12"><a aria-hidden="true" href="#cb41-12" tabindex="-1"></a>       <span class="op">+</span> p9.coord_flip()</span>
<span id="cb41-13"><a aria-hidden="true" href="#cb41-13" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Number of unique genera'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb41-14"><a aria-hidden="true" href="#cb41-14" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values <span class="op">=</span> [<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>] )</span>
<span id="cb41-15"><a aria-hidden="true" href="#cb41-15" tabindex="-1"></a>       <span class="op">+</span> p9.ylim(<span class="dv">0</span>, <span class="dv">330</span>)</span>
<span id="cb41-16"><a aria-hidden="true" href="#cb41-16" tabindex="-1"></a>       <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-17"><a aria-hidden="true" href="#cb41-17" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=</span><span class="fl">.6</span>, y<span class="op">=</span><span class="dv">275</span>,</span>
<span id="cb41-18"><a aria-hidden="true" href="#cb41-18" tabindex="-1"></a>                     label<span class="op">=</span><span class="ss">f'n = </span><span class="sc">{</span>dd[<span class="st">"size"</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> genera'</span>, size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb41-19"><a aria-hidden="true" href="#cb41-19" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.5</span>, <span class="dv">2</span>),</span>
<span id="cb41-20"><a aria-hidden="true" href="#cb41-20" tabindex="-1"></a>                  axis_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb41-21"><a aria-hidden="true" href="#cb41-21" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb41-22"><a aria-hidden="true" href="#cb41-22" tabindex="-1"></a>                  legend_position<span class="op">=</span>(<span class="fl">.775</span>, <span class="fl">.75</span>), legend_margin<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb41-23"><a aria-hidden="true" href="#cb41-23" tabindex="-1"></a>         )</span>
<span id="cb41-24"><a aria-hidden="true" href="#cb41-24" tabindex="-1"></a>)</span>
<span id="cb41-25"><a aria-hidden="true" href="#cb41-25" tabindex="-1"></a></span>
<span id="cb41-26"><a aria-hidden="true" href="#cb41-26" tabindex="-1"></a>f.save(<span class="st">'../output/figures/genera_presence_by_month.svg'</span>)</span>
<span id="cb41-27"><a aria-hidden="true" href="#cb41-27" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>
<figure class="figure">
<p><img class="figure-img" height="639" src="microbial_diversity_analysis_files/figure-html/cell-42-output-1.png" width="1089"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="59" id="cell-66">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a aria-hidden="true" href="#cb42-1" tabindex="-1"></a>presence_by_sample_type.presence_type.value_counts().rename(<span class="st">'Number of genera'</span>).to_frame()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<div>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Number of genera</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">presence_type</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Only February-Flight</td>
<td>104</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Only February-Ground</td>
<td>97</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Only April</td>
<td>76</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Only April-Flight</td>
<td>71</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">All except April-flight</td>
<td>63</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">All sample types</td>
<td>52</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Only February</td>
<td>38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Only April-Ground</td>
<td>30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Only Ground</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Only Flight</td>
<td>11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">April-Flight and February-Ground</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">February-Flight and April-Ground</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section class="level3" id="filtering-for-correlation-analysis">
<h3 class="anchored" data-anchor-id="filtering-for-correlation-analysis">Filtering for correlation analysis</h3>
<p>Firstly, if we look at how many unique OTUs we observe at each taxonomic level:</p>
<div class="cell" data-execution_count="61" id="cell-69">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a aria-hidden="true" href="#cb43-1" tabindex="-1"></a>(abundance_long_genera</span>
<span id="cb43-2"><a aria-hidden="true" href="#cb43-2" tabindex="-1"></a>  .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb43-3"><a aria-hidden="true" href="#cb43-3" tabindex="-1"></a>  .query(<span class="st">'Phylum != "unknown"'</span>)</span>
<span id="cb43-4"><a aria-hidden="true" href="#cb43-4" tabindex="-1"></a>  .query(<span class="st">'Phylum != "Fungi_phy_Incertae_sedis"'</span>)</span>
<span id="cb43-5"><a aria-hidden="true" href="#cb43-5" tabindex="-1"></a>  .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb43-6"><a aria-hidden="true" href="#cb43-6" tabindex="-1"></a>  .merge(samples_info)</span>
<span id="cb43-7"><a aria-hidden="true" href="#cb43-7" tabindex="-1"></a>  .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb43-8"><a aria-hidden="true" href="#cb43-8" tabindex="-1"></a>  .groupby([<span class="st">'Kingdom'</span>])</span>
<span id="cb43-9"><a aria-hidden="true" href="#cb43-9" tabindex="-1"></a>  [taxon_names[<span class="dv">1</span>:]]</span>
<span id="cb43-10"><a aria-hidden="true" href="#cb43-10" tabindex="-1"></a>  .nunique()</span>
<span id="cb43-11"><a aria-hidden="true" href="#cb43-11" tabindex="-1"></a>  .T</span>
<span id="cb43-12"><a aria-hidden="true" href="#cb43-12" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Kingdom</th>
<th data-quarto-table-cell-role="th">Bacteria</th>
<th data-quarto-table-cell-role="th">Fungi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Phylum</td>
<td>15</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Class</td>
<td>25</td>
<td>19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Order</td>
<td>68</td>
<td>68</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Family</td>
<td>127</td>
<td>168</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Genus</td>
<td>305</td>
<td>266</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="63" id="cell-70">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a aria-hidden="true" href="#cb44-1" tabindex="-1"></a>df <span class="op">=</span> (abundance_long_genera</span>
<span id="cb44-2"><a aria-hidden="true" href="#cb44-2" tabindex="-1"></a>  .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb44-3"><a aria-hidden="true" href="#cb44-3" tabindex="-1"></a>  .query(<span class="st">'Phylum != "unknown"'</span>)</span>
<span id="cb44-4"><a aria-hidden="true" href="#cb44-4" tabindex="-1"></a>  .query(<span class="st">'Phylum != "Fungi_phy_Incertae_sedis"'</span>)</span>
<span id="cb44-5"><a aria-hidden="true" href="#cb44-5" tabindex="-1"></a>  .groupby([<span class="st">'Kingdom'</span>])</span>
<span id="cb44-6"><a aria-hidden="true" href="#cb44-6" tabindex="-1"></a>  [taxon_names[<span class="dv">1</span>:]]</span>
<span id="cb44-7"><a aria-hidden="true" href="#cb44-7" tabindex="-1"></a>  .nunique()</span>
<span id="cb44-8"><a aria-hidden="true" href="#cb44-8" tabindex="-1"></a>)</span>
<span id="cb44-9"><a aria-hidden="true" href="#cb44-9" tabindex="-1"></a></span>
<span id="cb44-10"><a aria-hidden="true" href="#cb44-10" tabindex="-1"></a>df.loc[<span class="st">'TOTAL'</span>] <span class="op">=</span> df.<span class="bu">sum</span>()</span>
<span id="cb44-11"><a aria-hidden="true" href="#cb44-11" tabindex="-1"></a>df.rename(columns<span class="op">=</span>{</span>
<span id="cb44-12"><a aria-hidden="true" href="#cb44-12" tabindex="-1"></a>    <span class="st">'Phylum'</span>: <span class="st">'Phyla'</span>,</span>
<span id="cb44-13"><a aria-hidden="true" href="#cb44-13" tabindex="-1"></a>    <span class="st">'Class'</span>: <span class="st">'Classes'</span>,</span>
<span id="cb44-14"><a aria-hidden="true" href="#cb44-14" tabindex="-1"></a>    <span class="st">'Order'</span>: <span class="st">'Orders'</span>,</span>
<span id="cb44-15"><a aria-hidden="true" href="#cb44-15" tabindex="-1"></a>    <span class="st">'Family'</span>: <span class="st">'Families'</span>,</span>
<span id="cb44-16"><a aria-hidden="true" href="#cb44-16" tabindex="-1"></a>    <span class="st">'Genus'</span>: <span class="st">'Genera'</span>})</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Phyla</th>
<th data-quarto-table-cell-role="th">Classes</th>
<th data-quarto-table-cell-role="th">Orders</th>
<th data-quarto-table-cell-role="th">Families</th>
<th data-quarto-table-cell-role="th">Genera</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Kingdom</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bacteria</td>
<td>15</td>
<td>25</td>
<td>68</td>
<td>127</td>
<td>305</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Fungi</td>
<td>2</td>
<td>19</td>
<td>68</td>
<td>168</td>
<td>266</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TOTAL</td>
<td>17</td>
<td>44</td>
<td>136</td>
<td>295</td>
<td>571</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Letâ€™s make a full scan of how the total number of Genera and Phyla changes as we change over these parameters:</p>
<div class="cell" data-execution_count="64" id="cell-72">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a aria-hidden="true" href="#cb45-1" tabindex="-1"></a>(abundance_long_phyla</span>
<span id="cb45-2"><a aria-hidden="true" href="#cb45-2" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>])</span>
<span id="cb45-3"><a aria-hidden="true" href="#cb45-3" tabindex="-1"></a> .counts.<span class="bu">sum</span>()</span>
<span id="cb45-4"><a aria-hidden="true" href="#cb45-4" tabindex="-1"></a> .sort_values()</span>
<span id="cb45-5"><a aria-hidden="true" href="#cb45-5" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>Kingdom   Phylum           
Bacteria  Dependentiae              10
          Gemmatimonadota           27
          Myxococcota               28
          Deinococcota              79
          Armatimonadota            98
          Patescibacteria          110
          Planctomycetota          119
          Chloroflexi              123
          Campylobacterota         245
          Cyanobacteria            273
          Desulfobacterota         476
          Fusobacteriota           565
          Acidobacteriota          581
          Verrucomicrobiota        835
          unknown                 2702
          Actinobacteriota        6048
Fungi     unknown                 9247
Bacteria  Bacteroidota           30860
          Firmicutes             66403
Fungi     Basidiomycota         222314
Bacteria  Proteobacteria       1562108
Fungi     Ascomycota           1964855
Name: counts, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="65" id="cell-73">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a aria-hidden="true" href="#cb47-1" tabindex="-1"></a>n_df <span class="op">=</span> pd.concat([</span>
<span id="cb47-2"><a aria-hidden="true" href="#cb47-2" tabindex="-1"></a> abundance_long_genera</span>
<span id="cb47-3"><a aria-hidden="true" href="#cb47-3" tabindex="-1"></a>  .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb47-4"><a aria-hidden="true" href="#cb47-4" tabindex="-1"></a>  .groupby([<span class="st">'Kingdom'</span>])</span>
<span id="cb47-5"><a aria-hidden="true" href="#cb47-5" tabindex="-1"></a>  [[<span class="st">'Genus'</span>]]</span>
<span id="cb47-6"><a aria-hidden="true" href="#cb47-6" tabindex="-1"></a>  .nunique(),</span>
<span id="cb47-7"><a aria-hidden="true" href="#cb47-7" tabindex="-1"></a>  (abundance_long_phyla</span>
<span id="cb47-8"><a aria-hidden="true" href="#cb47-8" tabindex="-1"></a>   .query(<span class="st">'Phylum not in ["unknown", "Fungi_phy_Incertae_sedis"]'</span>)</span>
<span id="cb47-9"><a aria-hidden="true" href="#cb47-9" tabindex="-1"></a>    .groupby([<span class="st">'Kingdom'</span>])</span>
<span id="cb47-10"><a aria-hidden="true" href="#cb47-10" tabindex="-1"></a>    [[<span class="st">'Phylum'</span>]]</span>
<span id="cb47-11"><a aria-hidden="true" href="#cb47-11" tabindex="-1"></a>    .nunique()</span>
<span id="cb47-12"><a aria-hidden="true" href="#cb47-12" tabindex="-1"></a>  )</span>
<span id="cb47-13"><a aria-hidden="true" href="#cb47-13" tabindex="-1"></a>]</span>
<span id="cb47-14"><a aria-hidden="true" href="#cb47-14" tabindex="-1"></a>).melt(ignore_index<span class="op">=</span><span class="va">False</span>, var_name<span class="op">=</span><span class="st">'level'</span>, value_name<span class="op">=</span><span class="st">'n'</span>).dropna().reset_index()</span>
<span id="cb47-15"><a aria-hidden="true" href="#cb47-15" tabindex="-1"></a></span>
<span id="cb47-16"><a aria-hidden="true" href="#cb47-16" tabindex="-1"></a>abundance_long_df <span class="op">=</span> pd.concat([</span>
<span id="cb47-17"><a aria-hidden="true" href="#cb47-17" tabindex="-1"></a>    (abundance_long_genera</span>
<span id="cb47-18"><a aria-hidden="true" href="#cb47-18" tabindex="-1"></a>    .assign(level<span class="op">=</span><span class="st">'Genera'</span>)</span>
<span id="cb47-19"><a aria-hidden="true" href="#cb47-19" tabindex="-1"></a>    .query(<span class="st">'Genus not in @inconclusive_list'</span>)),</span>
<span id="cb47-20"><a aria-hidden="true" href="#cb47-20" tabindex="-1"></a>    (abundance_long_phyla</span>
<span id="cb47-21"><a aria-hidden="true" href="#cb47-21" tabindex="-1"></a>     .assign(level<span class="op">=</span><span class="st">'Phyla'</span>)</span>
<span id="cb47-22"><a aria-hidden="true" href="#cb47-22" tabindex="-1"></a>     .query(<span class="st">'Phylum != "unknown"'</span>)),</span>
<span id="cb47-23"><a aria-hidden="true" href="#cb47-23" tabindex="-1"></a>])</span>
<span id="cb47-24"><a aria-hidden="true" href="#cb47-24" tabindex="-1"></a></span>
<span id="cb47-25"><a aria-hidden="true" href="#cb47-25" tabindex="-1"></a>scan_df_list <span class="op">=</span> []</span>
<span id="cb47-26"><a aria-hidden="true" href="#cb47-26" tabindex="-1"></a><span class="cf">for</span> min_counts, min_samples <span class="kw">in</span> product(<span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>), <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>)):</span>
<span id="cb47-27"><a aria-hidden="true" href="#cb47-27" tabindex="-1"></a>    scan_df_list.append(</span>
<span id="cb47-28"><a aria-hidden="true" href="#cb47-28" tabindex="-1"></a>        (abundance_long_df</span>
<span id="cb47-29"><a aria-hidden="true" href="#cb47-29" tabindex="-1"></a>         .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb47-30"><a aria-hidden="true" href="#cb47-30" tabindex="-1"></a>         .query(<span class="st">'counts &gt;= @min_counts'</span>)</span>
<span id="cb47-31"><a aria-hidden="true" href="#cb47-31" tabindex="-1"></a>         .groupby(taxon_names <span class="op">+</span> [<span class="st">'level'</span>], as_index<span class="op">=</span><span class="va">False</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-32"><a aria-hidden="true" href="#cb47-32" tabindex="-1"></a>         .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: pd.Series(dd.loc[dd[<span class="st">'counts'</span>] <span class="op">&gt;=</span> min_counts].shape[<span class="dv">0</span>]))</span>
<span id="cb47-33"><a aria-hidden="true" href="#cb47-33" tabindex="-1"></a>         .assign(over_threshold<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="dv">0</span>] <span class="op">&gt;=</span> min_samples)</span>
<span id="cb47-34"><a aria-hidden="true" href="#cb47-34" tabindex="-1"></a>         .groupby([<span class="st">'Kingdom'</span>, <span class="st">'level'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-35"><a aria-hidden="true" href="#cb47-35" tabindex="-1"></a>         .over_threshold</span>
<span id="cb47-36"><a aria-hidden="true" href="#cb47-36" tabindex="-1"></a>         .agg({<span class="st">'over'</span>: <span class="st">'mean'</span>, <span class="st">'total_over'</span>: <span class="st">'sum'</span>})</span>
<span id="cb47-37"><a aria-hidden="true" href="#cb47-37" tabindex="-1"></a>         .assign(min_counts<span class="op">=</span>min_counts, min_samples<span class="op">=</span>min_samples)</span>
<span id="cb47-38"><a aria-hidden="true" href="#cb47-38" tabindex="-1"></a>        )</span>
<span id="cb47-39"><a aria-hidden="true" href="#cb47-39" tabindex="-1"></a>    )</span>
<span id="cb47-40"><a aria-hidden="true" href="#cb47-40" tabindex="-1"></a></span>
<span id="cb47-41"><a aria-hidden="true" href="#cb47-41" tabindex="-1"></a>scan_df <span class="op">=</span> (pd.concat(scan_df_list)</span>
<span id="cb47-42"><a aria-hidden="true" href="#cb47-42" tabindex="-1"></a>    .merge(n_df.replace({<span class="st">'level'</span>: {<span class="st">'Phylum'</span>: <span class="st">'Phyla'</span>, <span class="st">'Genus'</span>: <span class="st">'Genera'</span>}}))</span>
<span id="cb47-43"><a aria-hidden="true" href="#cb47-43" tabindex="-1"></a>    .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'total_over'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'/'</span> <span class="op">+</span> dd[<span class="st">'n'</span>].astype(<span class="bu">int</span>).astype(<span class="bu">str</span>))</span>
<span id="cb47-44"><a aria-hidden="true" href="#cb47-44" tabindex="-1"></a>    .assign(percent_label<span class="op">=</span><span class="kw">lambda</span> dd: (dd[<span class="st">'over'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>).astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'%'</span>)</span>
<span id="cb47-45"><a aria-hidden="true" href="#cb47-45" tabindex="-1"></a>    .assign(criteria_label<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb47-46"><a aria-hidden="true" href="#cb47-46" tabindex="-1"></a>            <span class="st">'r='</span> <span class="op">+</span> dd[<span class="st">'min_counts'</span>].astype(<span class="bu">str</span>)  <span class="op">+</span> </span>
<span id="cb47-47"><a aria-hidden="true" href="#cb47-47" tabindex="-1"></a>            <span class="st">'; n='</span> <span class="op">+</span> dd[<span class="st">'min_samples'</span>].astype(<span class="bu">str</span>))</span>
<span id="cb47-48"><a aria-hidden="true" href="#cb47-48" tabindex="-1"></a>    .assign(criteria_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd[<span class="st">'criteria_label'</span>], </span>
<span id="cb47-49"><a aria-hidden="true" href="#cb47-49" tabindex="-1"></a>                                                     categories<span class="op">=</span>dd[<span class="st">'criteria_label'</span>].unique(),</span>
<span id="cb47-50"><a aria-hidden="true" href="#cb47-50" tabindex="-1"></a>                                                    ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb47-51"><a aria-hidden="true" href="#cb47-51" tabindex="-1"></a>          )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="66" id="cell-74">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a aria-hidden="true" href="#cb48-1" tabindex="-1"></a>f <span class="op">=</span> (scan_df</span>
<span id="cb48-2"><a aria-hidden="true" href="#cb48-2" tabindex="-1"></a>.assign(source_level<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'level'</span>] <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> dd[<span class="st">'Kingdom'</span>]) </span>
<span id="cb48-3"><a aria-hidden="true" href="#cb48-3" tabindex="-1"></a>.assign(pos<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.over <span class="op">&gt;</span> <span class="fl">.9</span>, <span class="dv">0</span>, dd.over))</span>
<span id="cb48-4"><a aria-hidden="true" href="#cb48-4" tabindex="-1"></a>.assign(label_len<span class="op">=</span><span class="kw">lambda</span> dd: dd.label.<span class="bu">str</span>.<span class="bu">len</span>())</span>
<span id="cb48-5"><a aria-hidden="true" href="#cb48-5" tabindex="-1"></a>.assign(pos<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.label_len <span class="op">&gt;</span> dd.over <span class="op">*</span> <span class="dv">10</span>, dd.over, <span class="dv">0</span>))</span>
<span id="cb48-6"><a aria-hidden="true" href="#cb48-6" tabindex="-1"></a>.pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb48-7"><a aria-hidden="true" href="#cb48-7" tabindex="-1"></a>        <span class="op">+</span> p9.aes(<span class="st">'source_level'</span>, <span class="st">'over'</span>)</span>
<span id="cb48-8"><a aria-hidden="true" href="#cb48-8" tabindex="-1"></a>        <span class="op">+</span> p9.facet_wrap(<span class="st">'criteria_label'</span>, ncol<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb48-9"><a aria-hidden="true" href="#cb48-9" tabindex="-1"></a>        <span class="op">+</span> p9.geom_col()</span>
<span id="cb48-10"><a aria-hidden="true" href="#cb48-10" tabindex="-1"></a>        <span class="op">+</span> p9.scale_y_continuous(</span>
<span id="cb48-11"><a aria-hidden="true" href="#cb48-11" tabindex="-1"></a>            labels<span class="op">=</span>percent_format(),</span>
<span id="cb48-12"><a aria-hidden="true" href="#cb48-12" tabindex="-1"></a>            limits<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">1.35</span>),</span>
<span id="cb48-13"><a aria-hidden="true" href="#cb48-13" tabindex="-1"></a>            breaks<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb48-14"><a aria-hidden="true" href="#cb48-14" tabindex="-1"></a>        <span class="op">+</span> p9.geom_text(p9.aes(y<span class="op">=</span><span class="st">'pos'</span>, label<span class="op">=</span><span class="st">'label'</span>, color<span class="op">=</span><span class="st">'pos &lt; over'</span>),</span>
<span id="cb48-15"><a aria-hidden="true" href="#cb48-15" tabindex="-1"></a>                       nudge_y<span class="op">=</span><span class="fl">.02</span>, size<span class="op">=</span><span class="dv">8</span>, ha<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb48-16"><a aria-hidden="true" href="#cb48-16" tabindex="-1"></a>        <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'black'</span>, <span class="st">'white'</span>])</span>
<span id="cb48-17"><a aria-hidden="true" href="#cb48-17" tabindex="-1"></a>        <span class="op">+</span> p9.coord_flip()</span>
<span id="cb48-18"><a aria-hidden="true" href="#cb48-18" tabindex="-1"></a>        <span class="op">+</span> p9.guides(color<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-19"><a aria-hidden="true" href="#cb48-19" tabindex="-1"></a>        <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'</span><span class="sc">% o</span><span class="st">f taxa kept after filter'</span>,</span>
<span id="cb48-20"><a aria-hidden="true" href="#cb48-20" tabindex="-1"></a>                  caption<span class="op">=</span><span class="st">"*r = Min number of reads; n = Min number of different samples"</span>)</span>
<span id="cb48-21"><a aria-hidden="true" href="#cb48-21" tabindex="-1"></a>        <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">9</span>),</span>
<span id="cb48-22"><a aria-hidden="true" href="#cb48-22" tabindex="-1"></a>                   axis_title_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>))</span>
<span id="cb48-23"><a aria-hidden="true" href="#cb48-23" tabindex="-1"></a>)</span>
<span id="cb48-24"><a aria-hidden="true" href="#cb48-24" tabindex="-1"></a>)</span>
<span id="cb48-25"><a aria-hidden="true" href="#cb48-25" tabindex="-1"></a>f.save(<span class="st">'../output/figures/scan_filtering.svg'</span>)</span>
<span id="cb48-26"><a aria-hidden="true" href="#cb48-26" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>
<figure class="figure">
<p><img class="figure-img" height="2696" src="microbial_diversity_analysis_files/figure-html/cell-48-output-1.png" width="2412"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="67" id="cell-75">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a aria-hidden="true" href="#cb49-1" tabindex="-1"></a>f <span class="op">=</span> (abundance_long_df</span>
<span id="cb49-2"><a aria-hidden="true" href="#cb49-2" tabindex="-1"></a> .groupby(taxon_names <span class="op">+</span> [<span class="st">'level'</span>], as_index<span class="op">=</span><span class="va">False</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-3"><a aria-hidden="true" href="#cb49-3" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: pd.Series(dd.loc[dd[<span class="st">'counts'</span>] <span class="op">&gt;=</span> <span class="dv">2</span>].shape[<span class="dv">0</span>]))</span>
<span id="cb49-4"><a aria-hidden="true" href="#cb49-4" tabindex="-1"></a> .assign(over_threshold<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="dv">0</span>] <span class="op">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb49-5"><a aria-hidden="true" href="#cb49-5" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'level'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-6"><a aria-hidden="true" href="#cb49-6" tabindex="-1"></a> .over_threshold</span>
<span id="cb49-7"><a aria-hidden="true" href="#cb49-7" tabindex="-1"></a> .agg({<span class="st">'over'</span>: <span class="st">'mean'</span>, <span class="st">'total_over'</span>: <span class="st">'sum'</span>, <span class="st">'n'</span>: <span class="st">'size'</span>})</span>
<span id="cb49-8"><a aria-hidden="true" href="#cb49-8" tabindex="-1"></a> .reset_index()</span>
<span id="cb49-9"><a aria-hidden="true" href="#cb49-9" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'total_over'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'/'</span> <span class="op">+</span> dd[<span class="st">'n'</span>].astype(<span class="bu">str</span>))</span>
<span id="cb49-10"><a aria-hidden="true" href="#cb49-10" tabindex="-1"></a> .assign(percent_label<span class="op">=</span><span class="kw">lambda</span> dd: (dd[<span class="st">'over'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>).astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'%'</span>)</span>
<span id="cb49-11"><a aria-hidden="true" href="#cb49-11" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb49-12"><a aria-hidden="true" href="#cb49-12" tabindex="-1"></a>        <span class="op">+</span> p9.aes(<span class="st">'Kingdom'</span>, <span class="st">'over'</span>)</span>
<span id="cb49-13"><a aria-hidden="true" href="#cb49-13" tabindex="-1"></a>        <span class="op">+</span> p9.facet_wrap(<span class="st">'level'</span>)</span>
<span id="cb49-14"><a aria-hidden="true" href="#cb49-14" tabindex="-1"></a>        <span class="op">+</span> p9.geom_col()</span>
<span id="cb49-15"><a aria-hidden="true" href="#cb49-15" tabindex="-1"></a>        <span class="op">+</span> p9.scale_y_continuous(labels<span class="op">=</span>percent_format(), limits<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">1.1</span>),</span>
<span id="cb49-16"><a aria-hidden="true" href="#cb49-16" tabindex="-1"></a>                                breaks<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">.75</span>, <span class="dv">1</span>])</span>
<span id="cb49-17"><a aria-hidden="true" href="#cb49-17" tabindex="-1"></a>        <span class="op">+</span> p9.geom_text(p9.aes(y<span class="op">=</span><span class="st">'over + .04'</span>, label<span class="op">=</span><span class="st">'label'</span>), size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb49-18"><a aria-hidden="true" href="#cb49-18" tabindex="-1"></a>        <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'percent_label'</span>), size<span class="op">=</span><span class="dv">9</span>, y<span class="op">=</span><span class="fl">.05</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb49-19"><a aria-hidden="true" href="#cb49-19" tabindex="-1"></a>        <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'</span><span class="sc">% o</span><span class="st">f taxa kept after filter'</span>)</span>
<span id="cb49-20"><a aria-hidden="true" href="#cb49-20" tabindex="-1"></a>        <span class="op">+</span> p9.ggtitle(<span class="st">'Taxa with at least 2 reads across at least 2 samples'</span>)</span>
<span id="cb49-21"><a aria-hidden="true" href="#cb49-21" tabindex="-1"></a>        <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb49-22"><a aria-hidden="true" href="#cb49-22" tabindex="-1"></a>                   plot_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb49-23"><a aria-hidden="true" href="#cb49-23" tabindex="-1"></a>                   axis_title_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">9</span>))</span>
<span id="cb49-24"><a aria-hidden="true" href="#cb49-24" tabindex="-1"></a>)</span>
<span id="cb49-25"><a aria-hidden="true" href="#cb49-25" tabindex="-1"></a>)</span>
<span id="cb49-26"><a aria-hidden="true" href="#cb49-26" tabindex="-1"></a></span>
<span id="cb49-27"><a aria-hidden="true" href="#cb49-27" tabindex="-1"></a>f.save(<span class="st">'../output/figures/remaining_after_filter.svg'</span>)</span>
<span id="cb49-28"><a aria-hidden="true" href="#cb49-28" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>
<figure class="figure">
<p><img class="figure-img" height="636" src="microbial_diversity_analysis_files/figure-html/cell-49-output-1.png" width="1236"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level3" id="diversity-per-sample">
<h3 class="anchored" data-anchor-id="diversity-per-sample">Diversity per sample</h3>
<div class="cell" data-execution_count="68" id="cell-77">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a aria-hidden="true" href="#cb50-1" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb50-2"><a aria-hidden="true" href="#cb50-2" tabindex="-1"></a><span class="im">from</span> sklearn.manifold <span class="im">import</span> MDS</span>
<span id="cb50-3"><a aria-hidden="true" href="#cb50-3" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> ranksums</span>
<span id="cb50-4"><a aria-hidden="true" href="#cb50-4" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise_distances</span>
<span id="cb50-5"><a aria-hidden="true" href="#cb50-5" tabindex="-1"></a><span class="im">from</span> statsmodels.sandbox.stats.multicomp <span class="im">import</span> MultiComparison</span>
<span id="cb50-6"><a aria-hidden="true" href="#cb50-6" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.multitest <span class="im">import</span> multipletests</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="69" id="cell-78">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a aria-hidden="true" href="#cb51-1" tabindex="-1"></a>diversity_df <span class="op">=</span> (diversity_df</span>
<span id="cb51-2"><a aria-hidden="true" href="#cb51-2" tabindex="-1"></a>        .merge(samples_info)</span>
<span id="cb51-3"><a aria-hidden="true" href="#cb51-3" tabindex="-1"></a>        .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb51-4"><a aria-hidden="true" href="#cb51-4" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="70" id="cell-79">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a aria-hidden="true" href="#cb52-1" tabindex="-1"></a><span class="co"># Function to perform pairwise tests and return p-values</span></span>
<span id="cb52-2"><a aria-hidden="true" href="#cb52-2" tabindex="-1"></a><span class="kw">def</span> perform_pairwise_wilcoxon(data, group_col, value_col):</span>
<span id="cb52-3"><a aria-hidden="true" href="#cb52-3" tabindex="-1"></a>    groups <span class="op">=</span> data[group_col].unique()</span>
<span id="cb52-4"><a aria-hidden="true" href="#cb52-4" tabindex="-1"></a>    result <span class="op">=</span> ranksums(data.query(<span class="ss">f'</span><span class="sc">{</span>group_col<span class="sc">}</span><span class="ss"> == "</span><span class="sc">{</span>groups[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"'</span>)[value_col],</span>
<span id="cb52-5"><a aria-hidden="true" href="#cb52-5" tabindex="-1"></a>                        data.query(<span class="ss">f'</span><span class="sc">{</span>group_col<span class="sc">}</span><span class="ss"> == "</span><span class="sc">{</span>groups[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"'</span>)[value_col])</span>
<span id="cb52-6"><a aria-hidden="true" href="#cb52-6" tabindex="-1"></a>    <span class="cf">return</span> result.pvalue</span>
<span id="cb52-7"><a aria-hidden="true" href="#cb52-7" tabindex="-1"></a>perform_pairwise_wilcoxon(diversity_df, <span class="st">'month'</span>, <span class="st">'chao'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>0.5811694758577145</code></pre>
</div>
</div>
<div class="cell" data-execution_count="72" id="cell-80">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a aria-hidden="true" href="#cb54-1" tabindex="-1"></a>libraries <span class="op">=</span> []</span>
<span id="cb54-2"><a aria-hidden="true" href="#cb54-2" tabindex="-1"></a>subgroups <span class="op">=</span> []</span>
<span id="cb54-3"><a aria-hidden="true" href="#cb54-3" tabindex="-1"></a>test_names <span class="op">=</span> []</span>
<span id="cb54-4"><a aria-hidden="true" href="#cb54-4" tabindex="-1"></a>chao1_p_values <span class="op">=</span> []</span>
<span id="cb54-5"><a aria-hidden="true" href="#cb54-5" tabindex="-1"></a>shannon_p_values <span class="op">=</span> []</span>
<span id="cb54-6"><a aria-hidden="true" href="#cb54-6" tabindex="-1"></a></span>
<span id="cb54-7"><a aria-hidden="true" href="#cb54-7" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> [<span class="st">'ITS'</span>, <span class="st">'16S'</span>]:</span>
<span id="cb54-8"><a aria-hidden="true" href="#cb54-8" tabindex="-1"></a>    df_filtered <span class="op">=</span> diversity_df.query(<span class="st">'source == @s'</span>)</span>
<span id="cb54-9"><a aria-hidden="true" href="#cb54-9" tabindex="-1"></a>    <span class="cf">for</span> test_column <span class="kw">in</span> [<span class="st">'sample_mode'</span>, <span class="st">'month'</span>]:</span>
<span id="cb54-10"><a aria-hidden="true" href="#cb54-10" tabindex="-1"></a>        </span>
<span id="cb54-11"><a aria-hidden="true" href="#cb54-11" tabindex="-1"></a>        <span class="cf">if</span> test_column <span class="op">==</span> <span class="st">'sample_mode'</span>:</span>
<span id="cb54-12"><a aria-hidden="true" href="#cb54-12" tabindex="-1"></a>            test_name <span class="op">=</span> <span class="st">'Ground-Flight'</span></span>
<span id="cb54-13"><a aria-hidden="true" href="#cb54-13" tabindex="-1"></a>        <span class="cf">elif</span> test_column <span class="op">==</span> <span class="st">'month'</span>:</span>
<span id="cb54-14"><a aria-hidden="true" href="#cb54-14" tabindex="-1"></a>            test_name <span class="op">=</span> <span class="st">'February-April'</span></span>
<span id="cb54-15"><a aria-hidden="true" href="#cb54-15" tabindex="-1"></a>        m <span class="op">=</span> <span class="st">'All'</span></span>
<span id="cb54-16"><a aria-hidden="true" href="#cb54-16" tabindex="-1"></a>        <span class="co"># Compute p-values</span></span>
<span id="cb54-17"><a aria-hidden="true" href="#cb54-17" tabindex="-1"></a>        chao1_p <span class="op">=</span> perform_pairwise_wilcoxon(df_filtered, test_column, <span class="st">'chao'</span>)</span>
<span id="cb54-18"><a aria-hidden="true" href="#cb54-18" tabindex="-1"></a>        shannon_p <span class="op">=</span> perform_pairwise_wilcoxon(df_filtered, test_column, <span class="st">'shannon'</span>)</span>
<span id="cb54-19"><a aria-hidden="true" href="#cb54-19" tabindex="-1"></a></span>
<span id="cb54-20"><a aria-hidden="true" href="#cb54-20" tabindex="-1"></a>        <span class="co"># Append results</span></span>
<span id="cb54-21"><a aria-hidden="true" href="#cb54-21" tabindex="-1"></a>        libraries.append(s)</span>
<span id="cb54-22"><a aria-hidden="true" href="#cb54-22" tabindex="-1"></a>        subgroups.append(m)</span>
<span id="cb54-23"><a aria-hidden="true" href="#cb54-23" tabindex="-1"></a>        test_names.append(test_name)</span>
<span id="cb54-24"><a aria-hidden="true" href="#cb54-24" tabindex="-1"></a>        chao1_p_values.append(chao1_p)</span>
<span id="cb54-25"><a aria-hidden="true" href="#cb54-25" tabindex="-1"></a>        shannon_p_values.append(shannon_p)</span>
<span id="cb54-26"><a aria-hidden="true" href="#cb54-26" tabindex="-1"></a></span>
<span id="cb54-27"><a aria-hidden="true" href="#cb54-27" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb54-28"><a aria-hidden="true" href="#cb54-28" tabindex="-1"></a>res_df <span class="op">=</span> pd.DataFrame({<span class="st">'Library'</span>: libraries,</span>
<span id="cb54-29"><a aria-hidden="true" href="#cb54-29" tabindex="-1"></a>                          <span class="st">'Group'</span>: subgroups,</span>
<span id="cb54-30"><a aria-hidden="true" href="#cb54-30" tabindex="-1"></a>                          <span class="st">'Test'</span>: test_names,</span>
<span id="cb54-31"><a aria-hidden="true" href="#cb54-31" tabindex="-1"></a>                          <span class="st">'Chao1_p'</span>: chao1_p_values,</span>
<span id="cb54-32"><a aria-hidden="true" href="#cb54-32" tabindex="-1"></a>                          <span class="st">'Shannon_p'</span>: shannon_p_values})</span>
<span id="cb54-33"><a aria-hidden="true" href="#cb54-33" tabindex="-1"></a></span>
<span id="cb54-34"><a aria-hidden="true" href="#cb54-34" tabindex="-1"></a>(res_df</span>
<span id="cb54-35"><a aria-hidden="true" href="#cb54-35" tabindex="-1"></a> .sort_values([<span class="st">'Test'</span>, <span class="st">'Group'</span>])</span>
<span id="cb54-36"><a aria-hidden="true" href="#cb54-36" tabindex="-1"></a> <span class="co"># apply multiple test correction</span></span>
<span id="cb54-37"><a aria-hidden="true" href="#cb54-37" tabindex="-1"></a> .assign(Chao1_p_adj<span class="op">=</span><span class="kw">lambda</span> dd: multipletests(dd.Chao1_p, method<span class="op">=</span><span class="st">'fdr_bh'</span>)[<span class="dv">1</span>],</span>
<span id="cb54-38"><a aria-hidden="true" href="#cb54-38" tabindex="-1"></a>         Shannon_p_adj<span class="op">=</span><span class="kw">lambda</span> dd: multipletests(dd.Shannon_p, method<span class="op">=</span><span class="st">'fdr_bh'</span>)[<span class="dv">1</span>])</span>
<span id="cb54-39"><a aria-hidden="true" href="#cb54-39" tabindex="-1"></a> .style</span>
<span id="cb54-40"><a aria-hidden="true" href="#cb54-40" tabindex="-1"></a> .hide(axis<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb54-41"><a aria-hidden="true" href="#cb54-41" tabindex="-1"></a>.<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="st">'color: red'</span> <span class="cf">if</span> <span class="bu">isinstance</span>(x, <span class="bu">float</span>) <span class="kw">and</span> x <span class="op">&lt;</span> <span class="fl">.05</span> <span class="cf">else</span> <span class="st">''</span>)</span>
<span id="cb54-42"><a aria-hidden="true" href="#cb54-42" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<style type="text/css">
#T_df3f8_row0_col3, #T_df3f8_row0_col4, #T_df3f8_row1_col3, #T_df3f8_row1_col4, #T_df3f8_row1_col5, #T_df3f8_row1_col6 {
  color: red;
}
</style>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true" id="T_df3f8">
<thead>
<tr class="header">
<th class="col_heading level0 col0" data-quarto-table-cell-role="th" id="T_df3f8_level0_col0">Library</th>
<th class="col_heading level0 col1" data-quarto-table-cell-role="th" id="T_df3f8_level0_col1">Group</th>
<th class="col_heading level0 col2" data-quarto-table-cell-role="th" id="T_df3f8_level0_col2">Test</th>
<th class="col_heading level0 col3" data-quarto-table-cell-role="th" id="T_df3f8_level0_col3">Chao1_p</th>
<th class="col_heading level0 col4" data-quarto-table-cell-role="th" id="T_df3f8_level0_col4">Shannon_p</th>
<th class="col_heading level0 col5" data-quarto-table-cell-role="th" id="T_df3f8_level0_col5">Chao1_p_adj</th>
<th class="col_heading level0 col6" data-quarto-table-cell-role="th" id="T_df3f8_level0_col6">Shannon_p_adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="data row0 col0" id="T_df3f8_row0_col0">ITS</td>
<td class="data row0 col1" id="T_df3f8_row0_col1">All</td>
<td class="data row0 col2" id="T_df3f8_row0_col2">February-April</td>
<td class="data row0 col3" id="T_df3f8_row0_col3">0.027578</td>
<td class="data row0 col4" id="T_df3f8_row0_col4">0.025012</td>
<td class="data row0 col5" id="T_df3f8_row0_col5">0.055156</td>
<td class="data row0 col6" id="T_df3f8_row0_col6">0.050023</td>
</tr>
<tr class="even">
<td class="data row1 col0" id="T_df3f8_row1_col0">16S</td>
<td class="data row1 col1" id="T_df3f8_row1_col1">All</td>
<td class="data row1 col2" id="T_df3f8_row1_col2">February-April</td>
<td class="data row1 col3" id="T_df3f8_row1_col3">0.000252</td>
<td class="data row1 col4" id="T_df3f8_row1_col4">0.000124</td>
<td class="data row1 col5" id="T_df3f8_row1_col5">0.001009</td>
<td class="data row1 col6" id="T_df3f8_row1_col6">0.000497</td>
</tr>
<tr class="odd">
<td class="data row2 col0" id="T_df3f8_row2_col0">ITS</td>
<td class="data row2 col1" id="T_df3f8_row2_col1">All</td>
<td class="data row2 col2" id="T_df3f8_row2_col2">Ground-Flight</td>
<td class="data row2 col3" id="T_df3f8_row2_col3">0.384673</td>
<td class="data row2 col4" id="T_df3f8_row2_col4">0.198765</td>
<td class="data row2 col5" id="T_df3f8_row2_col5">0.481321</td>
<td class="data row2 col6" id="T_df3f8_row2_col6">0.204969</td>
</tr>
<tr class="even">
<td class="data row3 col0" id="T_df3f8_row3_col0">16S</td>
<td class="data row3 col1" id="T_df3f8_row3_col1">All</td>
<td class="data row3 col2" id="T_df3f8_row3_col2">Ground-Flight</td>
<td class="data row3 col3" id="T_df3f8_row3_col3">0.481321</td>
<td class="data row3 col4" id="T_df3f8_row3_col4">0.204969</td>
<td class="data row3 col5" id="T_df3f8_row3_col5">0.481321</td>
<td class="data row3 col6" id="T_df3f8_row3_col6">0.204969</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="73" id="cell-81">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a aria-hidden="true" href="#cb55-1" tabindex="-1"></a>sample_sizes <span class="op">=</span> (diversity_df</span>
<span id="cb55-2"><a aria-hidden="true" href="#cb55-2" tabindex="-1"></a>                .groupby([<span class="st">'source'</span>, <span class="st">'sample_mode'</span>])</span>
<span id="cb55-3"><a aria-hidden="true" href="#cb55-3" tabindex="-1"></a>                .size()</span>
<span id="cb55-4"><a aria-hidden="true" href="#cb55-4" tabindex="-1"></a>                .rename(<span class="st">'n'</span>)</span>
<span id="cb55-5"><a aria-hidden="true" href="#cb55-5" tabindex="-1"></a>                .<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'n = </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-6"><a aria-hidden="true" href="#cb55-6" tabindex="-1"></a>                .reset_index()</span>
<span id="cb55-7"><a aria-hidden="true" href="#cb55-7" tabindex="-1"></a>                .assign(Kingdom<span class="op">=</span><span class="kw">lambda</span> dd: dd.source.<span class="bu">map</span>({<span class="st">'16S'</span>: <span class="st">'Bacteria'</span>,</span>
<span id="cb55-8"><a aria-hidden="true" href="#cb55-8" tabindex="-1"></a>                                                          <span class="st">'ITS'</span>: <span class="st">'Fungi'</span>}))</span>
<span id="cb55-9"><a aria-hidden="true" href="#cb55-9" tabindex="-1"></a>               )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="74" id="cell-82">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a aria-hidden="true" href="#cb56-1" tabindex="-1"></a>sample_sizes_month <span class="op">=</span> (diversity_df</span>
<span id="cb56-2"><a aria-hidden="true" href="#cb56-2" tabindex="-1"></a>                .groupby([<span class="st">'source'</span>, <span class="st">'month'</span>])</span>
<span id="cb56-3"><a aria-hidden="true" href="#cb56-3" tabindex="-1"></a>                .size()</span>
<span id="cb56-4"><a aria-hidden="true" href="#cb56-4" tabindex="-1"></a>                .rename(<span class="st">'n'</span>)</span>
<span id="cb56-5"><a aria-hidden="true" href="#cb56-5" tabindex="-1"></a>                .<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'n = </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb56-6"><a aria-hidden="true" href="#cb56-6" tabindex="-1"></a>                .reset_index()</span>
<span id="cb56-7"><a aria-hidden="true" href="#cb56-7" tabindex="-1"></a>                            .assign(Kingdom<span class="op">=</span><span class="kw">lambda</span> dd: dd.source.<span class="bu">map</span>({<span class="st">'16S'</span>: <span class="st">'Bacteria'</span>,</span>
<span id="cb56-8"><a aria-hidden="true" href="#cb56-8" tabindex="-1"></a>                                                          <span class="st">'ITS'</span>: <span class="st">'Fungi'</span>}))</span>
<span id="cb56-9"><a aria-hidden="true" href="#cb56-9" tabindex="-1"></a>               )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="91" id="cell-83">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a aria-hidden="true" href="#cb57-1" tabindex="-1"></a>sample_sizes</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<div>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">source</th>
<th data-quarto-table-cell-role="th">sample_mode</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">Kingdom</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>16S</td>
<td>Flight</td>
<td>n = 10</td>
<td>Bacteria</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>16S</td>
<td>Ground</td>
<td>n = 11</td>
<td>Bacteria</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ITS</td>
<td>Flight</td>
<td>n = 10</td>
<td>Fungi</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ITS</td>
<td>Ground</td>
<td>n = 10</td>
<td>Fungi</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="93" id="cell-84">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a aria-hidden="true" href="#cb58-1" tabindex="-1"></a>f <span class="op">=</span> (diversity_df</span>
<span id="cb58-2"><a aria-hidden="true" href="#cb58-2" tabindex="-1"></a> .assign(Kingdom<span class="op">=</span><span class="kw">lambda</span> dd: dd.source.<span class="bu">map</span>({<span class="st">'16S'</span>: <span class="st">'Bacteria'</span>,</span>
<span id="cb58-3"><a aria-hidden="true" href="#cb58-3" tabindex="-1"></a>                                           <span class="st">'ITS'</span>: <span class="st">'Fungi'</span>}))</span>
<span id="cb58-4"><a aria-hidden="true" href="#cb58-4" tabindex="-1"></a> .melt([<span class="st">'sample_id'</span>, <span class="st">'source'</span>, <span class="st">'date'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Kingdom'</span>, <span class="st">'month'</span>])</span>
<span id="cb58-5"><a aria-hidden="true" href="#cb58-5" tabindex="-1"></a> .replace({<span class="st">'chao'</span>: <span class="st">'Chao1 Index'</span>, <span class="st">'shannon'</span>: <span class="st">'Shannon Index'</span>})</span>
<span id="cb58-6"><a aria-hidden="true" href="#cb58-6" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb58-7"><a aria-hidden="true" href="#cb58-7" tabindex="-1"></a>      <span class="op">+</span> p9.aes(<span class="st">'sample_mode'</span>, <span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'Kingdom'</span>)</span>
<span id="cb58-8"><a aria-hidden="true" href="#cb58-8" tabindex="-1"></a>      <span class="op">+</span> p9.geom_jitter(alpha<span class="op">=</span><span class="fl">.6</span>, width<span class="op">=</span><span class="dv">0</span>, height<span class="op">=</span><span class="dv">0</span>, fill<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb58-9"><a aria-hidden="true" href="#cb58-9" tabindex="-1"></a>      <span class="op">+</span> p9.geom_boxplot(alpha<span class="op">=</span><span class="fl">.6</span>, outlier_alpha<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb58-10"><a aria-hidden="true" href="#cb58-10" tabindex="-1"></a>      <span class="op">+</span> p9.geom_blank(p9.aes(y<span class="op">=</span><span class="st">'value * 1.1'</span>))</span>
<span id="cb58-11"><a aria-hidden="true" href="#cb58-11" tabindex="-1"></a>      <span class="op">+</span> p9.facet_grid(<span class="st">'variable ~ Kingdom'</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb58-12"><a aria-hidden="true" href="#cb58-12" tabindex="-1"></a>      <span class="op">+</span> p9.scale_fill_manual(values <span class="op">=</span> [<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>] )</span>
<span id="cb58-13"><a aria-hidden="true" href="#cb58-13" tabindex="-1"></a>      <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'n'</span>), y<span class="op">=-</span><span class="fl">.2</span>, size<span class="op">=</span><span class="dv">8</span>, data<span class="op">=</span>sample_sizes)</span>
<span id="cb58-14"><a aria-hidden="true" href="#cb58-14" tabindex="-1"></a>      <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb58-15"><a aria-hidden="true" href="#cb58-15" tabindex="-1"></a>      <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="vs">r'$\alpha$-Diversity '</span>)</span>
<span id="cb58-16"><a aria-hidden="true" href="#cb58-16" tabindex="-1"></a>      <span class="op">+</span> p9.scale_y_continuous(expand<span class="op">=</span>(<span class="fl">.175</span>, <span class="fl">.1</span>))</span>
<span id="cb58-17"><a aria-hidden="true" href="#cb58-17" tabindex="-1"></a>      <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb58-18"><a aria-hidden="true" href="#cb58-18" tabindex="-1"></a>    )</span>
<span id="cb58-19"><a aria-hidden="true" href="#cb58-19" tabindex="-1"></a>)</span>
<span id="cb58-20"><a aria-hidden="true" href="#cb58-20" tabindex="-1"></a>)</span>
<span id="cb58-21"><a aria-hidden="true" href="#cb58-21" tabindex="-1"></a>f.save(<span class="st">'../output/figures/boxplots_diversity_by_sample_type.svg'</span>)</span>
<span id="cb58-22"><a aria-hidden="true" href="#cb58-22" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<div>
<figure class="figure">
<p><img class="figure-img" height="920" src="microbial_diversity_analysis_files/figure-html/cell-57-output-1.png" width="1220"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="94" id="cell-85">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a aria-hidden="true" href="#cb59-1" tabindex="-1"></a>sample_sizes_month <span class="op">=</span> sample_sizes_month.assign(Kingdom<span class="op">=</span><span class="kw">lambda</span> dd: dd.source.<span class="bu">map</span>({<span class="st">'16S'</span>: <span class="st">'Bacteria'</span>, <span class="st">'ITS'</span>: <span class="st">'Fungi'</span>}))</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="98" id="cell-86">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a aria-hidden="true" href="#cb60-1" tabindex="-1"></a>f <span class="op">=</span> (diversity_df</span>
<span id="cb60-2"><a aria-hidden="true" href="#cb60-2" tabindex="-1"></a> .assign(Kingdom<span class="op">=</span><span class="kw">lambda</span> dd: dd.source.<span class="bu">map</span>({<span class="st">'16S'</span>: <span class="st">'Bacteria'</span>,</span>
<span id="cb60-3"><a aria-hidden="true" href="#cb60-3" tabindex="-1"></a>                                           <span class="st">'ITS'</span>: <span class="st">'Fungi'</span>}))</span>
<span id="cb60-4"><a aria-hidden="true" href="#cb60-4" tabindex="-1"></a> .melt([<span class="st">'sample_id'</span>, <span class="st">'source'</span>, <span class="st">'date'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Kingdom'</span>, <span class="st">'month'</span>])</span>
<span id="cb60-5"><a aria-hidden="true" href="#cb60-5" tabindex="-1"></a> .replace({<span class="st">'chao'</span>: <span class="st">'Chao1 Index'</span>, <span class="st">'shannon'</span>: <span class="st">'Shannon Index'</span>})</span>
<span id="cb60-6"><a aria-hidden="true" href="#cb60-6" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.month, categories<span class="op">=</span>[<span class="st">'February'</span>, <span class="st">'April'</span>]))</span>
<span id="cb60-7"><a aria-hidden="true" href="#cb60-7" tabindex="-1"></a>.pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb60-8"><a aria-hidden="true" href="#cb60-8" tabindex="-1"></a>      <span class="op">+</span> p9.aes(<span class="st">'month'</span>, <span class="st">'value'</span>)</span>
<span id="cb60-9"><a aria-hidden="true" href="#cb60-9" tabindex="-1"></a>      <span class="op">+</span> p9.geom_jitter(p9.aes(fill<span class="op">=</span><span class="st">'sample_mode'</span>), alpha<span class="op">=</span><span class="fl">.6</span>, width<span class="op">=</span><span class="dv">0</span>, height<span class="op">=</span><span class="dv">0</span>, stroke<span class="op">=</span><span class="dv">0</span>, size<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb60-10"><a aria-hidden="true" href="#cb60-10" tabindex="-1"></a>      <span class="op">+</span> p9.geom_boxplot(alpha<span class="op">=</span><span class="fl">.6</span>, outlier_alpha<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb60-11"><a aria-hidden="true" href="#cb60-11" tabindex="-1"></a>      <span class="op">+</span> p9.geom_blank(p9.aes(y<span class="op">=</span><span class="st">'value * 1.1'</span>))</span>
<span id="cb60-12"><a aria-hidden="true" href="#cb60-12" tabindex="-1"></a>      <span class="op">+</span> p9.facet_grid(<span class="st">'variable ~ Kingdom'</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb60-13"><a aria-hidden="true" href="#cb60-13" tabindex="-1"></a>      <span class="op">+</span> p9.scale_fill_manual(values <span class="op">=</span> [<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>] )</span>
<span id="cb60-14"><a aria-hidden="true" href="#cb60-14" tabindex="-1"></a>      <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'n'</span>), y<span class="op">=-</span><span class="fl">.2</span>, size<span class="op">=</span><span class="dv">8</span>, data<span class="op">=</span>sample_sizes_month)</span>
<span id="cb60-15"><a aria-hidden="true" href="#cb60-15" tabindex="-1"></a>      <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb60-16"><a aria-hidden="true" href="#cb60-16" tabindex="-1"></a>      <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="vs">r'$\alpha$-Diversity '</span>)</span>
<span id="cb60-17"><a aria-hidden="true" href="#cb60-17" tabindex="-1"></a>      <span class="op">+</span> p9.scale_y_continuous(expand<span class="op">=</span>(<span class="fl">.175</span>, <span class="fl">.1</span>))</span>
<span id="cb60-18"><a aria-hidden="true" href="#cb60-18" tabindex="-1"></a>      <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb60-19"><a aria-hidden="true" href="#cb60-19" tabindex="-1"></a>    )</span>
<span id="cb60-20"><a aria-hidden="true" href="#cb60-20" tabindex="-1"></a>)</span>
<span id="cb60-21"><a aria-hidden="true" href="#cb60-21" tabindex="-1"></a>)</span>
<span id="cb60-22"><a aria-hidden="true" href="#cb60-22" tabindex="-1"></a>f.save(<span class="st">'../output/figures/boxplots_diversity_by_month.svg'</span>)</span>
<span id="cb60-23"><a aria-hidden="true" href="#cb60-23" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<div>
<figure class="figure">
<p><img class="figure-img" height="920" src="microbial_diversity_analysis_files/figure-html/cell-59-output-1.png" width="1220"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level3" id="distance-between-samples-nmds-and-permanova">
<h3 class="anchored" data-anchor-id="distance-between-samples-nmds-and-permanova">Distance between samples (nMDS and PERMANOVA)</h3>
<div class="cell" data-execution_count="99" id="cell-88">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a aria-hidden="true" href="#cb61-1" tabindex="-1"></a>samples <span class="op">=</span> samples_info.query(<span class="st">'sample_id not in ["S06", "S14"]'</span>).sample_id</span>
<span id="cb61-2"><a aria-hidden="true" href="#cb61-2" tabindex="-1"></a>dm <span class="op">=</span> (abundance_df_genera</span>
<span id="cb61-3"><a aria-hidden="true" href="#cb61-3" tabindex="-1"></a> .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb61-4"><a aria-hidden="true" href="#cb61-4" tabindex="-1"></a> .drop(columns<span class="op">=</span>[<span class="st">'S06'</span>] <span class="op">+</span> taxon_names[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb61-5"><a aria-hidden="true" href="#cb61-5" tabindex="-1"></a> .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb61-6"><a aria-hidden="true" href="#cb61-6" tabindex="-1"></a> .T</span>
<span id="cb61-7"><a aria-hidden="true" href="#cb61-7" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="op">/</span> x.<span class="bu">sum</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb61-8"><a aria-hidden="true" href="#cb61-8" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: pairwise_distances(dd, metric<span class="op">=</span><span class="st">'braycurtis'</span>))</span>
<span id="cb61-9"><a aria-hidden="true" href="#cb61-9" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<section class="level4" id="non-metric-mds">
<h4 class="anchored" data-anchor-id="non-metric-mds">non-metric MDS</h4>
<div class="cell" data-execution_count="101" id="cell-90">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a aria-hidden="true" href="#cb62-1" tabindex="-1"></a>np.random.seed(<span class="dv">105</span>)</span>
<span id="cb62-2"><a aria-hidden="true" href="#cb62-2" tabindex="-1"></a>best_stress <span class="op">=</span> np.inf</span>
<span id="cb62-3"><a aria-hidden="true" href="#cb62-3" tabindex="-1"></a>best_npos <span class="op">=</span> <span class="va">None</span></span>
<span id="cb62-4"><a aria-hidden="true" href="#cb62-4" tabindex="-1"></a>stresses <span class="op">=</span> []</span>
<span id="cb62-5"><a aria-hidden="true" href="#cb62-5" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb62-6"><a aria-hidden="true" href="#cb62-6" tabindex="-1"></a>    nmds <span class="op">=</span> MDS(n_components<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb62-7"><a aria-hidden="true" href="#cb62-7" tabindex="-1"></a>            max_iter<span class="op">=</span><span class="dv">900</span>, </span>
<span id="cb62-8"><a aria-hidden="true" href="#cb62-8" tabindex="-1"></a>            eps<span class="op">=</span><span class="fl">1e-9</span>,</span>
<span id="cb62-9"><a aria-hidden="true" href="#cb62-9" tabindex="-1"></a>            dissimilarity<span class="op">=</span><span class="st">"precomputed"</span>,</span>
<span id="cb62-10"><a aria-hidden="true" href="#cb62-10" tabindex="-1"></a>            normalized_stress<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb62-11"><a aria-hidden="true" href="#cb62-11" tabindex="-1"></a>            metric<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb62-12"><a aria-hidden="true" href="#cb62-12" tabindex="-1"></a></span>
<span id="cb62-13"><a aria-hidden="true" href="#cb62-13" tabindex="-1"></a>    npos <span class="op">=</span> nmds.fit_transform(dm)</span>
<span id="cb62-14"><a aria-hidden="true" href="#cb62-14" tabindex="-1"></a></span>
<span id="cb62-15"><a aria-hidden="true" href="#cb62-15" tabindex="-1"></a>    stress <span class="op">=</span> nmds.stress_</span>
<span id="cb62-16"><a aria-hidden="true" href="#cb62-16" tabindex="-1"></a>    stresses.append(stress)</span>
<span id="cb62-17"><a aria-hidden="true" href="#cb62-17" tabindex="-1"></a>    <span class="cf">if</span> stress <span class="op">&lt;</span> best_stress:</span>
<span id="cb62-18"><a aria-hidden="true" href="#cb62-18" tabindex="-1"></a>        best_stress <span class="op">=</span> stress</span>
<span id="cb62-19"><a aria-hidden="true" href="#cb62-19" tabindex="-1"></a>        best_npos <span class="op">=</span> npos</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59" id="cell-91">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a aria-hidden="true" href="#cb63-1" tabindex="-1"></a>(p9.ggplot(pd.DataFrame(stresses, columns<span class="op">=</span>[<span class="st">'stress'</span>])) </span>
<span id="cb63-2"><a aria-hidden="true" href="#cb63-2" tabindex="-1"></a> <span class="op">+</span> p9.aes(<span class="st">'stress'</span>)</span>
<span id="cb63-3"><a aria-hidden="true" href="#cb63-3" tabindex="-1"></a> <span class="op">+</span> p9.geom_histogram(bins<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb63-4"><a aria-hidden="true" href="#cb63-4" tabindex="-1"></a> <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb63-5"><a aria-hidden="true" href="#cb63-5" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-62-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="102" id="cell-92">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a aria-hidden="true" href="#cb64-1" tabindex="-1"></a></span>
<span id="cb64-2"><a aria-hidden="true" href="#cb64-2" tabindex="-1"></a>f <span class="op">=</span> (pd.DataFrame(best_npos)</span>
<span id="cb64-3"><a aria-hidden="true" href="#cb64-3" tabindex="-1"></a> .assign(sample_id<span class="op">=</span>samples)</span>
<span id="cb64-4"><a aria-hidden="true" href="#cb64-4" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb64-5"><a aria-hidden="true" href="#cb64-5" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb64-6"><a aria-hidden="true" href="#cb64-6" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'x'</span>, <span class="dv">1</span>: <span class="st">'y'</span>})</span>
<span id="cb64-7"><a aria-hidden="true" href="#cb64-7" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb64-8"><a aria-hidden="true" href="#cb64-8" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'x'</span>, <span class="st">'y'</span>, color<span class="op">=</span><span class="st">'sample_mode'</span>, shape<span class="op">=</span><span class="st">'month'</span>)</span>
<span id="cb64-9"><a aria-hidden="true" href="#cb64-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(size<span class="op">=</span><span class="fl">2.5</span>)</span>
<span id="cb64-10"><a aria-hidden="true" href="#cb64-10" tabindex="-1"></a>       <span class="op">+</span> p9.stat_ellipse(p9.aes(group<span class="op">=</span><span class="st">'sample_mode'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>),</span>
<span id="cb64-11"><a aria-hidden="true" href="#cb64-11" tabindex="-1"></a>                         geom<span class="op">=</span><span class="st">'polygon'</span>, level<span class="op">=</span><span class="fl">.85</span>, alpha<span class="op">=</span><span class="fl">.25</span>)</span>
<span id="cb64-12"><a aria-hidden="true" href="#cb64-12" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb64-13"><a aria-hidden="true" href="#cb64-13" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb64-14"><a aria-hidden="true" href="#cb64-14" tabindex="-1"></a>       <span class="op">+</span> p9.ylim(<span class="op">-</span><span class="fl">1.2</span>, <span class="dv">1</span>)</span>
<span id="cb64-15"><a aria-hidden="true" href="#cb64-15" tabindex="-1"></a>       <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb64-16"><a aria-hidden="true" href="#cb64-16" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">'nMDS Dim 1'</span>, y<span class="op">=</span><span class="st">'nMDS Dim 2'</span>, color<span class="op">=</span><span class="st">''</span>, shape<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb64-17"><a aria-hidden="true" href="#cb64-17" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=-</span><span class="fl">.6</span>, y<span class="op">=</span><span class="fl">.95</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb64-18"><a aria-hidden="true" href="#cb64-18" tabindex="-1"></a>                     label<span class="op">=</span><span class="st">'Stress-1 = '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">round</span>(best_stress, <span class="dv">2</span>)),</span>
<span id="cb64-19"><a aria-hidden="true" href="#cb64-19" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb64-20"><a aria-hidden="true" href="#cb64-20" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb64-21"><a aria-hidden="true" href="#cb64-21" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb64-22"><a aria-hidden="true" href="#cb64-22" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb64-23"><a aria-hidden="true" href="#cb64-23" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb64-24"><a aria-hidden="true" href="#cb64-24" tabindex="-1"></a>                  )</span>
<span id="cb64-25"><a aria-hidden="true" href="#cb64-25" tabindex="-1"></a>       )</span>
<span id="cb64-26"><a aria-hidden="true" href="#cb64-26" tabindex="-1"></a>)</span>
<span id="cb64-27"><a aria-hidden="true" href="#cb64-27" tabindex="-1"></a></span>
<span id="cb64-28"><a aria-hidden="true" href="#cb64-28" tabindex="-1"></a>f.save(<span class="st">'../output/figures/nmds_fg.svg'</span>)</span>
<span id="cb64-29"><a aria-hidden="true" href="#cb64-29" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<div>
<figure class="figure">
<p><img class="figure-img" height="941" src="microbial_diversity_analysis_files/figure-html/cell-63-output-1.png" width="957"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="103" id="cell-93">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a aria-hidden="true" href="#cb65-1" tabindex="-1"></a></span>
<span id="cb65-2"><a aria-hidden="true" href="#cb65-2" tabindex="-1"></a>f <span class="op">=</span> (pd.DataFrame(best_npos)</span>
<span id="cb65-3"><a aria-hidden="true" href="#cb65-3" tabindex="-1"></a> .assign(sample_id<span class="op">=</span>samples)</span>
<span id="cb65-4"><a aria-hidden="true" href="#cb65-4" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb65-5"><a aria-hidden="true" href="#cb65-5" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb65-6"><a aria-hidden="true" href="#cb65-6" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'x'</span>, <span class="dv">1</span>: <span class="st">'y'</span>})</span>
<span id="cb65-7"><a aria-hidden="true" href="#cb65-7" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb65-8"><a aria-hidden="true" href="#cb65-8" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'x'</span>, <span class="st">'y'</span>, color<span class="op">=</span><span class="st">'sample_mode'</span>, shape<span class="op">=</span><span class="st">'month'</span>)</span>
<span id="cb65-9"><a aria-hidden="true" href="#cb65-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(size<span class="op">=</span><span class="fl">2.5</span>)</span>
<span id="cb65-10"><a aria-hidden="true" href="#cb65-10" tabindex="-1"></a>       <span class="op">+</span> p9.stat_ellipse(p9.aes(group<span class="op">=</span><span class="st">'month'</span>),</span>
<span id="cb65-11"><a aria-hidden="true" href="#cb65-11" tabindex="-1"></a>                         geom<span class="op">=</span><span class="st">'polygon'</span>, level<span class="op">=</span><span class="fl">.85</span>, alpha<span class="op">=</span><span class="fl">.25</span>)</span>
<span id="cb65-12"><a aria-hidden="true" href="#cb65-12" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb65-13"><a aria-hidden="true" href="#cb65-13" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb65-14"><a aria-hidden="true" href="#cb65-14" tabindex="-1"></a>       <span class="op">+</span> p9.ylim(<span class="op">-</span><span class="fl">1.2</span>, <span class="dv">1</span>)</span>
<span id="cb65-15"><a aria-hidden="true" href="#cb65-15" tabindex="-1"></a>       <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb65-16"><a aria-hidden="true" href="#cb65-16" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">'nMDS Dim 1'</span>, y<span class="op">=</span><span class="st">'nMDS Dim 2'</span>, color<span class="op">=</span><span class="st">''</span>, shape<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb65-17"><a aria-hidden="true" href="#cb65-17" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=-</span><span class="fl">.6</span>, y<span class="op">=</span><span class="fl">.95</span>, ha<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb65-18"><a aria-hidden="true" href="#cb65-18" tabindex="-1"></a>                     label<span class="op">=</span><span class="st">'Stress-1 = '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">round</span>(best_stress, <span class="dv">2</span>)),</span>
<span id="cb65-19"><a aria-hidden="true" href="#cb65-19" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb65-20"><a aria-hidden="true" href="#cb65-20" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb65-21"><a aria-hidden="true" href="#cb65-21" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb65-22"><a aria-hidden="true" href="#cb65-22" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb65-23"><a aria-hidden="true" href="#cb65-23" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb65-24"><a aria-hidden="true" href="#cb65-24" tabindex="-1"></a>                  )</span>
<span id="cb65-25"><a aria-hidden="true" href="#cb65-25" tabindex="-1"></a>       )</span>
<span id="cb65-26"><a aria-hidden="true" href="#cb65-26" tabindex="-1"></a>)</span>
<span id="cb65-27"><a aria-hidden="true" href="#cb65-27" tabindex="-1"></a></span>
<span id="cb65-28"><a aria-hidden="true" href="#cb65-28" tabindex="-1"></a>f.save(<span class="st">'../output/figures/nmds_af.svg'</span>)</span>
<span id="cb65-29"><a aria-hidden="true" href="#cb65-29" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<div>
<figure class="figure">
<p><img class="figure-img" height="941" src="microbial_diversity_analysis_files/figure-html/cell-64-output-1.png" width="957"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="104" id="cell-94">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a aria-hidden="true" href="#cb66-1" tabindex="-1"></a></span>
<span id="cb66-2"><a aria-hidden="true" href="#cb66-2" tabindex="-1"></a>(pd.DataFrame(best_npos)</span>
<span id="cb66-3"><a aria-hidden="true" href="#cb66-3" tabindex="-1"></a> .assign(sample_id<span class="op">=</span>samples)</span>
<span id="cb66-4"><a aria-hidden="true" href="#cb66-4" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb66-5"><a aria-hidden="true" href="#cb66-5" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb66-6"><a aria-hidden="true" href="#cb66-6" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'x'</span>, <span class="dv">1</span>: <span class="st">'y'</span>})</span>
<span id="cb66-7"><a aria-hidden="true" href="#cb66-7" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb66-8"><a aria-hidden="true" href="#cb66-8" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'x'</span>, <span class="st">'y'</span>, color<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb66-9"><a aria-hidden="true" href="#cb66-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(size<span class="op">=</span><span class="fl">2.5</span>)</span>
<span id="cb66-10"><a aria-hidden="true" href="#cb66-10" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb66-11"><a aria-hidden="true" href="#cb66-11" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb66-12"><a aria-hidden="true" href="#cb66-12" tabindex="-1"></a>       <span class="op">+</span> p9.stat_ellipse(p9.aes(fill<span class="op">=</span><span class="st">'sample_mode'</span>), geom<span class="op">=</span><span class="st">'polygon'</span>, level<span class="op">=</span><span class="fl">.95</span>, alpha<span class="op">=</span><span class="fl">.15</span>)</span>
<span id="cb66-13"><a aria-hidden="true" href="#cb66-13" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">'nMDS Dim 1'</span>, y<span class="op">=</span><span class="st">'nMDS Dim 2'</span>, color<span class="op">=</span><span class="st">''</span>, shape<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb66-14"><a aria-hidden="true" href="#cb66-14" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=-</span><span class="fl">.1</span>, y<span class="op">=</span><span class="fl">1.2</span>,</span>
<span id="cb66-15"><a aria-hidden="true" href="#cb66-15" tabindex="-1"></a>                     label<span class="op">=</span><span class="st">'Stress-1 = '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">round</span>(best_stress, <span class="dv">2</span>)),</span>
<span id="cb66-16"><a aria-hidden="true" href="#cb66-16" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb66-17"><a aria-hidden="true" href="#cb66-17" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>),</span>
<span id="cb66-18"><a aria-hidden="true" href="#cb66-18" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb66-19"><a aria-hidden="true" href="#cb66-19" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb66-20"><a aria-hidden="true" href="#cb66-20" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb66-21"><a aria-hidden="true" href="#cb66-21" tabindex="-1"></a>                  )</span>
<span id="cb66-22"><a aria-hidden="true" href="#cb66-22" tabindex="-1"></a>       )</span>
<span id="cb66-23"><a aria-hidden="true" href="#cb66-23" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-65-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="105" id="cell-95">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a aria-hidden="true" href="#cb67-1" tabindex="-1"></a>(pd.DataFrame(best_npos)</span>
<span id="cb67-2"><a aria-hidden="true" href="#cb67-2" tabindex="-1"></a> .assign(sample_id<span class="op">=</span>samples)</span>
<span id="cb67-3"><a aria-hidden="true" href="#cb67-3" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb67-4"><a aria-hidden="true" href="#cb67-4" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb67-5"><a aria-hidden="true" href="#cb67-5" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'x'</span>, <span class="dv">1</span>: <span class="st">'y'</span>})</span>
<span id="cb67-6"><a aria-hidden="true" href="#cb67-6" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb67-7"><a aria-hidden="true" href="#cb67-7" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'x'</span>, <span class="st">'y'</span>, color<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb67-8"><a aria-hidden="true" href="#cb67-8" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(size<span class="op">=</span><span class="fl">2.5</span>)</span>
<span id="cb67-9"><a aria-hidden="true" href="#cb67-9" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb67-10"><a aria-hidden="true" href="#cb67-10" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb67-11"><a aria-hidden="true" href="#cb67-11" tabindex="-1"></a>       <span class="op">+</span> p9.stat_ellipse(p9.aes(fill<span class="op">=</span><span class="st">'sample_mode'</span>), geom<span class="op">=</span><span class="st">'polygon'</span>, level<span class="op">=</span><span class="fl">.95</span>, alpha<span class="op">=</span><span class="fl">.15</span>)</span>
<span id="cb67-12"><a aria-hidden="true" href="#cb67-12" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">'nMDS Dim 1'</span>, y<span class="op">=</span><span class="st">'nMDS Dim 2'</span>, color<span class="op">=</span><span class="st">''</span>, shape<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb67-13"><a aria-hidden="true" href="#cb67-13" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=-</span><span class="dv">0</span>, y<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb67-14"><a aria-hidden="true" href="#cb67-14" tabindex="-1"></a>                     label<span class="op">=</span><span class="st">'Stress-1 = '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">round</span>(best_stress, <span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb67-15"><a aria-hidden="true" href="#cb67-15" tabindex="-1"></a>                     <span class="st">'    PERMANOVA pseudo-$F$ = 0.68, $p$ = 0.59'</span>,</span>
<span id="cb67-16"><a aria-hidden="true" href="#cb67-16" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb67-17"><a aria-hidden="true" href="#cb67-17" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_continuous(expand<span class="op">=</span>(<span class="fl">.02</span>, <span class="fl">.2</span>))</span>
<span id="cb67-18"><a aria-hidden="true" href="#cb67-18" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>),</span>
<span id="cb67-19"><a aria-hidden="true" href="#cb67-19" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb67-20"><a aria-hidden="true" href="#cb67-20" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb67-21"><a aria-hidden="true" href="#cb67-21" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb67-22"><a aria-hidden="true" href="#cb67-22" tabindex="-1"></a>                  )</span>
<span id="cb67-23"><a aria-hidden="true" href="#cb67-23" tabindex="-1"></a>       )</span>
<span id="cb67-24"><a aria-hidden="true" href="#cb67-24" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-66-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="106" id="cell-96">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a aria-hidden="true" href="#cb68-1" tabindex="-1"></a></span>
<span id="cb68-2"><a aria-hidden="true" href="#cb68-2" tabindex="-1"></a>(pd.DataFrame(best_npos)</span>
<span id="cb68-3"><a aria-hidden="true" href="#cb68-3" tabindex="-1"></a> .assign(sample_id<span class="op">=</span>samples)</span>
<span id="cb68-4"><a aria-hidden="true" href="#cb68-4" tabindex="-1"></a> .merge(samples_info)</span>
<span id="cb68-5"><a aria-hidden="true" href="#cb68-5" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb68-6"><a aria-hidden="true" href="#cb68-6" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'x'</span>, <span class="dv">1</span>: <span class="st">'y'</span>})</span>
<span id="cb68-7"><a aria-hidden="true" href="#cb68-7" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb68-8"><a aria-hidden="true" href="#cb68-8" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'x'</span>, <span class="st">'y'</span>, color<span class="op">=</span><span class="st">'month'</span>)</span>
<span id="cb68-9"><a aria-hidden="true" href="#cb68-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(size<span class="op">=</span><span class="fl">2.5</span>)</span>
<span id="cb68-10"><a aria-hidden="true" href="#cb68-10" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb68-11"><a aria-hidden="true" href="#cb68-11" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb68-12"><a aria-hidden="true" href="#cb68-12" tabindex="-1"></a>       <span class="op">+</span> p9.stat_ellipse(p9.aes(fill<span class="op">=</span><span class="st">'month'</span>), geom<span class="op">=</span><span class="st">'polygon'</span>, level<span class="op">=</span><span class="fl">.95</span>, alpha<span class="op">=</span><span class="fl">.15</span>)</span>
<span id="cb68-13"><a aria-hidden="true" href="#cb68-13" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">'nMDS Dim 1'</span>, y<span class="op">=</span><span class="st">'nMDS Dim 2'</span>, color<span class="op">=</span><span class="st">''</span>, shape<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb68-14"><a aria-hidden="true" href="#cb68-14" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'text'</span>, x<span class="op">=-</span><span class="dv">0</span>, y<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb68-15"><a aria-hidden="true" href="#cb68-15" tabindex="-1"></a>                     label<span class="op">=</span><span class="st">'Stress-1 = '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">round</span>(best_stress, <span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb68-16"><a aria-hidden="true" href="#cb68-16" tabindex="-1"></a>                     <span class="st">'    PERMANOVA pseudo-$F$ = 4.0, $p$ = 0.017'</span>,</span>
<span id="cb68-17"><a aria-hidden="true" href="#cb68-17" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb68-18"><a aria-hidden="true" href="#cb68-18" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_continuous(expand<span class="op">=</span>(<span class="fl">.02</span>, <span class="fl">.2</span>))</span>
<span id="cb68-19"><a aria-hidden="true" href="#cb68-19" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>),</span>
<span id="cb68-20"><a aria-hidden="true" href="#cb68-20" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb68-21"><a aria-hidden="true" href="#cb68-21" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb68-22"><a aria-hidden="true" href="#cb68-22" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb68-23"><a aria-hidden="true" href="#cb68-23" tabindex="-1"></a>                  )</span>
<span id="cb68-24"><a aria-hidden="true" href="#cb68-24" tabindex="-1"></a>       )</span>
<span id="cb68-25"><a aria-hidden="true" href="#cb68-25" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-67-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level4" id="permanova">
<h4 class="anchored" data-anchor-id="permanova">PERMANOVA</h4>
<div class="cell" data-execution_count="107" id="cell-98">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a aria-hidden="true" href="#cb69-1" tabindex="-1"></a>dm_pm <span class="op">=</span> DistanceMatrix(dm, ids<span class="op">=</span>samples)</span>
<span id="cb69-2"><a aria-hidden="true" href="#cb69-2" tabindex="-1"></a>pm_factors <span class="op">=</span> (samples_info</span>
<span id="cb69-3"><a aria-hidden="true" href="#cb69-3" tabindex="-1"></a> .query(<span class="st">'sample_id not in ["S06", "S14"]'</span>)</span>
<span id="cb69-4"><a aria-hidden="true" href="#cb69-4" tabindex="-1"></a> .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name())</span>
<span id="cb69-5"><a aria-hidden="true" href="#cb69-5" tabindex="-1"></a> .drop(columns<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb69-6"><a aria-hidden="true" href="#cb69-6" tabindex="-1"></a>)</span>
<span id="cb69-7"><a aria-hidden="true" href="#cb69-7" tabindex="-1"></a>permanova_sample_mode <span class="op">=</span> permanova(dm_pm, pm_factors[<span class="st">'sample_mode'</span>])</span>
<span id="cb69-8"><a aria-hidden="true" href="#cb69-8" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'PERMANOVA for sample_mode:</span><span class="ch">\n</span><span class="st">'</span>, permanova_sample_mode)</span>
<span id="cb69-9"><a aria-hidden="true" href="#cb69-9" tabindex="-1"></a>permanova_month <span class="op">=</span> permanova(dm_pm, pm_factors[<span class="st">'month'</span>])</span>
<span id="cb69-10"><a aria-hidden="true" href="#cb69-10" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">PERMANOVA for month:</span><span class="ch">\n</span><span class="st">'</span>, permanova_month)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PERMANOVA for sample_mode:
 method name               PERMANOVA
test statistic name        pseudo-F
sample size                      20
number of groups                  2
test statistic             0.676167
p-value                       0.558
number of permutations          999
Name: PERMANOVA results, dtype: object

PERMANOVA for month:
 method name               PERMANOVA
test statistic name        pseudo-F
sample size                      20
number of groups                  2
test statistic             3.999877
p-value                       0.013
number of permutations          999
Name: PERMANOVA results, dtype: object</code></pre>
</div>
</div>
</section>
</section>
<section class="level3" id="barplots">
<h3 class="anchored" data-anchor-id="barplots">Barplots</h3>
<div class="cell" data-execution_count="112" id="cell-100">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a aria-hidden="true" href="#cb71-1" tabindex="-1"></a>f <span class="op">=</span> (abundance_df_phyla</span>
<span id="cb71-2"><a aria-hidden="true" href="#cb71-2" tabindex="-1"></a> .melt([<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb71-3"><a aria-hidden="true" href="#cb71-3" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb71-4"><a aria-hidden="true" href="#cb71-4" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span>dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb71-5"><a aria-hidden="true" href="#cb71-5" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb71-6"><a aria-hidden="true" href="#cb71-6" tabindex="-1"></a> .melt([<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>, <span class="st">'sample_id'</span>])</span>
<span id="cb71-7"><a aria-hidden="true" href="#cb71-7" tabindex="-1"></a> .assign(value<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'value'</span>].astype(<span class="bu">float</span>))</span>
<span id="cb71-8"><a aria-hidden="true" href="#cb71-8" tabindex="-1"></a> .replace(<span class="st">'unknown'</span>, pd.NA)</span>
<span id="cb71-9"><a aria-hidden="true" href="#cb71-9" tabindex="-1"></a>  .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb71-10"><a aria-hidden="true" href="#cb71-10" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'Phylum'</span>)</span>
<span id="cb71-11"><a aria-hidden="true" href="#cb71-11" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col()</span>
<span id="cb71-12"><a aria-hidden="true" href="#cb71-12" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb71-13"><a aria-hidden="true" href="#cb71-13" tabindex="-1"></a>       <span class="op">+</span> p9.guides(fill<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb71-14"><a aria-hidden="true" href="#cb71-14" tabindex="-1"></a>       <span class="op">+</span> p9.facet_grid(<span class="st">'variable ~ Kingdom'</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb71-15"><a aria-hidden="true" href="#cb71-15" tabindex="-1"></a>       <span class="op">+</span> p9.theme(</span>
<span id="cb71-16"><a aria-hidden="true" href="#cb71-16" tabindex="-1"></a>           legend_key_size<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb71-17"><a aria-hidden="true" href="#cb71-17" tabindex="-1"></a>           axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb71-18"><a aria-hidden="true" href="#cb71-18" tabindex="-1"></a>           figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>),</span>
<span id="cb71-19"><a aria-hidden="true" href="#cb71-19" tabindex="-1"></a>           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb71-20"><a aria-hidden="true" href="#cb71-20" tabindex="-1"></a></span>
<span id="cb71-21"><a aria-hidden="true" href="#cb71-21" tabindex="-1"></a>       )</span>
<span id="cb71-22"><a aria-hidden="true" href="#cb71-22" tabindex="-1"></a>       )</span>
<span id="cb71-23"><a aria-hidden="true" href="#cb71-23" tabindex="-1"></a> )</span>
<span id="cb71-24"><a aria-hidden="true" href="#cb71-24" tabindex="-1"></a>f.save(<span class="st">'../output/figures/abundance_by_sample_type_phyla.svg'</span>)</span>
<span id="cb71-25"><a aria-hidden="true" href="#cb71-25" tabindex="-1"></a><span class="co"># After some retouching in Inkscape</span></span>
<span id="cb71-26"><a aria-hidden="true" href="#cb71-26" tabindex="-1"></a>Image(<span class="st">'../output/figures/abundance_by_sample_type_phyla.png'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<div>
<figure class="figure">
<p><img class="img-fluid figure-img" src="microbial_diversity_analysis_files/figure-html/cell-69-output-1.png"/></p>
</figure>
</div>
</div>
</div>
<section class="level4" id="bubble-charts">
<h4 class="anchored" data-anchor-id="bubble-charts">Bubble Charts</h4>
<section class="level5" id="phyla">
<h5 class="anchored" data-anchor-id="phyla">Phyla</h5>
<div class="cell" data-execution_count="114" id="cell-103">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a aria-hidden="true" href="#cb72-1" tabindex="-1"></a>(abundance_df_phyla</span>
<span id="cb72-2"><a aria-hidden="true" href="#cb72-2" tabindex="-1"></a> .melt([<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb72-3"><a aria-hidden="true" href="#cb72-3" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb72-4"><a aria-hidden="true" href="#cb72-4" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.value <span class="op">/</span> dd.value.<span class="bu">sum</span>()))</span>
<span id="cb72-5"><a aria-hidden="true" href="#cb72-5" tabindex="-1"></a> .query(<span class="st">'Phylum != "unknown"'</span>)</span>
<span id="cb72-6"><a aria-hidden="true" href="#cb72-6" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Fungi"'</span>)</span>
<span id="cb72-7"><a aria-hidden="true" href="#cb72-7" tabindex="-1"></a> .merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb72-8"><a aria-hidden="true" href="#cb72-8" tabindex="-1"></a> .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: <span class="st">'S'</span> <span class="op">+</span> dd.sample_id.<span class="bu">str</span>[<span class="op">-</span><span class="dv">2</span>:])</span>
<span id="cb72-9"><a aria-hidden="true" href="#cb72-9" tabindex="-1"></a>  .query(<span class="st">'relative_abundance &gt; 0'</span>)</span>
<span id="cb72-10"><a aria-hidden="true" href="#cb72-10" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb72-11"><a aria-hidden="true" href="#cb72-11" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'reorder(Phylum, relative_abundance)'</span>,</span>
<span id="cb72-12"><a aria-hidden="true" href="#cb72-12" tabindex="-1"></a>                 size<span class="op">=</span><span class="st">'relative_abundance'</span>, color<span class="op">=</span><span class="st">'Kingdom'</span>, fill<span class="op">=</span><span class="st">'Kingdom'</span>)</span>
<span id="cb72-13"><a aria-hidden="true" href="#cb72-13" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>)</span>
<span id="cb72-14"><a aria-hidden="true" href="#cb72-14" tabindex="-1"></a>       <span class="op">+</span> p9.facet_grid(<span class="st">'Kingdom ~ sample_mode'</span>, scales<span class="op">=</span><span class="st">'free'</span>, space<span class="op">=</span><span class="st">'free'</span>)</span>
<span id="cb72-15"><a aria-hidden="true" href="#cb72-15" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log2'</span>, <span class="bu">range</span><span class="op">=</span>(<span class="fl">.2</span>, <span class="dv">9</span>), labels<span class="op">=</span>percent_format(), </span>
<span id="cb72-16"><a aria-hidden="true" href="#cb72-16" tabindex="-1"></a>                                    limits<span class="op">=</span>(<span class="fl">.0005</span>, <span class="fl">.9</span>), breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb72-17"><a aria-hidden="true" href="#cb72-17" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.35</span>, <span class="fl">.35</span>))</span>
<span id="cb72-18"><a aria-hidden="true" href="#cb72-18" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb72-19"><a aria-hidden="true" href="#cb72-19" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#435B97'</span>])</span>
<span id="cb72-20"><a aria-hidden="true" href="#cb72-20" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#435B97'</span>])</span>
<span id="cb72-21"><a aria-hidden="true" href="#cb72-21" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Kingdom'</span>,</span>
<span id="cb72-22"><a aria-hidden="true" href="#cb72-22" tabindex="-1"></a>                  )</span>
<span id="cb72-23"><a aria-hidden="true" href="#cb72-23" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">2</span>),</span>
<span id="cb72-24"><a aria-hidden="true" href="#cb72-24" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb72-25"><a aria-hidden="true" href="#cb72-25" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb72-26"><a aria-hidden="true" href="#cb72-26" tabindex="-1"></a>       </span>
<span id="cb72-27"><a aria-hidden="true" href="#cb72-27" tabindex="-1"></a>       )</span>
<span id="cb72-28"><a aria-hidden="true" href="#cb72-28" tabindex="-1"></a> )</span>
<span id="cb72-29"><a aria-hidden="true" href="#cb72-29" tabindex="-1"></a>).save(<span class="st">'../output/figures/abundance_phyla_fungi.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb72-30"><a aria-hidden="true" href="#cb72-30" tabindex="-1"></a></span>
<span id="cb72-31"><a aria-hidden="true" href="#cb72-31" tabindex="-1"></a></span>
<span id="cb72-32"><a aria-hidden="true" href="#cb72-32" tabindex="-1"></a>(abundance_df_phyla</span>
<span id="cb72-33"><a aria-hidden="true" href="#cb72-33" tabindex="-1"></a> .melt([<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb72-34"><a aria-hidden="true" href="#cb72-34" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb72-35"><a aria-hidden="true" href="#cb72-35" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.value <span class="op">/</span> dd.value.<span class="bu">sum</span>()))</span>
<span id="cb72-36"><a aria-hidden="true" href="#cb72-36" tabindex="-1"></a> .query(<span class="st">'Phylum != "unknown"'</span>)</span>
<span id="cb72-37"><a aria-hidden="true" href="#cb72-37" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Bacteria"'</span>)</span>
<span id="cb72-38"><a aria-hidden="true" href="#cb72-38" tabindex="-1"></a> .query(<span class="st">'relative_abundance &gt; 0'</span>)</span>
<span id="cb72-39"><a aria-hidden="true" href="#cb72-39" tabindex="-1"></a> .merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb72-40"><a aria-hidden="true" href="#cb72-40" tabindex="-1"></a> .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: <span class="st">'S'</span> <span class="op">+</span> dd.sample_id.<span class="bu">str</span>[<span class="op">-</span><span class="dv">2</span>:])</span>
<span id="cb72-41"><a aria-hidden="true" href="#cb72-41" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb72-42"><a aria-hidden="true" href="#cb72-42" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'reorder(Phylum, relative_abundance)'</span>,</span>
<span id="cb72-43"><a aria-hidden="true" href="#cb72-43" tabindex="-1"></a>                 size<span class="op">=</span><span class="st">'relative_abundance'</span>, color<span class="op">=</span><span class="st">'Kingdom'</span>, fill<span class="op">=</span><span class="st">'Kingdom'</span>)</span>
<span id="cb72-44"><a aria-hidden="true" href="#cb72-44" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>)</span>
<span id="cb72-45"><a aria-hidden="true" href="#cb72-45" tabindex="-1"></a>       <span class="op">+</span> p9.facet_grid(<span class="st">'Kingdom ~ sample_mode'</span>, scales<span class="op">=</span><span class="st">'free'</span>, space<span class="op">=</span><span class="st">'free'</span>)</span>
<span id="cb72-46"><a aria-hidden="true" href="#cb72-46" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log2'</span>, <span class="bu">range</span><span class="op">=</span>(<span class="fl">.2</span>, <span class="dv">9</span>), labels<span class="op">=</span>percent_format(), </span>
<span id="cb72-47"><a aria-hidden="true" href="#cb72-47" tabindex="-1"></a>                                    limits<span class="op">=</span>(<span class="fl">.0005</span>, <span class="fl">.9</span>), breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb72-48"><a aria-hidden="true" href="#cb72-48" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.05</span>, <span class="fl">.05</span>))</span>
<span id="cb72-49"><a aria-hidden="true" href="#cb72-49" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb72-50"><a aria-hidden="true" href="#cb72-50" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>])</span>
<span id="cb72-51"><a aria-hidden="true" href="#cb72-51" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>])</span>
<span id="cb72-52"><a aria-hidden="true" href="#cb72-52" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Kingdom'</span>,</span>
<span id="cb72-53"><a aria-hidden="true" href="#cb72-53" tabindex="-1"></a>                  )</span>
<span id="cb72-54"><a aria-hidden="true" href="#cb72-54" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">5</span>),</span>
<span id="cb72-55"><a aria-hidden="true" href="#cb72-55" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb72-56"><a aria-hidden="true" href="#cb72-56" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_blank(),</span>
<span id="cb72-57"><a aria-hidden="true" href="#cb72-57" tabindex="-1"></a>                  axis_ticks_major_x<span class="op">=</span>p9.element_blank(),</span>
<span id="cb72-58"><a aria-hidden="true" href="#cb72-58" tabindex="-1"></a>       </span>
<span id="cb72-59"><a aria-hidden="true" href="#cb72-59" tabindex="-1"></a>       )</span>
<span id="cb72-60"><a aria-hidden="true" href="#cb72-60" tabindex="-1"></a> )</span>
<span id="cb72-61"><a aria-hidden="true" href="#cb72-61" tabindex="-1"></a>).save(<span class="st">'../output/figures/abundance_phyla_bacteria.svg'</span>)</span>
<span id="cb72-62"><a aria-hidden="true" href="#cb72-62" tabindex="-1"></a></span>
<span id="cb72-63"><a aria-hidden="true" href="#cb72-63" tabindex="-1"></a><span class="co"># The actual figure is made in Inkscape since plotnine doesn't support</span></span>
<span id="cb72-64"><a aria-hidden="true" href="#cb72-64" tabindex="-1"></a><span class="co"># facets of different sizes and the difference between the number of bacterial</span></span>
<span id="cb72-65"><a aria-hidden="true" href="#cb72-65" tabindex="-1"></a><span class="co"># and fungal phyla is too large to make a single figure with the same size</span></span>
<span id="cb72-66"><a aria-hidden="true" href="#cb72-66" tabindex="-1"></a></span>
<span id="cb72-67"><a aria-hidden="true" href="#cb72-67" tabindex="-1"></a>Image(<span class="st">'../output/figures/abundance_phyla.png'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="114">
<div>
<figure class="figure">
<p><img class="img-fluid figure-img" src="microbial_diversity_analysis_files/figure-html/cell-70-output-1.png"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level5" id="genera">
<h5 class="anchored" data-anchor-id="genera">Genera</h5>
<p>To represent the diversity and fluctuation of genera across all samples, what we will do is select the top 30 most common (by total number of reads across all 22 samples)</p>
<div class="cell" data-execution_count="115" id="cell-106">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a aria-hidden="true" href="#cb73-1" tabindex="-1"></a>taxon_names <span class="op">=</span> [<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>, <span class="st">'Class'</span>, <span class="st">'Order'</span>, <span class="st">'Family'</span>, <span class="st">'Genus'</span>]</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="116" id="cell-107">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a aria-hidden="true" href="#cb74-1" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb74-2"><a aria-hidden="true" href="#cb74-2" tabindex="-1"></a>l <span class="op">=</span> (<span class="dv">8</span> <span class="op">/</span> <span class="dv">20</span>) <span class="op">*</span> n</span>
<span id="cb74-3"><a aria-hidden="true" href="#cb74-3" tabindex="-1"></a></span>
<span id="cb74-4"><a aria-hidden="true" href="#cb74-4" tabindex="-1"></a>over_3_samples_genera <span class="op">=</span> samples_per_otu.query(<span class="st">'n_samples &gt;= 3'</span>).Genus</span>
<span id="cb74-5"><a aria-hidden="true" href="#cb74-5" tabindex="-1"></a>selected_bacterial_genera <span class="op">=</span> (abundance_long_genera</span>
<span id="cb74-6"><a aria-hidden="true" href="#cb74-6" tabindex="-1"></a>    .query(<span class="st">'Kingdom=="Bacteria"'</span>)</span>
<span id="cb74-7"><a aria-hidden="true" href="#cb74-7" tabindex="-1"></a>    .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb74-8"><a aria-hidden="true" href="#cb74-8" tabindex="-1"></a>    .query(<span class="st">'Genus in @over_3_samples_genera'</span>)</span>
<span id="cb74-9"><a aria-hidden="true" href="#cb74-9" tabindex="-1"></a>    .groupby(taxon_names)</span>
<span id="cb74-10"><a aria-hidden="true" href="#cb74-10" tabindex="-1"></a>    .counts</span>
<span id="cb74-11"><a aria-hidden="true" href="#cb74-11" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb74-12"><a aria-hidden="true" href="#cb74-12" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb74-13"><a aria-hidden="true" href="#cb74-13" tabindex="-1"></a>    .iloc[:n]</span>
<span id="cb74-14"><a aria-hidden="true" href="#cb74-14" tabindex="-1"></a>    .reset_index()</span>
<span id="cb74-15"><a aria-hidden="true" href="#cb74-15" tabindex="-1"></a>    [<span class="st">'Genus'</span>].unique()</span>
<span id="cb74-16"><a aria-hidden="true" href="#cb74-16" tabindex="-1"></a>)</span>
<span id="cb74-17"><a aria-hidden="true" href="#cb74-17" tabindex="-1"></a></span>
<span id="cb74-18"><a aria-hidden="true" href="#cb74-18" tabindex="-1"></a>selected_fungal_genera <span class="op">=</span> (abundance_long_genera</span>
<span id="cb74-19"><a aria-hidden="true" href="#cb74-19" tabindex="-1"></a>    .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb74-20"><a aria-hidden="true" href="#cb74-20" tabindex="-1"></a>    .query(<span class="st">'Kingdom=="Fungi"'</span>)</span>
<span id="cb74-21"><a aria-hidden="true" href="#cb74-21" tabindex="-1"></a>    .query(<span class="st">'Genus in @over_3_samples_genera'</span>)</span>
<span id="cb74-22"><a aria-hidden="true" href="#cb74-22" tabindex="-1"></a>    .groupby(taxon_names)</span>
<span id="cb74-23"><a aria-hidden="true" href="#cb74-23" tabindex="-1"></a>    .counts</span>
<span id="cb74-24"><a aria-hidden="true" href="#cb74-24" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb74-25"><a aria-hidden="true" href="#cb74-25" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb74-26"><a aria-hidden="true" href="#cb74-26" tabindex="-1"></a>    .iloc[:n]</span>
<span id="cb74-27"><a aria-hidden="true" href="#cb74-27" tabindex="-1"></a>    .reset_index()</span>
<span id="cb74-28"><a aria-hidden="true" href="#cb74-28" tabindex="-1"></a>    [<span class="st">'Genus'</span>].unique()</span>
<span id="cb74-29"><a aria-hidden="true" href="#cb74-29" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="118" id="cell-108">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a aria-hidden="true" href="#cb75-1" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb75-2"><a aria-hidden="true" href="#cb75-2" tabindex="-1"></a>l <span class="op">=</span> (<span class="dv">8</span> <span class="op">/</span> <span class="dv">20</span>) <span class="op">*</span> n</span>
<span id="cb75-3"><a aria-hidden="true" href="#cb75-3" tabindex="-1"></a></span>
<span id="cb75-4"><a aria-hidden="true" href="#cb75-4" tabindex="-1"></a>over_3_samples_genera <span class="op">=</span> samples_per_otu.query(<span class="st">'n_samples &gt;= 3'</span>).Genus</span>
<span id="cb75-5"><a aria-hidden="true" href="#cb75-5" tabindex="-1"></a>selected_bacterial_genera <span class="op">=</span> (abundance_long_genera</span>
<span id="cb75-6"><a aria-hidden="true" href="#cb75-6" tabindex="-1"></a>    .query(<span class="st">'Kingdom=="Bacteria"'</span>)</span>
<span id="cb75-7"><a aria-hidden="true" href="#cb75-7" tabindex="-1"></a>    .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb75-8"><a aria-hidden="true" href="#cb75-8" tabindex="-1"></a>    .query(<span class="st">'Genus in @over_3_samples_genera'</span>)</span>
<span id="cb75-9"><a aria-hidden="true" href="#cb75-9" tabindex="-1"></a>    .groupby(taxon_names)</span>
<span id="cb75-10"><a aria-hidden="true" href="#cb75-10" tabindex="-1"></a>    .counts</span>
<span id="cb75-11"><a aria-hidden="true" href="#cb75-11" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb75-12"><a aria-hidden="true" href="#cb75-12" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb75-13"><a aria-hidden="true" href="#cb75-13" tabindex="-1"></a>    .iloc[:n]</span>
<span id="cb75-14"><a aria-hidden="true" href="#cb75-14" tabindex="-1"></a>    .reset_index()</span>
<span id="cb75-15"><a aria-hidden="true" href="#cb75-15" tabindex="-1"></a>    [<span class="st">'Genus'</span>].unique()</span>
<span id="cb75-16"><a aria-hidden="true" href="#cb75-16" tabindex="-1"></a>)</span>
<span id="cb75-17"><a aria-hidden="true" href="#cb75-17" tabindex="-1"></a></span>
<span id="cb75-18"><a aria-hidden="true" href="#cb75-18" tabindex="-1"></a>selected_fungal_genera <span class="op">=</span> (abundance_long_genera</span>
<span id="cb75-19"><a aria-hidden="true" href="#cb75-19" tabindex="-1"></a>    .query(<span class="st">'Genus not in @inconclusive_list'</span>)</span>
<span id="cb75-20"><a aria-hidden="true" href="#cb75-20" tabindex="-1"></a>    .query(<span class="st">'Kingdom=="Fungi"'</span>)</span>
<span id="cb75-21"><a aria-hidden="true" href="#cb75-21" tabindex="-1"></a>    .query(<span class="st">'Genus in @over_3_samples_genera'</span>)</span>
<span id="cb75-22"><a aria-hidden="true" href="#cb75-22" tabindex="-1"></a>    .groupby(taxon_names)</span>
<span id="cb75-23"><a aria-hidden="true" href="#cb75-23" tabindex="-1"></a>    .counts</span>
<span id="cb75-24"><a aria-hidden="true" href="#cb75-24" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb75-25"><a aria-hidden="true" href="#cb75-25" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb75-26"><a aria-hidden="true" href="#cb75-26" tabindex="-1"></a>    .iloc[:n]</span>
<span id="cb75-27"><a aria-hidden="true" href="#cb75-27" tabindex="-1"></a>    .reset_index()</span>
<span id="cb75-28"><a aria-hidden="true" href="#cb75-28" tabindex="-1"></a>    [<span class="st">'Genus'</span>].unique()</span>
<span id="cb75-29"><a aria-hidden="true" href="#cb75-29" tabindex="-1"></a>)</span>
<span id="cb75-30"><a aria-hidden="true" href="#cb75-30" tabindex="-1"></a></span>
<span id="cb75-31"><a aria-hidden="true" href="#cb75-31" tabindex="-1"></a>ordered_genera <span class="op">=</span> selected_bacterial_genera.tolist() <span class="op">+</span> selected_fungal_genera.tolist()</span>
<span id="cb75-32"><a aria-hidden="true" href="#cb75-32" tabindex="-1"></a>ordered_genera.reverse()</span>
<span id="cb75-33"><a aria-hidden="true" href="#cb75-33" tabindex="-1"></a></span>
<span id="cb75-34"><a aria-hidden="true" href="#cb75-34" tabindex="-1"></a>f <span class="op">=</span> (abundance_long_genera</span>
<span id="cb75-35"><a aria-hidden="true" href="#cb75-35" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb75-36"><a aria-hidden="true" href="#cb75-36" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb75-37"><a aria-hidden="true" href="#cb75-37" tabindex="-1"></a> .query(<span class="st">'Genus in @selected_bacterial_genera or Genus in @selected_fungal_genera'</span>)</span>
<span id="cb75-38"><a aria-hidden="true" href="#cb75-38" tabindex="-1"></a> .merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb75-39"><a aria-hidden="true" href="#cb75-39" tabindex="-1"></a> .query(<span class="st">'relative_abundance &gt; 0'</span>)</span>
<span id="cb75-40"><a aria-hidden="true" href="#cb75-40" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.Genus, categories<span class="op">=</span>ordered_genera, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb75-41"><a aria-hidden="true" href="#cb75-41" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb75-42"><a aria-hidden="true" href="#cb75-42" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'relative_abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>, fill<span class="op">=</span><span class="st">'Class'</span>)</span>
<span id="cb75-43"><a aria-hidden="true" href="#cb75-43" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>)</span>
<span id="cb75-44"><a aria-hidden="true" href="#cb75-44" tabindex="-1"></a>       <span class="op">+</span> p9.facet_grid(<span class="st">'Kingdom ~ sample_mode'</span>, scales<span class="op">=</span><span class="st">'free'</span>)</span>
<span id="cb75-45"><a aria-hidden="true" href="#cb75-45" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>, <span class="bu">range</span><span class="op">=</span>(<span class="fl">.2</span>, <span class="dv">9</span>), labels<span class="op">=</span>percent_format(), </span>
<span id="cb75-46"><a aria-hidden="true" href="#cb75-46" tabindex="-1"></a>                                    limits<span class="op">=</span>(<span class="fl">.0005</span>, <span class="fl">.9</span>), breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb75-47"><a aria-hidden="true" href="#cb75-47" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb75-48"><a aria-hidden="true" href="#cb75-48" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb75-49"><a aria-hidden="true" href="#cb75-49" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb75-50"><a aria-hidden="true" href="#cb75-50" tabindex="-1"></a>                  )</span>
<span id="cb75-51"><a aria-hidden="true" href="#cb75-51" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">12</span>, l),</span>
<span id="cb75-52"><a aria-hidden="true" href="#cb75-52" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb75-53"><a aria-hidden="true" href="#cb75-53" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb75-54"><a aria-hidden="true" href="#cb75-54" tabindex="-1"></a>       </span>
<span id="cb75-55"><a aria-hidden="true" href="#cb75-55" tabindex="-1"></a>       )</span>
<span id="cb75-56"><a aria-hidden="true" href="#cb75-56" tabindex="-1"></a> )</span>
<span id="cb75-57"><a aria-hidden="true" href="#cb75-57" tabindex="-1"></a> )</span>
<span id="cb75-58"><a aria-hidden="true" href="#cb75-58" tabindex="-1"></a></span>
<span id="cb75-59"><a aria-hidden="true" href="#cb75-59" tabindex="-1"></a>f.save(<span class="st">'../output/figures/top30_genera_bubbles.svg'</span>)</span>
<span id="cb75-60"><a aria-hidden="true" href="#cb75-60" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="118">
<div>
<figure class="figure">
<p><img class="figure-img" height="3566" src="microbial_diversity_analysis_files/figure-html/cell-73-output-1.png" width="3587"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="119" id="cell-109">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a aria-hidden="true" href="#cb76-1" tabindex="-1"></a>dm_16s <span class="op">=</span> (abundance_df_genera</span>
<span id="cb76-2"><a aria-hidden="true" href="#cb76-2" tabindex="-1"></a> .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb76-3"><a aria-hidden="true" href="#cb76-3" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Bacteria"'</span>)</span>
<span id="cb76-4"><a aria-hidden="true" href="#cb76-4" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb76-5"><a aria-hidden="true" href="#cb76-5" tabindex="-1"></a> .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb76-6"><a aria-hidden="true" href="#cb76-6" tabindex="-1"></a> .T</span>
<span id="cb76-7"><a aria-hidden="true" href="#cb76-7" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="op">/</span> x.<span class="bu">sum</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb76-8"><a aria-hidden="true" href="#cb76-8" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: pairwise_distances(dd, metric<span class="op">=</span><span class="st">'braycurtis'</span>))</span>
<span id="cb76-9"><a aria-hidden="true" href="#cb76-9" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="120" id="cell-110">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a aria-hidden="true" href="#cb77-1" tabindex="-1"></a>dm_its <span class="op">=</span> (abundance_df_genera</span>
<span id="cb77-2"><a aria-hidden="true" href="#cb77-2" tabindex="-1"></a> .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb77-3"><a aria-hidden="true" href="#cb77-3" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Fungi"'</span>)</span>
<span id="cb77-4"><a aria-hidden="true" href="#cb77-4" tabindex="-1"></a> .drop(columns<span class="op">=</span>[<span class="st">'S06'</span>] <span class="op">+</span> taxon_names[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb77-5"><a aria-hidden="true" href="#cb77-5" tabindex="-1"></a> .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb77-6"><a aria-hidden="true" href="#cb77-6" tabindex="-1"></a> .T</span>
<span id="cb77-7"><a aria-hidden="true" href="#cb77-7" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="op">/</span> x.<span class="bu">sum</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-8"><a aria-hidden="true" href="#cb77-8" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: pairwise_distances(dd, metric<span class="op">=</span><span class="st">'braycurtis'</span>))</span>
<span id="cb77-9"><a aria-hidden="true" href="#cb77-9" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="121" id="cell-111">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a aria-hidden="true" href="#cb78-1" tabindex="-1"></a>sample_columns_s06 <span class="op">=</span> samples_info.query(<span class="st">'sample_id not in ["S06", "S14"]'</span>).sample_id</span>
<span id="cb78-2"><a aria-hidden="true" href="#cb78-2" tabindex="-1"></a></span>
<span id="cb78-3"><a aria-hidden="true" href="#cb78-3" tabindex="-1"></a>bc_df <span class="op">=</span> (pd.DataFrame(dm, index<span class="op">=</span>sample_columns_s06, columns<span class="op">=</span>sample_columns_s06)</span>
<span id="cb78-4"><a aria-hidden="true" href="#cb78-4" tabindex="-1"></a> .reset_index()</span>
<span id="cb78-5"><a aria-hidden="true" href="#cb78-5" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'sample_id'</span>})</span>
<span id="cb78-6"><a aria-hidden="true" href="#cb78-6" tabindex="-1"></a> .melt(<span class="st">'sample_id'</span>, var_name<span class="op">=</span><span class="st">'sample_id2'</span>, value_name<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb78-7"><a aria-hidden="true" href="#cb78-7" tabindex="-1"></a> .sort_values([<span class="st">'sample_id'</span>, <span class="st">'sample_id2'</span>])</span>
<span id="cb78-8"><a aria-hidden="true" href="#cb78-8" tabindex="-1"></a> .merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb78-9"><a aria-hidden="true" href="#cb78-9" tabindex="-1"></a> .merge(samples_info, left_on<span class="op">=</span><span class="st">'sample_id2'</span>, right_on<span class="op">=</span><span class="st">'sample_id'</span>, suffixes<span class="op">=</span>[<span class="st">''</span>, <span class="st">'_2'</span>])</span>
<span id="cb78-10"><a aria-hidden="true" href="#cb78-10" tabindex="-1"></a> .assign(timedelta<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date_2) <span class="op">-</span> pd.to_datetime(dd.date))</span>
<span id="cb78-11"><a aria-hidden="true" href="#cb78-11" tabindex="-1"></a> .assign(combi<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'sample_mode'</span>] <span class="op">+</span> <span class="vs">r'$\rightarrow$'</span> <span class="op">+</span> dd[<span class="st">'sample_mode_2'</span>])</span>
<span id="cb78-12"><a aria-hidden="true" href="#cb78-12" tabindex="-1"></a>)</span>
<span id="cb78-13"><a aria-hidden="true" href="#cb78-13" tabindex="-1"></a></span>
<span id="cb78-14"><a aria-hidden="true" href="#cb78-14" tabindex="-1"></a>bc_df_16s <span class="op">=</span> (pd.DataFrame(dm_16s, index<span class="op">=</span>sample_columns, columns<span class="op">=</span>sample_columns)</span>
<span id="cb78-15"><a aria-hidden="true" href="#cb78-15" tabindex="-1"></a> .reset_index()</span>
<span id="cb78-16"><a aria-hidden="true" href="#cb78-16" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'sample_id'</span>})</span>
<span id="cb78-17"><a aria-hidden="true" href="#cb78-17" tabindex="-1"></a> .melt(<span class="st">'sample_id'</span>, var_name<span class="op">=</span><span class="st">'sample_id2'</span>, value_name<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb78-18"><a aria-hidden="true" href="#cb78-18" tabindex="-1"></a> .sort_values([<span class="st">'sample_id'</span>, <span class="st">'sample_id2'</span>])</span>
<span id="cb78-19"><a aria-hidden="true" href="#cb78-19" tabindex="-1"></a> .merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb78-20"><a aria-hidden="true" href="#cb78-20" tabindex="-1"></a> .merge(samples_info, left_on<span class="op">=</span><span class="st">'sample_id2'</span>, right_on<span class="op">=</span><span class="st">'sample_id'</span>, suffixes<span class="op">=</span>[<span class="st">''</span>, <span class="st">'_2'</span>])</span>
<span id="cb78-21"><a aria-hidden="true" href="#cb78-21" tabindex="-1"></a> .assign(timedelta<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date_2) <span class="op">-</span> pd.to_datetime(dd.date))</span>
<span id="cb78-22"><a aria-hidden="true" href="#cb78-22" tabindex="-1"></a> .assign(combi<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'sample_mode'</span>] <span class="op">+</span> <span class="vs">r'$\rightarrow$'</span> <span class="op">+</span> dd[<span class="st">'sample_mode_2'</span>])</span>
<span id="cb78-23"><a aria-hidden="true" href="#cb78-23" tabindex="-1"></a>)</span>
<span id="cb78-24"><a aria-hidden="true" href="#cb78-24" tabindex="-1"></a></span>
<span id="cb78-25"><a aria-hidden="true" href="#cb78-25" tabindex="-1"></a>bc_df_its <span class="op">=</span> (pd.DataFrame(dm_its, index<span class="op">=</span>sample_columns_s06, columns<span class="op">=</span>sample_columns_s06)</span>
<span id="cb78-26"><a aria-hidden="true" href="#cb78-26" tabindex="-1"></a> .reset_index()</span>
<span id="cb78-27"><a aria-hidden="true" href="#cb78-27" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'sample_id'</span>})</span>
<span id="cb78-28"><a aria-hidden="true" href="#cb78-28" tabindex="-1"></a> .melt(<span class="st">'sample_id'</span>, var_name<span class="op">=</span><span class="st">'sample_id2'</span>, value_name<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb78-29"><a aria-hidden="true" href="#cb78-29" tabindex="-1"></a> .sort_values([<span class="st">'sample_id'</span>, <span class="st">'sample_id2'</span>])</span>
<span id="cb78-30"><a aria-hidden="true" href="#cb78-30" tabindex="-1"></a> .merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb78-31"><a aria-hidden="true" href="#cb78-31" tabindex="-1"></a> .merge(samples_info, left_on<span class="op">=</span><span class="st">'sample_id2'</span>, right_on<span class="op">=</span><span class="st">'sample_id'</span>, suffixes<span class="op">=</span>[<span class="st">''</span>, <span class="st">'_2'</span>])</span>
<span id="cb78-32"><a aria-hidden="true" href="#cb78-32" tabindex="-1"></a> .assign(timedelta<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date_2) <span class="op">-</span> pd.to_datetime(dd.date))</span>
<span id="cb78-33"><a aria-hidden="true" href="#cb78-33" tabindex="-1"></a> .assign(combi<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'sample_mode'</span>] <span class="op">+</span> <span class="vs">r'$\rightarrow$'</span> <span class="op">+</span> dd[<span class="st">'sample_mode_2'</span>])</span>
<span id="cb78-34"><a aria-hidden="true" href="#cb78-34" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="122" id="cell-112">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a aria-hidden="true" href="#cb79-1" tabindex="-1"></a>(bc_df</span>
<span id="cb79-2"><a aria-hidden="true" href="#cb79-2" tabindex="-1"></a> .query(<span class="st">'sample_id &lt; sample_id2'</span>)</span>
<span id="cb79-3"><a aria-hidden="true" href="#cb79-3" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd.distance.astype(<span class="bu">str</span>).<span class="bu">str</span>[<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb79-4"><a aria-hidden="true" href="#cb79-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb79-5"><a aria-hidden="true" href="#cb79-5" tabindex="-1"></a>        <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'sample_id2'</span>, fill<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb79-6"><a aria-hidden="true" href="#cb79-6" tabindex="-1"></a>        <span class="op">+</span> p9.geom_tile()</span>
<span id="cb79-7"><a aria-hidden="true" href="#cb79-7" tabindex="-1"></a>        <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'inferno'</span>, na_value<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb79-8"><a aria-hidden="true" href="#cb79-8" tabindex="-1"></a>        <span class="op">+</span> p9.theme_classic()</span>
<span id="cb79-9"><a aria-hidden="true" href="#cb79-9" tabindex="-1"></a>        <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'hline'</span>, yintercept<span class="op">=</span><span class="fl">10.5</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb79-10"><a aria-hidden="true" href="#cb79-10" tabindex="-1"></a>        <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, xintercept<span class="op">=</span><span class="fl">11.5</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb79-11"><a aria-hidden="true" href="#cb79-11" tabindex="-1"></a>        <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'label'</span>, color<span class="op">=</span><span class="st">'distance &gt;= .35'</span>), size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb79-12"><a aria-hidden="true" href="#cb79-12" tabindex="-1"></a>        <span class="op">+</span> p9.scale_color_manual([<span class="st">'white'</span>, <span class="st">'black'</span>])</span>
<span id="cb79-13"><a aria-hidden="true" href="#cb79-13" tabindex="-1"></a>        <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb79-14"><a aria-hidden="true" href="#cb79-14" tabindex="-1"></a>        <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, title<span class="op">=</span><span class="st">'Bray-Curtis dissimilarity (ITS + 16S)'</span>)</span>
<span id="cb79-15"><a aria-hidden="true" href="#cb79-15" tabindex="-1"></a>        <span class="op">+</span> p9.theme(</span>
<span id="cb79-16"><a aria-hidden="true" href="#cb79-16" tabindex="-1"></a>            axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb79-17"><a aria-hidden="true" href="#cb79-17" tabindex="-1"></a>            figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb79-18"><a aria-hidden="true" href="#cb79-18" tabindex="-1"></a>            dpi<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb79-19"><a aria-hidden="true" href="#cb79-19" tabindex="-1"></a>            title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb79-20"><a aria-hidden="true" href="#cb79-20" tabindex="-1"></a>            )</span>
<span id="cb79-21"><a aria-hidden="true" href="#cb79-21" tabindex="-1"></a>      )</span>
<span id="cb79-22"><a aria-hidden="true" href="#cb79-22" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2000" src="microbial_diversity_analysis_files/figure-html/cell-77-output-1.png" width="2000"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="123" id="cell-113">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a aria-hidden="true" href="#cb80-1" tabindex="-1"></a>(bc_df_16s</span>
<span id="cb80-2"><a aria-hidden="true" href="#cb80-2" tabindex="-1"></a> .query(<span class="st">'sample_id &lt; sample_id2'</span>)</span>
<span id="cb80-3"><a aria-hidden="true" href="#cb80-3" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd.distance.astype(<span class="bu">str</span>).<span class="bu">str</span>[<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb80-4"><a aria-hidden="true" href="#cb80-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb80-5"><a aria-hidden="true" href="#cb80-5" tabindex="-1"></a>        <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'sample_id2'</span>, fill<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb80-6"><a aria-hidden="true" href="#cb80-6" tabindex="-1"></a>        <span class="op">+</span> p9.geom_tile()</span>
<span id="cb80-7"><a aria-hidden="true" href="#cb80-7" tabindex="-1"></a>        <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'inferno'</span>, na_value<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb80-8"><a aria-hidden="true" href="#cb80-8" tabindex="-1"></a>        <span class="op">+</span> p9.theme_classic()</span>
<span id="cb80-9"><a aria-hidden="true" href="#cb80-9" tabindex="-1"></a>        <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'hline'</span>, yintercept<span class="op">=</span><span class="fl">10.5</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb80-10"><a aria-hidden="true" href="#cb80-10" tabindex="-1"></a>        <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, xintercept<span class="op">=</span><span class="fl">11.5</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb80-11"><a aria-hidden="true" href="#cb80-11" tabindex="-1"></a>        <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'label'</span>, color<span class="op">=</span><span class="st">'distance &gt;= .35'</span>), size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb80-12"><a aria-hidden="true" href="#cb80-12" tabindex="-1"></a>        <span class="op">+</span> p9.scale_color_manual([<span class="st">'white'</span>, <span class="st">'black'</span>])</span>
<span id="cb80-13"><a aria-hidden="true" href="#cb80-13" tabindex="-1"></a>        <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb80-14"><a aria-hidden="true" href="#cb80-14" tabindex="-1"></a>        <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, title<span class="op">=</span><span class="st">'Bray-Curtis dissimilarity (16S-only)'</span>)</span>
<span id="cb80-15"><a aria-hidden="true" href="#cb80-15" tabindex="-1"></a>        <span class="op">+</span> p9.theme(</span>
<span id="cb80-16"><a aria-hidden="true" href="#cb80-16" tabindex="-1"></a>            axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb80-17"><a aria-hidden="true" href="#cb80-17" tabindex="-1"></a>            figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb80-18"><a aria-hidden="true" href="#cb80-18" tabindex="-1"></a>            dpi<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb80-19"><a aria-hidden="true" href="#cb80-19" tabindex="-1"></a>            title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb80-20"><a aria-hidden="true" href="#cb80-20" tabindex="-1"></a>            )</span>
<span id="cb80-21"><a aria-hidden="true" href="#cb80-21" tabindex="-1"></a>      )</span>
<span id="cb80-22"><a aria-hidden="true" href="#cb80-22" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2000" src="microbial_diversity_analysis_files/figure-html/cell-78-output-1.png" width="2000"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="124" id="cell-114">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a aria-hidden="true" href="#cb81-1" tabindex="-1"></a>(bc_df_its</span>
<span id="cb81-2"><a aria-hidden="true" href="#cb81-2" tabindex="-1"></a> .query(<span class="st">'sample_id &lt; sample_id2'</span>)</span>
<span id="cb81-3"><a aria-hidden="true" href="#cb81-3" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd.distance.astype(<span class="bu">str</span>).<span class="bu">str</span>[<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb81-4"><a aria-hidden="true" href="#cb81-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb81-5"><a aria-hidden="true" href="#cb81-5" tabindex="-1"></a>        <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'sample_id2'</span>, fill<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb81-6"><a aria-hidden="true" href="#cb81-6" tabindex="-1"></a>        <span class="op">+</span> p9.geom_tile()</span>
<span id="cb81-7"><a aria-hidden="true" href="#cb81-7" tabindex="-1"></a>        <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'inferno'</span>, na_value<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb81-8"><a aria-hidden="true" href="#cb81-8" tabindex="-1"></a>        <span class="op">+</span> p9.theme_classic()</span>
<span id="cb81-9"><a aria-hidden="true" href="#cb81-9" tabindex="-1"></a>        <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'hline'</span>, yintercept<span class="op">=</span><span class="fl">10.5</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb81-10"><a aria-hidden="true" href="#cb81-10" tabindex="-1"></a>        <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, xintercept<span class="op">=</span><span class="fl">11.5</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb81-11"><a aria-hidden="true" href="#cb81-11" tabindex="-1"></a>        <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'label'</span>, color<span class="op">=</span><span class="st">'distance &gt;= .35'</span>), size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb81-12"><a aria-hidden="true" href="#cb81-12" tabindex="-1"></a>        <span class="op">+</span> p9.scale_color_manual([<span class="st">'white'</span>, <span class="st">'black'</span>])</span>
<span id="cb81-13"><a aria-hidden="true" href="#cb81-13" tabindex="-1"></a>        <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb81-14"><a aria-hidden="true" href="#cb81-14" tabindex="-1"></a>        <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, title<span class="op">=</span><span class="st">'Bray-Curtis dissimilarity (ITS-only)'</span>)</span>
<span id="cb81-15"><a aria-hidden="true" href="#cb81-15" tabindex="-1"></a>        <span class="op">+</span> p9.theme(</span>
<span id="cb81-16"><a aria-hidden="true" href="#cb81-16" tabindex="-1"></a>            axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb81-17"><a aria-hidden="true" href="#cb81-17" tabindex="-1"></a>            figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb81-18"><a aria-hidden="true" href="#cb81-18" tabindex="-1"></a>            dpi<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb81-19"><a aria-hidden="true" href="#cb81-19" tabindex="-1"></a>            title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb81-20"><a aria-hidden="true" href="#cb81-20" tabindex="-1"></a>            )</span>
<span id="cb81-21"><a aria-hidden="true" href="#cb81-21" tabindex="-1"></a>      )</span>
<span id="cb81-22"><a aria-hidden="true" href="#cb81-22" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2000" src="microbial_diversity_analysis_files/figure-html/cell-79-output-1.png" width="2000"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="126" id="cell-115">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a aria-hidden="true" href="#cb82-1" tabindex="-1"></a>(bc_df</span>
<span id="cb82-2"><a aria-hidden="true" href="#cb82-2" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd[<span class="st">'timedelta'</span>] <span class="op">&gt;=</span> pd.Timedelta(<span class="dv">0</span>)]</span>
<span id="cb82-3"><a aria-hidden="true" href="#cb82-3" tabindex="-1"></a> .query(<span class="st">'sample_id &lt; sample_id2'</span>)</span>
<span id="cb82-4"><a aria-hidden="true" href="#cb82-4" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'sample_id'</span>] <span class="op">+</span> <span class="vs">r'$\rightarrow$'</span> <span class="op">+</span> dd[<span class="st">'sample_id2'</span>])</span>
<span id="cb82-5"><a aria-hidden="true" href="#cb82-5" tabindex="-1"></a> .sort_values(<span class="st">'distance'</span>)</span>
<span id="cb82-6"><a aria-hidden="true" href="#cb82-6" tabindex="-1"></a>  .iloc[[<span class="op">-</span>i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">21</span>)] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">reversed</span>(<span class="bu">range</span>(<span class="dv">22</span>))]]</span>
<span id="cb82-7"><a aria-hidden="true" href="#cb82-7" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.label, categories<span class="op">=</span>dd.label, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb82-8"><a aria-hidden="true" href="#cb82-8" tabindex="-1"></a>  .assign(time_dist<span class="op">=</span><span class="kw">lambda</span> dd: dd.timedelta.<span class="bu">abs</span>().astype(<span class="bu">str</span>).<span class="bu">str</span>.split(<span class="st">' '</span>).<span class="bu">str</span>[:<span class="dv">2</span>].<span class="bu">str</span>.join(<span class="st">' '</span>))</span>
<span id="cb82-9"><a aria-hidden="true" href="#cb82-9" tabindex="-1"></a>   .assign(group<span class="op">=</span><span class="kw">lambda</span> dd: dd.distance.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'(1) Most similar'</span> <span class="cf">if</span> x <span class="op">&lt;</span> <span class="fl">.3</span></span>
<span id="cb82-10"><a aria-hidden="true" href="#cb82-10" tabindex="-1"></a>                                         <span class="cf">else</span> <span class="st">'(2) Least Similar'</span>))</span>
<span id="cb82-11"><a aria-hidden="true" href="#cb82-11" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb82-12"><a aria-hidden="true" href="#cb82-12" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'label'</span>, <span class="st">'distance'</span>, fill<span class="op">=</span><span class="st">'combi'</span>)</span>
<span id="cb82-13"><a aria-hidden="true" href="#cb82-13" tabindex="-1"></a>       <span class="op">+</span> p9.coord_flip()</span>
<span id="cb82-14"><a aria-hidden="true" href="#cb82-14" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col()</span>
<span id="cb82-15"><a aria-hidden="true" href="#cb82-15" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_continuous(labels<span class="op">=</span>percent_format(), limits<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), breaks<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb82-16"><a aria-hidden="true" href="#cb82-16" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'group'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb82-17"><a aria-hidden="true" href="#cb82-17" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>, <span class="st">'#ab2422'</span>, <span class="st">'#32a86d'</span>])</span>
<span id="cb82-18"><a aria-hidden="true" href="#cb82-18" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'time_dist'</span>, y<span class="op">=</span><span class="st">'distance + .01'</span>), size<span class="op">=</span><span class="dv">7</span>, ha<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb82-19"><a aria-hidden="true" href="#cb82-19" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Bray Curtis dissimilarity'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb82-20"><a aria-hidden="true" href="#cb82-20" tabindex="-1"></a>       <span class="op">+</span> p9.ggtitle(<span class="st">'ITS + 16S'</span>)</span>
<span id="cb82-21"><a aria-hidden="true" href="#cb82-21" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb82-22"><a aria-hidden="true" href="#cb82-22" tabindex="-1"></a>                  axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb82-23"><a aria-hidden="true" href="#cb82-23" tabindex="-1"></a>                  axis_title_x<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb82-24"><a aria-hidden="true" href="#cb82-24" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb82-25"><a aria-hidden="true" href="#cb82-25" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb82-26"><a aria-hidden="true" href="#cb82-26" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">11</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb82-27"><a aria-hidden="true" href="#cb82-27" tabindex="-1"></a>       )</span>
<span id="cb82-28"><a aria-hidden="true" href="#cb82-28" tabindex="-1"></a>)</span>
<span id="cb82-29"><a aria-hidden="true" href="#cb82-29" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1500" src="microbial_diversity_analysis_files/figure-html/cell-80-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-116">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a aria-hidden="true" href="#cb83-1" tabindex="-1"></a><span class="bu">range</span>(<span class="dv">21</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1279">
<pre><code>range(0, 21)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="127" id="cell-117">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a aria-hidden="true" href="#cb85-1" tabindex="-1"></a>(bc_df_16s</span>
<span id="cb85-2"><a aria-hidden="true" href="#cb85-2" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd[<span class="st">'timedelta'</span>] <span class="op">&gt;=</span> pd.Timedelta(<span class="dv">0</span>)]</span>
<span id="cb85-3"><a aria-hidden="true" href="#cb85-3" tabindex="-1"></a> .query(<span class="st">'sample_id &lt; sample_id2'</span>)</span>
<span id="cb85-4"><a aria-hidden="true" href="#cb85-4" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'sample_id'</span>] <span class="op">+</span> <span class="vs">r'$\rightarrow$'</span> <span class="op">+</span> dd[<span class="st">'sample_id2'</span>])</span>
<span id="cb85-5"><a aria-hidden="true" href="#cb85-5" tabindex="-1"></a> .sort_values(<span class="st">'distance'</span>)</span>
<span id="cb85-6"><a aria-hidden="true" href="#cb85-6" tabindex="-1"></a>  .iloc[[<span class="op">-</span>i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">21</span>)] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">reversed</span>(<span class="bu">range</span>(<span class="dv">21</span>))]]</span>
<span id="cb85-7"><a aria-hidden="true" href="#cb85-7" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.label, categories<span class="op">=</span>dd.label, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb85-8"><a aria-hidden="true" href="#cb85-8" tabindex="-1"></a>  .assign(time_dist<span class="op">=</span><span class="kw">lambda</span> dd: dd.timedelta.<span class="bu">abs</span>().astype(<span class="bu">str</span>).<span class="bu">str</span>.split(<span class="st">' '</span>).<span class="bu">str</span>[:<span class="dv">2</span>].<span class="bu">str</span>.join(<span class="st">' '</span>))</span>
<span id="cb85-9"><a aria-hidden="true" href="#cb85-9" tabindex="-1"></a>   .assign(group<span class="op">=</span><span class="kw">lambda</span> dd: dd.distance.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'(1) Most similar'</span> <span class="cf">if</span> x <span class="op">&lt;</span> <span class="fl">.29</span></span>
<span id="cb85-10"><a aria-hidden="true" href="#cb85-10" tabindex="-1"></a>                                         <span class="cf">else</span> <span class="st">'(2) Least Similar'</span>))</span>
<span id="cb85-11"><a aria-hidden="true" href="#cb85-11" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb85-12"><a aria-hidden="true" href="#cb85-12" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'label'</span>, <span class="st">'distance'</span>, fill<span class="op">=</span><span class="st">'combi'</span>)</span>
<span id="cb85-13"><a aria-hidden="true" href="#cb85-13" tabindex="-1"></a>       <span class="op">+</span> p9.coord_flip()</span>
<span id="cb85-14"><a aria-hidden="true" href="#cb85-14" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col()</span>
<span id="cb85-15"><a aria-hidden="true" href="#cb85-15" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_continuous(labels<span class="op">=</span>percent_format(), limits<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), breaks<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb85-16"><a aria-hidden="true" href="#cb85-16" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'group'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb85-17"><a aria-hidden="true" href="#cb85-17" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>, <span class="st">'#ab2422'</span>, <span class="st">'#32a86d'</span>])</span>
<span id="cb85-18"><a aria-hidden="true" href="#cb85-18" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'time_dist'</span>, y<span class="op">=</span><span class="st">'distance + .01'</span>), size<span class="op">=</span><span class="dv">7</span>, ha<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb85-19"><a aria-hidden="true" href="#cb85-19" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Bray Curtis dissimilarity'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb85-20"><a aria-hidden="true" href="#cb85-20" tabindex="-1"></a>       <span class="op">+</span> p9.ggtitle(<span class="st">'16S-only'</span>)</span>
<span id="cb85-21"><a aria-hidden="true" href="#cb85-21" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb85-22"><a aria-hidden="true" href="#cb85-22" tabindex="-1"></a>                  axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb85-23"><a aria-hidden="true" href="#cb85-23" tabindex="-1"></a>                  axis_title_x<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb85-24"><a aria-hidden="true" href="#cb85-24" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb85-25"><a aria-hidden="true" href="#cb85-25" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb85-26"><a aria-hidden="true" href="#cb85-26" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">11</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb85-27"><a aria-hidden="true" href="#cb85-27" tabindex="-1"></a>       )</span>
<span id="cb85-28"><a aria-hidden="true" href="#cb85-28" tabindex="-1"></a>)</span>
<span id="cb85-29"><a aria-hidden="true" href="#cb85-29" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1500" src="microbial_diversity_analysis_files/figure-html/cell-82-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="128" id="cell-118">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a aria-hidden="true" href="#cb86-1" tabindex="-1"></a>(bc_df_its</span>
<span id="cb86-2"><a aria-hidden="true" href="#cb86-2" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd[<span class="st">'timedelta'</span>] <span class="op">&gt;=</span> pd.Timedelta(<span class="dv">0</span>)]</span>
<span id="cb86-3"><a aria-hidden="true" href="#cb86-3" tabindex="-1"></a> .query(<span class="st">'sample_id &lt; sample_id2'</span>)</span>
<span id="cb86-4"><a aria-hidden="true" href="#cb86-4" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'sample_id'</span>] <span class="op">+</span> <span class="vs">r'$\rightarrow$'</span> <span class="op">+</span> dd[<span class="st">'sample_id2'</span>])</span>
<span id="cb86-5"><a aria-hidden="true" href="#cb86-5" tabindex="-1"></a> .sort_values(<span class="st">'distance'</span>)</span>
<span id="cb86-6"><a aria-hidden="true" href="#cb86-6" tabindex="-1"></a>  .iloc[[<span class="op">-</span>i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">21</span>)] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">reversed</span>(<span class="bu">range</span>(<span class="dv">20</span>))]]</span>
<span id="cb86-7"><a aria-hidden="true" href="#cb86-7" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.label, categories<span class="op">=</span>dd.label, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb86-8"><a aria-hidden="true" href="#cb86-8" tabindex="-1"></a>  .assign(time_dist<span class="op">=</span><span class="kw">lambda</span> dd: dd.timedelta.<span class="bu">abs</span>().astype(<span class="bu">str</span>).<span class="bu">str</span>.split(<span class="st">' '</span>).<span class="bu">str</span>[:<span class="dv">2</span>].<span class="bu">str</span>.join(<span class="st">' '</span>))</span>
<span id="cb86-9"><a aria-hidden="true" href="#cb86-9" tabindex="-1"></a>   .assign(group<span class="op">=</span><span class="kw">lambda</span> dd: dd.distance.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'(1) Most similar'</span> <span class="cf">if</span> x <span class="op">&lt;</span> <span class="fl">.3</span></span>
<span id="cb86-10"><a aria-hidden="true" href="#cb86-10" tabindex="-1"></a>                                         <span class="cf">else</span> <span class="st">'(2) Least Similar'</span>))</span>
<span id="cb86-11"><a aria-hidden="true" href="#cb86-11" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb86-12"><a aria-hidden="true" href="#cb86-12" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'label'</span>, <span class="st">'distance'</span>, fill<span class="op">=</span><span class="st">'combi'</span>)</span>
<span id="cb86-13"><a aria-hidden="true" href="#cb86-13" tabindex="-1"></a>       <span class="op">+</span> p9.coord_flip()</span>
<span id="cb86-14"><a aria-hidden="true" href="#cb86-14" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col()</span>
<span id="cb86-15"><a aria-hidden="true" href="#cb86-15" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_continuous(labels<span class="op">=</span>percent_format(), limits<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">1.1</span>), breaks<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb86-16"><a aria-hidden="true" href="#cb86-16" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'group'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb86-17"><a aria-hidden="true" href="#cb86-17" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>, <span class="st">'#ab2422'</span>, <span class="st">'#32a86d'</span>])</span>
<span id="cb86-18"><a aria-hidden="true" href="#cb86-18" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'time_dist'</span>, y<span class="op">=</span><span class="st">'distance + .01'</span>), size<span class="op">=</span><span class="dv">7</span>, ha<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb86-19"><a aria-hidden="true" href="#cb86-19" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Bray Curtis dissimilarity'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb86-20"><a aria-hidden="true" href="#cb86-20" tabindex="-1"></a>       <span class="op">+</span> p9.ggtitle(<span class="st">'ITS-only'</span>)</span>
<span id="cb86-21"><a aria-hidden="true" href="#cb86-21" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb86-22"><a aria-hidden="true" href="#cb86-22" tabindex="-1"></a>                  axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb86-23"><a aria-hidden="true" href="#cb86-23" tabindex="-1"></a>                  axis_title_x<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb86-24"><a aria-hidden="true" href="#cb86-24" tabindex="-1"></a>                  legend_key_size<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb86-25"><a aria-hidden="true" href="#cb86-25" tabindex="-1"></a>                  legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb86-26"><a aria-hidden="true" href="#cb86-26" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">11</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb86-27"><a aria-hidden="true" href="#cb86-27" tabindex="-1"></a>       )</span>
<span id="cb86-28"><a aria-hidden="true" href="#cb86-28" tabindex="-1"></a>)</span>
<span id="cb86-29"><a aria-hidden="true" href="#cb86-29" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1500" src="microbial_diversity_analysis_files/figure-html/cell-83-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="level3" id="correlation-with-heavy-metals">
<h3 class="anchored" data-anchor-id="correlation-with-heavy-metals">Correlation with heavy metals</h3>
<div class="cell" data-execution_count="129" id="cell-120">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a aria-hidden="true" href="#cb87-1" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb87-2"><a aria-hidden="true" href="#cb87-2" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> spearmanr</span>
<span id="cb87-3"><a aria-hidden="true" href="#cb87-3" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.multitest <span class="im">import</span> fdrcorrection</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="131" id="cell-121">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a aria-hidden="true" href="#cb88-1" tabindex="-1"></a>metals_matrix <span class="op">=</span> pd.read_csv(<span class="st">'../data/chemistry/metals.csv'</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb88-2"><a aria-hidden="true" href="#cb88-2" tabindex="-1"></a>metals_matrix.columns <span class="op">=</span> metals_matrix.columns.<span class="bu">str</span>.replace(<span class="st">'S0'</span>, <span class="st">'S'</span>, regex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb88-3"><a aria-hidden="true" href="#cb88-3" tabindex="-1"></a>metals_matrix <span class="op">=</span> metals_matrix.reset_index().replace(<span class="st">'Al2O3'</span>, <span class="st">'Al'</span>).set_index(<span class="st">'species'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="133" id="cell-122">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a aria-hidden="true" href="#cb89-1" tabindex="-1"></a>n_samples_per_metal <span class="op">=</span> (metals_matrix</span>
<span id="cb89-2"><a aria-hidden="true" href="#cb89-2" tabindex="-1"></a>                        .applymap(<span class="kw">lambda</span> x: x <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb89-3"><a aria-hidden="true" href="#cb89-3" tabindex="-1"></a>                        .<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb89-4"><a aria-hidden="true" href="#cb89-4" tabindex="-1"></a>                        .rename(<span class="st">'n_samples'</span>)</span>
<span id="cb89-5"><a aria-hidden="true" href="#cb89-5" tabindex="-1"></a>                        .reset_index()</span>
<span id="cb89-6"><a aria-hidden="true" href="#cb89-6" tabindex="-1"></a>                        .assign(keep<span class="op">=</span><span class="kw">lambda</span> dd: dd.n_samples <span class="op">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb89-7"><a aria-hidden="true" href="#cb89-7" tabindex="-1"></a>)</span>
<span id="cb89-8"><a aria-hidden="true" href="#cb89-8" tabindex="-1"></a></span>
<span id="cb89-9"><a aria-hidden="true" href="#cb89-9" tabindex="-1"></a>(n_samples_per_metal.pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb89-10"><a aria-hidden="true" href="#cb89-10" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'reorder(species, n_samples)'</span>, <span class="st">'n_samples'</span>) </span>
<span id="cb89-11"><a aria-hidden="true" href="#cb89-11" tabindex="-1"></a>                <span class="op">+</span> p9.geom_col(p9.aes(alpha<span class="op">=</span><span class="st">'keep'</span>))</span>
<span id="cb89-12"><a aria-hidden="true" href="#cb89-12" tabindex="-1"></a>                <span class="op">+</span> p9.scale_alpha_manual(values<span class="op">=</span>[<span class="fl">.5</span>, <span class="dv">1</span>])</span>
<span id="cb89-13"><a aria-hidden="true" href="#cb89-13" tabindex="-1"></a>                <span class="op">+</span> p9.scale_y_continuous(expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">.01</span>, <span class="dv">0</span>))</span>
<span id="cb89-14"><a aria-hidden="true" href="#cb89-14" tabindex="-1"></a>                <span class="op">+</span> p9.coord_flip()</span>
<span id="cb89-15"><a aria-hidden="true" href="#cb89-15" tabindex="-1"></a>                <span class="op">+</span> p9.guides(alpha<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-16"><a aria-hidden="true" href="#cb89-16" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Number of Samples over detection limit'</span>)</span>
<span id="cb89-17"><a aria-hidden="true" href="#cb89-17" tabindex="-1"></a>                <span class="op">+</span> p9.theme(</span>
<span id="cb89-18"><a aria-hidden="true" href="#cb89-18" tabindex="-1"></a>                    figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">6</span>),</span>
<span id="cb89-19"><a aria-hidden="true" href="#cb89-19" tabindex="-1"></a>                    axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb89-20"><a aria-hidden="true" href="#cb89-20" tabindex="-1"></a>                )</span>
<span id="cb89-21"><a aria-hidden="true" href="#cb89-21" tabindex="-1"></a>)</span>
<span id="cb89-22"><a aria-hidden="true" href="#cb89-22" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1800" src="microbial_diversity_analysis_files/figure-html/cell-86-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="134" id="cell-123">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a aria-hidden="true" href="#cb90-1" tabindex="-1"></a>get_pvals <span class="op">=</span> partial(<span class="kw">lambda</span> x, y: spearmanr(x, y).pvalue)</span>
<span id="cb90-2"><a aria-hidden="true" href="#cb90-2" tabindex="-1"></a>get_spearmanr <span class="op">=</span> partial(<span class="kw">lambda</span> x, y: spearmanr(x, y).correlation)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="135" id="cell-124">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a aria-hidden="true" href="#cb91-1" tabindex="-1"></a>micro_matrix <span class="op">=</span> (abundance_df_genera</span>
<span id="cb91-2"><a aria-hidden="true" href="#cb91-2" tabindex="-1"></a> .drop(columns<span class="op">=</span><span class="st">'S06'</span>)</span>
<span id="cb91-3"><a aria-hidden="true" href="#cb91-3" tabindex="-1"></a> .query(<span class="st">'Genus != "unknown"'</span>)</span>
<span id="cb91-4"><a aria-hidden="true" href="#cb91-4" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb91-5"><a aria-hidden="true" href="#cb91-5" tabindex="-1"></a> .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb91-6"><a aria-hidden="true" href="#cb91-6" tabindex="-1"></a> .T</span>
<span id="cb91-7"><a aria-hidden="true" href="#cb91-7" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="136" id="cell-125">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a aria-hidden="true" href="#cb92-1" tabindex="-1"></a>flight_samples <span class="op">=</span> [s <span class="cf">for</span> s, i <span class="kw">in</span> sample_map.items() <span class="cf">if</span> i <span class="op">==</span> <span class="st">"Flight"</span>]</span>
<span id="cb92-2"><a aria-hidden="true" href="#cb92-2" tabindex="-1"></a>ground_samples <span class="op">=</span> [s <span class="cf">for</span> s, i <span class="kw">in</span> sample_map.items() <span class="cf">if</span> i <span class="op">==</span> <span class="st">"Ground"</span>]</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="137" id="cell-126">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a aria-hidden="true" href="#cb93-1" tabindex="-1"></a>corrs_matrix <span class="op">=</span> (metals_matrix</span>
<span id="cb93-2"><a aria-hidden="true" href="#cb93-2" tabindex="-1"></a>                .reset_index()</span>
<span id="cb93-3"><a aria-hidden="true" href="#cb93-3" tabindex="-1"></a>                .drop(columns<span class="op">=</span><span class="st">'S14'</span>)</span>
<span id="cb93-4"><a aria-hidden="true" href="#cb93-4" tabindex="-1"></a>                .loc[<span class="kw">lambda</span> dd: dd.species.isin(n_samples_per_metal.query(<span class="st">'keep'</span>).species)]</span>
<span id="cb93-5"><a aria-hidden="true" href="#cb93-5" tabindex="-1"></a>                .set_index(<span class="st">'species'</span>)</span>
<span id="cb93-6"><a aria-hidden="true" href="#cb93-6" tabindex="-1"></a>                .T</span>
<span id="cb93-7"><a aria-hidden="true" href="#cb93-7" tabindex="-1"></a>                .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: micro_matrix.corrwith(dd, axis<span class="op">=</span><span class="dv">0</span>, method<span class="op">=</span>get_spearmanr))</span>
<span id="cb93-8"><a aria-hidden="true" href="#cb93-8" tabindex="-1"></a>                .reset_index()</span>
<span id="cb93-9"><a aria-hidden="true" href="#cb93-9" tabindex="-1"></a>)</span>
<span id="cb93-10"><a aria-hidden="true" href="#cb93-10" tabindex="-1"></a></span>
<span id="cb93-11"><a aria-hidden="true" href="#cb93-11" tabindex="-1"></a>p_values_matrix <span class="op">=</span> (metals_matrix</span>
<span id="cb93-12"><a aria-hidden="true" href="#cb93-12" tabindex="-1"></a>                .reset_index()</span>
<span id="cb93-13"><a aria-hidden="true" href="#cb93-13" tabindex="-1"></a>                .drop(columns<span class="op">=</span><span class="st">'S14'</span>)</span>
<span id="cb93-14"><a aria-hidden="true" href="#cb93-14" tabindex="-1"></a>                .loc[<span class="kw">lambda</span> dd: dd.species.isin(n_samples_per_metal.query(<span class="st">'keep'</span>).species)]</span>
<span id="cb93-15"><a aria-hidden="true" href="#cb93-15" tabindex="-1"></a>                .set_index(<span class="st">'species'</span>)</span>
<span id="cb93-16"><a aria-hidden="true" href="#cb93-16" tabindex="-1"></a>                .T</span>
<span id="cb93-17"><a aria-hidden="true" href="#cb93-17" tabindex="-1"></a>                .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: micro_matrix.corrwith(dd, axis<span class="op">=</span><span class="dv">0</span>, method<span class="op">=</span>get_pvals))</span>
<span id="cb93-18"><a aria-hidden="true" href="#cb93-18" tabindex="-1"></a>                .reset_index()</span>
<span id="cb93-19"><a aria-hidden="true" href="#cb93-19" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62" id="cell-127">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a aria-hidden="true" href="#cb94-1" tabindex="-1"></a>flight_present_genera <span class="op">=</span> micro_matrix.loc[flight_samples].<span class="bu">map</span>(<span class="kw">lambda</span> x: x <span class="op">&gt;</span> <span class="dv">0</span>).T.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>).loc[<span class="kw">lambda</span> x: x <span class="op">&gt;=</span> <span class="dv">2</span>].index</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="63" id="cell-128">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a aria-hidden="true" href="#cb95-1" tabindex="-1"></a>corrs_matrix_flight <span class="op">=</span> (metals_matrix</span>
<span id="cb95-2"><a aria-hidden="true" href="#cb95-2" tabindex="-1"></a>                [flight_samples]</span>
<span id="cb95-3"><a aria-hidden="true" href="#cb95-3" tabindex="-1"></a>                .reset_index()</span>
<span id="cb95-4"><a aria-hidden="true" href="#cb95-4" tabindex="-1"></a>                .loc[<span class="kw">lambda</span> dd: dd.species.isin(n_samples_per_metal.query(<span class="st">'keep'</span>).species)]</span>
<span id="cb95-5"><a aria-hidden="true" href="#cb95-5" tabindex="-1"></a>                .set_index(<span class="st">'species'</span>)</span>
<span id="cb95-6"><a aria-hidden="true" href="#cb95-6" tabindex="-1"></a>                .T</span>
<span id="cb95-7"><a aria-hidden="true" href="#cb95-7" tabindex="-1"></a>                .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: micro_matrix[flight_present_genera].loc[flight_samples].corrwith(dd, axis<span class="op">=</span><span class="dv">0</span>, method<span class="op">=</span>get_spearmanr))</span>
<span id="cb95-8"><a aria-hidden="true" href="#cb95-8" tabindex="-1"></a>                .reset_index()</span>
<span id="cb95-9"><a aria-hidden="true" href="#cb95-9" tabindex="-1"></a>)</span>
<span id="cb95-10"><a aria-hidden="true" href="#cb95-10" tabindex="-1"></a></span>
<span id="cb95-11"><a aria-hidden="true" href="#cb95-11" tabindex="-1"></a>p_values_matrix_flight <span class="op">=</span> (metals_matrix</span>
<span id="cb95-12"><a aria-hidden="true" href="#cb95-12" tabindex="-1"></a>                [flight_samples]</span>
<span id="cb95-13"><a aria-hidden="true" href="#cb95-13" tabindex="-1"></a>                .reset_index()</span>
<span id="cb95-14"><a aria-hidden="true" href="#cb95-14" tabindex="-1"></a>                .loc[<span class="kw">lambda</span> dd: dd.species.isin(n_samples_per_metal.query(<span class="st">'keep'</span>).species)]</span>
<span id="cb95-15"><a aria-hidden="true" href="#cb95-15" tabindex="-1"></a>                .set_index(<span class="st">'species'</span>)</span>
<span id="cb95-16"><a aria-hidden="true" href="#cb95-16" tabindex="-1"></a>                .T</span>
<span id="cb95-17"><a aria-hidden="true" href="#cb95-17" tabindex="-1"></a>                .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: micro_matrix[flight_present_genera].loc[flight_samples].corrwith(dd, axis<span class="op">=</span><span class="dv">0</span>, method<span class="op">=</span>get_pvals))</span>
<span id="cb95-18"><a aria-hidden="true" href="#cb95-18" tabindex="-1"></a>                .reset_index()</span>
<span id="cb95-19"><a aria-hidden="true" href="#cb95-19" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64" id="cell-129">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a aria-hidden="true" href="#cb96-1" tabindex="-1"></a>ground_samples.pop(ground_samples.index(<span class="st">'S06'</span>))</span>
<span id="cb96-2"><a aria-hidden="true" href="#cb96-2" tabindex="-1"></a>ground_samples.pop(ground_samples.index(<span class="st">'S14'</span>))</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>'S14'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="65" id="cell-130">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a aria-hidden="true" href="#cb98-1" tabindex="-1"></a>corrs_matrix_ground <span class="op">=</span> (metals_matrix</span>
<span id="cb98-2"><a aria-hidden="true" href="#cb98-2" tabindex="-1"></a>                [ground_samples]</span>
<span id="cb98-3"><a aria-hidden="true" href="#cb98-3" tabindex="-1"></a>                .reset_index()</span>
<span id="cb98-4"><a aria-hidden="true" href="#cb98-4" tabindex="-1"></a>                .loc[<span class="kw">lambda</span> dd: dd.species.isin(n_samples_per_metal.query(<span class="st">'keep'</span>).species)]</span>
<span id="cb98-5"><a aria-hidden="true" href="#cb98-5" tabindex="-1"></a>                .set_index(<span class="st">'species'</span>)</span>
<span id="cb98-6"><a aria-hidden="true" href="#cb98-6" tabindex="-1"></a>                .T</span>
<span id="cb98-7"><a aria-hidden="true" href="#cb98-7" tabindex="-1"></a>                .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: micro_matrix.loc[ground_samples].corrwith(dd, axis<span class="op">=</span><span class="dv">0</span>, method<span class="op">=</span>get_spearmanr))</span>
<span id="cb98-8"><a aria-hidden="true" href="#cb98-8" tabindex="-1"></a>                .reset_index()</span>
<span id="cb98-9"><a aria-hidden="true" href="#cb98-9" tabindex="-1"></a>)</span>
<span id="cb98-10"><a aria-hidden="true" href="#cb98-10" tabindex="-1"></a></span>
<span id="cb98-11"><a aria-hidden="true" href="#cb98-11" tabindex="-1"></a>p_values_matrix_ground <span class="op">=</span> (metals_matrix</span>
<span id="cb98-12"><a aria-hidden="true" href="#cb98-12" tabindex="-1"></a>                [ground_samples]</span>
<span id="cb98-13"><a aria-hidden="true" href="#cb98-13" tabindex="-1"></a>                .reset_index()</span>
<span id="cb98-14"><a aria-hidden="true" href="#cb98-14" tabindex="-1"></a>                .loc[<span class="kw">lambda</span> dd: dd.species.isin(n_samples_per_metal.query(<span class="st">'keep'</span>).species)]</span>
<span id="cb98-15"><a aria-hidden="true" href="#cb98-15" tabindex="-1"></a>                .set_index(<span class="st">'species'</span>)</span>
<span id="cb98-16"><a aria-hidden="true" href="#cb98-16" tabindex="-1"></a>                .T</span>
<span id="cb98-17"><a aria-hidden="true" href="#cb98-17" tabindex="-1"></a>                .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: micro_matrix.loc[ground_samples].corrwith(dd, axis<span class="op">=</span><span class="dv">0</span>, method<span class="op">=</span>get_pvals))</span>
<span id="cb98-18"><a aria-hidden="true" href="#cb98-18" tabindex="-1"></a>                .reset_index()</span>
<span id="cb98-19"><a aria-hidden="true" href="#cb98-19" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="66" id="cell-131">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a aria-hidden="true" href="#cb99-1" tabindex="-1"></a>corrs_list <span class="op">=</span> (corrs_matrix</span>
<span id="cb99-2"><a aria-hidden="true" href="#cb99-2" tabindex="-1"></a>              .dropna()</span>
<span id="cb99-3"><a aria-hidden="true" href="#cb99-3" tabindex="-1"></a>                .melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb99-4"><a aria-hidden="true" href="#cb99-4" tabindex="-1"></a>                .merge(p_values_matrix.melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_p_value'</span>))</span>
<span id="cb99-5"><a aria-hidden="true" href="#cb99-5" tabindex="-1"></a>                .merge(corrs_matrix.melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_r'</span>))</span>
<span id="cb99-6"><a aria-hidden="true" href="#cb99-6" tabindex="-1"></a>                .assign(spearman_fdr<span class="op">=</span><span class="kw">lambda</span> dd: fdrcorrection(dd.spearman_p_value)[<span class="dv">1</span>])</span>
<span id="cb99-7"><a aria-hidden="true" href="#cb99-7" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67" id="cell-132">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a aria-hidden="true" href="#cb100-1" tabindex="-1"></a>corrs_list_flights <span class="op">=</span> (corrs_matrix_flight</span>
<span id="cb100-2"><a aria-hidden="true" href="#cb100-2" tabindex="-1"></a>              .dropna()</span>
<span id="cb100-3"><a aria-hidden="true" href="#cb100-3" tabindex="-1"></a>              .melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb100-4"><a aria-hidden="true" href="#cb100-4" tabindex="-1"></a>              .merge(p_values_matrix_flight.melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_p_value'</span>))</span>
<span id="cb100-5"><a aria-hidden="true" href="#cb100-5" tabindex="-1"></a>              .merge(corrs_matrix_flight.melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_r'</span>))</span>
<span id="cb100-6"><a aria-hidden="true" href="#cb100-6" tabindex="-1"></a>              .assign(spearman_fdr<span class="op">=</span><span class="kw">lambda</span> dd: fdrcorrection(dd.spearman_p_value)[<span class="dv">1</span>])</span>
<span id="cb100-7"><a aria-hidden="true" href="#cb100-7" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68" id="cell-133">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a aria-hidden="true" href="#cb101-1" tabindex="-1"></a>corrs_list_ground <span class="op">=</span> (corrs_matrix_ground</span>
<span id="cb101-2"><a aria-hidden="true" href="#cb101-2" tabindex="-1"></a>                .dropna()</span>
<span id="cb101-3"><a aria-hidden="true" href="#cb101-3" tabindex="-1"></a>                .melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb101-4"><a aria-hidden="true" href="#cb101-4" tabindex="-1"></a>                .merge(p_values_matrix_ground.melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_p_value'</span>))</span>
<span id="cb101-5"><a aria-hidden="true" href="#cb101-5" tabindex="-1"></a>                .merge(corrs_matrix_ground.melt(<span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'spearman_r'</span>))</span>
<span id="cb101-6"><a aria-hidden="true" href="#cb101-6" tabindex="-1"></a>                .assign(spearman_fdr<span class="op">=</span><span class="kw">lambda</span> dd: fdrcorrection(dd.spearman_p_value)[<span class="dv">1</span>])</span>
<span id="cb101-7"><a aria-hidden="true" href="#cb101-7" tabindex="-1"></a>    )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="69" id="cell-134">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a aria-hidden="true" href="#cb102-1" tabindex="-1"></a>sig_genera <span class="op">=</span> (corrs_matrix</span>
<span id="cb102-2"><a aria-hidden="true" href="#cb102-2" tabindex="-1"></a>                      .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb102-3"><a aria-hidden="true" href="#cb102-3" tabindex="-1"></a>                      .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">max</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb102-4"><a aria-hidden="true" href="#cb102-4" tabindex="-1"></a>                      .loc[<span class="kw">lambda</span> x: x <span class="op">&gt;</span> <span class="fl">.544</span>]</span>
<span id="cb102-5"><a aria-hidden="true" href="#cb102-5" tabindex="-1"></a>                      .index.values</span>
<span id="cb102-6"><a aria-hidden="true" href="#cb102-6" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-135">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a aria-hidden="true" href="#cb103-1" tabindex="-1"></a>kingdom_genera <span class="op">=</span> abundance_df_genera[[<span class="st">'Kingdom'</span>, <span class="st">'Genus'</span>]].drop_duplicates()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="84" id="cell-136">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a aria-hidden="true" href="#cb104-1" tabindex="-1"></a>sig_genera_flights <span class="op">=</span> (corrs_matrix_flight</span>
<span id="cb104-2"><a aria-hidden="true" href="#cb104-2" tabindex="-1"></a> .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb104-3"><a aria-hidden="true" href="#cb104-3" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">max</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb104-4"><a aria-hidden="true" href="#cb104-4" tabindex="-1"></a> .reset_index()</span>
<span id="cb104-5"><a aria-hidden="true" href="#cb104-5" tabindex="-1"></a> .merge(kingdom_genera)</span>
<span id="cb104-6"><a aria-hidden="true" href="#cb104-6" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>])</span>
<span id="cb104-7"><a aria-hidden="true" href="#cb104-7" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.sort_values(<span class="dv">0</span>, ascending<span class="op">=</span><span class="va">False</span>).iloc[:<span class="dv">40</span>])</span>
<span id="cb104-8"><a aria-hidden="true" href="#cb104-8" tabindex="-1"></a> .Genus</span>
<span id="cb104-9"><a aria-hidden="true" href="#cb104-9" tabindex="-1"></a> .values</span>
<span id="cb104-10"><a aria-hidden="true" href="#cb104-10" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>array(['Staphylococcus', 'Dialister', 'Actinomyces', 'Rothia',
       'Campylobacter', 'Megasphaera', 'Eggerthella', 'Subdoligranulum',
       'Holdemanella', '[Ruminococcus] gnavus group', 'Barnesiella',
       'Ruminococcus', 'Pseudomonas', '[Ruminococcus] torques group',
       'Pygmaiobacter', 'UBA1819', 'Lachnospiraceae UCG-007', 'Megamonas',
       'Klebsiella', 'Dorea', 'Lachnospiraceae UCG-004', 'Akkermansia',
       'Bifidobacterium', 'Atopobium', 'Collinsella', 'Asteroleplasma',
       'Anaerostipes', 'Butyricicoccus', 'Parasutterella',
       'Flavonifractor', 'Lachnospira', 'Hungatella', 'Epulopiscium',
       'Christensenellaceae R-7 group', 'Bryocella', 'Faecalitalea',
       'Acinetobacter', 'UCG-005', 'Streptococcus', 'Lactobacillus',
       'Penicillium', 'Rhodotorula', 'Malassezia', 'Daedaleopsis',
       'Lentinula', 'Hypoxylon', 'Filobasidium', 'Stereum', 'Hannaella',
       'Dioszegia', 'Amyloxenasma', 'Catenulostroma', 'Trametes',
       'Vuilleminia', 'Stemphylium', 'Sarocladium', 'Vishniacozyma',
       'Phaeosclera', 'Symmetrospora', 'Coprinopsis', 'Kondoa',
       'Exophiala', 'Gymnopus', 'Lophiostoma', 'Coniosporium',
       'Verrucocladosporium', 'Paecilomyces', 'Chaetomium', 'Radulomyces',
       'Xylodon', 'Incrucipulum', 'Phlebia', 'Acremonium', 'Stanjemonium',
       'Knufia', 'Torula', 'Cladosporium', 'Phaeosphaeria',
       'Malasseziaceae_gen_Incertae_sedis', 'Petrophila'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="85" id="cell-137">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a aria-hidden="true" href="#cb106-1" tabindex="-1"></a>sig_genera_ground <span class="op">=</span> (corrs_matrix_ground</span>
<span id="cb106-2"><a aria-hidden="true" href="#cb106-2" tabindex="-1"></a>  .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb106-3"><a aria-hidden="true" href="#cb106-3" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">max</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb106-4"><a aria-hidden="true" href="#cb106-4" tabindex="-1"></a> .reset_index()</span>
<span id="cb106-5"><a aria-hidden="true" href="#cb106-5" tabindex="-1"></a> .merge(kingdom_genera)</span>
<span id="cb106-6"><a aria-hidden="true" href="#cb106-6" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>])</span>
<span id="cb106-7"><a aria-hidden="true" href="#cb106-7" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.sort_values(<span class="dv">0</span>, ascending<span class="op">=</span><span class="va">False</span>).iloc[:<span class="dv">40</span>])</span>
<span id="cb106-8"><a aria-hidden="true" href="#cb106-8" tabindex="-1"></a> .Genus</span>
<span id="cb106-9"><a aria-hidden="true" href="#cb106-9" tabindex="-1"></a> .values</span>
<span id="cb106-10"><a aria-hidden="true" href="#cb106-10" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55" id="cell-138">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a aria-hidden="true" href="#cb107-1" tabindex="-1"></a>(corrs_list</span>
<span id="cb107-2"><a aria-hidden="true" href="#cb107-2" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.Genus.isin(sig_genera)]</span>
<span id="cb107-3"><a aria-hidden="true" href="#cb107-3" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb107-4"><a aria-hidden="true" href="#cb107-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb107-5"><a aria-hidden="true" href="#cb107-5" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb107-6"><a aria-hidden="true" href="#cb107-6" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb107-7"><a aria-hidden="true" href="#cb107-7" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb107-8"><a aria-hidden="true" href="#cb107-8" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb107-9"><a aria-hidden="true" href="#cb107-9" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb107-10"><a aria-hidden="true" href="#cb107-10" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb107-11"><a aria-hidden="true" href="#cb107-11" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb107-12"><a aria-hidden="true" href="#cb107-12" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb107-13"><a aria-hidden="true" href="#cb107-13" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>),</span>
<span id="cb107-14"><a aria-hidden="true" href="#cb107-14" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb107-15"><a aria-hidden="true" href="#cb107-15" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb107-16"><a aria-hidden="true" href="#cb107-16" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb107-17"><a aria-hidden="true" href="#cb107-17" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb107-18"><a aria-hidden="true" href="#cb107-18" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb107-19"><a aria-hidden="true" href="#cb107-19" tabindex="-1"></a>                )</span>
<span id="cb107-20"><a aria-hidden="true" href="#cb107-20" tabindex="-1"></a>))</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1200" src="microbial_diversity_analysis_files/figure-html/cell-102-output-1.png" width="1500"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="143" id="cell-139">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a aria-hidden="true" href="#cb108-1" tabindex="-1"></a>(micro_matrix</span>
<span id="cb108-2"><a aria-hidden="true" href="#cb108-2" tabindex="-1"></a> .merge(metals_matrix.T, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb108-3"><a aria-hidden="true" href="#cb108-3" tabindex="-1"></a> .reset_index()</span>
<span id="cb108-4"><a aria-hidden="true" href="#cb108-4" tabindex="-1"></a> .melt(<span class="st">'index'</span>, var_name<span class="op">=</span><span class="st">'species'</span>, value_name<span class="op">=</span><span class="st">'abundance'</span>)</span>
<span id="cb108-5"><a aria-hidden="true" href="#cb108-5" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'index'</span>].<span class="bu">map</span>(sample_map))</span>
<span id="cb108-6"><a aria-hidden="true" href="#cb108-6" tabindex="-1"></a> .query(<span class="st">'species.isin(["Sphingomonas", "Zn"])'</span>)</span>
<span id="cb108-7"><a aria-hidden="true" href="#cb108-7" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) <span class="op">+</span> p9.aes(<span class="st">'index'</span>, <span class="st">'abundance'</span>)</span>
<span id="cb108-8"><a aria-hidden="true" href="#cb108-8" tabindex="-1"></a>       <span class="op">+</span> p9.facet_grid([<span class="st">'species'</span>, <span class="st">'sample_mode'</span>], scales<span class="op">=</span><span class="st">'free'</span>)</span>
<span id="cb108-9"><a aria-hidden="true" href="#cb108-9" tabindex="-1"></a>       <span class="op">+</span> p9.geom_line(group<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb108-10"><a aria-hidden="true" href="#cb108-10" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb108-11"><a aria-hidden="true" href="#cb108-11" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">5.5</span>, <span class="dv">3</span>),</span>
<span id="cb108-12"><a aria-hidden="true" href="#cb108-12" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">45</span>, size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb108-13"><a aria-hidden="true" href="#cb108-13" tabindex="-1"></a>                  )</span>
<span id="cb108-14"><a aria-hidden="true" href="#cb108-14" tabindex="-1"></a>       )</span>
<span id="cb108-15"><a aria-hidden="true" href="#cb108-15" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="900" src="microbial_diversity_analysis_files/figure-html/cell-103-output-1.png" width="1650"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="89" id="cell-140">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a aria-hidden="true" href="#cb109-1" tabindex="-1"></a>f <span class="op">=</span> (corrs_list</span>
<span id="cb109-2"><a aria-hidden="true" href="#cb109-2" tabindex="-1"></a>.query(<span class="st">'Genus in @selected_bacterial_genera'</span>) </span>
<span id="cb109-3"><a aria-hidden="true" href="#cb109-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb109-4"><a aria-hidden="true" href="#cb109-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb109-5"><a aria-hidden="true" href="#cb109-5" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb109-6"><a aria-hidden="true" href="#cb109-6" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb109-7"><a aria-hidden="true" href="#cb109-7" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb109-8"><a aria-hidden="true" href="#cb109-8" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb109-9"><a aria-hidden="true" href="#cb109-9" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb109-10"><a aria-hidden="true" href="#cb109-10" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb109-11"><a aria-hidden="true" href="#cb109-11" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb109-12"><a aria-hidden="true" href="#cb109-12" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb109-13"><a aria-hidden="true" href="#cb109-13" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">4.5</span>, <span class="dv">4</span>),</span>
<span id="cb109-14"><a aria-hidden="true" href="#cb109-14" tabindex="-1"></a>                           legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb109-15"><a aria-hidden="true" href="#cb109-15" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb109-16"><a aria-hidden="true" href="#cb109-16" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, y<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb109-17"><a aria-hidden="true" href="#cb109-17" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb109-18"><a aria-hidden="true" href="#cb109-18" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, face<span class="op">=</span><span class="st">'italic'</span>),</span>
<span id="cb109-19"><a aria-hidden="true" href="#cb109-19" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb109-20"><a aria-hidden="true" href="#cb109-20" tabindex="-1"></a>                )</span>
<span id="cb109-21"><a aria-hidden="true" href="#cb109-21" tabindex="-1"></a>))</span>
<span id="cb109-22"><a aria-hidden="true" href="#cb109-22" tabindex="-1"></a>f.save(<span class="st">'../output/figures/correlations_bacteria.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb109-23"><a aria-hidden="true" href="#cb109-23" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<div>
<figure class="figure">
<p><img class="figure-img" height="1233" src="microbial_diversity_analysis_files/figure-html/cell-104-output-1.png" width="1383"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="63" id="cell-141">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a aria-hidden="true" href="#cb110-1" tabindex="-1"></a>f <span class="op">=</span> (corrs_list_flights</span>
<span id="cb110-2"><a aria-hidden="true" href="#cb110-2" tabindex="-1"></a>.query(<span class="st">'Genus in @selected_bacterial_genera'</span>) </span>
<span id="cb110-3"><a aria-hidden="true" href="#cb110-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb110-4"><a aria-hidden="true" href="#cb110-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb110-5"><a aria-hidden="true" href="#cb110-5" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb110-6"><a aria-hidden="true" href="#cb110-6" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb110-7"><a aria-hidden="true" href="#cb110-7" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb110-8"><a aria-hidden="true" href="#cb110-8" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb110-9"><a aria-hidden="true" href="#cb110-9" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb110-10"><a aria-hidden="true" href="#cb110-10" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb110-11"><a aria-hidden="true" href="#cb110-11" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb110-12"><a aria-hidden="true" href="#cb110-12" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb110-13"><a aria-hidden="true" href="#cb110-13" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">4.5</span>, <span class="dv">4</span>),</span>
<span id="cb110-14"><a aria-hidden="true" href="#cb110-14" tabindex="-1"></a>                           legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb110-15"><a aria-hidden="true" href="#cb110-15" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb110-16"><a aria-hidden="true" href="#cb110-16" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, y<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb110-17"><a aria-hidden="true" href="#cb110-17" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb110-18"><a aria-hidden="true" href="#cb110-18" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb110-19"><a aria-hidden="true" href="#cb110-19" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb110-20"><a aria-hidden="true" href="#cb110-20" tabindex="-1"></a>                )</span>
<span id="cb110-21"><a aria-hidden="true" href="#cb110-21" tabindex="-1"></a>))</span>
<span id="cb110-22"><a aria-hidden="true" href="#cb110-22" tabindex="-1"></a>f.save(<span class="st">'../output/figures/corr_bac_flights.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb110-23"><a aria-hidden="true" href="#cb110-23" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>
<figure class="figure">
<p><img class="figure-img" height="1233" src="microbial_diversity_analysis_files/figure-html/cell-105-output-1.png" width="1383"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="64" id="cell-142">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a aria-hidden="true" href="#cb111-1" tabindex="-1"></a>f <span class="op">=</span> (corrs_list_ground</span>
<span id="cb111-2"><a aria-hidden="true" href="#cb111-2" tabindex="-1"></a> .query(<span class="st">'Genus in @selected_bacterial_genera'</span>) </span>
<span id="cb111-3"><a aria-hidden="true" href="#cb111-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb111-4"><a aria-hidden="true" href="#cb111-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb111-5"><a aria-hidden="true" href="#cb111-5" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb111-6"><a aria-hidden="true" href="#cb111-6" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb111-7"><a aria-hidden="true" href="#cb111-7" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb111-8"><a aria-hidden="true" href="#cb111-8" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb111-9"><a aria-hidden="true" href="#cb111-9" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb111-10"><a aria-hidden="true" href="#cb111-10" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb111-11"><a aria-hidden="true" href="#cb111-11" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb111-12"><a aria-hidden="true" href="#cb111-12" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb111-13"><a aria-hidden="true" href="#cb111-13" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">4.5</span>, <span class="dv">4</span>),</span>
<span id="cb111-14"><a aria-hidden="true" href="#cb111-14" tabindex="-1"></a>                           legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb111-15"><a aria-hidden="true" href="#cb111-15" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb111-16"><a aria-hidden="true" href="#cb111-16" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, y<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb111-17"><a aria-hidden="true" href="#cb111-17" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb111-18"><a aria-hidden="true" href="#cb111-18" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb111-19"><a aria-hidden="true" href="#cb111-19" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb111-20"><a aria-hidden="true" href="#cb111-20" tabindex="-1"></a>                )</span>
<span id="cb111-21"><a aria-hidden="true" href="#cb111-21" tabindex="-1"></a>))</span>
<span id="cb111-22"><a aria-hidden="true" href="#cb111-22" tabindex="-1"></a>f.save(<span class="st">'../output/figures/corr_bac_ground.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb111-23"><a aria-hidden="true" href="#cb111-23" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<div>
<figure class="figure">
<p><img class="figure-img" height="1233" src="microbial_diversity_analysis_files/figure-html/cell-106-output-1.png" width="1383"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="92" id="cell-143">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a aria-hidden="true" href="#cb112-1" tabindex="-1"></a>abundance_df_genera.query(<span class="st">'Phylum.str.startswith("Deino")'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<div>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Kingdom</th>
<th data-quarto-table-cell-role="th">Phylum</th>
<th data-quarto-table-cell-role="th">Class</th>
<th data-quarto-table-cell-role="th">Order</th>
<th data-quarto-table-cell-role="th">Family</th>
<th data-quarto-table-cell-role="th">Genus</th>
<th data-quarto-table-cell-role="th">S01</th>
<th data-quarto-table-cell-role="th">S02</th>
<th data-quarto-table-cell-role="th">S03</th>
<th data-quarto-table-cell-role="th">S04</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">S12</th>
<th data-quarto-table-cell-role="th">S13</th>
<th data-quarto-table-cell-role="th">S15</th>
<th data-quarto-table-cell-role="th">S16</th>
<th data-quarto-table-cell-role="th">S17</th>
<th data-quarto-table-cell-role="th">S18</th>
<th data-quarto-table-cell-role="th">S19</th>
<th data-quarto-table-cell-role="th">S20</th>
<th data-quarto-table-cell-role="th">S21</th>
<th data-quarto-table-cell-role="th">S22</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">129</td>
<td>Bacteria</td>
<td>Deinococcota</td>
<td>Deinococci</td>
<td>Deinococcales</td>
<td>Deinococcaceae</td>
<td>Deinococcus</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>19</td>
<td>12</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">130</td>
<td>Bacteria</td>
<td>Deinococcota</td>
<td>Deinococci</td>
<td>Deinococcales</td>
<td>Trueperaceae</td>
<td>Truepera</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>38</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>2 rows Ã— 27 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="255" id="cell-144">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a aria-hidden="true" href="#cb113-1" tabindex="-1"></a>f <span class="op">=</span> (corrs_list_flights</span>
<span id="cb113-2"><a aria-hidden="true" href="#cb113-2" tabindex="-1"></a>.query(<span class="st">'Genus in @selected_fungal_genera'</span>) </span>
<span id="cb113-3"><a aria-hidden="true" href="#cb113-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb113-4"><a aria-hidden="true" href="#cb113-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb113-5"><a aria-hidden="true" href="#cb113-5" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb113-6"><a aria-hidden="true" href="#cb113-6" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb113-7"><a aria-hidden="true" href="#cb113-7" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb113-8"><a aria-hidden="true" href="#cb113-8" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb113-9"><a aria-hidden="true" href="#cb113-9" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb113-10"><a aria-hidden="true" href="#cb113-10" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb113-11"><a aria-hidden="true" href="#cb113-11" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb113-12"><a aria-hidden="true" href="#cb113-12" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb113-13"><a aria-hidden="true" href="#cb113-13" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb113-14"><a aria-hidden="true" href="#cb113-14" tabindex="-1"></a>                           legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb113-15"><a aria-hidden="true" href="#cb113-15" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb113-16"><a aria-hidden="true" href="#cb113-16" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, y<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb113-17"><a aria-hidden="true" href="#cb113-17" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb113-18"><a aria-hidden="true" href="#cb113-18" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb113-19"><a aria-hidden="true" href="#cb113-19" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb113-20"><a aria-hidden="true" href="#cb113-20" tabindex="-1"></a>                )</span>
<span id="cb113-21"><a aria-hidden="true" href="#cb113-21" tabindex="-1"></a>))</span>
<span id="cb113-22"><a aria-hidden="true" href="#cb113-22" tabindex="-1"></a>f.save(<span class="st">'../output/figures/corr_fun_flights.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb113-23"><a aria-hidden="true" href="#cb113-23" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="255">
<div>
<figure class="figure">
<p><img class="figure-img" height="1200" src="microbial_diversity_analysis_files/figure-html/cell-108-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="258" id="cell-145">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a aria-hidden="true" href="#cb114-1" tabindex="-1"></a>f <span class="op">=</span> (corrs_list_ground</span>
<span id="cb114-2"><a aria-hidden="true" href="#cb114-2" tabindex="-1"></a> .query(<span class="st">'Genus in @selected_fungal_genera'</span>) </span>
<span id="cb114-3"><a aria-hidden="true" href="#cb114-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb114-4"><a aria-hidden="true" href="#cb114-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb114-5"><a aria-hidden="true" href="#cb114-5" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb114-6"><a aria-hidden="true" href="#cb114-6" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb114-7"><a aria-hidden="true" href="#cb114-7" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb114-8"><a aria-hidden="true" href="#cb114-8" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb114-9"><a aria-hidden="true" href="#cb114-9" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb114-10"><a aria-hidden="true" href="#cb114-10" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb114-11"><a aria-hidden="true" href="#cb114-11" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb114-12"><a aria-hidden="true" href="#cb114-12" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb114-13"><a aria-hidden="true" href="#cb114-13" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb114-14"><a aria-hidden="true" href="#cb114-14" tabindex="-1"></a>                           legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb114-15"><a aria-hidden="true" href="#cb114-15" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb114-16"><a aria-hidden="true" href="#cb114-16" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, y<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb114-17"><a aria-hidden="true" href="#cb114-17" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb114-18"><a aria-hidden="true" href="#cb114-18" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb114-19"><a aria-hidden="true" href="#cb114-19" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb114-20"><a aria-hidden="true" href="#cb114-20" tabindex="-1"></a>                )</span>
<span id="cb114-21"><a aria-hidden="true" href="#cb114-21" tabindex="-1"></a>))</span>
<span id="cb114-22"><a aria-hidden="true" href="#cb114-22" tabindex="-1"></a></span>
<span id="cb114-23"><a aria-hidden="true" href="#cb114-23" tabindex="-1"></a>f.save(<span class="st">'../output/figures/corr_fun_ground.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb114-24"><a aria-hidden="true" href="#cb114-24" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="258">
<div>
<figure class="figure">
<p><img class="figure-img" height="1200" src="microbial_diversity_analysis_files/figure-html/cell-109-output-1.png" width="1200"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="112" id="cell-146">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a aria-hidden="true" href="#cb115-1" tabindex="-1"></a>top_correlated_genera <span class="op">=</span> (corrs_matrix_flight</span>
<span id="cb115-2"><a aria-hidden="true" href="#cb115-2" tabindex="-1"></a> .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb115-3"><a aria-hidden="true" href="#cb115-3" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">abs</span>().<span class="bu">max</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb115-4"><a aria-hidden="true" href="#cb115-4" tabindex="-1"></a> .rename(<span class="st">'correlation'</span>)</span>
<span id="cb115-5"><a aria-hidden="true" href="#cb115-5" tabindex="-1"></a> .reset_index()</span>
<span id="cb115-6"><a aria-hidden="true" href="#cb115-6" tabindex="-1"></a> .merge(kingdom_genera)</span>
<span id="cb115-7"><a aria-hidden="true" href="#cb115-7" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb115-8"><a aria-hidden="true" href="#cb115-8" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.sort_values(by<span class="op">=</span><span class="st">'correlation'</span>, ascending<span class="op">=</span><span class="va">False</span>).iloc[:<span class="dv">30</span>])</span>
<span id="cb115-9"><a aria-hidden="true" href="#cb115-9" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="173" id="cell-147">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a aria-hidden="true" href="#cb116-1" tabindex="-1"></a>top_correlated_genera <span class="op">=</span> (corrs_matrix_flight</span>
<span id="cb116-2"><a aria-hidden="true" href="#cb116-2" tabindex="-1"></a> .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb116-3"><a aria-hidden="true" href="#cb116-3" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">abs</span>().<span class="bu">max</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb116-4"><a aria-hidden="true" href="#cb116-4" tabindex="-1"></a> .rename(<span class="st">'correlation'</span>)</span>
<span id="cb116-5"><a aria-hidden="true" href="#cb116-5" tabindex="-1"></a> .reset_index()</span>
<span id="cb116-6"><a aria-hidden="true" href="#cb116-6" tabindex="-1"></a> .merge(kingdom_genera)</span>
<span id="cb116-7"><a aria-hidden="true" href="#cb116-7" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb116-8"><a aria-hidden="true" href="#cb116-8" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.sort_values(by<span class="op">=</span><span class="st">'correlation'</span>, ascending<span class="op">=</span><span class="va">False</span>).iloc[:<span class="dv">40</span>])</span>
<span id="cb116-9"><a aria-hidden="true" href="#cb116-9" tabindex="-1"></a>)</span>
<span id="cb116-10"><a aria-hidden="true" href="#cb116-10" tabindex="-1"></a></span>
<span id="cb116-11"><a aria-hidden="true" href="#cb116-11" tabindex="-1"></a>f <span class="op">=</span> (corrs_list_flights</span>
<span id="cb116-12"><a aria-hidden="true" href="#cb116-12" tabindex="-1"></a> .merge(kingdom_genera)</span>
<span id="cb116-13"><a aria-hidden="true" href="#cb116-13" tabindex="-1"></a> .merge(top_correlated_genera.sort_values(<span class="st">'correlation'</span>, ascending<span class="op">=</span><span class="va">False</span>).iloc[:<span class="dv">40</span>][[<span class="st">'Genus'</span>]], on<span class="op">=</span>[<span class="st">'Genus'</span>])</span>
<span id="cb116-14"><a aria-hidden="true" href="#cb116-14" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.Genus, categories<span class="op">=</span>top_correlated_genera.Genus, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb116-15"><a aria-hidden="true" href="#cb116-15" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb116-16"><a aria-hidden="true" href="#cb116-16" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'Genus'</span>, <span class="st">'species'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb116-17"><a aria-hidden="true" href="#cb116-17" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb116-18"><a aria-hidden="true" href="#cb116-18" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb116-19"><a aria-hidden="true" href="#cb116-19" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb116-20"><a aria-hidden="true" href="#cb116-20" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb116-21"><a aria-hidden="true" href="#cb116-21" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb116-22"><a aria-hidden="true" href="#cb116-22" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb116-23"><a aria-hidden="true" href="#cb116-23" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb116-24"><a aria-hidden="true" href="#cb116-24" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="fl">4.5</span>),</span>
<span id="cb116-25"><a aria-hidden="true" href="#cb116-25" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb116-26"><a aria-hidden="true" href="#cb116-26" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb116-27"><a aria-hidden="true" href="#cb116-27" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb116-28"><a aria-hidden="true" href="#cb116-28" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb116-29"><a aria-hidden="true" href="#cb116-29" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb116-30"><a aria-hidden="true" href="#cb116-30" tabindex="-1"></a>                           legend_position<span class="op">=</span><span class="st">'bottom'</span></span>
<span id="cb116-31"><a aria-hidden="true" href="#cb116-31" tabindex="-1"></a>                )</span>
<span id="cb116-32"><a aria-hidden="true" href="#cb116-32" tabindex="-1"></a>)</span>
<span id="cb116-33"><a aria-hidden="true" href="#cb116-33" tabindex="-1"></a>)</span>
<span id="cb116-34"><a aria-hidden="true" href="#cb116-34" tabindex="-1"></a>f.save(<span class="st">'../output/figures/top40_corr.svg'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="167" id="cell-148">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a aria-hidden="true" href="#cb117-1" tabindex="-1"></a>(corrs_list_flights</span>
<span id="cb117-2"><a aria-hidden="true" href="#cb117-2" tabindex="-1"></a> .merge(kingdom_genera)</span>
<span id="cb117-3"><a aria-hidden="true" href="#cb117-3" tabindex="-1"></a> .merge(top_correlated_genera[[<span class="st">'Genus'</span>]], on<span class="op">=</span>[<span class="st">'Genus'</span>])</span>
<span id="cb117-4"><a aria-hidden="true" href="#cb117-4" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.Genus, categories<span class="op">=</span>top_correlated_genera.Genus, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb117-5"><a aria-hidden="true" href="#cb117-5" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb117-6"><a aria-hidden="true" href="#cb117-6" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb117-7"><a aria-hidden="true" href="#cb117-7" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile(</span>
<span id="cb117-8"><a aria-hidden="true" href="#cb117-8" tabindex="-1"></a>                    <span class="co"># color='black'</span></span>
<span id="cb117-9"><a aria-hidden="true" href="#cb117-9" tabindex="-1"></a>                    )</span>
<span id="cb117-10"><a aria-hidden="true" href="#cb117-10" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb117-11"><a aria-hidden="true" href="#cb117-11" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb117-12"><a aria-hidden="true" href="#cb117-12" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb117-13"><a aria-hidden="true" href="#cb117-13" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb117-14"><a aria-hidden="true" href="#cb117-14" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb117-15"><a aria-hidden="true" href="#cb117-15" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb117-16"><a aria-hidden="true" href="#cb117-16" tabindex="-1"></a>                <span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom'</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb117-17"><a aria-hidden="true" href="#cb117-17" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">4</span>),</span>
<span id="cb117-18"><a aria-hidden="true" href="#cb117-18" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb117-19"><a aria-hidden="true" href="#cb117-19" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb117-20"><a aria-hidden="true" href="#cb117-20" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb117-21"><a aria-hidden="true" href="#cb117-21" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb117-22"><a aria-hidden="true" href="#cb117-22" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb117-23"><a aria-hidden="true" href="#cb117-23" tabindex="-1"></a>                )</span>
<span id="cb117-24"><a aria-hidden="true" href="#cb117-24" tabindex="-1"></a>)</span>
<span id="cb117-25"><a aria-hidden="true" href="#cb117-25" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1200" src="microbial_diversity_analysis_files/figure-html/cell-112-output-1.png" width="2700"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-149">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a aria-hidden="true" href="#cb118-1" tabindex="-1"></a></span>
<span id="cb118-2"><a aria-hidden="true" href="#cb118-2" tabindex="-1"></a>f <span class="op">=</span> (corrs_list</span>
<span id="cb118-3"><a aria-hidden="true" href="#cb118-3" tabindex="-1"></a>.query(<span class="st">'Genus in @selected_bacterial_genera'</span>) </span>
<span id="cb118-4"><a aria-hidden="true" href="#cb118-4" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb118-5"><a aria-hidden="true" href="#cb118-5" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb118-6"><a aria-hidden="true" href="#cb118-6" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb118-7"><a aria-hidden="true" href="#cb118-7" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb118-8"><a aria-hidden="true" href="#cb118-8" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb118-9"><a aria-hidden="true" href="#cb118-9" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb118-10"><a aria-hidden="true" href="#cb118-10" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb118-11"><a aria-hidden="true" href="#cb118-11" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb118-12"><a aria-hidden="true" href="#cb118-12" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb118-13"><a aria-hidden="true" href="#cb118-13" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb118-14"><a aria-hidden="true" href="#cb118-14" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb118-15"><a aria-hidden="true" href="#cb118-15" tabindex="-1"></a>                           legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb118-16"><a aria-hidden="true" href="#cb118-16" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb118-17"><a aria-hidden="true" href="#cb118-17" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, y<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb118-18"><a aria-hidden="true" href="#cb118-18" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb118-19"><a aria-hidden="true" href="#cb118-19" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb118-20"><a aria-hidden="true" href="#cb118-20" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb118-21"><a aria-hidden="true" href="#cb118-21" tabindex="-1"></a>                )</span>
<span id="cb118-22"><a aria-hidden="true" href="#cb118-22" tabindex="-1"></a>))</span>
<span id="cb118-23"><a aria-hidden="true" href="#cb118-23" tabindex="-1"></a>f.save(<span class="st">'../output/figures/correlations_bacteria.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-150">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a aria-hidden="true" href="#cb119-1" tabindex="-1"></a>f <span class="op">=</span> (corrs_list</span>
<span id="cb119-2"><a aria-hidden="true" href="#cb119-2" tabindex="-1"></a>.query(<span class="st">'Genus in @selected_fungal_genera'</span>) </span>
<span id="cb119-3"><a aria-hidden="true" href="#cb119-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb119-4"><a aria-hidden="true" href="#cb119-4" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb119-5"><a aria-hidden="true" href="#cb119-5" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb119-6"><a aria-hidden="true" href="#cb119-6" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb119-7"><a aria-hidden="true" href="#cb119-7" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb119-8"><a aria-hidden="true" href="#cb119-8" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb119-9"><a aria-hidden="true" href="#cb119-9" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb119-10"><a aria-hidden="true" href="#cb119-10" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb119-11"><a aria-hidden="true" href="#cb119-11" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb119-12"><a aria-hidden="true" href="#cb119-12" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb119-13"><a aria-hidden="true" href="#cb119-13" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb119-14"><a aria-hidden="true" href="#cb119-14" tabindex="-1"></a>                           legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb119-15"><a aria-hidden="true" href="#cb119-15" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb119-16"><a aria-hidden="true" href="#cb119-16" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>, y<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb119-17"><a aria-hidden="true" href="#cb119-17" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb119-18"><a aria-hidden="true" href="#cb119-18" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb119-19"><a aria-hidden="true" href="#cb119-19" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb119-20"><a aria-hidden="true" href="#cb119-20" tabindex="-1"></a>                )</span>
<span id="cb119-21"><a aria-hidden="true" href="#cb119-21" tabindex="-1"></a>))</span>
<span id="cb119-22"><a aria-hidden="true" href="#cb119-22" tabindex="-1"></a>f.save(<span class="st">'../output/figures/correlations_fungi.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-151">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a aria-hidden="true" href="#cb120-1" tabindex="-1"></a>sig_genera <span class="op">=</span> (corrs_matrix</span>
<span id="cb120-2"><a aria-hidden="true" href="#cb120-2" tabindex="-1"></a>                      .set_index(<span class="st">'Genus'</span>)</span>
<span id="cb120-3"><a aria-hidden="true" href="#cb120-3" tabindex="-1"></a>                      .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">max</span>(), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb120-4"><a aria-hidden="true" href="#cb120-4" tabindex="-1"></a>                      .loc[<span class="kw">lambda</span> x: x <span class="op">&gt;</span> <span class="fl">.544</span>]</span>
<span id="cb120-5"><a aria-hidden="true" href="#cb120-5" tabindex="-1"></a>                      .index.values</span>
<span id="cb120-6"><a aria-hidden="true" href="#cb120-6" tabindex="-1"></a>)</span>
<span id="cb120-7"><a aria-hidden="true" href="#cb120-7" tabindex="-1"></a></span>
<span id="cb120-8"><a aria-hidden="true" href="#cb120-8" tabindex="-1"></a>(corrs_list</span>
<span id="cb120-9"><a aria-hidden="true" href="#cb120-9" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.Genus.isin(sig_genera)]</span>
<span id="cb120-10"><a aria-hidden="true" href="#cb120-10" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.split(<span class="st">'-'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb120-11"><a aria-hidden="true" href="#cb120-11" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb120-12"><a aria-hidden="true" href="#cb120-12" tabindex="-1"></a>                <span class="op">+</span> p9.aes(<span class="st">'species'</span>, <span class="st">'Genus'</span>, fill<span class="op">=</span><span class="st">'spearman_r'</span>)</span>
<span id="cb120-13"><a aria-hidden="true" href="#cb120-13" tabindex="-1"></a>                <span class="op">+</span> p9.geom_tile()</span>
<span id="cb120-14"><a aria-hidden="true" href="#cb120-14" tabindex="-1"></a>                <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">"Spearman's $r$"</span>)</span>
<span id="cb120-15"><a aria-hidden="true" href="#cb120-15" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'+'</span>, data<span class="op">=</span>dd.query(<span class="st">'.01 &lt; spearman_p_value &lt; .05'</span>),</span>
<span id="cb120-16"><a aria-hidden="true" href="#cb120-16" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb120-17"><a aria-hidden="true" href="#cb120-17" tabindex="-1"></a>                <span class="op">+</span> p9.geom_text(label<span class="op">=</span><span class="st">'$*$'</span>, data<span class="op">=</span>dd.query(<span class="st">'spearman_p_value &lt; .01'</span>),</span>
<span id="cb120-18"><a aria-hidden="true" href="#cb120-18" tabindex="-1"></a>                     size<span class="op">=</span><span class="dv">5</span>, va<span class="op">=</span><span class="st">'center_baseline'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb120-19"><a aria-hidden="true" href="#cb120-19" tabindex="-1"></a>                <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'RdBu_r'</span>, limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.9</span>, <span class="fl">.9</span>))</span>
<span id="cb120-20"><a aria-hidden="true" href="#cb120-20" tabindex="-1"></a>                <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>),</span>
<span id="cb120-21"><a aria-hidden="true" href="#cb120-21" tabindex="-1"></a>                           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb120-22"><a aria-hidden="true" href="#cb120-22" tabindex="-1"></a>                           axis_text_x<span class="op">=</span>p9.element_text(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb120-23"><a aria-hidden="true" href="#cb120-23" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb120-24"><a aria-hidden="true" href="#cb120-24" tabindex="-1"></a>                           legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb120-25"><a aria-hidden="true" href="#cb120-25" tabindex="-1"></a>                           legend_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb120-26"><a aria-hidden="true" href="#cb120-26" tabindex="-1"></a>                )</span>
<span id="cb120-27"><a aria-hidden="true" href="#cb120-27" tabindex="-1"></a>))</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1200" src="microbial_diversity_analysis_files/figure-html/cell-115-output-1.png" width="1500"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level3" id="pathogen-bubble-plots">
<h3 class="anchored" data-anchor-id="pathogen-bubble-plots">Pathogen bubble plots</h3>
<div class="cell" data-execution_count="144" id="cell-153">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a aria-hidden="true" href="#cb121-1" tabindex="-1"></a>bac_pathogens_df <span class="op">=</span> (</span>
<span id="cb121-2"><a aria-hidden="true" href="#cb121-2" tabindex="-1"></a>    pd.read_excel(<span class="st">'../data/metadata/Species 2023_final.xlsx'</span>,</span>
<span id="cb121-3"><a aria-hidden="true" href="#cb121-3" tabindex="-1"></a>                  sheet_name<span class="op">=</span><span class="st">'JV analysis_Bacteria'</span>)</span>
<span id="cb121-4"><a aria-hidden="true" href="#cb121-4" tabindex="-1"></a>                  [[<span class="st">'Genus'</span>, <span class="st">'Species'</span>]]</span>
<span id="cb121-5"><a aria-hidden="true" href="#cb121-5" tabindex="-1"></a>    .assign(label<span class="op">=</span><span class="st">'Bacterial Potential Human Pathogens'</span>)</span>
<span id="cb121-6"><a aria-hidden="true" href="#cb121-6" tabindex="-1"></a>)</span>
<span id="cb121-7"><a aria-hidden="true" href="#cb121-7" tabindex="-1"></a></span>
<span id="cb121-8"><a aria-hidden="true" href="#cb121-8" tabindex="-1"></a>fungi_pathogens_df <span class="op">=</span> (pd.read_excel(<span class="st">'../data/metadata/Species 2023_final.xlsx'</span>,</span>
<span id="cb121-9"><a aria-hidden="true" href="#cb121-9" tabindex="-1"></a>                                     sheet_name<span class="op">=</span><span class="st">'JV analysis_Fungi'</span>, </span>
<span id="cb121-10"><a aria-hidden="true" href="#cb121-10" tabindex="-1"></a>                                     skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb121-11"><a aria-hidden="true" href="#cb121-11" tabindex="-1"></a>                       [[<span class="st">'Genus'</span>, <span class="st">'Species'</span>]]</span>
<span id="cb121-12"><a aria-hidden="true" href="#cb121-12" tabindex="-1"></a>                       .dropna()</span>
<span id="cb121-13"><a aria-hidden="true" href="#cb121-13" tabindex="-1"></a>    .assign(label<span class="op">=</span><span class="st">'Fungal Potential Human Pathogens'</span>) </span>
<span id="cb121-14"><a aria-hidden="true" href="#cb121-14" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="145" id="cell-154">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a aria-hidden="true" href="#cb122-1" tabindex="-1"></a>taxon_names <span class="op">=</span> [<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>, <span class="st">'Class'</span>, <span class="st">'Order'</span>, <span class="st">'Family'</span>, <span class="st">'Genus'</span>, <span class="st">'Species'</span>]</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="140" id="cell-155">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a aria-hidden="true" href="#cb123-1" tabindex="-1"></a>fun_df_sp <span class="op">=</span> (pd.read_csv(<span class="st">'../data/metagenomics/ITS_species_NB90.csv'</span>)</span>
<span id="cb123-2"><a aria-hidden="true" href="#cb123-2" tabindex="-1"></a>          .query(<span class="st">'Kingdom == "k__Fungi"'</span>)</span>
<span id="cb123-3"><a aria-hidden="true" href="#cb123-3" tabindex="-1"></a>)</span>
<span id="cb123-4"><a aria-hidden="true" href="#cb123-4" tabindex="-1"></a>fun_df_sp[taxon_names] <span class="op">=</span> fun_df_sp[taxon_names].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb123-5"><a aria-hidden="true" href="#cb123-5" tabindex="-1"></a>fun_df_sp <span class="op">=</span> fun_df_sp.rename(columns<span class="op">=</span>zfill_map).fillna(<span class="st">'unknown'</span>)</span>
<span id="cb123-6"><a aria-hidden="true" href="#cb123-6" tabindex="-1"></a></span>
<span id="cb123-7"><a aria-hidden="true" href="#cb123-7" tabindex="-1"></a>bac_df_sp <span class="op">=</span> (pd.read_csv(<span class="st">'../data/metagenomics/16S_species_NB90.csv'</span>)</span>
<span id="cb123-8"><a aria-hidden="true" href="#cb123-8" tabindex="-1"></a>            .rename(columns<span class="op">=</span>zfill_map)</span>
<span id="cb123-9"><a aria-hidden="true" href="#cb123-9" tabindex="-1"></a>            .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>))</span>
<span id="cb123-10"><a aria-hidden="true" href="#cb123-10" tabindex="-1"></a>            .fillna(<span class="st">'unknown'</span>)</span>
<span id="cb123-11"><a aria-hidden="true" href="#cb123-11" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="82" id="cell-156">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a aria-hidden="true" href="#cb124-1" tabindex="-1"></a>f <span class="op">=</span> (pd.concat([bac_df_sp, fun_df_sp])</span>
<span id="cb124-2"><a aria-hidden="true" href="#cb124-2" tabindex="-1"></a>.merge(pd.concat([bac_pathogens_df, fungi_pathogens_df]),</span>
<span id="cb124-3"><a aria-hidden="true" href="#cb124-3" tabindex="-1"></a>       on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb124-4"><a aria-hidden="true" href="#cb124-4" tabindex="-1"></a>.drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb124-5"><a aria-hidden="true" href="#cb124-5" tabindex="-1"></a>.assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd.label.fillna(<span class="st">'Fungal Human Pathogens'</span>))</span>
<span id="cb124-6"><a aria-hidden="true" href="#cb124-6" tabindex="-1"></a>.melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'label'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb124-7"><a aria-hidden="true" href="#cb124-7" tabindex="-1"></a>.merge(samples_info, on<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb124-8"><a aria-hidden="true" href="#cb124-8" tabindex="-1"></a>.groupby([<span class="st">'label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'sample_id'</span>])</span>
<span id="cb124-9"><a aria-hidden="true" href="#cb124-9" tabindex="-1"></a>.aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb124-10"><a aria-hidden="true" href="#cb124-10" tabindex="-1"></a>.reset_index()</span>
<span id="cb124-11"><a aria-hidden="true" href="#cb124-11" tabindex="-1"></a>.groupby([<span class="st">'label'</span>, <span class="st">'sample_mode'</span>])</span>
<span id="cb124-12"><a aria-hidden="true" href="#cb124-12" tabindex="-1"></a>.aggregate({<span class="st">'counts'</span>: <span class="st">'mean'</span>})</span>
<span id="cb124-13"><a aria-hidden="true" href="#cb124-13" tabindex="-1"></a>.reset_index()</span>
<span id="cb124-14"><a aria-hidden="true" href="#cb124-14" tabindex="-1"></a>.assign(Kingdom<span class="op">=</span><span class="kw">lambda</span> dd: dd.label.<span class="bu">str</span>.split().<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb124-15"><a aria-hidden="true" href="#cb124-15" tabindex="-1"></a>.replace({<span class="st">'Kingdom'</span>: {<span class="st">'Bacterial'</span>: <span class="st">'Bacteria'</span>, <span class="st">'Fungal'</span>: <span class="st">'Fungi'</span>}})</span>
<span id="cb124-16"><a aria-hidden="true" href="#cb124-16" tabindex="-1"></a>.assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd.label.<span class="bu">str</span>.split().<span class="bu">str</span>[<span class="dv">1</span>:].<span class="bu">str</span>.join(<span class="st">' '</span>))</span>
<span id="cb124-17"><a aria-hidden="true" href="#cb124-17" tabindex="-1"></a>.pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) <span class="op">+</span> p9.aes(<span class="st">'label'</span>, <span class="st">'counts'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb124-18"><a aria-hidden="true" href="#cb124-18" tabindex="-1"></a><span class="op">+</span> p9.geom_col(position<span class="op">=</span><span class="st">'dodge'</span>)</span>
<span id="cb124-19"><a aria-hidden="true" href="#cb124-19" tabindex="-1"></a><span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb124-20"><a aria-hidden="true" href="#cb124-20" tabindex="-1"></a><span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom'</span>, scales<span class="op">=</span><span class="st">'free_x'</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb124-21"><a aria-hidden="true" href="#cb124-21" tabindex="-1"></a><span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Read counts'</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb124-22"><a aria-hidden="true" href="#cb124-22" tabindex="-1"></a><span class="op">+</span> p9.coord_flip()</span>
<span id="cb124-23"><a aria-hidden="true" href="#cb124-23" tabindex="-1"></a><span class="op">+</span> p9.theme(legend_position<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb124-24"><a aria-hidden="true" href="#cb124-24" tabindex="-1"></a>           figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb124-25"><a aria-hidden="true" href="#cb124-25" tabindex="-1"></a>           strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb124-26"><a aria-hidden="true" href="#cb124-26" tabindex="-1"></a>           )</span>
<span id="cb124-27"><a aria-hidden="true" href="#cb124-27" tabindex="-1"></a>)</span>
<span id="cb124-28"><a aria-hidden="true" href="#cb124-28" tabindex="-1"></a>)</span>
<span id="cb124-29"><a aria-hidden="true" href="#cb124-29" tabindex="-1"></a>f.save(<span class="st">'../output/figures/pathogens_bars.svg'</span>)</span>
<span id="cb124-30"><a aria-hidden="true" href="#cb124-30" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>
<figure class="figure">
<p><img class="figure-img" height="1530" src="microbial_diversity_analysis_files/figure-html/cell-119-output-1.png" width="1537"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="138" id="cell-157">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a aria-hidden="true" href="#cb125-1" tabindex="-1"></a>all_species_df <span class="op">=</span> (pd.read_csv(<span class="st">'../data/metagenomics/with_blank_pools/complete_table_naivebayes.csv'</span>)</span>
<span id="cb125-2"><a aria-hidden="true" href="#cb125-2" tabindex="-1"></a>                  .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>))</span>
<span id="cb125-3"><a aria-hidden="true" href="#cb125-3" tabindex="-1"></a>                  )</span>
<span id="cb125-4"><a aria-hidden="true" href="#cb125-4" tabindex="-1"></a>blank_species_df <span class="op">=</span> (pd.read_csv(<span class="st">'../data/metagenomics/with_blank_pools/complete_table_naivebayes.csv'</span>)</span>
<span id="cb125-5"><a aria-hidden="true" href="#cb125-5" tabindex="-1"></a> .query(<span class="st">'Species.notna()'</span>)</span>
<span id="cb125-6"><a aria-hidden="true" href="#cb125-6" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>))</span>
<span id="cb125-7"><a aria-hidden="true" href="#cb125-7" tabindex="-1"></a> [[ <span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'Blank-Flightpoolsubsampled'</span>, <span class="st">'Blank-Groundpoolsubsampled'</span>]]</span>
<span id="cb125-8"><a aria-hidden="true" href="#cb125-8" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb125-9"><a aria-hidden="true" href="#cb125-9" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb125-10"><a aria-hidden="true" href="#cb125-10" tabindex="-1"></a>         np.where(dd.sample_id.<span class="bu">str</span>.contains(<span class="st">'Flight'</span>), <span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>))</span>
<span id="cb125-11"><a aria-hidden="true" href="#cb125-11" tabindex="-1"></a> .drop(columns<span class="op">=</span><span class="st">'sample_id'</span>)</span>
<span id="cb125-12"><a aria-hidden="true" href="#cb125-12" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'sample_label'</span>])</span>
<span id="cb125-13"><a aria-hidden="true" href="#cb125-13" tabindex="-1"></a>        .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb125-14"><a aria-hidden="true" href="#cb125-14" tabindex="-1"></a> .reset_index()</span>
<span id="cb125-15"><a aria-hidden="true" href="#cb125-15" tabindex="-1"></a> .groupby(<span class="st">'sample_label'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb125-16"><a aria-hidden="true" href="#cb125-16" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb125-17"><a aria-hidden="true" href="#cb125-17" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="146" id="cell-158">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a aria-hidden="true" href="#cb126-1" tabindex="-1"></a>taxon_names <span class="op">=</span> [<span class="st">'Kingdom'</span>, <span class="st">'Phylum'</span>, <span class="st">'Class'</span>, <span class="st">'Order'</span>, <span class="st">'Family'</span>, <span class="st">'Genus'</span>, <span class="st">'Species'</span>]</span>
<span id="cb126-2"><a aria-hidden="true" href="#cb126-2" tabindex="-1"></a>sample_fun_path <span class="op">=</span> (fun_df_sp</span>
<span id="cb126-3"><a aria-hidden="true" href="#cb126-3" tabindex="-1"></a>    .assign(Species<span class="op">=</span><span class="kw">lambda</span> dd: dd.Species.<span class="bu">str</span>.split(<span class="st">'__'</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb126-4"><a aria-hidden="true" href="#cb126-4" tabindex="-1"></a>    .melt(taxon_names, var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb126-5"><a aria-hidden="true" href="#cb126-5" tabindex="-1"></a>    .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb126-6"><a aria-hidden="true" href="#cb126-6" tabindex="-1"></a>    .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' samples'</span>)</span>
<span id="cb126-7"><a aria-hidden="true" href="#cb126-7" tabindex="-1"></a>    .groupby([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'sample_label'</span>])</span>
<span id="cb126-8"><a aria-hidden="true" href="#cb126-8" tabindex="-1"></a>    .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb126-9"><a aria-hidden="true" href="#cb126-9" tabindex="-1"></a>    .groupby(<span class="st">'sample_label'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb126-10"><a aria-hidden="true" href="#cb126-10" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb126-11"><a aria-hidden="true" href="#cb126-11" tabindex="-1"></a>    .reset_index()</span>
<span id="cb126-12"><a aria-hidden="true" href="#cb126-12" tabindex="-1"></a>    .merge(fungi_pathogens_df)</span>
<span id="cb126-13"><a aria-hidden="true" href="#cb126-13" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="147" id="cell-159">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a aria-hidden="true" href="#cb127-1" tabindex="-1"></a>blank_bac_pathogens <span class="op">=</span> (all_species_df</span>
<span id="cb127-2"><a aria-hidden="true" href="#cb127-2" tabindex="-1"></a> .fillna(<span class="st">'unknown'</span>)</span>
<span id="cb127-3"><a aria-hidden="true" href="#cb127-3" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'Species'</span>])</span>
<span id="cb127-4"><a aria-hidden="true" href="#cb127-4" tabindex="-1"></a> .<span class="bu">sum</span>(numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb127-5"><a aria-hidden="true" href="#cb127-5" tabindex="-1"></a> [[<span class="st">'Blank-Flightpoolsubsampled'</span>, <span class="st">'Blank-Groundpoolsubsampled'</span>]]</span>
<span id="cb127-6"><a aria-hidden="true" href="#cb127-6" tabindex="-1"></a> .reset_index()</span>
<span id="cb127-7"><a aria-hidden="true" href="#cb127-7" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>])</span>
<span id="cb127-8"><a aria-hidden="true" href="#cb127-8" tabindex="-1"></a> .groupby(<span class="st">'variable'</span>)</span>
<span id="cb127-9"><a aria-hidden="true" href="#cb127-9" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.value <span class="op">/</span> dd.value.<span class="bu">sum</span>()))</span>
<span id="cb127-10"><a aria-hidden="true" href="#cb127-10" tabindex="-1"></a> .merge(bac_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb127-11"><a aria-hidden="true" href="#cb127-11" tabindex="-1"></a> .assign(value<span class="op">=</span><span class="kw">lambda</span> dd: dd.value.fillna(<span class="dv">0</span>))</span>
<span id="cb127-12"><a aria-hidden="true" href="#cb127-12" tabindex="-1"></a> .query(<span class="st">'variable.notna()'</span>)</span>
<span id="cb127-13"><a aria-hidden="true" href="#cb127-13" tabindex="-1"></a> .replace({</span>
<span id="cb127-14"><a aria-hidden="true" href="#cb127-14" tabindex="-1"></a>     <span class="st">'Blank-Flightpoolsubsampled'</span>: <span class="st">'Flight Blanks'</span>,</span>
<span id="cb127-15"><a aria-hidden="true" href="#cb127-15" tabindex="-1"></a>     <span class="st">'Blank-Groundpoolsubsampled'</span>: <span class="st">'Ground Blanks'</span></span>
<span id="cb127-16"><a aria-hidden="true" href="#cb127-16" tabindex="-1"></a> })</span>
<span id="cb127-17"><a aria-hidden="true" href="#cb127-17" tabindex="-1"></a> .rename(columns<span class="op">=</span>{<span class="st">'variable'</span>: <span class="st">'sample_label'</span>})</span>
<span id="cb127-18"><a aria-hidden="true" href="#cb127-18" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="148" id="cell-160">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a aria-hidden="true" href="#cb128-1" tabindex="-1"></a>samples_pathogens_bac_df <span class="op">=</span> (bac_df_sp</span>
<span id="cb128-2"><a aria-hidden="true" href="#cb128-2" tabindex="-1"></a> .fillna(<span class="st">'unknown'</span>)</span>
<span id="cb128-3"><a aria-hidden="true" href="#cb128-3" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'Species'</span>])</span>
<span id="cb128-4"><a aria-hidden="true" href="#cb128-4" tabindex="-1"></a> .<span class="bu">sum</span>(numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb128-5"><a aria-hidden="true" href="#cb128-5" tabindex="-1"></a> .reset_index()</span>
<span id="cb128-6"><a aria-hidden="true" href="#cb128-6" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>])</span>
<span id="cb128-7"><a aria-hidden="true" href="#cb128-7" tabindex="-1"></a> .assign(value<span class="op">=</span><span class="kw">lambda</span> dd: dd.value.fillna(<span class="dv">0</span>))</span>
<span id="cb128-8"><a aria-hidden="true" href="#cb128-8" tabindex="-1"></a> .query(<span class="st">'variable.notna()'</span>)</span>
<span id="cb128-9"><a aria-hidden="true" href="#cb128-9" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.variable.<span class="bu">map</span>(sample_map))</span>
<span id="cb128-10"><a aria-hidden="true" href="#cb128-10" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'sample_mode'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb128-11"><a aria-hidden="true" href="#cb128-11" tabindex="-1"></a> .value</span>
<span id="cb128-12"><a aria-hidden="true" href="#cb128-12" tabindex="-1"></a> .mean()</span>
<span id="cb128-13"><a aria-hidden="true" href="#cb128-13" tabindex="-1"></a> .<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb128-14"><a aria-hidden="true" href="#cb128-14" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' samples'</span>)</span>
<span id="cb128-15"><a aria-hidden="true" href="#cb128-15" tabindex="-1"></a> .groupby(<span class="st">'sample_label'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb128-16"><a aria-hidden="true" href="#cb128-16" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.value <span class="op">/</span> dd.value.<span class="bu">sum</span>()))</span>
<span id="cb128-17"><a aria-hidden="true" href="#cb128-17" tabindex="-1"></a> .merge(bac_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb128-18"><a aria-hidden="true" href="#cb128-18" tabindex="-1"></a> .drop(columns<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb128-19"><a aria-hidden="true" href="#cb128-19" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="149" id="cell-161">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a aria-hidden="true" href="#cb129-1" tabindex="-1"></a>bac_names <span class="op">=</span> (pd.concat([blank_bac_pathogens, samples_pathogens_bac_df])</span>
<span id="cb129-2"><a aria-hidden="true" href="#cb129-2" tabindex="-1"></a> .query(<span class="st">'sample_label.notna()'</span>)</span>
<span id="cb129-3"><a aria-hidden="true" href="#cb129-3" tabindex="-1"></a> .pivot(index<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], columns<span class="op">=</span><span class="st">'sample_label'</span>, values<span class="op">=</span><span class="st">'relative_abundance'</span>)</span>
<span id="cb129-4"><a aria-hidden="true" href="#cb129-4" tabindex="-1"></a> .fillna(<span class="dv">0</span>)</span>
<span id="cb129-5"><a aria-hidden="true" href="#cb129-5" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb129-6"><a aria-hidden="true" href="#cb129-6" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>).<span class="bu">round</span>(<span class="dv">5</span>) <span class="op">&gt;=</span> <span class="fl">.0001</span>]</span>
<span id="cb129-7"><a aria-hidden="true" href="#cb129-7" tabindex="-1"></a> .reset_index()</span>
<span id="cb129-8"><a aria-hidden="true" href="#cb129-8" tabindex="-1"></a> .assign(total<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'Flight samples'</span>] <span class="op">+</span> dd[<span class="st">'Ground samples'</span>])</span>
<span id="cb129-9"><a aria-hidden="true" href="#cb129-9" tabindex="-1"></a> .sort_values(<span class="st">'total'</span>)</span>
<span id="cb129-10"><a aria-hidden="true" href="#cb129-10" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb129-11"><a aria-hidden="true" href="#cb129-11" tabindex="-1"></a> [<span class="st">'name'</span>]</span>
<span id="cb129-12"><a aria-hidden="true" href="#cb129-12" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="150" id="cell-162">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a aria-hidden="true" href="#cb130-1" tabindex="-1"></a>f <span class="op">=</span> (pd.concat([blank_bac_pathogens, samples_pathogens_bac_df])</span>
<span id="cb130-2"><a aria-hidden="true" href="#cb130-2" tabindex="-1"></a> .query(<span class="st">'sample_label.notna()'</span>)</span>
<span id="cb130-3"><a aria-hidden="true" href="#cb130-3" tabindex="-1"></a> .pivot(index<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], columns<span class="op">=</span><span class="st">'sample_label'</span>, values<span class="op">=</span><span class="st">'relative_abundance'</span>)</span>
<span id="cb130-4"><a aria-hidden="true" href="#cb130-4" tabindex="-1"></a> .fillna(<span class="dv">0</span>)</span>
<span id="cb130-5"><a aria-hidden="true" href="#cb130-5" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb130-6"><a aria-hidden="true" href="#cb130-6" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>).<span class="bu">round</span>(<span class="dv">5</span>) <span class="op">&gt;=</span> <span class="fl">.0001</span>]</span>
<span id="cb130-7"><a aria-hidden="true" href="#cb130-7" tabindex="-1"></a> .reset_index()</span>
<span id="cb130-8"><a aria-hidden="true" href="#cb130-8" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>], value_name<span class="op">=</span><span class="st">'relative_abundance'</span>)</span>
<span id="cb130-9"><a aria-hidden="true" href="#cb130-9" tabindex="-1"></a> .assign(Genus_short<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span>)</span>
<span id="cb130-10"><a aria-hidden="true" href="#cb130-10" tabindex="-1"></a> .assign(fullname<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus_short <span class="op">+</span> dd.Species)</span>
<span id="cb130-11"><a aria-hidden="true" href="#cb130-11" tabindex="-1"></a> .query(<span class="st">'fullname != "C. gingivalis"'</span>)</span>
<span id="cb130-12"><a aria-hidden="true" href="#cb130-12" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))</span>
<span id="cb130-13"><a aria-hidden="true" href="#cb130-13" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb130-14"><a aria-hidden="true" href="#cb130-14" tabindex="-1"></a>         pd.Categorical(dd.sample_label,</span>
<span id="cb130-15"><a aria-hidden="true" href="#cb130-15" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">'Flight</span><span class="ch">\n</span><span class="st">samples'</span>, <span class="st">'Ground</span><span class="ch">\n</span><span class="st">samples'</span>,</span>
<span id="cb130-16"><a aria-hidden="true" href="#cb130-16" tabindex="-1"></a>                <span class="st">'Flight</span><span class="ch">\n</span><span class="st">Blanks'</span>, <span class="st">'Ground</span><span class="ch">\n</span><span class="st">Blanks'</span>])</span>
<span id="cb130-17"><a aria-hidden="true" href="#cb130-17" tabindex="-1"></a>    )</span>
<span id="cb130-18"><a aria-hidden="true" href="#cb130-18" tabindex="-1"></a> .merge(bac_pathogens_df)</span>
<span id="cb130-19"><a aria-hidden="true" href="#cb130-19" tabindex="-1"></a> .assign(fullname<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.fullname, categories<span class="op">=</span>bac_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb130-20"><a aria-hidden="true" href="#cb130-20" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb130-21"><a aria-hidden="true" href="#cb130-21" tabindex="-1"></a>    <span class="op">+</span> p9.aes(<span class="st">'fullname'</span>, <span class="st">'sample_label'</span>)</span>
<span id="cb130-22"><a aria-hidden="true" href="#cb130-22" tabindex="-1"></a>    <span class="op">+</span> p9.geom_tile(p9.aes(fill<span class="op">=</span><span class="st">'relative_abundance &gt; 0'</span>), color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb130-23"><a aria-hidden="true" href="#cb130-23" tabindex="-1"></a>    <span class="op">+</span> p9.coord_flip()</span>
<span id="cb130-24"><a aria-hidden="true" href="#cb130-24" tabindex="-1"></a>    <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'round(relative_abundance * 100, 3).astype(str) + "%"'</span>), size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb130-25"><a aria-hidden="true" href="#cb130-25" tabindex="-1"></a>    <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb130-26"><a aria-hidden="true" href="#cb130-26" tabindex="-1"></a><span class="co">#     + p9.facet_wrap('label', scales='free_y', ncol=1)</span></span>
<span id="cb130-27"><a aria-hidden="true" href="#cb130-27" tabindex="-1"></a>    <span class="op">+</span> p9.scale_x_discrete(expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>), trans<span class="op">=</span><span class="st">'reverse'</span>)</span>
<span id="cb130-28"><a aria-hidden="true" href="#cb130-28" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb130-29"><a aria-hidden="true" href="#cb130-29" tabindex="-1"></a>    <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb130-30"><a aria-hidden="true" href="#cb130-30" tabindex="-1"></a>    <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.5</span>, <span class="dv">8</span>),</span>
<span id="cb130-31"><a aria-hidden="true" href="#cb130-31" tabindex="-1"></a>               axis_text_x<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb130-32"><a aria-hidden="true" href="#cb130-32" tabindex="-1"></a>               axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>, face<span class="op">=</span><span class="st">'italic'</span>),</span>
<span id="cb130-33"><a aria-hidden="true" href="#cb130-33" tabindex="-1"></a>               strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb130-34"><a aria-hidden="true" href="#cb130-34" tabindex="-1"></a>               )</span>
<span id="cb130-35"><a aria-hidden="true" href="#cb130-35" tabindex="-1"></a>       )</span>
<span id="cb130-36"><a aria-hidden="true" href="#cb130-36" tabindex="-1"></a>)</span>
<span id="cb130-37"><a aria-hidden="true" href="#cb130-37" tabindex="-1"></a>f.save(<span class="st">'../output/figures/bac_pathogens_table.svg'</span>)</span>
<span id="cb130-38"><a aria-hidden="true" href="#cb130-38" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<div>
<figure class="figure">
<p><img class="figure-img" height="2439" src="microbial_diversity_analysis_files/figure-html/cell-125-output-1.png" width="1089"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="155" id="cell-163">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a aria-hidden="true" href="#cb131-1" tabindex="-1"></a>fun_names <span class="op">=</span> (pd.concat([sample_fun_path, blank_species_df])</span>
<span id="cb131-2"><a aria-hidden="true" href="#cb131-2" tabindex="-1"></a> .pivot(index<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], columns<span class="op">=</span><span class="st">'sample_label'</span>, values<span class="op">=</span><span class="st">'relative_abundance'</span>)</span>
<span id="cb131-3"><a aria-hidden="true" href="#cb131-3" tabindex="-1"></a> .fillna(<span class="dv">0</span>)</span>
<span id="cb131-4"><a aria-hidden="true" href="#cb131-4" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb131-5"><a aria-hidden="true" href="#cb131-5" tabindex="-1"></a> .loc[<span class="kw">lambda</span> dd: dd.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">&gt;</span> <span class="fl">.0001</span>]</span>
<span id="cb131-6"><a aria-hidden="true" href="#cb131-6" tabindex="-1"></a> .reset_index()</span>
<span id="cb131-7"><a aria-hidden="true" href="#cb131-7" tabindex="-1"></a> .merge(fungi_pathogens_df)</span>
<span id="cb131-8"><a aria-hidden="true" href="#cb131-8" tabindex="-1"></a> .assign(total<span class="op">=</span><span class="kw">lambda</span> dd: dd[<span class="st">'Flight samples'</span>] <span class="op">+</span> dd[<span class="st">'Ground samples'</span>])</span>
<span id="cb131-9"><a aria-hidden="true" href="#cb131-9" tabindex="-1"></a> .sort_values(<span class="st">'total'</span>)</span>
<span id="cb131-10"><a aria-hidden="true" href="#cb131-10" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb131-11"><a aria-hidden="true" href="#cb131-11" tabindex="-1"></a> [<span class="st">'name'</span>]</span>
<span id="cb131-12"><a aria-hidden="true" href="#cb131-12" tabindex="-1"></a></span>
<span id="cb131-13"><a aria-hidden="true" href="#cb131-13" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="157" id="cell-164">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a aria-hidden="true" href="#cb132-1" tabindex="-1"></a>f <span class="op">=</span> (pd.concat([sample_fun_path, blank_species_df])</span>
<span id="cb132-2"><a aria-hidden="true" href="#cb132-2" tabindex="-1"></a> .pivot(index<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], columns<span class="op">=</span><span class="st">'sample_label'</span>, values<span class="op">=</span><span class="st">'relative_abundance'</span>)</span>
<span id="cb132-3"><a aria-hidden="true" href="#cb132-3" tabindex="-1"></a> .fillna(<span class="dv">0</span>)</span>
<span id="cb132-4"><a aria-hidden="true" href="#cb132-4" tabindex="-1"></a> .reset_index()</span>
<span id="cb132-5"><a aria-hidden="true" href="#cb132-5" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>], var_name<span class="op">=</span><span class="st">'sample_label'</span>, value_name<span class="op">=</span><span class="st">'relative_abundance'</span>)</span>
<span id="cb132-6"><a aria-hidden="true" href="#cb132-6" tabindex="-1"></a> .merge(fungi_pathogens_df)</span>
<span id="cb132-7"><a aria-hidden="true" href="#cb132-7" tabindex="-1"></a> .assign(Genus_short<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span>)</span>
<span id="cb132-8"><a aria-hidden="true" href="#cb132-8" tabindex="-1"></a> .assign(fullname<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus_short <span class="op">+</span> dd.Species)</span>
<span id="cb132-9"><a aria-hidden="true" href="#cb132-9" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))</span>
<span id="cb132-10"><a aria-hidden="true" href="#cb132-10" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.replace(<span class="st">'Samples'</span>, <span class="st">'samples'</span>))</span>
<span id="cb132-11"><a aria-hidden="true" href="#cb132-11" tabindex="-1"></a> .query(<span class="st">'fullname.isin(@fun_names)'</span>)</span>
<span id="cb132-12"><a aria-hidden="true" href="#cb132-12" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_label,</span>
<span id="cb132-13"><a aria-hidden="true" href="#cb132-13" tabindex="-1"></a>                      categories<span class="op">=</span>[<span class="st">'Flight</span><span class="ch">\n</span><span class="st">samples'</span>, <span class="st">'Ground</span><span class="ch">\n</span><span class="st">samples'</span>, <span class="st">'Flight</span><span class="ch">\n</span><span class="st">Blanks'</span>, <span class="st">'Ground</span><span class="ch">\n</span><span class="st">Blanks'</span>]))</span>
<span id="cb132-14"><a aria-hidden="true" href="#cb132-14" tabindex="-1"></a> .assign(fullname<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.fullname, categories<span class="op">=</span>fun_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb132-15"><a aria-hidden="true" href="#cb132-15" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb132-16"><a aria-hidden="true" href="#cb132-16" tabindex="-1"></a>    <span class="op">+</span> p9.aes(<span class="st">'fullname'</span>, <span class="st">'sample_label'</span>)</span>
<span id="cb132-17"><a aria-hidden="true" href="#cb132-17" tabindex="-1"></a>    <span class="op">+</span> p9.geom_tile(p9.aes(fill<span class="op">=</span><span class="st">'relative_abundance &gt; 0'</span>), color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb132-18"><a aria-hidden="true" href="#cb132-18" tabindex="-1"></a>    <span class="op">+</span> p9.coord_flip()</span>
<span id="cb132-19"><a aria-hidden="true" href="#cb132-19" tabindex="-1"></a>    <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'round(relative_abundance * 100, 3).astype(str) + "%"'</span>), size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb132-20"><a aria-hidden="true" href="#cb132-20" tabindex="-1"></a>    <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb132-21"><a aria-hidden="true" href="#cb132-21" tabindex="-1"></a>    <span class="op">+</span> p9.facet_wrap(<span class="st">'label'</span>, scales<span class="op">=</span><span class="st">'free_y'</span>, ncol<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb132-22"><a aria-hidden="true" href="#cb132-22" tabindex="-1"></a>    <span class="op">+</span> p9.scale_x_discrete(expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>), trans<span class="op">=</span><span class="st">'reverse'</span>)</span>
<span id="cb132-23"><a aria-hidden="true" href="#cb132-23" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb132-24"><a aria-hidden="true" href="#cb132-24" tabindex="-1"></a>    <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb132-25"><a aria-hidden="true" href="#cb132-25" tabindex="-1"></a>    <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">4.5</span>),</span>
<span id="cb132-26"><a aria-hidden="true" href="#cb132-26" tabindex="-1"></a>               axis_text_x<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb132-27"><a aria-hidden="true" href="#cb132-27" tabindex="-1"></a>               axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>, face<span class="op">=</span><span class="st">'italic'</span>),</span>
<span id="cb132-28"><a aria-hidden="true" href="#cb132-28" tabindex="-1"></a>               strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb132-29"><a aria-hidden="true" href="#cb132-29" tabindex="-1"></a>       )</span>
<span id="cb132-30"><a aria-hidden="true" href="#cb132-30" tabindex="-1"></a>)</span>
<span id="cb132-31"><a aria-hidden="true" href="#cb132-31" tabindex="-1"></a>)</span>
<span id="cb132-32"><a aria-hidden="true" href="#cb132-32" tabindex="-1"></a>f.save(<span class="st">'../output/figures/fun_pathogens_table.svg'</span>)</span>
<span id="cb132-33"><a aria-hidden="true" href="#cb132-33" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="157">
<div>
<figure class="figure">
<p><img class="figure-img" height="1374" src="microbial_diversity_analysis_files/figure-html/cell-127-output-1.png" width="1089"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="150" id="cell-165">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a aria-hidden="true" href="#cb133-1" tabindex="-1"></a>f <span class="op">=</span> (bac_df_sp</span>
<span id="cb133-2"><a aria-hidden="true" href="#cb133-2" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb133-3"><a aria-hidden="true" href="#cb133-3" tabindex="-1"></a> .merge(bac_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb133-4"><a aria-hidden="true" href="#cb133-4" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'label'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb133-5"><a aria-hidden="true" href="#cb133-5" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb133-6"><a aria-hidden="true" href="#cb133-6" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb133-7"><a aria-hidden="true" href="#cb133-7" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.name, categories<span class="op">=</span>bac_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb133-8"><a aria-hidden="true" href="#cb133-8" tabindex="-1"></a> .dropna()</span>
<span id="cb133-9"><a aria-hidden="true" href="#cb133-9" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb133-10"><a aria-hidden="true" href="#cb133-10" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb133-11"><a aria-hidden="true" href="#cb133-11" tabindex="-1"></a>      <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>,</span>
<span id="cb133-12"><a aria-hidden="true" href="#cb133-12" tabindex="-1"></a>               <span class="st">'name'</span>,</span>
<span id="cb133-13"><a aria-hidden="true" href="#cb133-13" tabindex="-1"></a>               size<span class="op">=</span><span class="st">'counts'</span>,</span>
<span id="cb133-14"><a aria-hidden="true" href="#cb133-14" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'sample_mode'</span>,</span>
<span id="cb133-15"><a aria-hidden="true" href="#cb133-15" tabindex="-1"></a>               fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb133-16"><a aria-hidden="true" href="#cb133-16" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>)</span>
<span id="cb133-17"><a aria-hidden="true" href="#cb133-17" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.015</span>, <span class="fl">.015</span>))</span>
<span id="cb133-18"><a aria-hidden="true" href="#cb133-18" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb133-19"><a aria-hidden="true" href="#cb133-19" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb133-20"><a aria-hidden="true" href="#cb133-20" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb133-21"><a aria-hidden="true" href="#cb133-21" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Total Reads'</span>, color<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb133-22"><a aria-hidden="true" href="#cb133-22" tabindex="-1"></a>                  )</span>
<span id="cb133-23"><a aria-hidden="true" href="#cb133-23" tabindex="-1"></a>      <span class="co">#  + p9.facet_wrap('label', ncol=1, scales='free_y')</span></span>
<span id="cb133-24"><a aria-hidden="true" href="#cb133-24" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">9.5</span>),</span>
<span id="cb133-25"><a aria-hidden="true" href="#cb133-25" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb133-26"><a aria-hidden="true" href="#cb133-26" tabindex="-1"></a>                  axis_text_y<span class="op">=</span>p9.element_blank(),</span>
<span id="cb133-27"><a aria-hidden="true" href="#cb133-27" tabindex="-1"></a>                  axis_ticks_y<span class="op">=</span>p9.element_blank(),</span>
<span id="cb133-28"><a aria-hidden="true" href="#cb133-28" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb133-29"><a aria-hidden="true" href="#cb133-29" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb133-30"><a aria-hidden="true" href="#cb133-30" tabindex="-1"></a>                  legend_direction<span class="op">=</span><span class="st">'horizontal'</span>,</span>
<span id="cb133-31"><a aria-hidden="true" href="#cb133-31" tabindex="-1"></a>       </span>
<span id="cb133-32"><a aria-hidden="true" href="#cb133-32" tabindex="-1"></a>       )</span>
<span id="cb133-33"><a aria-hidden="true" href="#cb133-33" tabindex="-1"></a> )</span>
<span id="cb133-34"><a aria-hidden="true" href="#cb133-34" tabindex="-1"></a>)</span>
<span id="cb133-35"><a aria-hidden="true" href="#cb133-35" tabindex="-1"></a>f.save(<span class="st">'../output/figures/bac_pathogens_samples.svg'</span>)</span>
<span id="cb133-36"><a aria-hidden="true" href="#cb133-36" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<div>
<figure class="figure">
<p><img class="figure-img" height="2888" src="microbial_diversity_analysis_files/figure-html/cell-128-output-1.png" width="1112"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-166">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a aria-hidden="true" href="#cb134-1" tabindex="-1"></a>f <span class="op">=</span> (fun_df_sp</span>
<span id="cb134-2"><a aria-hidden="true" href="#cb134-2" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb134-3"><a aria-hidden="true" href="#cb134-3" tabindex="-1"></a> .merge(fungi_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb134-4"><a aria-hidden="true" href="#cb134-4" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'label'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb134-5"><a aria-hidden="true" href="#cb134-5" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb134-6"><a aria-hidden="true" href="#cb134-6" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb134-7"><a aria-hidden="true" href="#cb134-7" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.name, categories<span class="op">=</span>fun_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb134-8"><a aria-hidden="true" href="#cb134-8" tabindex="-1"></a>  .dropna()</span>
<span id="cb134-9"><a aria-hidden="true" href="#cb134-9" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb134-10"><a aria-hidden="true" href="#cb134-10" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb134-11"><a aria-hidden="true" href="#cb134-11" tabindex="-1"></a>      <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>,</span>
<span id="cb134-12"><a aria-hidden="true" href="#cb134-12" tabindex="-1"></a>               <span class="st">'name'</span>,</span>
<span id="cb134-13"><a aria-hidden="true" href="#cb134-13" tabindex="-1"></a>               size<span class="op">=</span><span class="st">'counts'</span>,</span>
<span id="cb134-14"><a aria-hidden="true" href="#cb134-14" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'sample_mode'</span>,</span>
<span id="cb134-15"><a aria-hidden="true" href="#cb134-15" tabindex="-1"></a>               fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb134-16"><a aria-hidden="true" href="#cb134-16" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>)</span>
<span id="cb134-17"><a aria-hidden="true" href="#cb134-17" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb134-18"><a aria-hidden="true" href="#cb134-18" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb134-19"><a aria-hidden="true" href="#cb134-19" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb134-20"><a aria-hidden="true" href="#cb134-20" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb134-21"><a aria-hidden="true" href="#cb134-21" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Total Reads'</span>, color<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb134-22"><a aria-hidden="true" href="#cb134-22" tabindex="-1"></a>                  )</span>
<span id="cb134-23"><a aria-hidden="true" href="#cb134-23" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'label'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb134-24"><a aria-hidden="true" href="#cb134-24" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="fl">4.5</span>),</span>
<span id="cb134-25"><a aria-hidden="true" href="#cb134-25" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb134-26"><a aria-hidden="true" href="#cb134-26" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb134-27"><a aria-hidden="true" href="#cb134-27" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb134-28"><a aria-hidden="true" href="#cb134-28" tabindex="-1"></a>       </span>
<span id="cb134-29"><a aria-hidden="true" href="#cb134-29" tabindex="-1"></a>       )</span>
<span id="cb134-30"><a aria-hidden="true" href="#cb134-30" tabindex="-1"></a> )</span>
<span id="cb134-31"><a aria-hidden="true" href="#cb134-31" tabindex="-1"></a>)</span>
<span id="cb134-32"><a aria-hidden="true" href="#cb134-32" tabindex="-1"></a></span>
<span id="cb134-33"><a aria-hidden="true" href="#cb134-33" tabindex="-1"></a>f.save(<span class="st">'../output/figures/fun_pathogens_samples.svg'</span>)</span>
<span id="cb134-34"><a aria-hidden="true" href="#cb134-34" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1569">
<div>
<figure class="figure">
<p><img class="figure-img" height="1350" src="microbial_diversity_analysis_files/figure-html/cell-129-output-1.png" width="1800"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-167">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a aria-hidden="true" href="#cb135-1" tabindex="-1"></a>fun_names <span class="op">=</span> (fun_df_sp</span>
<span id="cb135-2"><a aria-hidden="true" href="#cb135-2" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb135-3"><a aria-hidden="true" href="#cb135-3" tabindex="-1"></a> .merge(fungi_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb135-4"><a aria-hidden="true" href="#cb135-4" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb135-5"><a aria-hidden="true" href="#cb135-5" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb135-6"><a aria-hidden="true" href="#cb135-6" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb135-7"><a aria-hidden="true" href="#cb135-7" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="st">'Fungal Human Pathogens'</span>)</span>
<span id="cb135-8"><a aria-hidden="true" href="#cb135-8" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb135-9"><a aria-hidden="true" href="#cb135-9" tabindex="-1"></a> .query(<span class="st">'sample_mode == "Flight"'</span>)</span>
<span id="cb135-10"><a aria-hidden="true" href="#cb135-10" tabindex="-1"></a> .groupby(<span class="st">'name'</span>)</span>
<span id="cb135-11"><a aria-hidden="true" href="#cb135-11" tabindex="-1"></a> [<span class="st">'counts'</span>]</span>
<span id="cb135-12"><a aria-hidden="true" href="#cb135-12" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb135-13"><a aria-hidden="true" href="#cb135-13" tabindex="-1"></a> .sort_values()</span>
<span id="cb135-14"><a aria-hidden="true" href="#cb135-14" tabindex="-1"></a> .index</span>
<span id="cb135-15"><a aria-hidden="true" href="#cb135-15" tabindex="-1"></a> .values</span>
<span id="cb135-16"><a aria-hidden="true" href="#cb135-16" tabindex="-1"></a>)</span>
<span id="cb135-17"><a aria-hidden="true" href="#cb135-17" tabindex="-1"></a></span>
<span id="cb135-18"><a aria-hidden="true" href="#cb135-18" tabindex="-1"></a>bac_path_names <span class="op">=</span> (bac_df_sp</span>
<span id="cb135-19"><a aria-hidden="true" href="#cb135-19" tabindex="-1"></a>    .merge(bac_pathogens_df</span>
<span id="cb135-20"><a aria-hidden="true" href="#cb135-20" tabindex="-1"></a>           .query(<span class="st">'label == "Bacterial Human Pathogens"'</span>),</span>
<span id="cb135-21"><a aria-hidden="true" href="#cb135-21" tabindex="-1"></a>           on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb135-22"><a aria-hidden="true" href="#cb135-22" tabindex="-1"></a>    .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'.'</span>)</span>
<span id="cb135-23"><a aria-hidden="true" href="#cb135-23" tabindex="-1"></a>    .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>] <span class="op">+</span> [<span class="st">'label'</span>])</span>
<span id="cb135-24"><a aria-hidden="true" href="#cb135-24" tabindex="-1"></a>    .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb135-25"><a aria-hidden="true" href="#cb135-25" tabindex="-1"></a>    .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb135-26"><a aria-hidden="true" href="#cb135-26" tabindex="-1"></a>    .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb135-27"><a aria-hidden="true" href="#cb135-27" tabindex="-1"></a>    .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb135-28"><a aria-hidden="true" href="#cb135-28" tabindex="-1"></a>    .query(<span class="st">'sample_mode == "Flight"'</span>)</span>
<span id="cb135-29"><a aria-hidden="true" href="#cb135-29" tabindex="-1"></a>    .groupby(<span class="st">'name'</span>)</span>
<span id="cb135-30"><a aria-hidden="true" href="#cb135-30" tabindex="-1"></a>    .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb135-31"><a aria-hidden="true" href="#cb135-31" tabindex="-1"></a>    .sort_values(<span class="st">'counts'</span>)</span>
<span id="cb135-32"><a aria-hidden="true" href="#cb135-32" tabindex="-1"></a>    .index.values</span>
<span id="cb135-33"><a aria-hidden="true" href="#cb135-33" tabindex="-1"></a>)</span>
<span id="cb135-34"><a aria-hidden="true" href="#cb135-34" tabindex="-1"></a></span>
<span id="cb135-35"><a aria-hidden="true" href="#cb135-35" tabindex="-1"></a>bac_opp_path_names <span class="op">=</span> (bac_df_sp</span>
<span id="cb135-36"><a aria-hidden="true" href="#cb135-36" tabindex="-1"></a>    .merge(bac_pathogens_df</span>
<span id="cb135-37"><a aria-hidden="true" href="#cb135-37" tabindex="-1"></a>           .query(<span class="st">'label == "Bacterial Opportunistic Human Pathogens"'</span>),</span>
<span id="cb135-38"><a aria-hidden="true" href="#cb135-38" tabindex="-1"></a>           on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb135-39"><a aria-hidden="true" href="#cb135-39" tabindex="-1"></a>    .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'.'</span>)</span>
<span id="cb135-40"><a aria-hidden="true" href="#cb135-40" tabindex="-1"></a>    .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>] <span class="op">+</span> [<span class="st">'label'</span>])</span>
<span id="cb135-41"><a aria-hidden="true" href="#cb135-41" tabindex="-1"></a>    .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb135-42"><a aria-hidden="true" href="#cb135-42" tabindex="-1"></a>    .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb135-43"><a aria-hidden="true" href="#cb135-43" tabindex="-1"></a>    .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb135-44"><a aria-hidden="true" href="#cb135-44" tabindex="-1"></a>    .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb135-45"><a aria-hidden="true" href="#cb135-45" tabindex="-1"></a>    .query(<span class="st">'sample_mode == "Flight"'</span>)</span>
<span id="cb135-46"><a aria-hidden="true" href="#cb135-46" tabindex="-1"></a>    .groupby(<span class="st">'name'</span>)</span>
<span id="cb135-47"><a aria-hidden="true" href="#cb135-47" tabindex="-1"></a>    .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb135-48"><a aria-hidden="true" href="#cb135-48" tabindex="-1"></a>    .sort_values(<span class="st">'counts'</span>)</span>
<span id="cb135-49"><a aria-hidden="true" href="#cb135-49" tabindex="-1"></a>    .index.values</span>
<span id="cb135-50"><a aria-hidden="true" href="#cb135-50" tabindex="-1"></a>)</span>
<span id="cb135-51"><a aria-hidden="true" href="#cb135-51" tabindex="-1"></a></span>
<span id="cb135-52"><a aria-hidden="true" href="#cb135-52" tabindex="-1"></a>extra_opp <span class="op">=</span> (bac_pathogens_df</span>
<span id="cb135-53"><a aria-hidden="true" href="#cb135-53" tabindex="-1"></a>.query(<span class="st">'label == "Bacterial Opportunistic Human Pathogens"'</span>)</span>
<span id="cb135-54"><a aria-hidden="true" href="#cb135-54" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb135-55"><a aria-hidden="true" href="#cb135-55" tabindex="-1"></a>.query(<span class="st">'name not in @bac_opp_path_names'</span>)</span>
<span id="cb135-56"><a aria-hidden="true" href="#cb135-56" tabindex="-1"></a>.merge(bac_df_sp, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb135-57"><a aria-hidden="true" href="#cb135-57" tabindex="-1"></a>.drop(columns<span class="op">=</span>taxon_names <span class="op">+</span> [<span class="st">'label'</span>])</span>
<span id="cb135-58"><a aria-hidden="true" href="#cb135-58" tabindex="-1"></a>.melt([<span class="st">'name'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb135-59"><a aria-hidden="true" href="#cb135-59" tabindex="-1"></a>.groupby(<span class="st">'name'</span>)</span>
<span id="cb135-60"><a aria-hidden="true" href="#cb135-60" tabindex="-1"></a>.aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb135-61"><a aria-hidden="true" href="#cb135-61" tabindex="-1"></a>.sort_values(<span class="st">'counts'</span>)</span>
<span id="cb135-62"><a aria-hidden="true" href="#cb135-62" tabindex="-1"></a>.index.values</span>
<span id="cb135-63"><a aria-hidden="true" href="#cb135-63" tabindex="-1"></a>)</span>
<span id="cb135-64"><a aria-hidden="true" href="#cb135-64" tabindex="-1"></a></span>
<span id="cb135-65"><a aria-hidden="true" href="#cb135-65" tabindex="-1"></a>extra_fun <span class="op">=</span> (fungi_pathogens_df</span>
<span id="cb135-66"><a aria-hidden="true" href="#cb135-66" tabindex="-1"></a>.assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb135-67"><a aria-hidden="true" href="#cb135-67" tabindex="-1"></a>.query(<span class="st">'name not in @fun_names'</span>)</span>
<span id="cb135-68"><a aria-hidden="true" href="#cb135-68" tabindex="-1"></a>.merge(fun_df_sp, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb135-69"><a aria-hidden="true" href="#cb135-69" tabindex="-1"></a>.drop(columns<span class="op">=</span>taxon_names)</span>
<span id="cb135-70"><a aria-hidden="true" href="#cb135-70" tabindex="-1"></a>.melt([<span class="st">'name'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb135-71"><a aria-hidden="true" href="#cb135-71" tabindex="-1"></a>.groupby(<span class="st">'name'</span>)</span>
<span id="cb135-72"><a aria-hidden="true" href="#cb135-72" tabindex="-1"></a>.aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb135-73"><a aria-hidden="true" href="#cb135-73" tabindex="-1"></a>.sort_values(<span class="st">'counts'</span>)</span>
<span id="cb135-74"><a aria-hidden="true" href="#cb135-74" tabindex="-1"></a>.index.values</span>
<span id="cb135-75"><a aria-hidden="true" href="#cb135-75" tabindex="-1"></a>)</span>
<span id="cb135-76"><a aria-hidden="true" href="#cb135-76" tabindex="-1"></a></span>
<span id="cb135-77"><a aria-hidden="true" href="#cb135-77" tabindex="-1"></a>bac_opp_path_names <span class="op">=</span> np.concatenate([extra_opp, bac_opp_path_names])</span>
<span id="cb135-78"><a aria-hidden="true" href="#cb135-78" tabindex="-1"></a>fun_names <span class="op">=</span> np.concatenate([extra_fun, fun_names])</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-168">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a aria-hidden="true" href="#cb136-1" tabindex="-1"></a>fun_names <span class="op">=</span> (fun_df_sp</span>
<span id="cb136-2"><a aria-hidden="true" href="#cb136-2" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb136-3"><a aria-hidden="true" href="#cb136-3" tabindex="-1"></a> .merge(fungi_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb136-4"><a aria-hidden="true" href="#cb136-4" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'label'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb136-5"><a aria-hidden="true" href="#cb136-5" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'Species'</span>])</span>
<span id="cb136-6"><a aria-hidden="true" href="#cb136-6" tabindex="-1"></a> .counts</span>
<span id="cb136-7"><a aria-hidden="true" href="#cb136-7" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb136-8"><a aria-hidden="true" href="#cb136-8" tabindex="-1"></a> .sort_values()</span>
<span id="cb136-9"><a aria-hidden="true" href="#cb136-9" tabindex="-1"></a> .reset_index()</span>
<span id="cb136-10"><a aria-hidden="true" href="#cb136-10" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb136-11"><a aria-hidden="true" href="#cb136-11" tabindex="-1"></a> .name</span>
<span id="cb136-12"><a aria-hidden="true" href="#cb136-12" tabindex="-1"></a>)</span>
<span id="cb136-13"><a aria-hidden="true" href="#cb136-13" tabindex="-1"></a>(fun_df_sp</span>
<span id="cb136-14"><a aria-hidden="true" href="#cb136-14" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb136-15"><a aria-hidden="true" href="#cb136-15" tabindex="-1"></a> .merge(fungi_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb136-16"><a aria-hidden="true" href="#cb136-16" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'label'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb136-17"><a aria-hidden="true" href="#cb136-17" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb136-18"><a aria-hidden="true" href="#cb136-18" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb136-19"><a aria-hidden="true" href="#cb136-19" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.name, categories<span class="op">=</span>fun_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb136-20"><a aria-hidden="true" href="#cb136-20" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb136-21"><a aria-hidden="true" href="#cb136-21" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb136-22"><a aria-hidden="true" href="#cb136-22" tabindex="-1"></a>      <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>,</span>
<span id="cb136-23"><a aria-hidden="true" href="#cb136-23" tabindex="-1"></a>               <span class="st">'name'</span>,</span>
<span id="cb136-24"><a aria-hidden="true" href="#cb136-24" tabindex="-1"></a>               size<span class="op">=</span><span class="st">'counts'</span>,</span>
<span id="cb136-25"><a aria-hidden="true" href="#cb136-25" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'sample_mode'</span>,</span>
<span id="cb136-26"><a aria-hidden="true" href="#cb136-26" tabindex="-1"></a>               fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb136-27"><a aria-hidden="true" href="#cb136-27" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>)</span>
<span id="cb136-28"><a aria-hidden="true" href="#cb136-28" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb136-29"><a aria-hidden="true" href="#cb136-29" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb136-30"><a aria-hidden="true" href="#cb136-30" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb136-31"><a aria-hidden="true" href="#cb136-31" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb136-32"><a aria-hidden="true" href="#cb136-32" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Total Reads'</span>, color<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb136-33"><a aria-hidden="true" href="#cb136-33" tabindex="-1"></a>                  )</span>
<span id="cb136-34"><a aria-hidden="true" href="#cb136-34" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'label'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb136-35"><a aria-hidden="true" href="#cb136-35" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="fl">4.5</span>),</span>
<span id="cb136-36"><a aria-hidden="true" href="#cb136-36" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb136-37"><a aria-hidden="true" href="#cb136-37" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb136-38"><a aria-hidden="true" href="#cb136-38" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb136-39"><a aria-hidden="true" href="#cb136-39" tabindex="-1"></a>       </span>
<span id="cb136-40"><a aria-hidden="true" href="#cb136-40" tabindex="-1"></a>       )</span>
<span id="cb136-41"><a aria-hidden="true" href="#cb136-41" tabindex="-1"></a> )</span>
<span id="cb136-42"><a aria-hidden="true" href="#cb136-42" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1350" src="microbial_diversity_analysis_files/figure-html/cell-131-output-1.png" width="1800"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-169">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a aria-hidden="true" href="#cb137-1" tabindex="-1"></a>bac_names <span class="op">=</span> (bac_df_sp</span>
<span id="cb137-2"><a aria-hidden="true" href="#cb137-2" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb137-3"><a aria-hidden="true" href="#cb137-3" tabindex="-1"></a> .merge(bac_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb137-4"><a aria-hidden="true" href="#cb137-4" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'label'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb137-5"><a aria-hidden="true" href="#cb137-5" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'Species'</span>])</span>
<span id="cb137-6"><a aria-hidden="true" href="#cb137-6" tabindex="-1"></a> .counts</span>
<span id="cb137-7"><a aria-hidden="true" href="#cb137-7" tabindex="-1"></a> .<span class="bu">sum</span>()</span>
<span id="cb137-8"><a aria-hidden="true" href="#cb137-8" tabindex="-1"></a> .sort_values()</span>
<span id="cb137-9"><a aria-hidden="true" href="#cb137-9" tabindex="-1"></a> .reset_index()</span>
<span id="cb137-10"><a aria-hidden="true" href="#cb137-10" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb137-11"><a aria-hidden="true" href="#cb137-11" tabindex="-1"></a> .name</span>
<span id="cb137-12"><a aria-hidden="true" href="#cb137-12" tabindex="-1"></a>)</span>
<span id="cb137-13"><a aria-hidden="true" href="#cb137-13" tabindex="-1"></a></span>
<span id="cb137-14"><a aria-hidden="true" href="#cb137-14" tabindex="-1"></a>(bac_df_sp</span>
<span id="cb137-15"><a aria-hidden="true" href="#cb137-15" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb137-16"><a aria-hidden="true" href="#cb137-16" tabindex="-1"></a> .merge(bac_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb137-17"><a aria-hidden="true" href="#cb137-17" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'label'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb137-18"><a aria-hidden="true" href="#cb137-18" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb137-19"><a aria-hidden="true" href="#cb137-19" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb137-20"><a aria-hidden="true" href="#cb137-20" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.name, categories<span class="op">=</span>bac_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb137-21"><a aria-hidden="true" href="#cb137-21" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb137-22"><a aria-hidden="true" href="#cb137-22" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb137-23"><a aria-hidden="true" href="#cb137-23" tabindex="-1"></a>      <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>,</span>
<span id="cb137-24"><a aria-hidden="true" href="#cb137-24" tabindex="-1"></a>               <span class="st">'name'</span>,</span>
<span id="cb137-25"><a aria-hidden="true" href="#cb137-25" tabindex="-1"></a>               size<span class="op">=</span><span class="st">'counts'</span>,</span>
<span id="cb137-26"><a aria-hidden="true" href="#cb137-26" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'sample_mode'</span>,</span>
<span id="cb137-27"><a aria-hidden="true" href="#cb137-27" tabindex="-1"></a>               fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb137-28"><a aria-hidden="true" href="#cb137-28" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>)</span>
<span id="cb137-29"><a aria-hidden="true" href="#cb137-29" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.01</span>, <span class="fl">.01</span>))</span>
<span id="cb137-30"><a aria-hidden="true" href="#cb137-30" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb137-31"><a aria-hidden="true" href="#cb137-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb137-32"><a aria-hidden="true" href="#cb137-32" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb137-33"><a aria-hidden="true" href="#cb137-33" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Total Reads'</span>, color<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb137-34"><a aria-hidden="true" href="#cb137-34" tabindex="-1"></a>                  )</span>
<span id="cb137-35"><a aria-hidden="true" href="#cb137-35" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'label'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb137-36"><a aria-hidden="true" href="#cb137-36" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">9</span>),</span>
<span id="cb137-37"><a aria-hidden="true" href="#cb137-37" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb137-38"><a aria-hidden="true" href="#cb137-38" tabindex="-1"></a>                  axis_text_y<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb137-39"><a aria-hidden="true" href="#cb137-39" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb137-40"><a aria-hidden="true" href="#cb137-40" tabindex="-1"></a>       </span>
<span id="cb137-41"><a aria-hidden="true" href="#cb137-41" tabindex="-1"></a>       )</span>
<span id="cb137-42"><a aria-hidden="true" href="#cb137-42" tabindex="-1"></a> )</span>
<span id="cb137-43"><a aria-hidden="true" href="#cb137-43" tabindex="-1"></a>)</span>
<span id="cb137-44"><a aria-hidden="true" href="#cb137-44" tabindex="-1"></a></span>
<span id="cb137-45"><a aria-hidden="true" href="#cb137-45" tabindex="-1"></a>(fun_df_sp</span>
<span id="cb137-46"><a aria-hidden="true" href="#cb137-46" tabindex="-1"></a> .drop(columns<span class="op">=</span>taxon_names[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb137-47"><a aria-hidden="true" href="#cb137-47" tabindex="-1"></a> .merge(fungi_pathogens_df, on<span class="op">=</span>[<span class="st">'Genus'</span>, <span class="st">'Species'</span>], how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb137-48"><a aria-hidden="true" href="#cb137-48" tabindex="-1"></a> .melt([<span class="st">'Genus'</span>, <span class="st">'Species'</span>, <span class="st">'label'</span>], var_name<span class="op">=</span><span class="st">'sample_id'</span>, value_name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb137-49"><a aria-hidden="true" href="#cb137-49" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb137-50"><a aria-hidden="true" href="#cb137-50" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: dd.Genus.<span class="bu">str</span>[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'. '</span> <span class="op">+</span> dd.Species)</span>
<span id="cb137-51"><a aria-hidden="true" href="#cb137-51" tabindex="-1"></a> .assign(name<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.name, categories<span class="op">=</span>fun_names, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb137-52"><a aria-hidden="true" href="#cb137-52" tabindex="-1"></a> .query(<span class="st">'counts &gt; 0'</span>)</span>
<span id="cb137-53"><a aria-hidden="true" href="#cb137-53" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb137-54"><a aria-hidden="true" href="#cb137-54" tabindex="-1"></a>      <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>,</span>
<span id="cb137-55"><a aria-hidden="true" href="#cb137-55" tabindex="-1"></a>               <span class="st">'name'</span>,</span>
<span id="cb137-56"><a aria-hidden="true" href="#cb137-56" tabindex="-1"></a>               size<span class="op">=</span><span class="st">'counts'</span>,</span>
<span id="cb137-57"><a aria-hidden="true" href="#cb137-57" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'sample_mode'</span>,</span>
<span id="cb137-58"><a aria-hidden="true" href="#cb137-58" tabindex="-1"></a>               fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb137-59"><a aria-hidden="true" href="#cb137-59" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>)</span>
<span id="cb137-60"><a aria-hidden="true" href="#cb137-60" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb137-61"><a aria-hidden="true" href="#cb137-61" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb137-62"><a aria-hidden="true" href="#cb137-62" tabindex="-1"></a>       <span class="op">+</span> p9.scale_color_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb137-63"><a aria-hidden="true" href="#cb137-63" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb137-64"><a aria-hidden="true" href="#cb137-64" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Total Reads'</span>, color<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb137-65"><a aria-hidden="true" href="#cb137-65" tabindex="-1"></a>                  )</span>
<span id="cb137-66"><a aria-hidden="true" href="#cb137-66" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'label'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales<span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb137-67"><a aria-hidden="true" href="#cb137-67" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="fl">4.5</span>),</span>
<span id="cb137-68"><a aria-hidden="true" href="#cb137-68" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb137-69"><a aria-hidden="true" href="#cb137-69" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb137-70"><a aria-hidden="true" href="#cb137-70" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb137-71"><a aria-hidden="true" href="#cb137-71" tabindex="-1"></a>       </span>
<span id="cb137-72"><a aria-hidden="true" href="#cb137-72" tabindex="-1"></a>       )</span>
<span id="cb137-73"><a aria-hidden="true" href="#cb137-73" tabindex="-1"></a> )</span>
<span id="cb137-74"><a aria-hidden="true" href="#cb137-74" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2700" src="microbial_diversity_analysis_files/figure-html/cell-132-output-1.png" width="1800"/></p>
</figure>
</div>
</div>
</div>
</section>
<section class="level3" id="re-sequencing-nov23">
<h3 class="anchored" data-anchor-id="re-sequencing-nov23">Re-sequencing Novâ€™23</h3>
<div class="cell" id="cell-171">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a aria-hidden="true" href="#cb138-1" tabindex="-1"></a>individual_blanks <span class="op">=</span> [<span class="ss">f'B</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">22</span>)]</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-172">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a aria-hidden="true" href="#cb139-1" tabindex="-1"></a>top_genera_bac <span class="op">=</span> (full_genera_df</span>
<span id="cb139-2"><a aria-hidden="true" href="#cb139-2" tabindex="-1"></a>                .query(<span class="st">'Kingdom == "Bacteria"'</span>)</span>
<span id="cb139-3"><a aria-hidden="true" href="#cb139-3" tabindex="-1"></a>                .query(<span class="st">'Genus != "unknown"'</span>)</span>
<span id="cb139-4"><a aria-hidden="true" href="#cb139-4" tabindex="-1"></a>                .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb139-5"><a aria-hidden="true" href="#cb139-5" tabindex="-1"></a>                .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb139-6"><a aria-hidden="true" href="#cb139-6" tabindex="-1"></a>                .sort_values(<span class="st">'counts'</span>)</span>
<span id="cb139-7"><a aria-hidden="true" href="#cb139-7" tabindex="-1"></a>                .tail(<span class="dv">20</span>)</span>
<span id="cb139-8"><a aria-hidden="true" href="#cb139-8" tabindex="-1"></a>                .index</span>
<span id="cb139-9"><a aria-hidden="true" href="#cb139-9" tabindex="-1"></a>                .values</span>
<span id="cb139-10"><a aria-hidden="true" href="#cb139-10" tabindex="-1"></a>)</span>
<span id="cb139-11"><a aria-hidden="true" href="#cb139-11" tabindex="-1"></a></span>
<span id="cb139-12"><a aria-hidden="true" href="#cb139-12" tabindex="-1"></a>top_genera_fun <span class="op">=</span> (full_genera_df</span>
<span id="cb139-13"><a aria-hidden="true" href="#cb139-13" tabindex="-1"></a>              .query(<span class="st">'Kingdom == "Fungi"'</span>)</span>
<span id="cb139-14"><a aria-hidden="true" href="#cb139-14" tabindex="-1"></a>              .query(<span class="st">'Genus != "unknown"'</span>)</span>
<span id="cb139-15"><a aria-hidden="true" href="#cb139-15" tabindex="-1"></a>              .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb139-16"><a aria-hidden="true" href="#cb139-16" tabindex="-1"></a>              .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb139-17"><a aria-hidden="true" href="#cb139-17" tabindex="-1"></a>              .sort_values(<span class="st">'counts'</span>)</span>
<span id="cb139-18"><a aria-hidden="true" href="#cb139-18" tabindex="-1"></a>              .tail(<span class="dv">20</span>)</span>
<span id="cb139-19"><a aria-hidden="true" href="#cb139-19" tabindex="-1"></a>              .index</span>
<span id="cb139-20"><a aria-hidden="true" href="#cb139-20" tabindex="-1"></a>              .values</span>
<span id="cb139-21"><a aria-hidden="true" href="#cb139-21" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-173">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a aria-hidden="true" href="#cb140-1" tabindex="-1"></a>new_labels_bac <span class="op">=</span> np.concatenate([</span>
<span id="cb140-2"><a aria-hidden="true" href="#cb140-2" tabindex="-1"></a>    np.sort(np.concatenate([top_genera_bac, [<span class="st">'Other'</span>]])),</span>
<span id="cb140-3"><a aria-hidden="true" href="#cb140-3" tabindex="-1"></a>    [<span class="st">'Unknown'</span>]</span>
<span id="cb140-4"><a aria-hidden="true" href="#cb140-4" tabindex="-1"></a>    ])</span>
<span id="cb140-5"><a aria-hidden="true" href="#cb140-5" tabindex="-1"></a></span>
<span id="cb140-6"><a aria-hidden="true" href="#cb140-6" tabindex="-1"></a>new_labels_fun <span class="op">=</span> np.concatenate([</span>
<span id="cb140-7"><a aria-hidden="true" href="#cb140-7" tabindex="-1"></a>    np.sort(np.concatenate([top_genera_fun, [<span class="st">'Other'</span>]])),</span>
<span id="cb140-8"><a aria-hidden="true" href="#cb140-8" tabindex="-1"></a>    [<span class="st">'Unknown'</span>]</span>
<span id="cb140-9"><a aria-hidden="true" href="#cb140-9" tabindex="-1"></a>    ])</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-174">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a aria-hidden="true" href="#cb141-1" tabindex="-1"></a>sample_map[<span class="st">'B_Flight'</span>] <span class="op">=</span> <span class="st">'Flight'</span></span>
<span id="cb141-2"><a aria-hidden="true" href="#cb141-2" tabindex="-1"></a>sample_map[<span class="st">'B_Ground'</span>] <span class="op">=</span> <span class="st">'Ground'</span></span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-176">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a aria-hidden="true" href="#cb142-1" tabindex="-1"></a>(full_genera_df</span>
<span id="cb142-2"><a aria-hidden="true" href="#cb142-2" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Bacteria"'</span>)</span>
<span id="cb142-3"><a aria-hidden="true" href="#cb142-3" tabindex="-1"></a> .replace({<span class="st">'unknown'</span>, np.nan})</span>
<span id="cb142-4"><a aria-hidden="true" href="#cb142-4" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.Genus.isin(top_genera_bac) <span class="op">|</span> dd.Genus.isna(), dd.Genus, <span class="st">'Other'</span>))</span>
<span id="cb142-5"><a aria-hidden="true" href="#cb142-5" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb142-6"><a aria-hidden="true" href="#cb142-6" tabindex="-1"></a>    .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb142-7"><a aria-hidden="true" href="#cb142-7" tabindex="-1"></a> .groupby(<span class="st">'sample_id'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb142-8"><a aria-hidden="true" href="#cb142-8" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb142-9"><a aria-hidden="true" href="#cb142-9" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb142-10"><a aria-hidden="true" href="#cb142-10" tabindex="-1"></a> .melt([<span class="st">'sample_id'</span>, <span class="st">'Genus'</span>], var_name<span class="op">=</span><span class="st">'metric'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb142-11"><a aria-hidden="true" href="#cb142-11" tabindex="-1"></a> .replace({<span class="st">'counts'</span>: <span class="st">'Number of Reads'</span>,</span>
<span id="cb142-12"><a aria-hidden="true" href="#cb142-12" tabindex="-1"></a>           <span class="st">'relative_abundance'</span>: <span class="st">'Relative Abundance'</span>})</span>
<span id="cb142-13"><a aria-hidden="true" href="#cb142-13" tabindex="-1"></a> .query(<span class="st">'sample_id != "S06"'</span>)</span>
<span id="cb142-14"><a aria-hidden="true" href="#cb142-14" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb142-15"><a aria-hidden="true" href="#cb142-15" tabindex="-1"></a> .replace({<span class="st">'B_Flight'</span>: <span class="st">'Blanks Pool'</span>,</span>
<span id="cb142-16"><a aria-hidden="true" href="#cb142-16" tabindex="-1"></a>           <span class="st">'B_Ground'</span>: <span class="st">'Blanks Pool'</span>})</span>
<span id="cb142-17"><a aria-hidden="true" href="#cb142-17" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">('</span> <span class="op">+</span> dd.sample_mode <span class="op">+</span> <span class="st">')'</span>)</span>
<span id="cb142-18"><a aria-hidden="true" href="#cb142-18" tabindex="-1"></a> </span>
<span id="cb142-19"><a aria-hidden="true" href="#cb142-19" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: </span>
<span id="cb142-20"><a aria-hidden="true" href="#cb142-20" tabindex="-1"></a>       p9.ggplot(dd) </span>
<span id="cb142-21"><a aria-hidden="true" href="#cb142-21" tabindex="-1"></a>     <span class="op">+</span> p9.aes(<span class="st">'sample_label'</span>, <span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'Genus'</span>)</span>
<span id="cb142-22"><a aria-hidden="true" href="#cb142-22" tabindex="-1"></a>     <span class="op">+</span> p9.geom_col()</span>
<span id="cb142-23"><a aria-hidden="true" href="#cb142-23" tabindex="-1"></a>     <span class="op">+</span> p9.coord_flip()</span>
<span id="cb142-24"><a aria-hidden="true" href="#cb142-24" tabindex="-1"></a>     <span class="op">+</span> p9.facet_wrap(<span class="st">'metric'</span>, scales<span class="op">=</span><span class="st">'free_x'</span>)</span>
<span id="cb142-25"><a aria-hidden="true" href="#cb142-25" tabindex="-1"></a>     <span class="op">+</span> p9.guides(fill<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">4</span>))</span>
<span id="cb142-26"><a aria-hidden="true" href="#cb142-26" tabindex="-1"></a>     <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb142-27"><a aria-hidden="true" href="#cb142-27" tabindex="-1"></a>     <span class="op">+</span> p9.scale_y_continuous(expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb142-28"><a aria-hidden="true" href="#cb142-28" tabindex="-1"></a>     <span class="op">+</span> p9.scale_fill_discrete(labels<span class="op">=</span><span class="bu">list</span>(new_labels_bac))</span>
<span id="cb142-29"><a aria-hidden="true" href="#cb142-29" tabindex="-1"></a>     <span class="op">+</span> p9.theme(</span>
<span id="cb142-30"><a aria-hidden="true" href="#cb142-30" tabindex="-1"></a>         figure_size<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">8</span>),</span>
<span id="cb142-31"><a aria-hidden="true" href="#cb142-31" tabindex="-1"></a>         axis_text_y<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>, x<span class="op">=-</span><span class="fl">.1</span>),</span>
<span id="cb142-32"><a aria-hidden="true" href="#cb142-32" tabindex="-1"></a>         legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb142-33"><a aria-hidden="true" href="#cb142-33" tabindex="-1"></a>         legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb142-34"><a aria-hidden="true" href="#cb142-34" tabindex="-1"></a>         legend_position<span class="op">=</span><span class="st">'bottom'</span></span>
<span id="cb142-35"><a aria-hidden="true" href="#cb142-35" tabindex="-1"></a>         )</span>
<span id="cb142-36"><a aria-hidden="true" href="#cb142-36" tabindex="-1"></a>     )</span>
<span id="cb142-37"><a aria-hidden="true" href="#cb142-37" tabindex="-1"></a>)</span>
<span id="cb142-38"><a aria-hidden="true" href="#cb142-38" tabindex="-1"></a></span>
<span id="cb142-39"><a aria-hidden="true" href="#cb142-39" tabindex="-1"></a> </span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2400" src="microbial_diversity_analysis_files/figure-html/cell-137-output-1.png" width="2100"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-177">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a aria-hidden="true" href="#cb143-1" tabindex="-1"></a>(full_genera_df</span>
<span id="cb143-2"><a aria-hidden="true" href="#cb143-2" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Fungi"'</span>)</span>
<span id="cb143-3"><a aria-hidden="true" href="#cb143-3" tabindex="-1"></a> .query(<span class="st">'sample_id!="S06"'</span>)</span>
<span id="cb143-4"><a aria-hidden="true" href="#cb143-4" tabindex="-1"></a> .replace({<span class="st">'Genus'</span>: {<span class="st">'unknown'</span>: np.nan}})</span>
<span id="cb143-5"><a aria-hidden="true" href="#cb143-5" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.Genus.isin(top_genera_fun) <span class="op">|</span> dd.Genus.isna(), dd.Genus, <span class="st">'Other'</span>))</span>
<span id="cb143-6"><a aria-hidden="true" href="#cb143-6" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb143-7"><a aria-hidden="true" href="#cb143-7" tabindex="-1"></a> .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb143-8"><a aria-hidden="true" href="#cb143-8" tabindex="-1"></a> .groupby(<span class="st">'sample_id'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb143-9"><a aria-hidden="true" href="#cb143-9" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb143-10"><a aria-hidden="true" href="#cb143-10" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb143-11"><a aria-hidden="true" href="#cb143-11" tabindex="-1"></a> .melt([<span class="st">'sample_id'</span>, <span class="st">'Genus'</span>], var_name<span class="op">=</span><span class="st">'metric'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb143-12"><a aria-hidden="true" href="#cb143-12" tabindex="-1"></a> .replace({<span class="st">'counts'</span>: <span class="st">'Number of Reads'</span>,</span>
<span id="cb143-13"><a aria-hidden="true" href="#cb143-13" tabindex="-1"></a>           <span class="st">'relative_abundance'</span>: <span class="st">'Relative Abundance'</span>})</span>
<span id="cb143-14"><a aria-hidden="true" href="#cb143-14" tabindex="-1"></a> .query(<span class="st">'sample_id != "S06"'</span>)</span>
<span id="cb143-15"><a aria-hidden="true" href="#cb143-15" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb143-16"><a aria-hidden="true" href="#cb143-16" tabindex="-1"></a> .replace({<span class="st">'B_Flight'</span>: <span class="st">'Blanks Pool'</span>,</span>
<span id="cb143-17"><a aria-hidden="true" href="#cb143-17" tabindex="-1"></a>           <span class="st">'B_Ground'</span>: <span class="st">'Blanks Pool'</span>})</span>
<span id="cb143-18"><a aria-hidden="true" href="#cb143-18" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">('</span> <span class="op">+</span> dd.sample_mode <span class="op">+</span> <span class="st">')'</span>)</span>
<span id="cb143-19"><a aria-hidden="true" href="#cb143-19" tabindex="-1"></a> </span>
<span id="cb143-20"><a aria-hidden="true" href="#cb143-20" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: </span>
<span id="cb143-21"><a aria-hidden="true" href="#cb143-21" tabindex="-1"></a>       p9.ggplot(dd) </span>
<span id="cb143-22"><a aria-hidden="true" href="#cb143-22" tabindex="-1"></a>     <span class="op">+</span> p9.aes(<span class="st">'sample_label'</span>, <span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'Genus'</span>)</span>
<span id="cb143-23"><a aria-hidden="true" href="#cb143-23" tabindex="-1"></a>     <span class="op">+</span> p9.geom_col()</span>
<span id="cb143-24"><a aria-hidden="true" href="#cb143-24" tabindex="-1"></a>     <span class="op">+</span> p9.coord_flip()</span>
<span id="cb143-25"><a aria-hidden="true" href="#cb143-25" tabindex="-1"></a>     <span class="op">+</span> p9.facet_wrap(<span class="st">'metric'</span>, scales<span class="op">=</span><span class="st">'free_x'</span>)</span>
<span id="cb143-26"><a aria-hidden="true" href="#cb143-26" tabindex="-1"></a>     <span class="op">+</span> p9.guides(fill<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">4</span>))</span>
<span id="cb143-27"><a aria-hidden="true" href="#cb143-27" tabindex="-1"></a>     <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, fill<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb143-28"><a aria-hidden="true" href="#cb143-28" tabindex="-1"></a>     <span class="op">+</span> p9.scale_y_continuous(expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb143-29"><a aria-hidden="true" href="#cb143-29" tabindex="-1"></a>     <span class="op">+</span> p9.scale_fill_discrete(labels<span class="op">=</span><span class="bu">list</span>(new_labels_fun))</span>
<span id="cb143-30"><a aria-hidden="true" href="#cb143-30" tabindex="-1"></a>     <span class="op">+</span> p9.theme(</span>
<span id="cb143-31"><a aria-hidden="true" href="#cb143-31" tabindex="-1"></a>         figure_size<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">8</span>),</span>
<span id="cb143-32"><a aria-hidden="true" href="#cb143-32" tabindex="-1"></a>         axis_text_y<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>, x<span class="op">=-</span><span class="fl">.1</span>),</span>
<span id="cb143-33"><a aria-hidden="true" href="#cb143-33" tabindex="-1"></a>         legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb143-34"><a aria-hidden="true" href="#cb143-34" tabindex="-1"></a>         legend_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb143-35"><a aria-hidden="true" href="#cb143-35" tabindex="-1"></a>         legend_position<span class="op">=</span><span class="st">'bottom'</span></span>
<span id="cb143-36"><a aria-hidden="true" href="#cb143-36" tabindex="-1"></a>         )</span>
<span id="cb143-37"><a aria-hidden="true" href="#cb143-37" tabindex="-1"></a>     )</span>
<span id="cb143-38"><a aria-hidden="true" href="#cb143-38" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2400" src="microbial_diversity_analysis_files/figure-html/cell-138-output-1.png" width="2100"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-178">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a aria-hidden="true" href="#cb144-1" tabindex="-1"></a>(pd.concat([genera_long_df, blanks_abundance_df])</span>
<span id="cb144-2"><a aria-hidden="true" href="#cb144-2" tabindex="-1"></a> .assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.Genus.isin(top_genera) <span class="op">|</span> dd.Genus.isna(), dd.Genus, <span class="st">'Other'</span>))</span>
<span id="cb144-3"><a aria-hidden="true" href="#cb144-3" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb144-4"><a aria-hidden="true" href="#cb144-4" tabindex="-1"></a>    .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb144-5"><a aria-hidden="true" href="#cb144-5" tabindex="-1"></a> .groupby(<span class="st">'sample_id'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb144-6"><a aria-hidden="true" href="#cb144-6" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb144-7"><a aria-hidden="true" href="#cb144-7" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb144-8"><a aria-hidden="true" href="#cb144-8" tabindex="-1"></a> .melt([<span class="st">'sample_id'</span>, <span class="st">'Genus'</span>], var_name<span class="op">=</span><span class="st">'metric'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb144-9"><a aria-hidden="true" href="#cb144-9" tabindex="-1"></a> .replace({<span class="st">'counts'</span>: <span class="st">'Number of Reads'</span>,</span>
<span id="cb144-10"><a aria-hidden="true" href="#cb144-10" tabindex="-1"></a>           <span class="st">'relative_abundance'</span>: <span class="st">'Relative Abundance'</span>})</span>
<span id="cb144-11"><a aria-hidden="true" href="#cb144-11" tabindex="-1"></a> .query(<span class="st">'sample_id != "S06"'</span>)</span>
<span id="cb144-12"><a aria-hidden="true" href="#cb144-12" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb144-13"><a aria-hidden="true" href="#cb144-13" tabindex="-1"></a> .replace({<span class="st">'B_Flight'</span>: <span class="st">'Blanks Pool'</span>,</span>
<span id="cb144-14"><a aria-hidden="true" href="#cb144-14" tabindex="-1"></a>           <span class="st">'B_Ground'</span>: <span class="st">'Blanks Pool'</span>})</span>
<span id="cb144-15"><a aria-hidden="true" href="#cb144-15" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">('</span> <span class="op">+</span> dd.sample_mode <span class="op">+</span> <span class="st">')'</span>)</span>
<span id="cb144-16"><a aria-hidden="true" href="#cb144-16" tabindex="-1"></a> .query(<span class="st">'Genus=="Sphingomonas"'</span>)</span>
<span id="cb144-17"><a aria-hidden="true" href="#cb144-17" tabindex="-1"></a> .query(<span class="st">'metric=="Relative Abundance"'</span>)</span>
<span id="cb144-18"><a aria-hidden="true" href="#cb144-18" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb144-19"><a aria-hidden="true" href="#cb144-19" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_label'</span>, <span class="st">'value'</span>)</span>
<span id="cb144-20"><a aria-hidden="true" href="#cb144-20" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col()</span>
<span id="cb144-21"><a aria-hidden="true" href="#cb144-21" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'(value * 100).round(1).astype(str) + "%"'</span>), ha<span class="op">=</span><span class="st">'left'</span>, size<span class="op">=</span><span class="dv">9</span>, nudge_y<span class="op">=</span><span class="fl">.01</span>)</span>
<span id="cb144-22"><a aria-hidden="true" href="#cb144-22" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_continuous(labels<span class="op">=</span>percent_format(), expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>), limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.01</span>, <span class="fl">1.07</span>))</span>
<span id="cb144-23"><a aria-hidden="true" href="#cb144-23" tabindex="-1"></a>       <span class="op">+</span> p9.coord_flip()</span>
<span id="cb144-24"><a aria-hidden="true" href="#cb144-24" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Relative abundance of Sphingomonas'</span>)</span>
<span id="cb144-25"><a aria-hidden="true" href="#cb144-25" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb144-26"><a aria-hidden="true" href="#cb144-26" tabindex="-1"></a>                           axis_text_y<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>, x<span class="op">=-</span><span class="fl">.06</span>, size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb144-27"><a aria-hidden="true" href="#cb144-27" tabindex="-1"></a>         legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb144-28"><a aria-hidden="true" href="#cb144-28" tabindex="-1"></a>                  )</span>
<span id="cb144-29"><a aria-hidden="true" href="#cb144-29" tabindex="-1"></a>       </span>
<span id="cb144-30"><a aria-hidden="true" href="#cb144-30" tabindex="-1"></a>       )</span>
<span id="cb144-31"><a aria-hidden="true" href="#cb144-31" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="1800" src="microbial_diversity_analysis_files/figure-html/cell-139-output-1.png" width="1500"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-179">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a aria-hidden="true" href="#cb145-1" tabindex="-1"></a>(pd.concat([genera_long_df, blanks_abundance_df.fillna(<span class="st">'unknown'</span>)])</span>
<span id="cb145-2"><a aria-hidden="true" href="#cb145-2" tabindex="-1"></a> .groupby([<span class="st">'Kingdom'</span>, <span class="st">'Genus'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb145-3"><a aria-hidden="true" href="#cb145-3" tabindex="-1"></a> .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb145-4"><a aria-hidden="true" href="#cb145-4" tabindex="-1"></a> .groupby([<span class="st">'sample_id'</span>, <span class="st">'Kingdom'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb145-5"><a aria-hidden="true" href="#cb145-5" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb145-6"><a aria-hidden="true" href="#cb145-6" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb145-7"><a aria-hidden="true" href="#cb145-7" tabindex="-1"></a> .melt([<span class="st">'sample_id'</span>, <span class="st">'Genus'</span>, <span class="st">'Kingdom'</span>], var_name<span class="op">=</span><span class="st">'metric'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb145-8"><a aria-hidden="true" href="#cb145-8" tabindex="-1"></a> .replace({<span class="st">'counts'</span>: <span class="st">'Number of Reads'</span>,</span>
<span id="cb145-9"><a aria-hidden="true" href="#cb145-9" tabindex="-1"></a>           <span class="st">'relative_abundance'</span>: <span class="st">'Relative Abundance'</span>})</span>
<span id="cb145-10"><a aria-hidden="true" href="#cb145-10" tabindex="-1"></a> .query(<span class="st">'sample_id != "S06"'</span>)</span>
<span id="cb145-11"><a aria-hidden="true" href="#cb145-11" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb145-12"><a aria-hidden="true" href="#cb145-12" tabindex="-1"></a> .replace({<span class="st">'B_Flight'</span>: <span class="st">'Blanks Pool'</span>,</span>
<span id="cb145-13"><a aria-hidden="true" href="#cb145-13" tabindex="-1"></a>           <span class="st">'B_Ground'</span>: <span class="st">'Blanks Pool'</span>})</span>
<span id="cb145-14"><a aria-hidden="true" href="#cb145-14" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">('</span> <span class="op">+</span> dd.sample_mode <span class="op">+</span> <span class="st">')'</span>)</span>
<span id="cb145-15"><a aria-hidden="true" href="#cb145-15" tabindex="-1"></a> .query(<span class="st">'Genus=="unknown"'</span>)</span>
<span id="cb145-16"><a aria-hidden="true" href="#cb145-16" tabindex="-1"></a> .query(<span class="st">'metric=="Relative Abundance"'</span>)</span>
<span id="cb145-17"><a aria-hidden="true" href="#cb145-17" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd) </span>
<span id="cb145-18"><a aria-hidden="true" href="#cb145-18" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_label'</span>, <span class="st">'value'</span>)</span>
<span id="cb145-19"><a aria-hidden="true" href="#cb145-19" tabindex="-1"></a>       <span class="op">+</span> p9.geom_col()</span>
<span id="cb145-20"><a aria-hidden="true" href="#cb145-20" tabindex="-1"></a>       <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'(value * 100).round(1).astype(str) + "%"'</span>), ha<span class="op">=</span><span class="st">'left'</span>, size<span class="op">=</span><span class="dv">9</span>, nudge_y<span class="op">=</span><span class="fl">.01</span>)</span>
<span id="cb145-21"><a aria-hidden="true" href="#cb145-21" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_continuous(labels<span class="op">=</span>percent_format(),</span>
<span id="cb145-22"><a aria-hidden="true" href="#cb145-22" tabindex="-1"></a>                               expand<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb145-23"><a aria-hidden="true" href="#cb145-23" tabindex="-1"></a>                               limits<span class="op">=</span>(<span class="op">-</span><span class="fl">.01</span>, <span class="fl">.35</span>))</span>
<span id="cb145-24"><a aria-hidden="true" href="#cb145-24" tabindex="-1"></a>       <span class="op">+</span> p9.coord_flip()</span>
<span id="cb145-25"><a aria-hidden="true" href="#cb145-25" tabindex="-1"></a>       <span class="op">+</span> p9.facet_wrap(<span class="st">'Kingdom'</span>)</span>
<span id="cb145-26"><a aria-hidden="true" href="#cb145-26" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Relative abundance of unresolved reads at Genus level'</span>)</span>
<span id="cb145-27"><a aria-hidden="true" href="#cb145-27" tabindex="-1"></a>       <span class="op">+</span> p9.theme(</span>
<span id="cb145-28"><a aria-hidden="true" href="#cb145-28" tabindex="-1"></a>           figure_size<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb145-29"><a aria-hidden="true" href="#cb145-29" tabindex="-1"></a>           axis_text_y<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>, x<span class="op">=-</span><span class="fl">.11</span>, size<span class="op">=</span><span class="dv">8</span>),</span>
<span id="cb145-30"><a aria-hidden="true" href="#cb145-30" tabindex="-1"></a>           legend_key_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb145-31"><a aria-hidden="true" href="#cb145-31" tabindex="-1"></a>                  )</span>
<span id="cb145-32"><a aria-hidden="true" href="#cb145-32" tabindex="-1"></a>       </span>
<span id="cb145-33"><a aria-hidden="true" href="#cb145-33" tabindex="-1"></a>       )</span>
<span id="cb145-34"><a aria-hidden="true" href="#cb145-34" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2100" src="microbial_diversity_analysis_files/figure-html/cell-140-output-1.png" width="1800"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-180">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a aria-hidden="true" href="#cb146-1" tabindex="-1"></a>full_matrix_bac <span class="op">=</span> (full_genera_df</span>
<span id="cb146-2"><a aria-hidden="true" href="#cb146-2" tabindex="-1"></a> .fillna(<span class="st">'unknown'</span>)</span>
<span id="cb146-3"><a aria-hidden="true" href="#cb146-3" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Bacteria"'</span>)</span>
<span id="cb146-4"><a aria-hidden="true" href="#cb146-4" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb146-5"><a aria-hidden="true" href="#cb146-5" tabindex="-1"></a> .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb146-6"><a aria-hidden="true" href="#cb146-6" tabindex="-1"></a> .groupby(<span class="st">'sample_id'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb146-7"><a aria-hidden="true" href="#cb146-7" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb146-8"><a aria-hidden="true" href="#cb146-8" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb146-9"><a aria-hidden="true" href="#cb146-9" tabindex="-1"></a> .melt([<span class="st">'sample_id'</span>, <span class="st">'Genus'</span>], var_name<span class="op">=</span><span class="st">'metric'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb146-10"><a aria-hidden="true" href="#cb146-10" tabindex="-1"></a> .replace({<span class="st">'counts'</span>: <span class="st">'Number of Reads'</span>,</span>
<span id="cb146-11"><a aria-hidden="true" href="#cb146-11" tabindex="-1"></a>           <span class="st">'relative_abundance'</span>: <span class="st">'Relative Abundance'</span>})</span>
<span id="cb146-12"><a aria-hidden="true" href="#cb146-12" tabindex="-1"></a> .query(<span class="st">'sample_id != "S06"'</span>)</span>
<span id="cb146-13"><a aria-hidden="true" href="#cb146-13" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb146-14"><a aria-hidden="true" href="#cb146-14" tabindex="-1"></a> .replace({<span class="st">'B_Flight'</span>: <span class="st">'Blanks Pool'</span>,</span>
<span id="cb146-15"><a aria-hidden="true" href="#cb146-15" tabindex="-1"></a>           <span class="st">'B_Ground'</span>: <span class="st">'Blanks Pool'</span>})</span>
<span id="cb146-16"><a aria-hidden="true" href="#cb146-16" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">('</span> <span class="op">+</span> dd.sample_mode <span class="op">+</span> <span class="st">')'</span>)</span>
<span id="cb146-17"><a aria-hidden="true" href="#cb146-17" tabindex="-1"></a> .query(<span class="st">'metric=="Relative Abundance"'</span>)</span>
<span id="cb146-18"><a aria-hidden="true" href="#cb146-18" tabindex="-1"></a> .pivot(index<span class="op">=</span><span class="st">'sample_label'</span>, columns<span class="op">=</span><span class="st">'Genus'</span>, values<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb146-19"><a aria-hidden="true" href="#cb146-19" tabindex="-1"></a> .fillna(<span class="dv">0</span>)</span>
<span id="cb146-20"><a aria-hidden="true" href="#cb146-20" tabindex="-1"></a>)</span>
<span id="cb146-21"><a aria-hidden="true" href="#cb146-21" tabindex="-1"></a>samples <span class="op">=</span> full_matrix_bac.index.values</span>
<span id="cb146-22"><a aria-hidden="true" href="#cb146-22" tabindex="-1"></a>dm <span class="op">=</span> (full_matrix_bac</span>
<span id="cb146-23"><a aria-hidden="true" href="#cb146-23" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: pairwise_distances(dd, metric<span class="op">=</span><span class="st">'braycurtis'</span>))</span>
<span id="cb146-24"><a aria-hidden="true" href="#cb146-24" tabindex="-1"></a>)</span>
<span id="cb146-25"><a aria-hidden="true" href="#cb146-25" tabindex="-1"></a>(pd.DataFrame(dm, columns<span class="op">=</span>samples)</span>
<span id="cb146-26"><a aria-hidden="true" href="#cb146-26" tabindex="-1"></a> .assign(sample_id<span class="op">=</span>samples)</span>
<span id="cb146-27"><a aria-hidden="true" href="#cb146-27" tabindex="-1"></a> .melt(<span class="st">'sample_id'</span>, var_name<span class="op">=</span><span class="st">'sample_id2'</span>, value_name<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb146-28"><a aria-hidden="true" href="#cb146-28" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd.distance.astype(<span class="bu">str</span>).<span class="bu">str</span>[<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb146-29"><a aria-hidden="true" href="#cb146-29" tabindex="-1"></a> .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb146-30"><a aria-hidden="true" href="#cb146-30" tabindex="-1"></a>         pd.Categorical(dd.sample_id, categories<span class="op">=</span>samples, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb146-31"><a aria-hidden="true" href="#cb146-31" tabindex="-1"></a> .assign(sample_id2<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb146-32"><a aria-hidden="true" href="#cb146-32" tabindex="-1"></a>         pd.Categorical(dd.sample_id2, categories<span class="op">=</span>samples, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb146-33"><a aria-hidden="true" href="#cb146-33" tabindex="-1"></a> .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">str</span>.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>))</span>
<span id="cb146-34"><a aria-hidden="true" href="#cb146-34" tabindex="-1"></a> .assign(sample_id2<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id2.<span class="bu">str</span>.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>))</span>
<span id="cb146-35"><a aria-hidden="true" href="#cb146-35" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb146-36"><a aria-hidden="true" href="#cb146-36" tabindex="-1"></a>        <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'sample_id2'</span>, fill<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb146-37"><a aria-hidden="true" href="#cb146-37" tabindex="-1"></a>        <span class="op">+</span> p9.geom_tile()</span>
<span id="cb146-38"><a aria-hidden="true" href="#cb146-38" tabindex="-1"></a>        <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'inferno'</span>, na_value<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb146-39"><a aria-hidden="true" href="#cb146-39" tabindex="-1"></a>        <span class="op">+</span> p9.theme_classic()</span>
<span id="cb146-40"><a aria-hidden="true" href="#cb146-40" tabindex="-1"></a>        <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'label'</span>, color<span class="op">=</span><span class="st">'distance &gt;= .35'</span>), size<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb146-41"><a aria-hidden="true" href="#cb146-41" tabindex="-1"></a>        <span class="op">+</span> p9.scale_color_manual([<span class="st">'white'</span>, <span class="st">'black'</span>])</span>
<span id="cb146-42"><a aria-hidden="true" href="#cb146-42" tabindex="-1"></a>        <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb146-43"><a aria-hidden="true" href="#cb146-43" tabindex="-1"></a>        <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, title<span class="op">=</span><span class="st">'Bray-Curtis dissimilarity (16S)'</span>)</span>
<span id="cb146-44"><a aria-hidden="true" href="#cb146-44" tabindex="-1"></a>        <span class="op">+</span> p9.theme(</span>
<span id="cb146-45"><a aria-hidden="true" href="#cb146-45" tabindex="-1"></a>            axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb146-46"><a aria-hidden="true" href="#cb146-46" tabindex="-1"></a>            axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb146-47"><a aria-hidden="true" href="#cb146-47" tabindex="-1"></a>            figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb146-48"><a aria-hidden="true" href="#cb146-48" tabindex="-1"></a>            dpi<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb146-49"><a aria-hidden="true" href="#cb146-49" tabindex="-1"></a>            title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb146-50"><a aria-hidden="true" href="#cb146-50" tabindex="-1"></a>            )</span>
<span id="cb146-51"><a aria-hidden="true" href="#cb146-51" tabindex="-1"></a>      )</span>
<span id="cb146-52"><a aria-hidden="true" href="#cb146-52" tabindex="-1"></a></span>
<span id="cb146-53"><a aria-hidden="true" href="#cb146-53" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2000" src="microbial_diversity_analysis_files/figure-html/cell-141-output-1.png" width="2000"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-181">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a aria-hidden="true" href="#cb147-1" tabindex="-1"></a>full_matrix_fun <span class="op">=</span> (full_genera_df</span>
<span id="cb147-2"><a aria-hidden="true" href="#cb147-2" tabindex="-1"></a> .fillna(<span class="st">'unknown'</span>)</span>
<span id="cb147-3"><a aria-hidden="true" href="#cb147-3" tabindex="-1"></a> .query(<span class="st">'Kingdom == "Fungi"'</span>)</span>
<span id="cb147-4"><a aria-hidden="true" href="#cb147-4" tabindex="-1"></a> .groupby([<span class="st">'Genus'</span>, <span class="st">'sample_id'</span>], as_index<span class="op">=</span><span class="va">False</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb147-5"><a aria-hidden="true" href="#cb147-5" tabindex="-1"></a> .aggregate({<span class="st">'counts'</span>: <span class="st">'sum'</span>})</span>
<span id="cb147-6"><a aria-hidden="true" href="#cb147-6" tabindex="-1"></a> .groupby(<span class="st">'sample_id'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb147-7"><a aria-hidden="true" href="#cb147-7" tabindex="-1"></a> .<span class="bu">apply</span>(<span class="kw">lambda</span> dd: dd.assign(relative_abundance<span class="op">=</span><span class="kw">lambda</span> dd: dd.counts <span class="op">/</span> dd.counts.<span class="bu">sum</span>()))</span>
<span id="cb147-8"><a aria-hidden="true" href="#cb147-8" tabindex="-1"></a> .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb147-9"><a aria-hidden="true" href="#cb147-9" tabindex="-1"></a> .melt([<span class="st">'sample_id'</span>, <span class="st">'Genus'</span>], var_name<span class="op">=</span><span class="st">'metric'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb147-10"><a aria-hidden="true" href="#cb147-10" tabindex="-1"></a> .replace({<span class="st">'counts'</span>: <span class="st">'Number of Reads'</span>,</span>
<span id="cb147-11"><a aria-hidden="true" href="#cb147-11" tabindex="-1"></a>           <span class="st">'relative_abundance'</span>: <span class="st">'Relative Abundance'</span>})</span>
<span id="cb147-12"><a aria-hidden="true" href="#cb147-12" tabindex="-1"></a> .query(<span class="st">'sample_id != "S06"'</span>)</span>
<span id="cb147-13"><a aria-hidden="true" href="#cb147-13" tabindex="-1"></a> .assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">map</span>(sample_map))</span>
<span id="cb147-14"><a aria-hidden="true" href="#cb147-14" tabindex="-1"></a> .replace({<span class="st">'B_Flight'</span>: <span class="st">'Blanks Pool'</span>,</span>
<span id="cb147-15"><a aria-hidden="true" href="#cb147-15" tabindex="-1"></a>           <span class="st">'B_Ground'</span>: <span class="st">'Blanks Pool'</span>})</span>
<span id="cb147-16"><a aria-hidden="true" href="#cb147-16" tabindex="-1"></a> .assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">('</span> <span class="op">+</span> dd.sample_mode <span class="op">+</span> <span class="st">')'</span>)</span>
<span id="cb147-17"><a aria-hidden="true" href="#cb147-17" tabindex="-1"></a> .query(<span class="st">'metric=="Relative Abundance"'</span>)</span>
<span id="cb147-18"><a aria-hidden="true" href="#cb147-18" tabindex="-1"></a> .pivot(index<span class="op">=</span><span class="st">'sample_label'</span>, columns<span class="op">=</span><span class="st">'Genus'</span>, values<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb147-19"><a aria-hidden="true" href="#cb147-19" tabindex="-1"></a> .fillna(<span class="dv">0</span>)</span>
<span id="cb147-20"><a aria-hidden="true" href="#cb147-20" tabindex="-1"></a>)</span>
<span id="cb147-21"><a aria-hidden="true" href="#cb147-21" tabindex="-1"></a>samples <span class="op">=</span> full_matrix_fun.index.values</span>
<span id="cb147-22"><a aria-hidden="true" href="#cb147-22" tabindex="-1"></a>dm <span class="op">=</span> (full_matrix_fun</span>
<span id="cb147-23"><a aria-hidden="true" href="#cb147-23" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: pairwise_distances(dd, metric<span class="op">=</span><span class="st">'braycurtis'</span>))</span>
<span id="cb147-24"><a aria-hidden="true" href="#cb147-24" tabindex="-1"></a>)</span>
<span id="cb147-25"><a aria-hidden="true" href="#cb147-25" tabindex="-1"></a>(pd.DataFrame(dm, columns<span class="op">=</span>samples)</span>
<span id="cb147-26"><a aria-hidden="true" href="#cb147-26" tabindex="-1"></a> .assign(sample_id<span class="op">=</span>samples)</span>
<span id="cb147-27"><a aria-hidden="true" href="#cb147-27" tabindex="-1"></a> .melt(<span class="st">'sample_id'</span>, var_name<span class="op">=</span><span class="st">'sample_id2'</span>, value_name<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb147-28"><a aria-hidden="true" href="#cb147-28" tabindex="-1"></a> .assign(label<span class="op">=</span><span class="kw">lambda</span> dd: dd.distance.astype(<span class="bu">str</span>).<span class="bu">str</span>[<span class="dv">1</span>:<span class="dv">4</span>])</span>
<span id="cb147-29"><a aria-hidden="true" href="#cb147-29" tabindex="-1"></a> .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb147-30"><a aria-hidden="true" href="#cb147-30" tabindex="-1"></a>         pd.Categorical(dd.sample_id, categories<span class="op">=</span>samples, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb147-31"><a aria-hidden="true" href="#cb147-31" tabindex="-1"></a> .assign(sample_id2<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb147-32"><a aria-hidden="true" href="#cb147-32" tabindex="-1"></a>         pd.Categorical(dd.sample_id2, categories<span class="op">=</span>samples, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb147-33"><a aria-hidden="true" href="#cb147-33" tabindex="-1"></a> .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id.<span class="bu">str</span>.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>))</span>
<span id="cb147-34"><a aria-hidden="true" href="#cb147-34" tabindex="-1"></a> .assign(sample_id2<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_id2.<span class="bu">str</span>.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>))</span>
<span id="cb147-35"><a aria-hidden="true" href="#cb147-35" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb147-36"><a aria-hidden="true" href="#cb147-36" tabindex="-1"></a>        <span class="op">+</span> p9.aes(<span class="st">'sample_id'</span>, <span class="st">'sample_id2'</span>, fill<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb147-37"><a aria-hidden="true" href="#cb147-37" tabindex="-1"></a>        <span class="op">+</span> p9.geom_tile()</span>
<span id="cb147-38"><a aria-hidden="true" href="#cb147-38" tabindex="-1"></a>        <span class="op">+</span> p9.scale_fill_continuous(<span class="st">'inferno'</span>, na_value<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb147-39"><a aria-hidden="true" href="#cb147-39" tabindex="-1"></a>        <span class="op">+</span> p9.theme_classic()</span>
<span id="cb147-40"><a aria-hidden="true" href="#cb147-40" tabindex="-1"></a>        <span class="op">+</span> p9.geom_text(p9.aes(label<span class="op">=</span><span class="st">'label'</span>, color<span class="op">=</span><span class="st">'distance &gt;= .35'</span>), size<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb147-41"><a aria-hidden="true" href="#cb147-41" tabindex="-1"></a>        <span class="op">+</span> p9.scale_color_manual([<span class="st">'white'</span>, <span class="st">'black'</span>])</span>
<span id="cb147-42"><a aria-hidden="true" href="#cb147-42" tabindex="-1"></a>        <span class="op">+</span> p9.guides(fill<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb147-43"><a aria-hidden="true" href="#cb147-43" tabindex="-1"></a>        <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, title<span class="op">=</span><span class="st">'Bray-Curtis dissimilarity (ITS)'</span>)</span>
<span id="cb147-44"><a aria-hidden="true" href="#cb147-44" tabindex="-1"></a>        <span class="op">+</span> p9.theme(</span>
<span id="cb147-45"><a aria-hidden="true" href="#cb147-45" tabindex="-1"></a>            axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb147-46"><a aria-hidden="true" href="#cb147-46" tabindex="-1"></a>            axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cb147-47"><a aria-hidden="true" href="#cb147-47" tabindex="-1"></a>            figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb147-48"><a aria-hidden="true" href="#cb147-48" tabindex="-1"></a>            dpi<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb147-49"><a aria-hidden="true" href="#cb147-49" tabindex="-1"></a>            title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb147-50"><a aria-hidden="true" href="#cb147-50" tabindex="-1"></a>            )</span>
<span id="cb147-51"><a aria-hidden="true" href="#cb147-51" tabindex="-1"></a>      )</span>
<span id="cb147-52"><a aria-hidden="true" href="#cb147-52" tabindex="-1"></a></span>
<span id="cb147-53"><a aria-hidden="true" href="#cb147-53" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2000" src="microbial_diversity_analysis_files/figure-html/cell-142-output-1.png" width="2000"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-182">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a aria-hidden="true" href="#cb148-1" tabindex="-1"></a>(full_long_df </span>
<span id="cb148-2"><a aria-hidden="true" href="#cb148-2" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb148-3"><a aria-hidden="true" href="#cb148-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb148-4"><a aria-hidden="true" href="#cb148-4" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_samples, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb148-5"><a aria-hidden="true" href="#cb148-5" tabindex="-1"></a>.dropna()</span>
<span id="cb148-6"><a aria-hidden="true" href="#cb148-6" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb148-7"><a aria-hidden="true" href="#cb148-7" tabindex="-1"></a>.merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb148-8"><a aria-hidden="true" href="#cb148-8" tabindex="-1"></a>.assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb148-9"><a aria-hidden="true" href="#cb148-9" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb148-10"><a aria-hidden="true" href="#cb148-10" tabindex="-1"></a>        np.where(dd.sample_mode.isna, </span>
<span id="cb148-11"><a aria-hidden="true" href="#cb148-11" tabindex="-1"></a>                 dd.sample_label.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb148-12"><a aria-hidden="true" href="#cb148-12" tabindex="-1"></a>                 dd.sample_mode))</span>
<span id="cb148-13"><a aria-hidden="true" href="#cb148-13" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.month)</span>
<span id="cb148-14"><a aria-hidden="true" href="#cb148-14" tabindex="-1"></a>.groupby([<span class="st">'sample_group_label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Genus'</span>])</span>
<span id="cb148-15"><a aria-hidden="true" href="#cb148-15" tabindex="-1"></a>.aggregate({<span class="st">'value'</span>: <span class="st">'mean'</span>})</span>
<span id="cb148-16"><a aria-hidden="true" href="#cb148-16" tabindex="-1"></a>.reset_index()</span>
<span id="cb148-17"><a aria-hidden="true" href="#cb148-17" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb148-18"><a aria-hidden="true" href="#cb148-18" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb148-19"><a aria-hidden="true" href="#cb148-19" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_group_label,</span>
<span id="cb148-20"><a aria-hidden="true" href="#cb148-20" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>, <span class="st">'Flight February'</span>, <span class="st">'Ground February'</span>,</span>
<span id="cb148-21"><a aria-hidden="true" href="#cb148-21" tabindex="-1"></a>                    <span class="st">'Flight April'</span>, <span class="st">'Ground April'</span>], ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb148-22"><a aria-hidden="true" href="#cb148-22" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb148-23"><a aria-hidden="true" href="#cb148-23" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_group_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb148-24"><a aria-hidden="true" href="#cb148-24" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb148-25"><a aria-hidden="true" href="#cb148-25" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb148-26"><a aria-hidden="true" href="#cb148-26" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb148-27"><a aria-hidden="true" href="#cb148-27" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb148-28"><a aria-hidden="true" href="#cb148-28" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb148-29"><a aria-hidden="true" href="#cb148-29" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb148-30"><a aria-hidden="true" href="#cb148-30" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb148-31"><a aria-hidden="true" href="#cb148-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb148-32"><a aria-hidden="true" href="#cb148-32" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">4</span>))</span>
<span id="cb148-33"><a aria-hidden="true" href="#cb148-33" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb148-34"><a aria-hidden="true" href="#cb148-34" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">'Relative Abundance of Top 30 Genera in Samples'</span>,</span>
<span id="cb148-35"><a aria-hidden="true" href="#cb148-35" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb148-36"><a aria-hidden="true" href="#cb148-36" tabindex="-1"></a>                 )</span>
<span id="cb148-37"><a aria-hidden="true" href="#cb148-37" tabindex="-1"></a>                  )</span>
<span id="cb148-38"><a aria-hidden="true" href="#cb148-38" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb148-39"><a aria-hidden="true" href="#cb148-39" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.25</span>, <span class="fl">7.5</span>),</span>
<span id="cb148-40"><a aria-hidden="true" href="#cb148-40" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb148-41"><a aria-hidden="true" href="#cb148-41" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb148-42"><a aria-hidden="true" href="#cb148-42" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb148-43"><a aria-hidden="true" href="#cb148-43" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb148-44"><a aria-hidden="true" href="#cb148-44" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb148-45"><a aria-hidden="true" href="#cb148-45" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb148-46"><a aria-hidden="true" href="#cb148-46" tabindex="-1"></a>       )</span>
<span id="cb148-47"><a aria-hidden="true" href="#cb148-47" tabindex="-1"></a> )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-143-output-1.png" width="975"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-183">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a aria-hidden="true" href="#cb149-1" tabindex="-1"></a>(full_long_df </span>
<span id="cb149-2"><a aria-hidden="true" href="#cb149-2" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb149-3"><a aria-hidden="true" href="#cb149-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb149-4"><a aria-hidden="true" href="#cb149-4" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_blanks, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb149-5"><a aria-hidden="true" href="#cb149-5" tabindex="-1"></a>.dropna()</span>
<span id="cb149-6"><a aria-hidden="true" href="#cb149-6" tabindex="-1"></a>.replace({<span class="st">'Genus'</span>: {<span class="st">'Malasseziaceae_gen_Incertae_sedis'</span>: <span class="st">'Malasseziaceae'</span>}})</span>
<span id="cb149-7"><a aria-hidden="true" href="#cb149-7" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb149-8"><a aria-hidden="true" href="#cb149-8" tabindex="-1"></a>.merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb149-9"><a aria-hidden="true" href="#cb149-9" tabindex="-1"></a>.assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb149-10"><a aria-hidden="true" href="#cb149-10" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb149-11"><a aria-hidden="true" href="#cb149-11" tabindex="-1"></a>        np.where(dd.sample_mode.isna, </span>
<span id="cb149-12"><a aria-hidden="true" href="#cb149-12" tabindex="-1"></a>                 dd.sample_label.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb149-13"><a aria-hidden="true" href="#cb149-13" tabindex="-1"></a>                 dd.sample_mode))</span>
<span id="cb149-14"><a aria-hidden="true" href="#cb149-14" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.month)</span>
<span id="cb149-15"><a aria-hidden="true" href="#cb149-15" tabindex="-1"></a>.groupby([<span class="st">'sample_group_label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Genus'</span>])</span>
<span id="cb149-16"><a aria-hidden="true" href="#cb149-16" tabindex="-1"></a>.aggregate({<span class="st">'value'</span>: <span class="st">'mean'</span>})</span>
<span id="cb149-17"><a aria-hidden="true" href="#cb149-17" tabindex="-1"></a>.reset_index()</span>
<span id="cb149-18"><a aria-hidden="true" href="#cb149-18" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb149-19"><a aria-hidden="true" href="#cb149-19" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb149-20"><a aria-hidden="true" href="#cb149-20" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_group_label,</span>
<span id="cb149-21"><a aria-hidden="true" href="#cb149-21" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>, <span class="st">'Flight February'</span>, <span class="st">'Ground February'</span>,</span>
<span id="cb149-22"><a aria-hidden="true" href="#cb149-22" tabindex="-1"></a>                    <span class="st">'Flight April'</span>, <span class="st">'Ground April'</span>], ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb149-23"><a aria-hidden="true" href="#cb149-23" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb149-24"><a aria-hidden="true" href="#cb149-24" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_group_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb149-25"><a aria-hidden="true" href="#cb149-25" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb149-26"><a aria-hidden="true" href="#cb149-26" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb149-27"><a aria-hidden="true" href="#cb149-27" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb149-28"><a aria-hidden="true" href="#cb149-28" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb149-29"><a aria-hidden="true" href="#cb149-29" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb149-30"><a aria-hidden="true" href="#cb149-30" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb149-31"><a aria-hidden="true" href="#cb149-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb149-32"><a aria-hidden="true" href="#cb149-32" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb149-33"><a aria-hidden="true" href="#cb149-33" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">4</span>))</span>
<span id="cb149-34"><a aria-hidden="true" href="#cb149-34" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb149-35"><a aria-hidden="true" href="#cb149-35" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">'Relative Abundance of Top 30 Genera in Samples'</span>,</span>
<span id="cb149-36"><a aria-hidden="true" href="#cb149-36" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb149-37"><a aria-hidden="true" href="#cb149-37" tabindex="-1"></a>                 )</span>
<span id="cb149-38"><a aria-hidden="true" href="#cb149-38" tabindex="-1"></a>                  )</span>
<span id="cb149-39"><a aria-hidden="true" href="#cb149-39" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb149-40"><a aria-hidden="true" href="#cb149-40" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">3</span>, <span class="fl">7.5</span>),</span>
<span id="cb149-41"><a aria-hidden="true" href="#cb149-41" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb149-42"><a aria-hidden="true" href="#cb149-42" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb149-43"><a aria-hidden="true" href="#cb149-43" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb149-44"><a aria-hidden="true" href="#cb149-44" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb149-45"><a aria-hidden="true" href="#cb149-45" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb149-46"><a aria-hidden="true" href="#cb149-46" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb149-47"><a aria-hidden="true" href="#cb149-47" tabindex="-1"></a>       )</span>
<span id="cb149-48"><a aria-hidden="true" href="#cb149-48" tabindex="-1"></a> )</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-144-output-1.png" width="900"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-184">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a aria-hidden="true" href="#cb150-1" tabindex="-1"></a>full_long_df <span class="op">=</span> (full_matrix_bac</span>
<span id="cb150-2"><a aria-hidden="true" href="#cb150-2" tabindex="-1"></a>                .reset_index()</span>
<span id="cb150-3"><a aria-hidden="true" href="#cb150-3" tabindex="-1"></a>                .melt(<span class="st">'sample_label'</span>, var_name<span class="op">=</span><span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb150-4"><a aria-hidden="true" href="#cb150-4" tabindex="-1"></a>)</span>
<span id="cb150-5"><a aria-hidden="true" href="#cb150-5" tabindex="-1"></a></span>
<span id="cb150-6"><a aria-hidden="true" href="#cb150-6" tabindex="-1"></a></span>
<span id="cb150-7"><a aria-hidden="true" href="#cb150-7" tabindex="-1"></a>top_30_genera_blanks <span class="op">=</span> (</span>
<span id="cb150-8"><a aria-hidden="true" href="#cb150-8" tabindex="-1"></a>    full_long_df</span>
<span id="cb150-9"><a aria-hidden="true" href="#cb150-9" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb150-10"><a aria-hidden="true" href="#cb150-10" tabindex="-1"></a>    .query(<span class="st">'sample_label.str.contains("Pool")'</span>)</span>
<span id="cb150-11"><a aria-hidden="true" href="#cb150-11" tabindex="-1"></a>    .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb150-12"><a aria-hidden="true" href="#cb150-12" tabindex="-1"></a>    [<span class="st">'value'</span>]</span>
<span id="cb150-13"><a aria-hidden="true" href="#cb150-13" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb150-14"><a aria-hidden="true" href="#cb150-14" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb150-15"><a aria-hidden="true" href="#cb150-15" tabindex="-1"></a>    .tail(<span class="dv">30</span>)</span>
<span id="cb150-16"><a aria-hidden="true" href="#cb150-16" tabindex="-1"></a>    .index</span>
<span id="cb150-17"><a aria-hidden="true" href="#cb150-17" tabindex="-1"></a>    .values</span>
<span id="cb150-18"><a aria-hidden="true" href="#cb150-18" tabindex="-1"></a>)</span>
<span id="cb150-19"><a aria-hidden="true" href="#cb150-19" tabindex="-1"></a></span>
<span id="cb150-20"><a aria-hidden="true" href="#cb150-20" tabindex="-1"></a>top_30_genera_samples_april <span class="op">=</span> (</span>
<span id="cb150-21"><a aria-hidden="true" href="#cb150-21" tabindex="-1"></a>    full_long_df</span>
<span id="cb150-22"><a aria-hidden="true" href="#cb150-22" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb150-23"><a aria-hidden="true" href="#cb150-23" tabindex="-1"></a>    .query(<span class="st">'sample_label.str.startswith("S")'</span>)</span>
<span id="cb150-24"><a aria-hidden="true" href="#cb150-24" tabindex="-1"></a>    .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb150-25"><a aria-hidden="true" href="#cb150-25" tabindex="-1"></a>    .merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb150-26"><a aria-hidden="true" href="#cb150-26" tabindex="-1"></a>    .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb150-27"><a aria-hidden="true" href="#cb150-27" tabindex="-1"></a>    .query(<span class="st">'month=="April"'</span>)</span>
<span id="cb150-28"><a aria-hidden="true" href="#cb150-28" tabindex="-1"></a>    .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb150-29"><a aria-hidden="true" href="#cb150-29" tabindex="-1"></a>    [<span class="st">'value'</span>]</span>
<span id="cb150-30"><a aria-hidden="true" href="#cb150-30" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb150-31"><a aria-hidden="true" href="#cb150-31" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb150-32"><a aria-hidden="true" href="#cb150-32" tabindex="-1"></a>    .tail(<span class="dv">30</span>)</span>
<span id="cb150-33"><a aria-hidden="true" href="#cb150-33" tabindex="-1"></a>    .index</span>
<span id="cb150-34"><a aria-hidden="true" href="#cb150-34" tabindex="-1"></a>    .values</span>
<span id="cb150-35"><a aria-hidden="true" href="#cb150-35" tabindex="-1"></a>)</span>
<span id="cb150-36"><a aria-hidden="true" href="#cb150-36" tabindex="-1"></a></span>
<span id="cb150-37"><a aria-hidden="true" href="#cb150-37" tabindex="-1"></a>top_30_genera_samples_february <span class="op">=</span> (</span>
<span id="cb150-38"><a aria-hidden="true" href="#cb150-38" tabindex="-1"></a>    full_long_df</span>
<span id="cb150-39"><a aria-hidden="true" href="#cb150-39" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb150-40"><a aria-hidden="true" href="#cb150-40" tabindex="-1"></a>    .query(<span class="st">'sample_label.str.startswith("S")'</span>)</span>
<span id="cb150-41"><a aria-hidden="true" href="#cb150-41" tabindex="-1"></a>    .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb150-42"><a aria-hidden="true" href="#cb150-42" tabindex="-1"></a>    .merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb150-43"><a aria-hidden="true" href="#cb150-43" tabindex="-1"></a>    .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb150-44"><a aria-hidden="true" href="#cb150-44" tabindex="-1"></a>    .query(<span class="st">'month=="February"'</span>)</span>
<span id="cb150-45"><a aria-hidden="true" href="#cb150-45" tabindex="-1"></a>    .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb150-46"><a aria-hidden="true" href="#cb150-46" tabindex="-1"></a>    [<span class="st">'value'</span>]</span>
<span id="cb150-47"><a aria-hidden="true" href="#cb150-47" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb150-48"><a aria-hidden="true" href="#cb150-48" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb150-49"><a aria-hidden="true" href="#cb150-49" tabindex="-1"></a>    .tail(<span class="dv">30</span>)</span>
<span id="cb150-50"><a aria-hidden="true" href="#cb150-50" tabindex="-1"></a>    .index</span>
<span id="cb150-51"><a aria-hidden="true" href="#cb150-51" tabindex="-1"></a>    .values</span>
<span id="cb150-52"><a aria-hidden="true" href="#cb150-52" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-185">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a aria-hidden="true" href="#cb151-1" tabindex="-1"></a>f <span class="op">=</span> (full_long_df </span>
<span id="cb151-2"><a aria-hidden="true" href="#cb151-2" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb151-3"><a aria-hidden="true" href="#cb151-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb151-4"><a aria-hidden="true" href="#cb151-4" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_samples_february, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb151-5"><a aria-hidden="true" href="#cb151-5" tabindex="-1"></a>.dropna()</span>
<span id="cb151-6"><a aria-hidden="true" href="#cb151-6" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb151-7"><a aria-hidden="true" href="#cb151-7" tabindex="-1"></a>.merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb151-8"><a aria-hidden="true" href="#cb151-8" tabindex="-1"></a>.assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb151-9"><a aria-hidden="true" href="#cb151-9" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb151-10"><a aria-hidden="true" href="#cb151-10" tabindex="-1"></a>        np.where(dd.sample_mode.isna, </span>
<span id="cb151-11"><a aria-hidden="true" href="#cb151-11" tabindex="-1"></a>                 dd.sample_label.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb151-12"><a aria-hidden="true" href="#cb151-12" tabindex="-1"></a>                 dd.sample_mode))</span>
<span id="cb151-13"><a aria-hidden="true" href="#cb151-13" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.month)</span>
<span id="cb151-14"><a aria-hidden="true" href="#cb151-14" tabindex="-1"></a>.groupby([<span class="st">'sample_group_label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Genus'</span>])</span>
<span id="cb151-15"><a aria-hidden="true" href="#cb151-15" tabindex="-1"></a>.aggregate({<span class="st">'value'</span>: <span class="st">'mean'</span>})</span>
<span id="cb151-16"><a aria-hidden="true" href="#cb151-16" tabindex="-1"></a>.reset_index()</span>
<span id="cb151-17"><a aria-hidden="true" href="#cb151-17" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb151-18"><a aria-hidden="true" href="#cb151-18" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb151-19"><a aria-hidden="true" href="#cb151-19" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_group_label,</span>
<span id="cb151-20"><a aria-hidden="true" href="#cb151-20" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>, <span class="st">'Flight February'</span>, <span class="st">'Ground February'</span>,</span>
<span id="cb151-21"><a aria-hidden="true" href="#cb151-21" tabindex="-1"></a>                    <span class="st">'Flight April'</span>, <span class="st">'Ground April'</span>], ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb151-22"><a aria-hidden="true" href="#cb151-22" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb151-23"><a aria-hidden="true" href="#cb151-23" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_group_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb151-24"><a aria-hidden="true" href="#cb151-24" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb151-25"><a aria-hidden="true" href="#cb151-25" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb151-26"><a aria-hidden="true" href="#cb151-26" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb151-27"><a aria-hidden="true" href="#cb151-27" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb151-28"><a aria-hidden="true" href="#cb151-28" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb151-29"><a aria-hidden="true" href="#cb151-29" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb151-30"><a aria-hidden="true" href="#cb151-30" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb151-31"><a aria-hidden="true" href="#cb151-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb151-32"><a aria-hidden="true" href="#cb151-32" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb151-33"><a aria-hidden="true" href="#cb151-33" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb151-34"><a aria-hidden="true" href="#cb151-34" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb151-35"><a aria-hidden="true" href="#cb151-35" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb151-36"><a aria-hidden="true" href="#cb151-36" tabindex="-1"></a>                 )</span>
<span id="cb151-37"><a aria-hidden="true" href="#cb151-37" tabindex="-1"></a>                  )</span>
<span id="cb151-38"><a aria-hidden="true" href="#cb151-38" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb151-39"><a aria-hidden="true" href="#cb151-39" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">3</span>, <span class="fl">7.5</span>),</span>
<span id="cb151-40"><a aria-hidden="true" href="#cb151-40" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb151-41"><a aria-hidden="true" href="#cb151-41" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb151-42"><a aria-hidden="true" href="#cb151-42" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb151-43"><a aria-hidden="true" href="#cb151-43" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb151-44"><a aria-hidden="true" href="#cb151-44" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb151-45"><a aria-hidden="true" href="#cb151-45" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb151-46"><a aria-hidden="true" href="#cb151-46" tabindex="-1"></a>       )</span>
<span id="cb151-47"><a aria-hidden="true" href="#cb151-47" tabindex="-1"></a> )</span>
<span id="cb151-48"><a aria-hidden="true" href="#cb151-48" tabindex="-1"></a></span>
<span id="cb151-49"><a aria-hidden="true" href="#cb151-49" tabindex="-1"></a>f.save(<span class="st">'../output/figures/feb_top_30_genera.svg'</span>)</span>
<span id="cb151-50"><a aria-hidden="true" href="#cb151-50" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="852">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-146-output-1.png" width="900"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-186">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a aria-hidden="true" href="#cb152-1" tabindex="-1"></a>f <span class="op">=</span> (full_long_df </span>
<span id="cb152-2"><a aria-hidden="true" href="#cb152-2" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb152-3"><a aria-hidden="true" href="#cb152-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb152-4"><a aria-hidden="true" href="#cb152-4" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_samples_april, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb152-5"><a aria-hidden="true" href="#cb152-5" tabindex="-1"></a>.dropna()</span>
<span id="cb152-6"><a aria-hidden="true" href="#cb152-6" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb152-7"><a aria-hidden="true" href="#cb152-7" tabindex="-1"></a>.merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb152-8"><a aria-hidden="true" href="#cb152-8" tabindex="-1"></a>.assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb152-9"><a aria-hidden="true" href="#cb152-9" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb152-10"><a aria-hidden="true" href="#cb152-10" tabindex="-1"></a>        np.where(dd.sample_mode.isna, </span>
<span id="cb152-11"><a aria-hidden="true" href="#cb152-11" tabindex="-1"></a>                 dd.sample_label.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb152-12"><a aria-hidden="true" href="#cb152-12" tabindex="-1"></a>                 dd.sample_mode))</span>
<span id="cb152-13"><a aria-hidden="true" href="#cb152-13" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.month)</span>
<span id="cb152-14"><a aria-hidden="true" href="#cb152-14" tabindex="-1"></a>.groupby([<span class="st">'sample_group_label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Genus'</span>])</span>
<span id="cb152-15"><a aria-hidden="true" href="#cb152-15" tabindex="-1"></a>.aggregate({<span class="st">'value'</span>: <span class="st">'mean'</span>})</span>
<span id="cb152-16"><a aria-hidden="true" href="#cb152-16" tabindex="-1"></a>.reset_index()</span>
<span id="cb152-17"><a aria-hidden="true" href="#cb152-17" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb152-18"><a aria-hidden="true" href="#cb152-18" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb152-19"><a aria-hidden="true" href="#cb152-19" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_group_label,</span>
<span id="cb152-20"><a aria-hidden="true" href="#cb152-20" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>, <span class="st">'Flight February'</span>, <span class="st">'Ground February'</span>,</span>
<span id="cb152-21"><a aria-hidden="true" href="#cb152-21" tabindex="-1"></a>                    <span class="st">'Flight April'</span>, <span class="st">'Ground April'</span>], ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb152-22"><a aria-hidden="true" href="#cb152-22" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb152-23"><a aria-hidden="true" href="#cb152-23" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_group_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb152-24"><a aria-hidden="true" href="#cb152-24" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb152-25"><a aria-hidden="true" href="#cb152-25" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb152-26"><a aria-hidden="true" href="#cb152-26" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb152-27"><a aria-hidden="true" href="#cb152-27" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb152-28"><a aria-hidden="true" href="#cb152-28" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb152-29"><a aria-hidden="true" href="#cb152-29" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb152-30"><a aria-hidden="true" href="#cb152-30" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb152-31"><a aria-hidden="true" href="#cb152-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb152-32"><a aria-hidden="true" href="#cb152-32" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb152-33"><a aria-hidden="true" href="#cb152-33" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb152-34"><a aria-hidden="true" href="#cb152-34" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb152-35"><a aria-hidden="true" href="#cb152-35" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb152-36"><a aria-hidden="true" href="#cb152-36" tabindex="-1"></a>                 )</span>
<span id="cb152-37"><a aria-hidden="true" href="#cb152-37" tabindex="-1"></a>                  )</span>
<span id="cb152-38"><a aria-hidden="true" href="#cb152-38" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb152-39"><a aria-hidden="true" href="#cb152-39" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="dv">5</span>, <span class="fl">7.5</span>),</span>
<span id="cb152-40"><a aria-hidden="true" href="#cb152-40" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb152-41"><a aria-hidden="true" href="#cb152-41" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb152-42"><a aria-hidden="true" href="#cb152-42" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb152-43"><a aria-hidden="true" href="#cb152-43" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb152-44"><a aria-hidden="true" href="#cb152-44" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb152-45"><a aria-hidden="true" href="#cb152-45" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb152-46"><a aria-hidden="true" href="#cb152-46" tabindex="-1"></a>       )</span>
<span id="cb152-47"><a aria-hidden="true" href="#cb152-47" tabindex="-1"></a> )</span>
<span id="cb152-48"><a aria-hidden="true" href="#cb152-48" tabindex="-1"></a>f.save(<span class="st">'../output/figures/apr_top_30_genera.svg'</span>)</span>
<span id="cb152-49"><a aria-hidden="true" href="#cb152-49" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="856">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-147-output-1.png" width="1500"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-187">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a aria-hidden="true" href="#cb153-1" tabindex="-1"></a>f <span class="op">=</span> (full_long_df </span>
<span id="cb153-2"><a aria-hidden="true" href="#cb153-2" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb153-3"><a aria-hidden="true" href="#cb153-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb153-4"><a aria-hidden="true" href="#cb153-4" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_blanks, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb153-5"><a aria-hidden="true" href="#cb153-5" tabindex="-1"></a>.dropna()</span>
<span id="cb153-6"><a aria-hidden="true" href="#cb153-6" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb153-7"><a aria-hidden="true" href="#cb153-7" tabindex="-1"></a>.merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb153-8"><a aria-hidden="true" href="#cb153-8" tabindex="-1"></a>.assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb153-9"><a aria-hidden="true" href="#cb153-9" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb153-10"><a aria-hidden="true" href="#cb153-10" tabindex="-1"></a>        np.where(dd.sample_mode.isna, </span>
<span id="cb153-11"><a aria-hidden="true" href="#cb153-11" tabindex="-1"></a>                 dd.sample_label.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb153-12"><a aria-hidden="true" href="#cb153-12" tabindex="-1"></a>                 dd.sample_mode))</span>
<span id="cb153-13"><a aria-hidden="true" href="#cb153-13" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.month)</span>
<span id="cb153-14"><a aria-hidden="true" href="#cb153-14" tabindex="-1"></a>.groupby([<span class="st">'sample_group_label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Genus'</span>])</span>
<span id="cb153-15"><a aria-hidden="true" href="#cb153-15" tabindex="-1"></a>.aggregate({<span class="st">'value'</span>: <span class="st">'mean'</span>})</span>
<span id="cb153-16"><a aria-hidden="true" href="#cb153-16" tabindex="-1"></a>.reset_index()</span>
<span id="cb153-17"><a aria-hidden="true" href="#cb153-17" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb153-18"><a aria-hidden="true" href="#cb153-18" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb153-19"><a aria-hidden="true" href="#cb153-19" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_group_label,</span>
<span id="cb153-20"><a aria-hidden="true" href="#cb153-20" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>, <span class="st">'Flight February'</span>, <span class="st">'Ground February'</span>,</span>
<span id="cb153-21"><a aria-hidden="true" href="#cb153-21" tabindex="-1"></a>                    <span class="st">'Flight April'</span>, <span class="st">'Ground April'</span>], ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb153-22"><a aria-hidden="true" href="#cb153-22" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb153-23"><a aria-hidden="true" href="#cb153-23" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_group_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb153-24"><a aria-hidden="true" href="#cb153-24" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb153-25"><a aria-hidden="true" href="#cb153-25" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb153-26"><a aria-hidden="true" href="#cb153-26" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb153-27"><a aria-hidden="true" href="#cb153-27" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb153-28"><a aria-hidden="true" href="#cb153-28" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb153-29"><a aria-hidden="true" href="#cb153-29" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb153-30"><a aria-hidden="true" href="#cb153-30" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb153-31"><a aria-hidden="true" href="#cb153-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb153-32"><a aria-hidden="true" href="#cb153-32" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb153-33"><a aria-hidden="true" href="#cb153-33" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb153-34"><a aria-hidden="true" href="#cb153-34" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb153-35"><a aria-hidden="true" href="#cb153-35" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb153-36"><a aria-hidden="true" href="#cb153-36" tabindex="-1"></a>                 )</span>
<span id="cb153-37"><a aria-hidden="true" href="#cb153-37" tabindex="-1"></a>                  )</span>
<span id="cb153-38"><a aria-hidden="true" href="#cb153-38" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb153-39"><a aria-hidden="true" href="#cb153-39" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">5.5</span>, <span class="fl">7.5</span>),</span>
<span id="cb153-40"><a aria-hidden="true" href="#cb153-40" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb153-41"><a aria-hidden="true" href="#cb153-41" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb153-42"><a aria-hidden="true" href="#cb153-42" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb153-43"><a aria-hidden="true" href="#cb153-43" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb153-44"><a aria-hidden="true" href="#cb153-44" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb153-45"><a aria-hidden="true" href="#cb153-45" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb153-46"><a aria-hidden="true" href="#cb153-46" tabindex="-1"></a>       )</span>
<span id="cb153-47"><a aria-hidden="true" href="#cb153-47" tabindex="-1"></a> )</span>
<span id="cb153-48"><a aria-hidden="true" href="#cb153-48" tabindex="-1"></a>f.save(<span class="st">'../output/figures/blanks_top_30_genera.svg'</span>)</span>
<span id="cb153-49"><a aria-hidden="true" href="#cb153-49" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="858">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-148-output-1.png" width="1650"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-188">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a aria-hidden="true" href="#cb154-1" tabindex="-1"></a>full_long_df <span class="op">=</span> (full_matrix_fun</span>
<span id="cb154-2"><a aria-hidden="true" href="#cb154-2" tabindex="-1"></a>                .reset_index()</span>
<span id="cb154-3"><a aria-hidden="true" href="#cb154-3" tabindex="-1"></a>                .melt(<span class="st">'sample_label'</span>, var_name<span class="op">=</span><span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb154-4"><a aria-hidden="true" href="#cb154-4" tabindex="-1"></a>)</span>
<span id="cb154-5"><a aria-hidden="true" href="#cb154-5" tabindex="-1"></a></span>
<span id="cb154-6"><a aria-hidden="true" href="#cb154-6" tabindex="-1"></a></span>
<span id="cb154-7"><a aria-hidden="true" href="#cb154-7" tabindex="-1"></a>top_30_genera_blanks <span class="op">=</span> (</span>
<span id="cb154-8"><a aria-hidden="true" href="#cb154-8" tabindex="-1"></a>    full_long_df</span>
<span id="cb154-9"><a aria-hidden="true" href="#cb154-9" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb154-10"><a aria-hidden="true" href="#cb154-10" tabindex="-1"></a>    .query(<span class="st">'sample_label.str.contains("Pool")'</span>)</span>
<span id="cb154-11"><a aria-hidden="true" href="#cb154-11" tabindex="-1"></a>    .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb154-12"><a aria-hidden="true" href="#cb154-12" tabindex="-1"></a>    [<span class="st">'value'</span>]</span>
<span id="cb154-13"><a aria-hidden="true" href="#cb154-13" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb154-14"><a aria-hidden="true" href="#cb154-14" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb154-15"><a aria-hidden="true" href="#cb154-15" tabindex="-1"></a>    .tail(<span class="dv">30</span>)</span>
<span id="cb154-16"><a aria-hidden="true" href="#cb154-16" tabindex="-1"></a>    .index</span>
<span id="cb154-17"><a aria-hidden="true" href="#cb154-17" tabindex="-1"></a>    .values</span>
<span id="cb154-18"><a aria-hidden="true" href="#cb154-18" tabindex="-1"></a>)</span>
<span id="cb154-19"><a aria-hidden="true" href="#cb154-19" tabindex="-1"></a></span>
<span id="cb154-20"><a aria-hidden="true" href="#cb154-20" tabindex="-1"></a>top_30_genera_samples_april <span class="op">=</span> (</span>
<span id="cb154-21"><a aria-hidden="true" href="#cb154-21" tabindex="-1"></a>    full_long_df</span>
<span id="cb154-22"><a aria-hidden="true" href="#cb154-22" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb154-23"><a aria-hidden="true" href="#cb154-23" tabindex="-1"></a>    .query(<span class="st">'sample_label.str.startswith("S")'</span>)</span>
<span id="cb154-24"><a aria-hidden="true" href="#cb154-24" tabindex="-1"></a>    .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb154-25"><a aria-hidden="true" href="#cb154-25" tabindex="-1"></a>    .merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb154-26"><a aria-hidden="true" href="#cb154-26" tabindex="-1"></a>    .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb154-27"><a aria-hidden="true" href="#cb154-27" tabindex="-1"></a>    .query(<span class="st">'month=="April"'</span>)</span>
<span id="cb154-28"><a aria-hidden="true" href="#cb154-28" tabindex="-1"></a>    .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb154-29"><a aria-hidden="true" href="#cb154-29" tabindex="-1"></a>    [<span class="st">'value'</span>]</span>
<span id="cb154-30"><a aria-hidden="true" href="#cb154-30" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb154-31"><a aria-hidden="true" href="#cb154-31" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb154-32"><a aria-hidden="true" href="#cb154-32" tabindex="-1"></a>    .tail(<span class="dv">30</span>)</span>
<span id="cb154-33"><a aria-hidden="true" href="#cb154-33" tabindex="-1"></a>    .index</span>
<span id="cb154-34"><a aria-hidden="true" href="#cb154-34" tabindex="-1"></a>    .values</span>
<span id="cb154-35"><a aria-hidden="true" href="#cb154-35" tabindex="-1"></a>)</span>
<span id="cb154-36"><a aria-hidden="true" href="#cb154-36" tabindex="-1"></a></span>
<span id="cb154-37"><a aria-hidden="true" href="#cb154-37" tabindex="-1"></a>top_30_genera_samples_february <span class="op">=</span> (</span>
<span id="cb154-38"><a aria-hidden="true" href="#cb154-38" tabindex="-1"></a>    full_long_df</span>
<span id="cb154-39"><a aria-hidden="true" href="#cb154-39" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb154-40"><a aria-hidden="true" href="#cb154-40" tabindex="-1"></a>    .query(<span class="st">'sample_label.str.startswith("S")'</span>)</span>
<span id="cb154-41"><a aria-hidden="true" href="#cb154-41" tabindex="-1"></a>    .assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb154-42"><a aria-hidden="true" href="#cb154-42" tabindex="-1"></a>    .merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb154-43"><a aria-hidden="true" href="#cb154-43" tabindex="-1"></a>    .assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb154-44"><a aria-hidden="true" href="#cb154-44" tabindex="-1"></a>    .query(<span class="st">'month=="February"'</span>)</span>
<span id="cb154-45"><a aria-hidden="true" href="#cb154-45" tabindex="-1"></a>    .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb154-46"><a aria-hidden="true" href="#cb154-46" tabindex="-1"></a>    [<span class="st">'value'</span>]</span>
<span id="cb154-47"><a aria-hidden="true" href="#cb154-47" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb154-48"><a aria-hidden="true" href="#cb154-48" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb154-49"><a aria-hidden="true" href="#cb154-49" tabindex="-1"></a>    .tail(<span class="dv">30</span>)</span>
<span id="cb154-50"><a aria-hidden="true" href="#cb154-50" tabindex="-1"></a>    .index</span>
<span id="cb154-51"><a aria-hidden="true" href="#cb154-51" tabindex="-1"></a>    .values</span>
<span id="cb154-52"><a aria-hidden="true" href="#cb154-52" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-189">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a aria-hidden="true" href="#cb155-1" tabindex="-1"></a>f <span class="op">=</span> (full_long_df </span>
<span id="cb155-2"><a aria-hidden="true" href="#cb155-2" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb155-3"><a aria-hidden="true" href="#cb155-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb155-4"><a aria-hidden="true" href="#cb155-4" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_samples_february, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb155-5"><a aria-hidden="true" href="#cb155-5" tabindex="-1"></a>.dropna()</span>
<span id="cb155-6"><a aria-hidden="true" href="#cb155-6" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb155-7"><a aria-hidden="true" href="#cb155-7" tabindex="-1"></a>.merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb155-8"><a aria-hidden="true" href="#cb155-8" tabindex="-1"></a>.assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb155-9"><a aria-hidden="true" href="#cb155-9" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb155-10"><a aria-hidden="true" href="#cb155-10" tabindex="-1"></a>        np.where(dd.sample_mode.isna, </span>
<span id="cb155-11"><a aria-hidden="true" href="#cb155-11" tabindex="-1"></a>                 dd.sample_label.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb155-12"><a aria-hidden="true" href="#cb155-12" tabindex="-1"></a>                 dd.sample_mode))</span>
<span id="cb155-13"><a aria-hidden="true" href="#cb155-13" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.month)</span>
<span id="cb155-14"><a aria-hidden="true" href="#cb155-14" tabindex="-1"></a>.groupby([<span class="st">'sample_group_label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Genus'</span>])</span>
<span id="cb155-15"><a aria-hidden="true" href="#cb155-15" tabindex="-1"></a>.aggregate({<span class="st">'value'</span>: <span class="st">'mean'</span>})</span>
<span id="cb155-16"><a aria-hidden="true" href="#cb155-16" tabindex="-1"></a>.reset_index()</span>
<span id="cb155-17"><a aria-hidden="true" href="#cb155-17" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb155-18"><a aria-hidden="true" href="#cb155-18" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb155-19"><a aria-hidden="true" href="#cb155-19" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_group_label,</span>
<span id="cb155-20"><a aria-hidden="true" href="#cb155-20" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>, <span class="st">'Flight February'</span>, <span class="st">'Ground February'</span>,</span>
<span id="cb155-21"><a aria-hidden="true" href="#cb155-21" tabindex="-1"></a>                    <span class="st">'Flight April'</span>, <span class="st">'Ground April'</span>], ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb155-22"><a aria-hidden="true" href="#cb155-22" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb155-23"><a aria-hidden="true" href="#cb155-23" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_group_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb155-24"><a aria-hidden="true" href="#cb155-24" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb155-25"><a aria-hidden="true" href="#cb155-25" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb155-26"><a aria-hidden="true" href="#cb155-26" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb155-27"><a aria-hidden="true" href="#cb155-27" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb155-28"><a aria-hidden="true" href="#cb155-28" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb155-29"><a aria-hidden="true" href="#cb155-29" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb155-30"><a aria-hidden="true" href="#cb155-30" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb155-31"><a aria-hidden="true" href="#cb155-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb155-32"><a aria-hidden="true" href="#cb155-32" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb155-33"><a aria-hidden="true" href="#cb155-33" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb155-34"><a aria-hidden="true" href="#cb155-34" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb155-35"><a aria-hidden="true" href="#cb155-35" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb155-36"><a aria-hidden="true" href="#cb155-36" tabindex="-1"></a>                 )</span>
<span id="cb155-37"><a aria-hidden="true" href="#cb155-37" tabindex="-1"></a>                  )</span>
<span id="cb155-38"><a aria-hidden="true" href="#cb155-38" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb155-39"><a aria-hidden="true" href="#cb155-39" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.75</span>, <span class="fl">7.5</span>),</span>
<span id="cb155-40"><a aria-hidden="true" href="#cb155-40" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb155-41"><a aria-hidden="true" href="#cb155-41" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb155-42"><a aria-hidden="true" href="#cb155-42" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb155-43"><a aria-hidden="true" href="#cb155-43" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb155-44"><a aria-hidden="true" href="#cb155-44" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb155-45"><a aria-hidden="true" href="#cb155-45" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb155-46"><a aria-hidden="true" href="#cb155-46" tabindex="-1"></a>       )</span>
<span id="cb155-47"><a aria-hidden="true" href="#cb155-47" tabindex="-1"></a> )</span>
<span id="cb155-48"><a aria-hidden="true" href="#cb155-48" tabindex="-1"></a></span>
<span id="cb155-49"><a aria-hidden="true" href="#cb155-49" tabindex="-1"></a>f.save(<span class="st">'../output/figures/feb_top_30_genera_fun.svg'</span>)</span>
<span id="cb155-50"><a aria-hidden="true" href="#cb155-50" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="863">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-150-output-1.png" width="1125"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-190">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a aria-hidden="true" href="#cb156-1" tabindex="-1"></a>f <span class="op">=</span> (full_long_df </span>
<span id="cb156-2"><a aria-hidden="true" href="#cb156-2" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb156-3"><a aria-hidden="true" href="#cb156-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb156-4"><a aria-hidden="true" href="#cb156-4" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_samples_april, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb156-5"><a aria-hidden="true" href="#cb156-5" tabindex="-1"></a>.dropna()</span>
<span id="cb156-6"><a aria-hidden="true" href="#cb156-6" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb156-7"><a aria-hidden="true" href="#cb156-7" tabindex="-1"></a>.merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb156-8"><a aria-hidden="true" href="#cb156-8" tabindex="-1"></a>.assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb156-9"><a aria-hidden="true" href="#cb156-9" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb156-10"><a aria-hidden="true" href="#cb156-10" tabindex="-1"></a>        np.where(dd.sample_mode.isna, </span>
<span id="cb156-11"><a aria-hidden="true" href="#cb156-11" tabindex="-1"></a>                 dd.sample_label.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb156-12"><a aria-hidden="true" href="#cb156-12" tabindex="-1"></a>                 dd.sample_mode))</span>
<span id="cb156-13"><a aria-hidden="true" href="#cb156-13" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.month)</span>
<span id="cb156-14"><a aria-hidden="true" href="#cb156-14" tabindex="-1"></a>.groupby([<span class="st">'sample_group_label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Genus'</span>])</span>
<span id="cb156-15"><a aria-hidden="true" href="#cb156-15" tabindex="-1"></a>.aggregate({<span class="st">'value'</span>: <span class="st">'mean'</span>})</span>
<span id="cb156-16"><a aria-hidden="true" href="#cb156-16" tabindex="-1"></a>.reset_index()</span>
<span id="cb156-17"><a aria-hidden="true" href="#cb156-17" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb156-18"><a aria-hidden="true" href="#cb156-18" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb156-19"><a aria-hidden="true" href="#cb156-19" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_group_label,</span>
<span id="cb156-20"><a aria-hidden="true" href="#cb156-20" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>, <span class="st">'Flight February'</span>, <span class="st">'Ground February'</span>,</span>
<span id="cb156-21"><a aria-hidden="true" href="#cb156-21" tabindex="-1"></a>                    <span class="st">'Flight April'</span>, <span class="st">'Ground April'</span>], ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb156-22"><a aria-hidden="true" href="#cb156-22" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb156-23"><a aria-hidden="true" href="#cb156-23" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_group_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb156-24"><a aria-hidden="true" href="#cb156-24" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb156-25"><a aria-hidden="true" href="#cb156-25" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb156-26"><a aria-hidden="true" href="#cb156-26" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb156-27"><a aria-hidden="true" href="#cb156-27" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb156-28"><a aria-hidden="true" href="#cb156-28" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb156-29"><a aria-hidden="true" href="#cb156-29" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb156-30"><a aria-hidden="true" href="#cb156-30" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb156-31"><a aria-hidden="true" href="#cb156-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb156-32"><a aria-hidden="true" href="#cb156-32" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb156-33"><a aria-hidden="true" href="#cb156-33" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb156-34"><a aria-hidden="true" href="#cb156-34" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb156-35"><a aria-hidden="true" href="#cb156-35" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb156-36"><a aria-hidden="true" href="#cb156-36" tabindex="-1"></a>                 )</span>
<span id="cb156-37"><a aria-hidden="true" href="#cb156-37" tabindex="-1"></a>                  )</span>
<span id="cb156-38"><a aria-hidden="true" href="#cb156-38" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb156-39"><a aria-hidden="true" href="#cb156-39" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.75</span>, <span class="fl">7.5</span>),</span>
<span id="cb156-40"><a aria-hidden="true" href="#cb156-40" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb156-41"><a aria-hidden="true" href="#cb156-41" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb156-42"><a aria-hidden="true" href="#cb156-42" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb156-43"><a aria-hidden="true" href="#cb156-43" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb156-44"><a aria-hidden="true" href="#cb156-44" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb156-45"><a aria-hidden="true" href="#cb156-45" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb156-46"><a aria-hidden="true" href="#cb156-46" tabindex="-1"></a>       )</span>
<span id="cb156-47"><a aria-hidden="true" href="#cb156-47" tabindex="-1"></a> )</span>
<span id="cb156-48"><a aria-hidden="true" href="#cb156-48" tabindex="-1"></a>f.save(<span class="st">'../output/figures/apr_top_30_genera_fun.svg'</span>)</span>
<span id="cb156-49"><a aria-hidden="true" href="#cb156-49" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="865">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-151-output-1.png" width="1125"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="69" id="cell-192">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a aria-hidden="true" href="#cb157-1" tabindex="-1"></a>bac_pathogens_df <span class="op">=</span> (</span>
<span id="cb157-2"><a aria-hidden="true" href="#cb157-2" tabindex="-1"></a>    pd.read_excel(<span class="st">'../data/Species 2023_final.xlsx'</span>,</span>
<span id="cb157-3"><a aria-hidden="true" href="#cb157-3" tabindex="-1"></a>                  sheet_name<span class="op">=</span><span class="st">'JV analysis_Bacteria'</span>)</span>
<span id="cb157-4"><a aria-hidden="true" href="#cb157-4" tabindex="-1"></a>                  [[<span class="st">'Genus'</span>, <span class="st">'Species'</span>]]</span>
<span id="cb157-5"><a aria-hidden="true" href="#cb157-5" tabindex="-1"></a>    .assign(label<span class="op">=</span><span class="st">'Bacterial Potential Human Pathogens'</span>)</span>
<span id="cb157-6"><a aria-hidden="true" href="#cb157-6" tabindex="-1"></a>)</span>
<span id="cb157-7"><a aria-hidden="true" href="#cb157-7" tabindex="-1"></a></span>
<span id="cb157-8"><a aria-hidden="true" href="#cb157-8" tabindex="-1"></a>fungi_pathogens_df <span class="op">=</span> (pd.read_excel(<span class="st">'../data/Species 2023_final.xlsx'</span>,</span>
<span id="cb157-9"><a aria-hidden="true" href="#cb157-9" tabindex="-1"></a>                                     sheet_name<span class="op">=</span><span class="st">'JV analysis_Fungi'</span>, </span>
<span id="cb157-10"><a aria-hidden="true" href="#cb157-10" tabindex="-1"></a>                                     skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb157-11"><a aria-hidden="true" href="#cb157-11" tabindex="-1"></a>                       [[<span class="st">'Genus'</span>, <span class="st">'Species'</span>]]</span>
<span id="cb157-12"><a aria-hidden="true" href="#cb157-12" tabindex="-1"></a>                       .dropna()</span>
<span id="cb157-13"><a aria-hidden="true" href="#cb157-13" tabindex="-1"></a>    .assign(label<span class="op">=</span><span class="st">'Fungal Potential Human Pathogens'</span>) </span>
<span id="cb157-14"><a aria-hidden="true" href="#cb157-14" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" id="cell-193">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a aria-hidden="true" href="#cb158-1" tabindex="-1"></a>f <span class="op">=</span> (full_long_df </span>
<span id="cb158-2"><a aria-hidden="true" href="#cb158-2" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb158-3"><a aria-hidden="true" href="#cb158-3" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb158-4"><a aria-hidden="true" href="#cb158-4" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_blanks, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb158-5"><a aria-hidden="true" href="#cb158-5" tabindex="-1"></a>.dropna()</span>
<span id="cb158-6"><a aria-hidden="true" href="#cb158-6" tabindex="-1"></a>.assign(sample_id<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>).<span class="bu">str</span>[<span class="dv">0</span>])</span>
<span id="cb158-7"><a aria-hidden="true" href="#cb158-7" tabindex="-1"></a>.merge(samples_info, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb158-8"><a aria-hidden="true" href="#cb158-8" tabindex="-1"></a> .replace({<span class="st">'Genus'</span>: {<span class="st">'Malasseziaceae_gen_Incertae_sedis'</span>: <span class="st">'Malasseziaceae'</span>}})</span>
<span id="cb158-9"><a aria-hidden="true" href="#cb158-9" tabindex="-1"></a>.assign(month<span class="op">=</span><span class="kw">lambda</span> dd: pd.to_datetime(dd.date).dt.month_name().fillna(<span class="st">'Blanks'</span>))</span>
<span id="cb158-10"><a aria-hidden="true" href="#cb158-10" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb158-11"><a aria-hidden="true" href="#cb158-11" tabindex="-1"></a>        np.where(dd.sample_mode.isna, </span>
<span id="cb158-12"><a aria-hidden="true" href="#cb158-12" tabindex="-1"></a>                 dd.sample_label.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb158-13"><a aria-hidden="true" href="#cb158-13" tabindex="-1"></a>                 dd.sample_mode))</span>
<span id="cb158-14"><a aria-hidden="true" href="#cb158-14" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_mode <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> dd.month)</span>
<span id="cb158-15"><a aria-hidden="true" href="#cb158-15" tabindex="-1"></a>.groupby([<span class="st">'sample_group_label'</span>, <span class="st">'sample_mode'</span>, <span class="st">'Genus'</span>])</span>
<span id="cb158-16"><a aria-hidden="true" href="#cb158-16" tabindex="-1"></a>.aggregate({<span class="st">'value'</span>: <span class="st">'mean'</span>})</span>
<span id="cb158-17"><a aria-hidden="true" href="#cb158-17" tabindex="-1"></a>.reset_index()</span>
<span id="cb158-18"><a aria-hidden="true" href="#cb158-18" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb158-19"><a aria-hidden="true" href="#cb158-19" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb158-20"><a aria-hidden="true" href="#cb158-20" tabindex="-1"></a>.assign(sample_group_label<span class="op">=</span><span class="kw">lambda</span> dd: pd.Categorical(dd.sample_group_label,</span>
<span id="cb158-21"><a aria-hidden="true" href="#cb158-21" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">'Flight Blanks'</span>, <span class="st">'Ground Blanks'</span>, <span class="st">'Flight February'</span>, <span class="st">'Ground February'</span>,</span>
<span id="cb158-22"><a aria-hidden="true" href="#cb158-22" tabindex="-1"></a>                    <span class="st">'Flight April'</span>, <span class="st">'Ground April'</span>], ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb158-23"><a aria-hidden="true" href="#cb158-23" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb158-24"><a aria-hidden="true" href="#cb158-24" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_group_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb158-25"><a aria-hidden="true" href="#cb158-25" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb158-26"><a aria-hidden="true" href="#cb158-26" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb158-27"><a aria-hidden="true" href="#cb158-27" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb158-28"><a aria-hidden="true" href="#cb158-28" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb158-29"><a aria-hidden="true" href="#cb158-29" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb158-30"><a aria-hidden="true" href="#cb158-30" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb158-31"><a aria-hidden="true" href="#cb158-31" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb158-32"><a aria-hidden="true" href="#cb158-32" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb158-33"><a aria-hidden="true" href="#cb158-33" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb158-34"><a aria-hidden="true" href="#cb158-34" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb158-35"><a aria-hidden="true" href="#cb158-35" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb158-36"><a aria-hidden="true" href="#cb158-36" tabindex="-1"></a>                 )</span>
<span id="cb158-37"><a aria-hidden="true" href="#cb158-37" tabindex="-1"></a>                  )</span>
<span id="cb158-38"><a aria-hidden="true" href="#cb158-38" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb158-39"><a aria-hidden="true" href="#cb158-39" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">3.75</span>, <span class="fl">7.5</span>),</span>
<span id="cb158-40"><a aria-hidden="true" href="#cb158-40" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb158-41"><a aria-hidden="true" href="#cb158-41" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb158-42"><a aria-hidden="true" href="#cb158-42" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb158-43"><a aria-hidden="true" href="#cb158-43" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb158-44"><a aria-hidden="true" href="#cb158-44" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb158-45"><a aria-hidden="true" href="#cb158-45" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb158-46"><a aria-hidden="true" href="#cb158-46" tabindex="-1"></a>       )</span>
<span id="cb158-47"><a aria-hidden="true" href="#cb158-47" tabindex="-1"></a> )</span>
<span id="cb158-48"><a aria-hidden="true" href="#cb158-48" tabindex="-1"></a>f.save(<span class="st">'../output/figures/blanks_top_30_genera_fun.svg'</span>)</span>
<span id="cb158-49"><a aria-hidden="true" href="#cb158-49" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="867">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-154-output-1.png" width="1125"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-194">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a aria-hidden="true" href="#cb159-1" tabindex="-1"></a>full_long_df <span class="op">=</span> (full_matrix_bac</span>
<span id="cb159-2"><a aria-hidden="true" href="#cb159-2" tabindex="-1"></a>                .reset_index()</span>
<span id="cb159-3"><a aria-hidden="true" href="#cb159-3" tabindex="-1"></a>                .melt(<span class="st">'sample_label'</span>, var_name<span class="op">=</span><span class="st">'Genus'</span>, value_name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb159-4"><a aria-hidden="true" href="#cb159-4" tabindex="-1"></a>)</span>
<span id="cb159-5"><a aria-hidden="true" href="#cb159-5" tabindex="-1"></a></span>
<span id="cb159-6"><a aria-hidden="true" href="#cb159-6" tabindex="-1"></a></span>
<span id="cb159-7"><a aria-hidden="true" href="#cb159-7" tabindex="-1"></a>top_30_genera_blanks <span class="op">=</span> (</span>
<span id="cb159-8"><a aria-hidden="true" href="#cb159-8" tabindex="-1"></a>    full_long_df</span>
<span id="cb159-9"><a aria-hidden="true" href="#cb159-9" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb159-10"><a aria-hidden="true" href="#cb159-10" tabindex="-1"></a>    .query(<span class="st">'sample_label.str.contains("Pool")'</span>)</span>
<span id="cb159-11"><a aria-hidden="true" href="#cb159-11" tabindex="-1"></a>    .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb159-12"><a aria-hidden="true" href="#cb159-12" tabindex="-1"></a>    [<span class="st">'value'</span>]</span>
<span id="cb159-13"><a aria-hidden="true" href="#cb159-13" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb159-14"><a aria-hidden="true" href="#cb159-14" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb159-15"><a aria-hidden="true" href="#cb159-15" tabindex="-1"></a>    .tail(<span class="dv">30</span>)</span>
<span id="cb159-16"><a aria-hidden="true" href="#cb159-16" tabindex="-1"></a>    .index</span>
<span id="cb159-17"><a aria-hidden="true" href="#cb159-17" tabindex="-1"></a>    .values</span>
<span id="cb159-18"><a aria-hidden="true" href="#cb159-18" tabindex="-1"></a>)</span>
<span id="cb159-19"><a aria-hidden="true" href="#cb159-19" tabindex="-1"></a></span>
<span id="cb159-20"><a aria-hidden="true" href="#cb159-20" tabindex="-1"></a>top_30_genera_samples <span class="op">=</span> (</span>
<span id="cb159-21"><a aria-hidden="true" href="#cb159-21" tabindex="-1"></a>    full_long_df</span>
<span id="cb159-22"><a aria-hidden="true" href="#cb159-22" tabindex="-1"></a>    .query(<span class="st">'Genus!="unknown"'</span>)</span>
<span id="cb159-23"><a aria-hidden="true" href="#cb159-23" tabindex="-1"></a>    .query(<span class="st">'sample_label.str.startswith("S")'</span>)</span>
<span id="cb159-24"><a aria-hidden="true" href="#cb159-24" tabindex="-1"></a>    .groupby(<span class="st">'Genus'</span>)</span>
<span id="cb159-25"><a aria-hidden="true" href="#cb159-25" tabindex="-1"></a>    [<span class="st">'value'</span>]</span>
<span id="cb159-26"><a aria-hidden="true" href="#cb159-26" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb159-27"><a aria-hidden="true" href="#cb159-27" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb159-28"><a aria-hidden="true" href="#cb159-28" tabindex="-1"></a>    .tail(<span class="dv">30</span>)</span>
<span id="cb159-29"><a aria-hidden="true" href="#cb159-29" tabindex="-1"></a>    .index</span>
<span id="cb159-30"><a aria-hidden="true" href="#cb159-30" tabindex="-1"></a>    .values</span>
<span id="cb159-31"><a aria-hidden="true" href="#cb159-31" tabindex="-1"></a>)</span>
<span id="cb159-32"><a aria-hidden="true" href="#cb159-32" tabindex="-1"></a>treshold <span class="op">=</span> <span class="fl">.0005</span></span>
<span id="cb159-33"><a aria-hidden="true" href="#cb159-33" tabindex="-1"></a>f <span class="op">=</span> (full_long_df </span>
<span id="cb159-34"><a aria-hidden="true" href="#cb159-34" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb159-35"><a aria-hidden="true" href="#cb159-35" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb159-36"><a aria-hidden="true" href="#cb159-36" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_samples, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb159-37"><a aria-hidden="true" href="#cb159-37" tabindex="-1"></a>.dropna()</span>
<span id="cb159-38"><a aria-hidden="true" href="#cb159-38" tabindex="-1"></a>.replace({<span class="st">'Allorhizobium-Neorhizobium-Pararhizobium-Rhizobium'</span>: <span class="st">'Rhizobium'</span>})</span>
<span id="cb159-39"><a aria-hidden="true" href="#cb159-39" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.sample_label.<span class="bu">str</span>.contains(<span class="st">'Flight'</span>), <span class="st">'Flight'</span>, <span class="st">'Ground'</span>))</span>
<span id="cb159-40"><a aria-hidden="true" href="#cb159-40" tabindex="-1"></a>.assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>))</span>
<span id="cb159-41"><a aria-hidden="true" href="#cb159-41" tabindex="-1"></a>.query(<span class="st">'value &gt; 0'</span>)</span>
<span id="cb159-42"><a aria-hidden="true" href="#cb159-42" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb159-43"><a aria-hidden="true" href="#cb159-43" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb159-44"><a aria-hidden="true" href="#cb159-44" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb159-45"><a aria-hidden="true" href="#cb159-45" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb159-46"><a aria-hidden="true" href="#cb159-46" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>,</span>
<span id="cb159-47"><a aria-hidden="true" href="#cb159-47" tabindex="-1"></a>                                  <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb159-48"><a aria-hidden="true" href="#cb159-48" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb159-49"><a aria-hidden="true" href="#cb159-49" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb159-50"><a aria-hidden="true" href="#cb159-50" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb159-51"><a aria-hidden="true" href="#cb159-51" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb159-52"><a aria-hidden="true" href="#cb159-52" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb159-53"><a aria-hidden="true" href="#cb159-53" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">4</span>))</span>
<span id="cb159-54"><a aria-hidden="true" href="#cb159-54" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb159-55"><a aria-hidden="true" href="#cb159-55" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">'Relative Abundance of Top 30 Genera in Samples'</span>,</span>
<span id="cb159-56"><a aria-hidden="true" href="#cb159-56" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb159-57"><a aria-hidden="true" href="#cb159-57" tabindex="-1"></a>                 )</span>
<span id="cb159-58"><a aria-hidden="true" href="#cb159-58" tabindex="-1"></a>                  )</span>
<span id="cb159-59"><a aria-hidden="true" href="#cb159-59" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb159-60"><a aria-hidden="true" href="#cb159-60" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">7.5</span>, <span class="fl">7.5</span>),</span>
<span id="cb159-61"><a aria-hidden="true" href="#cb159-61" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb159-62"><a aria-hidden="true" href="#cb159-62" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb159-63"><a aria-hidden="true" href="#cb159-63" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb159-64"><a aria-hidden="true" href="#cb159-64" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb159-65"><a aria-hidden="true" href="#cb159-65" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb159-66"><a aria-hidden="true" href="#cb159-66" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb159-67"><a aria-hidden="true" href="#cb159-67" tabindex="-1"></a>       )</span>
<span id="cb159-68"><a aria-hidden="true" href="#cb159-68" tabindex="-1"></a> )</span>
<span id="cb159-69"><a aria-hidden="true" href="#cb159-69" tabindex="-1"></a>f.save(<span class="st">'../output/figures/top_genera_samples.svg'</span>)</span>
<span id="cb159-70"><a aria-hidden="true" href="#cb159-70" tabindex="-1"></a>f.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="520">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-155-output-1.png" width="2250"/></p>
</figure>
</div>
</div>
</div>
<div class="cell" id="cell-195">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a aria-hidden="true" href="#cb160-1" tabindex="-1"></a></span>
<span id="cb160-2"><a aria-hidden="true" href="#cb160-2" tabindex="-1"></a>g <span class="op">=</span> (full_long_df </span>
<span id="cb160-3"><a aria-hidden="true" href="#cb160-3" tabindex="-1"></a> .query(<span class="st">'Genus.notna()'</span>)</span>
<span id="cb160-4"><a aria-hidden="true" href="#cb160-4" tabindex="-1"></a>.assign(Genus<span class="op">=</span><span class="kw">lambda</span> dd: </span>
<span id="cb160-5"><a aria-hidden="true" href="#cb160-5" tabindex="-1"></a>        pd.Categorical(dd.Genus, categories<span class="op">=</span>top_30_genera_blanks, ordered<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb160-6"><a aria-hidden="true" href="#cb160-6" tabindex="-1"></a>.dropna()</span>
<span id="cb160-7"><a aria-hidden="true" href="#cb160-7" tabindex="-1"></a>.replace({<span class="st">'Burkholderia-Caballeronia-Paraburkholderia'</span>: <span class="st">'Burkholderia-Caballeronia'</span>})</span>
<span id="cb160-8"><a aria-hidden="true" href="#cb160-8" tabindex="-1"></a>.assign(sample_mode<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.sample_label.<span class="bu">str</span>.contains(<span class="st">'Flight'</span>), <span class="st">'Flight'</span>, <span class="st">'Ground'</span>))</span>
<span id="cb160-9"><a aria-hidden="true" href="#cb160-9" tabindex="-1"></a>.assign(sample_label<span class="op">=</span><span class="kw">lambda</span> dd: dd.sample_label.<span class="bu">str</span>.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>))</span>
<span id="cb160-10"><a aria-hidden="true" href="#cb160-10" tabindex="-1"></a>.assign(value<span class="op">=</span><span class="kw">lambda</span> dd: np.where(dd.value <span class="op">&lt;</span> treshold, treshold, dd.value))</span>
<span id="cb160-11"><a aria-hidden="true" href="#cb160-11" tabindex="-1"></a></span>
<span id="cb160-12"><a aria-hidden="true" href="#cb160-12" tabindex="-1"></a> .pipe(<span class="kw">lambda</span> dd: p9.ggplot(dd)</span>
<span id="cb160-13"><a aria-hidden="true" href="#cb160-13" tabindex="-1"></a>       <span class="op">+</span> p9.aes(<span class="st">'sample_label'</span>, <span class="st">'Genus'</span>, size<span class="op">=</span><span class="st">'value'</span>, fill<span class="op">=</span><span class="st">'sample_mode'</span>)</span>
<span id="cb160-14"><a aria-hidden="true" href="#cb160-14" tabindex="-1"></a>       <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">.8</span>, stroke<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb160-15"><a aria-hidden="true" href="#cb160-15" tabindex="-1"></a>       <span class="op">+</span> p9.scale_size_continuous(trans<span class="op">=</span><span class="st">'log10'</span>, <span class="bu">range</span><span class="op">=</span>(<span class="dv">1</span>, <span class="dv">9</span>),</span>
<span id="cb160-16"><a aria-hidden="true" href="#cb160-16" tabindex="-1"></a>                                  labels<span class="op">=</span>percent_format(), </span>
<span id="cb160-17"><a aria-hidden="true" href="#cb160-17" tabindex="-1"></a>                                  limits<span class="op">=</span>(treshold <span class="op">-</span> <span class="fl">1e-5</span>, <span class="fl">.9</span>),</span>
<span id="cb160-18"><a aria-hidden="true" href="#cb160-18" tabindex="-1"></a>                                  breaks<span class="op">=</span>[<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.5</span>])</span>
<span id="cb160-19"><a aria-hidden="true" href="#cb160-19" tabindex="-1"></a>       <span class="op">+</span> p9.scale_y_discrete(expand<span class="op">=</span>(<span class="fl">.035</span>, <span class="fl">.035</span>))</span>
<span id="cb160-20"><a aria-hidden="true" href="#cb160-20" tabindex="-1"></a>       <span class="op">+</span> p9.scale_fill_manual(values<span class="op">=</span>[<span class="st">'#D3894C'</span>, <span class="st">'#435B97'</span>])</span>
<span id="cb160-21"><a aria-hidden="true" href="#cb160-21" tabindex="-1"></a>       <span class="op">+</span> p9.guides(size<span class="op">=</span>p9.guide_legend(ncol<span class="op">=</span><span class="dv">4</span>))</span>
<span id="cb160-22"><a aria-hidden="true" href="#cb160-22" tabindex="-1"></a>       <span class="op">+</span> p9.labs(x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">''</span>, size<span class="op">=</span><span class="st">'Relative Abundance'</span>, color<span class="op">=</span><span class="st">'Class'</span>,</span>
<span id="cb160-23"><a aria-hidden="true" href="#cb160-23" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">'Relative Abundance of Top 30 Genera in Blanks'</span>,</span>
<span id="cb160-24"><a aria-hidden="true" href="#cb160-24" tabindex="-1"></a>                 fill<span class="op">=</span><span class="st">''</span></span>
<span id="cb160-25"><a aria-hidden="true" href="#cb160-25" tabindex="-1"></a>                 )</span>
<span id="cb160-26"><a aria-hidden="true" href="#cb160-26" tabindex="-1"></a>                  )</span>
<span id="cb160-27"><a aria-hidden="true" href="#cb160-27" tabindex="-1"></a>       <span class="op">+</span> p9.annotate(geom<span class="op">=</span><span class="st">'vline'</span>, linetype<span class="op">=</span><span class="st">'dashed'</span>, xintercept<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">'grey'</span>)</span>
<span id="cb160-28"><a aria-hidden="true" href="#cb160-28" tabindex="-1"></a>       <span class="op">+</span> p9.theme(figure_size<span class="op">=</span>(<span class="fl">6.75</span>, <span class="fl">7.5</span>),</span>
<span id="cb160-29"><a aria-hidden="true" href="#cb160-29" tabindex="-1"></a>                  strip_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb160-30"><a aria-hidden="true" href="#cb160-30" tabindex="-1"></a>                  axis_text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb160-31"><a aria-hidden="true" href="#cb160-31" tabindex="-1"></a>                  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb160-32"><a aria-hidden="true" href="#cb160-32" tabindex="-1"></a>                  title<span class="op">=</span>p9.element_text(ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb160-33"><a aria-hidden="true" href="#cb160-33" tabindex="-1"></a>                  legend_title<span class="op">=</span>p9.element_text(x<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb160-34"><a aria-hidden="true" href="#cb160-34" tabindex="-1"></a>                  axis_text_x<span class="op">=</span>p9element_text(angle<span class="op">=</span><span class="dv">90</span>),</span>
<span id="cb160-35"><a aria-hidden="true" href="#cb160-35" tabindex="-1"></a>       )</span>
<span id="cb160-36"><a aria-hidden="true" href="#cb160-36" tabindex="-1"></a> )</span>
<span id="cb160-37"><a aria-hidden="true" href="#cb160-37" tabindex="-1"></a>g.save(<span class="st">'../output/figures/top_genera_blanks.svg'</span>)</span>
<span id="cb160-38"><a aria-hidden="true" href="#cb160-38" tabindex="-1"></a>g.draw()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="521">
<div>
<figure class="figure">
<p><img class="figure-img" height="2250" src="microbial_diversity_analysis_files/figure-html/cell-156-output-1.png" width="2025"/></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>